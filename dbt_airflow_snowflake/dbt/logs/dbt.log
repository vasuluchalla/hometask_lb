[0m05:10:01.335356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143894f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1438bcf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1438bd610>]}


============================== 05:10:01.338926 | 409fa6b4-db2f-4cf4-aa1d-51004ebb2fdd ==============================
[0m05:10:01.338926 [info ] [MainThread]: Running with dbt=1.8.0
[0m05:10:01.339214 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:10:01.348192 [info ] [MainThread]: dbt version: 1.8.0
[0m05:10:01.348485 [info ] [MainThread]: python version: 3.11.9
[0m05:10:01.348619 [info ] [MainThread]: python path: /opt/homebrew/opt/python@3.11/bin/python3.11
[0m05:10:01.348737 [info ] [MainThread]: os info: macOS-14.1-arm64-arm-64bit
[0m05:10:01.966565 [info ] [MainThread]: Using profiles dir at /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt
[0m05:10:01.966856 [info ] [MainThread]: Using profiles.yml file at /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/profiles.yml
[0m05:10:01.966985 [info ] [MainThread]: Using dbt_project.yml file at /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_project.yml
[0m05:10:01.967365 [info ] [MainThread]: adapter type: snowflake
[0m05:10:01.967534 [info ] [MainThread]: adapter version: 1.8.3
[0m05:10:01.998106 [info ] [MainThread]: Configuration:
[0m05:10:01.998411 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m05:10:01.998553 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m05:10:01.998672 [info ] [MainThread]: Required dependencies:
[0m05:10:01.998833 [debug] [MainThread]: Executing "git --help"
[0m05:10:02.007186 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m05:10:02.007631 [debug] [MainThread]: STDERR: "b''"
[0m05:10:02.007780 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m05:10:02.007939 [info ] [MainThread]: Connection:
[0m05:10:02.008086 [info ] [MainThread]:   account: oh95089.eu-central-1
[0m05:10:02.008192 [info ] [MainThread]:   user: DBT_USER
[0m05:10:02.008293 [info ] [MainThread]:   database: DBT_DEV_DB
[0m05:10:02.008397 [info ] [MainThread]:   warehouse: DBT_WH
[0m05:10:02.008491 [info ] [MainThread]:   role: DBT_ROLE
[0m05:10:02.008586 [info ] [MainThread]:   schema: LB_SCHEMA
[0m05:10:02.008684 [info ] [MainThread]:   authenticator: None
[0m05:10:02.008780 [info ] [MainThread]:   oauth_client_id: None
[0m05:10:02.008878 [info ] [MainThread]:   query_tag: None
[0m05:10:02.008977 [info ] [MainThread]:   client_session_keep_alive: False
[0m05:10:02.009075 [info ] [MainThread]:   host: None
[0m05:10:02.009171 [info ] [MainThread]:   port: None
[0m05:10:02.009265 [info ] [MainThread]:   proxy_host: None
[0m05:10:02.009364 [info ] [MainThread]:   proxy_port: None
[0m05:10:02.009460 [info ] [MainThread]:   protocol: None
[0m05:10:02.009552 [info ] [MainThread]:   connect_retries: 1
[0m05:10:02.009645 [info ] [MainThread]:   connect_timeout: None
[0m05:10:02.009738 [info ] [MainThread]:   retry_on_database_errors: False
[0m05:10:02.009830 [info ] [MainThread]:   retry_all: False
[0m05:10:02.009923 [info ] [MainThread]:   insecure_mode: False
[0m05:10:02.010016 [info ] [MainThread]:   reuse_connections: None
[0m05:10:02.010278 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m05:10:02.051936 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m05:10:02.053838 [debug] [MainThread]: Using snowflake connection "debug"
[0m05:10:02.054039 [debug] [MainThread]: On debug: select 1 as id
[0m05:10:02.054175 [debug] [MainThread]: Opening a new connection, currently in state init
[0m05:10:03.018651 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.964 seconds
[0m05:10:03.021239 [debug] [MainThread]: On debug: Close
[0m05:10:03.214811 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m05:10:03.216060 [info ] [MainThread]: [32mAll checks passed![0m
[0m05:10:03.254413 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.9680816, "process_user_time": 1.747557, "process_kernel_time": 2.275102, "process_mem_max_rss": "191201280", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m05:10:03.254841 [debug] [MainThread]: Command `dbt debug` succeeded at 05:10:03.254786 after 1.97 seconds
[0m05:10:03.255015 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m05:10:03.255174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14387bb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1691f9ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100c86cd0>]}
[0m05:10:03.255356 [debug] [MainThread]: Flushing usage events
[0m05:10:12.571231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122b97a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122b57b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122b96cd0>]}


============================== 05:10:12.573808 | 702f77b4-fde3-4900-a546-a26c70a839da ==============================
[0m05:10:12.573808 [info ] [MainThread]: Running with dbt=1.8.0
[0m05:10:12.574088 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:10:13.250482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a85e9d0>]}
[0m05:10:13.268426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1226009d0>]}
[0m05:10:13.268951 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m05:10:13.279240 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m05:10:13.279697 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m05:10:13.279880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a8dfdd0>]}
[0m05:10:13.785503 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m05:10:13.785769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae8b310>]}
[0m05:10:13.858091 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.snowflake_airflow_dbt.transform
- models.snowflake_airflow_dbt.analysis
[0m05:10:13.862776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ad9e390>]}
[0m05:10:13.910017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b14b110>]}
[0m05:10:13.910468 [info ] [MainThread]: Found 3 models, 3 seeds, 5 data tests, 3 sources, 448 macros
[0m05:10:13.910614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b123750>]}
[0m05:10:13.911434 [info ] [MainThread]: 
[0m05:10:13.911661 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m05:10:13.913440 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_DBT_DEV_DB'
[0m05:10:13.918775 [debug] [ThreadPool]: Using snowflake connection "list_DBT_DEV_DB"
[0m05:10:13.918981 [debug] [ThreadPool]: On list_DBT_DEV_DB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_DBT_DEV_DB"} */
show terse schemas in database DBT_DEV_DB
    limit 10000
[0m05:10:13.919107 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:10:14.940500 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.021 seconds
[0m05:10:14.942543 [debug] [ThreadPool]: On list_DBT_DEV_DB: Close
[0m05:10:15.087076 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_DBT_DEV_DB, now list_DBT_DEV_DB_LB_SCHEMA)
[0m05:10:15.099167 [debug] [ThreadPool]: Using snowflake connection "list_DBT_DEV_DB_LB_SCHEMA"
[0m05:10:15.099582 [debug] [ThreadPool]: On list_DBT_DEV_DB_LB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_DBT_DEV_DB_LB_SCHEMA"} */
show objects in DBT_DEV_DB.LB_SCHEMA limit 10000
[0m05:10:15.099881 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m05:10:15.872654 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.773 seconds
[0m05:10:15.875910 [debug] [ThreadPool]: On list_DBT_DEV_DB_LB_SCHEMA: Close
[0m05:10:16.039639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2e5e50>]}
[0m05:10:16.040107 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m05:10:16.040301 [info ] [MainThread]: 
[0m05:10:16.042472 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m05:10:16.042802 [info ] [Thread-1 (]: 1 of 3 START sql view model LB_SCHEMA.stg_contract ............................. [RUN]
[0m05:10:16.043051 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_DBT_DEV_DB_LB_SCHEMA, now model.snowflake_airflow_dbt.stg_contract)
[0m05:10:16.043222 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m05:10:16.047793 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m05:10:16.048367 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m05:10:16.052276 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m05:10:16.052579 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m05:10:16.052736 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:10:16.610371 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.553 seconds
[0m05:10:16.619372 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m05:10:16.620692 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m05:10:16.621172 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m05:10:16.747538 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.126 seconds
[0m05:10:16.773094 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m05:10:16.774441 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m05:10:16.774598 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view DBT_DEV_DB.LB_SCHEMA.stg_contract
  
   as (
    SELECT
    id ,
    energy_type ,
    energy_subtype ,
    consumption,
    consumption_previous ,
    contract_date ,
    start_date  ,
    end_date ,
    cancellation_date,
    cancellation_reason ,
    city,
    status,
    productid,
    modificationdate
FROM DBT_DEV_DB.RAW.contract
  );
[0m05:10:17.511471 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.737 seconds
[0m05:10:17.532797 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m05:10:17.666010 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b5a3250>]}
[0m05:10:17.667632 [info ] [Thread-1 (]: 1 of 3 OK created sql view model LB_SCHEMA.stg_contract ........................ [[32mSUCCESS 1[0m in 1.62s]
[0m05:10:17.668877 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m05:10:17.669704 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_price
[0m05:10:17.670686 [info ] [Thread-1 (]: 2 of 3 START sql view model LB_SCHEMA.stg_price ................................ [RUN]
[0m05:10:17.671428 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_price)
[0m05:10:17.671963 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_price
[0m05:10:17.677297 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_price"
[0m05:10:17.678288 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_price
[0m05:10:17.681084 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_price"
[0m05:10:17.681467 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_price: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_price"} */
show parameters like 'query_tag' in session
[0m05:10:17.681798 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:10:18.307522 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.625 seconds
[0m05:10:18.310544 [debug] [Thread-1 (]: Setting query_tag to 'stg_price'. Will reset to '' after materialization.
[0m05:10:18.311776 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_price"
[0m05:10:18.312340 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_price: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_price"} */
alter session set query_tag = 'stg_price'
[0m05:10:18.492551 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.179 seconds
[0m05:10:18.496263 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_price"
[0m05:10:18.498680 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_price"
[0m05:10:18.499314 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_price: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_price"} */
create or replace   view DBT_DEV_DB.LB_SCHEMA.stg_price
  
   as (
    SELECT
    id::integer AS bank_id,
    productid 
    account_number::integer AS account_number,
    pricecomponentid,
    productcomponent ,
    price ,
    unit ,
    valid_from  ,
    valid_until ,
    modificationdate,
FROM DBT_DEV_DB.RAW.price
  );
[0m05:10:18.692926 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b585be-0202-cf6c-0000-0002d44660c5
[0m05:10:18.693243 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 7 at position 18 unexpected '::'.
[0m05:10:18.693542 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_price: Close
[0m05:10:18.826339 [debug] [Thread-1 (]: Database Error in model stg_price (models/staging/stg_price.sql)
  001003 (42000): SQL compilation error:
  syntax error line 7 at position 18 unexpected '::'.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/stg_price.sql
[0m05:10:18.827655 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b4db3d0>]}
[0m05:10:18.828612 [error] [Thread-1 (]: 2 of 3 ERROR creating sql view model LB_SCHEMA.stg_price ....................... [[31mERROR[0m in 1.16s]
[0m05:10:18.829592 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_price
[0m05:10:18.830128 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_product
[0m05:10:18.831695 [info ] [Thread-1 (]: 3 of 3 START sql view model LB_SCHEMA.stg_product .............................. [RUN]
[0m05:10:18.832258 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_price, now model.snowflake_airflow_dbt.stg_product)
[0m05:10:18.832641 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_product
[0m05:10:18.835960 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_product"
[0m05:10:18.836746 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_product
[0m05:10:18.838866 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_product"
[0m05:10:18.839173 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_product"} */
show parameters like 'query_tag' in session
[0m05:10:18.839441 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m05:10:19.417515 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.578 seconds
[0m05:10:19.420801 [debug] [Thread-1 (]: Setting query_tag to 'stg_product'. Will reset to '' after materialization.
[0m05:10:19.421703 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_product"
[0m05:10:19.422230 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_product"} */
alter session set query_tag = 'stg_product'
[0m05:10:19.541662 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.119 seconds
[0m05:10:19.545344 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_product"
[0m05:10:19.547196 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_product"
[0m05:10:19.547809 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_product"} */
create or replace   view DBT_DEV_DB.LB_SCHEMA.stg_product
  
   as (
    SELECT
    id INTEGER ,
    productcode ,
    productname ,
    energy ,
    consumptiontype ,
    deleted,
    modificationdate 
FROM DBT_DEV_DB.RAW.product
contract
  );
[0m05:10:19.847985 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.299 seconds
[0m05:10:19.851739 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_product: Close
[0m05:10:20.065829 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '702f77b4-fde3-4900-a546-a26c70a839da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16af79f50>]}
[0m05:10:20.066662 [info ] [Thread-1 (]: 3 of 3 OK created sql view model LB_SCHEMA.stg_product ......................... [[32mSUCCESS 1[0m in 1.23s]
[0m05:10:20.067276 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_product
[0m05:10:20.070979 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:10:20.071397 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_product' was properly closed.
[0m05:10:20.072521 [info ] [MainThread]: 
[0m05:10:20.073121 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 6.16 seconds (6.16s).
[0m05:10:20.074256 [debug] [MainThread]: Command end result
[0m05:10:20.096706 [info ] [MainThread]: 
[0m05:10:20.097070 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m05:10:20.097214 [info ] [MainThread]: 
[0m05:10:20.097392 [error] [MainThread]:   Database Error in model stg_price (models/staging/stg_price.sql)
  001003 (42000): SQL compilation error:
  syntax error line 7 at position 18 unexpected '::'.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/stg_price.sql
[0m05:10:20.097534 [info ] [MainThread]: 
[0m05:10:20.097671 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m05:10:20.100039 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.5607557, "process_user_time": 2.65813, "process_kernel_time": 1.304148, "process_mem_max_rss": "201981952", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m05:10:20.100542 [debug] [MainThread]: Command `dbt run` failed at 05:10:20.100503 after 7.56 seconds
[0m05:10:20.100897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10235ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122bb5350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102369650>]}
[0m05:10:20.101067 [debug] [MainThread]: Flushing usage events
[0m13:05:18.980225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fc95e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fcbd0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fcbd750>]}


============================== 13:05:18.983127 | 4b9cb013-fe9e-488d-8532-408d071a451d ==============================
[0m13:05:18.983127 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:05:18.983386 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:05:19.937330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4b9cb013-fe9e-488d-8532-408d071a451d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1630bd250>]}
[0m13:05:19.956808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4b9cb013-fe9e-488d-8532-408d071a451d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f500ad0>]}
[0m13:05:19.957468 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:05:20.007549 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:05:20.053015 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m13:05:20.053329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4b9cb013-fe9e-488d-8532-408d071a451d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e52eb10>]}
[0m13:05:20.585194 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m13:05:20.585528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '4b9cb013-fe9e-488d-8532-408d071a451d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167a95990>]}
[0m13:05:20.636534 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_contract' (models/marts/fact_contract.sql) depends on a source named 'raw.price' which was not found
[0m13:05:20.670045 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.7184305, "process_user_time": 2.2123, "process_kernel_time": 2.554001, "process_mem_max_rss": "185876480", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:05:20.670503 [debug] [MainThread]: Command `dbt run` failed at 13:05:20.670444 after 1.72 seconds
[0m13:05:20.670758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fc5a050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104652d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167bf8e90>]}
[0m13:05:20.670978 [debug] [MainThread]: Flushing usage events
[0m13:06:23.467645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d5a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d43c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d5a9d0>]}


============================== 13:06:23.473059 | 0ff00f38-0619-4fff-94ed-be66f48faca7 ==============================
[0m13:06:23.473059 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:06:23.473902 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:06:24.314042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0ff00f38-0619-4fff-94ed-be66f48faca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1444c1810>]}
[0m13:06:24.347186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0ff00f38-0619-4fff-94ed-be66f48faca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17283e390>]}
[0m13:06:24.348611 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:06:24.363475 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:06:24.421091 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m13:06:24.421445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0ff00f38-0619-4fff-94ed-be66f48faca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124b32b50>]}
[0m13:06:24.952022 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m13:06:24.952331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0ff00f38-0619-4fff-94ed-be66f48faca7', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x177ed8290>]}
[0m13:06:25.023588 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m13:06:25.028639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0ff00f38-0619-4fff-94ed-be66f48faca7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x173fac550>]}
[0m13:06:25.105423 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.dim_product
[0m13:06:25.108328 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.dim_product

[0m13:06:25.110108 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6841804, "process_user_time": 2.73198, "process_kernel_time": 1.358324, "process_mem_max_rss": "191741952", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:06:25.110401 [debug] [MainThread]: Command `dbt run` failed at 13:06:25.110355 after 1.68 seconds
[0m13:06:25.110603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d5b110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1025ded90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x280532090>]}
[0m13:06:25.110787 [debug] [MainThread]: Flushing usage events
[0m14:54:37.321632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe56dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe97bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12feb5c90>]}


============================== 14:54:37.323961 | 5145ffbb-6440-42a4-a8cc-dfa05eccc081 ==============================
[0m14:54:37.323961 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:54:37.324215 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:54:38.710285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5145ffbb-6440-42a4-a8cc-dfa05eccc081', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x162224ed0>]}
[0m14:54:38.728446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5145ffbb-6440-42a4-a8cc-dfa05eccc081', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c7ef8d0>]}
[0m14:54:38.728972 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:54:38.779926 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:54:38.841799 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m14:54:38.842261 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/_stg_sources.yml
[0m14:54:38.842407 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_product.sql
[0m14:54:38.842531 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_price.sql
[0m14:54:38.842657 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:54:38.989227 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m14:54:38.989530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '5145ffbb-6440-42a4-a8cc-dfa05eccc081', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167756e90>]}
[0m14:54:39.023778 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/staging/stg_contract.sql) depends on a source named 'app.contracts' which was not found
[0m14:54:39.063260 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.7698433, "process_user_time": 1.878539, "process_kernel_time": 2.512295, "process_mem_max_rss": "186368000", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:54:39.063611 [debug] [MainThread]: Command `dbt run` failed at 14:54:39.063564 after 1.77 seconds
[0m14:54:39.063789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12feb5090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10431ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104398090>]}
[0m14:54:39.063960 [debug] [MainThread]: Flushing usage events
[0m14:54:59.276739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16841bad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16847d250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16847d890>]}


============================== 14:54:59.279664 | d0a594e9-a559-465f-b18c-07b079aec7e7 ==============================
[0m14:54:59.279664 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:54:59.280009 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:54:59.960665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd0a594e9-a559-465f-b18c-07b079aec7e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126df1610>]}
[0m14:54:59.981771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd0a594e9-a559-465f-b18c-07b079aec7e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127d00910>]}
[0m14:54:59.982515 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:54:59.995014 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:55:00.127194 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m14:55:00.127966 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/_stg_sources.yml
[0m14:55:00.128151 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_product.sql
[0m14:55:00.128293 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_price.sql
[0m14:55:00.128424 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:55:00.390398 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m14:55:00.390738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd0a594e9-a559-465f-b18c-07b079aec7e7', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e460150>]}
[0m14:55:00.463514 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m14:55:00.469669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd0a594e9-a559-465f-b18c-07b079aec7e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e23d550>]}
[0m14:55:00.534430 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.dim_product
[0m14:55:00.536612 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.dim_product

[0m14:55:00.538359 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.2959895, "process_user_time": 2.221609, "process_kernel_time": 2.077613, "process_mem_max_rss": "184287232", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:55:00.538609 [debug] [MainThread]: Command `dbt run` failed at 14:55:00.538569 after 1.30 seconds
[0m14:55:00.538775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168460150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053bed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fdfe590>]}
[0m14:55:00.538929 [debug] [MainThread]: Flushing usage events
[0m14:55:53.080957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c497290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c4b92d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c4b9950>]}


============================== 14:55:53.083593 | f20b75b4-8381-4785-b2f0-88c1c23f641c ==============================
[0m14:55:53.083593 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:55:53.083873 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:55:53.825381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f20b75b4-8381-4785-b2f0-88c1c23f641c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c48a510>]}
[0m14:55:53.851176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f20b75b4-8381-4785-b2f0-88c1c23f641c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16befca10>]}
[0m14:55:53.851813 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:55:53.865333 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:55:53.928130 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m14:55:53.928600 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/_stg_sources.yml
[0m14:55:53.928778 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:55:54.153146 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m14:55:54.157887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f20b75b4-8381-4785-b2f0-88c1c23f641c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x170d6e950>]}
[0m14:55:54.201282 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.dim_product
[0m14:55:54.203575 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.dim_product

[0m14:55:54.205833 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1548028, "process_user_time": 1.711832, "process_kernel_time": 2.476074, "process_mem_max_rss": "184385536", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:55:54.206121 [debug] [MainThread]: Command `dbt run` failed at 14:55:54.206075 after 1.16 seconds
[0m14:55:54.206311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100e3ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c4bb050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f38690>]}
[0m14:55:54.206478 [debug] [MainThread]: Flushing usage events
[0m14:58:08.265538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126e5ab90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126ebd410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126ebda50>]}


============================== 14:58:08.268422 | 112a3e3d-d894-4b5b-b8e7-864090bd7a5b ==============================
[0m14:58:08.268422 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:58:08.268738 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:58:09.009272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '112a3e3d-d894-4b5b-b8e7-864090bd7a5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126edb850>]}
[0m14:58:09.029171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '112a3e3d-d894-4b5b-b8e7-864090bd7a5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1268fca10>]}
[0m14:58:09.029784 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:58:09.041210 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:58:09.124131 [debug] [MainThread]: Partial parsing enabled: 5 files deleted, 3 files added, 0 files changed.
[0m14:58:09.124443 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m14:58:09.124599 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/_stg_models.yml
[0m14:58:09.124738 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/_stg_sources.yml
[0m14:58:09.124945 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:58:09.125059 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_product.sql
[0m14:58:09.125170 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_price.sql
[0m14:58:09.288407 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_contract' (models/marts/fact_contract.sql) depends on a node named 'stg_price' which was not found
[0m14:58:09.290353 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0571929, "process_user_time": 1.825026, "process_kernel_time": 2.284346, "process_mem_max_rss": "186925056", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:58:09.290639 [debug] [MainThread]: Command `dbt run` failed at 14:58:09.290595 after 1.06 seconds
[0m14:58:09.290818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1004bed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1007c01d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1007c00d0>]}
[0m14:58:09.290982 [debug] [MainThread]: Flushing usage events
[0m14:58:44.814645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1452f0a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1457b55d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1457b5bd0>]}


============================== 14:58:44.818467 | 3403bc8f-4ece-405f-a1fe-2167a25fcb5e ==============================
[0m14:58:44.818467 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:58:44.818774 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:58:45.720757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3403bc8f-4ece-405f-a1fe-2167a25fcb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1457b5b50>]}
[0m14:58:45.738896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3403bc8f-4ece-405f-a1fe-2167a25fcb5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145000ad0>]}
[0m14:58:45.739384 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:58:45.755855 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:58:45.814123 [debug] [MainThread]: Partial parsing enabled: 5 files deleted, 3 files added, 0 files changed.
[0m14:58:45.814414 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/_stg_sources.yml
[0m14:58:45.814557 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m14:58:45.814688 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/_stg_models.yml
[0m14:58:45.814869 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_product.sql
[0m14:58:45.815008 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:58:45.815111 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_price.sql
[0m14:58:45.958275 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_contract' (models/marts/fact_contract.sql) depends on a node named 'stg_price' which was not found
[0m14:58:45.960007 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1761793, "process_user_time": 1.66963, "process_kernel_time": 2.215814, "process_mem_max_rss": "194002944", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:58:45.960255 [debug] [MainThread]: Command `dbt run` failed at 14:58:45.960218 after 1.18 seconds
[0m14:58:45.960414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102bbed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155feb410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c38090>]}
[0m14:58:45.960567 [debug] [MainThread]: Flushing usage events
[0m14:59:02.371849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd5b290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd81590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd81bd0>]}


============================== 14:59:02.374286 | c4b7dc8f-bca2-4296-9386-a153995bb544 ==============================
[0m14:59:02.374286 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:59:02.374567 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:59:02.960081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c4b7dc8f-bca2-4296-9386-a153995bb544', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1334d2f90>]}
[0m14:59:02.977942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c4b7dc8f-bca2-4296-9386-a153995bb544', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d6009d0>]}
[0m14:59:02.978455 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:59:02.988947 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:59:03.040211 [debug] [MainThread]: Partial parsing enabled: 5 files deleted, 3 files added, 0 files changed.
[0m14:59:03.040506 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/_stg_models.yml
[0m14:59:03.040648 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m14:59:03.040786 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/_stg_sources.yml
[0m14:59:03.041003 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:59:03.041125 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_price.sql
[0m14:59:03.041232 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_product.sql
[0m14:59:03.183575 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_contract' (models/marts/fact_contract.sql) depends on a node named 'stg_price' which was not found
[0m14:59:03.185430 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.84175384, "process_user_time": 1.679582, "process_kernel_time": 2.486965, "process_mem_max_rss": "191561728", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:59:03.185709 [debug] [MainThread]: Command `dbt run` failed at 14:59:03.185668 after 0.84 seconds
[0m14:59:03.185876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10027ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133847ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1002f4090>]}
[0m14:59:03.186033 [debug] [MainThread]: Flushing usage events
[0m14:59:37.294484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13de1b450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13de1a950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13de5acd0>]}


============================== 14:59:37.297171 | 50b79a8c-a476-4d23-a099-677597020a85 ==============================
[0m14:59:37.297171 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:59:37.297466 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:59:37.947792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '50b79a8c-a476-4d23-a099-677597020a85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a8fb6d0>]}
[0m14:59:37.969142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '50b79a8c-a476-4d23-a099-677597020a85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d700990>]}
[0m14:59:37.969977 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:59:37.982888 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:59:38.041047 [debug] [MainThread]: Partial parsing enabled: 8 files deleted, 3 files added, 0 files changed.
[0m14:59:38.041392 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/_stg_models.yml
[0m14:59:38.041561 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/_stg_sources.yml
[0m14:59:38.041697 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m14:59:38.041893 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/marts/dim_date.sql
[0m14:59:38.042015 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:59:38.042125 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_price.sql
[0m14:59:38.042232 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/marts/dim_product.sql
[0m14:59:38.042332 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/marts/fact_contract.sql
[0m14:59:38.042432 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_product.sql
[0m14:59:38.236280 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m14:59:38.242550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '50b79a8c-a476-4d23-a099-677597020a85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a9e8b90>]}
[0m14:59:38.293756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '50b79a8c-a476-4d23-a099-677597020a85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abf6310>]}
[0m14:59:38.294030 [info ] [MainThread]: Found 3 seeds, 1 model, 1 source, 448 macros
[0m14:59:38.294180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '50b79a8c-a476-4d23-a099-677597020a85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae210d0>]}
[0m14:59:38.294962 [info ] [MainThread]: 
[0m14:59:38.295248 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:59:38.295653 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_DBT_DEV_DB'
[0m14:59:38.301194 [debug] [ThreadPool]: Using snowflake connection "list_DBT_DEV_DB"
[0m14:59:38.301369 [debug] [ThreadPool]: On list_DBT_DEV_DB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_DBT_DEV_DB"} */
show terse schemas in database DBT_DEV_DB
    limit 10000
[0m14:59:38.301499 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:38.688400 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_DBT_DEV_DB"} */
show terse schemas in database DBT_DEV_DB
    limit 10000
[0m14:59:38.688737 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m14:59:38.689099 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_schemas
[0m14:59:38.689394 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m14:59:38.689776 [debug] [ThreadPool]: On list_DBT_DEV_DB: No close available on handle
[0m14:59:38.690320 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:59:38.690547 [debug] [MainThread]: Connection 'list_DBT_DEV_DB' was properly closed.
[0m14:59:38.690743 [info ] [MainThread]: 
[0m14:59:38.691049 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.40 seconds (0.40s).
[0m14:59:38.691464 [error] [MainThread]: Encountered an error:
Runtime Error
  Database error while listing schemas in database "DBT_DEV_DB"
  Database Error
    250001 (08001): Failed to connect to DB: oh95089.eu-central-1.snowflakecomputing.com:443. Incorrect username or password was specified.
[0m14:59:38.693518 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4287354, "process_user_time": 1.757592, "process_kernel_time": 2.44124, "process_mem_max_rss": "198377472", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:59:38.693902 [debug] [MainThread]: Command `dbt run` failed at 14:59:38.693835 after 1.43 seconds
[0m14:59:38.694161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10266ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13de83710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102768690>]}
[0m14:59:38.694409 [debug] [MainThread]: Flushing usage events
[0m15:01:09.015580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f42790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f78d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f5acd0>]}


============================== 15:01:09.018917 | b0cf377f-2029-4932-94f5-7228777b88a8 ==============================
[0m15:01:09.018917 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:01:09.019239 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m15:01:09.771718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b0cf377f-2029-4932-94f5-7228777b88a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a75e590>]}
[0m15:01:09.791365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b0cf377f-2029-4932-94f5-7228777b88a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120f00b50>]}
[0m15:01:09.792056 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:01:09.847911 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:01:09.918164 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m15:01:09.918533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b0cf377f-2029-4932-94f5-7228777b88a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f2ee10>]}
[0m15:01:10.544797 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:01:10.549433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b0cf377f-2029-4932-94f5-7228777b88a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16acab950>]}
[0m15:01:10.596519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b0cf377f-2029-4932-94f5-7228777b88a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae308d0>]}
[0m15:01:10.596844 [info ] [MainThread]: Found 1 model, 3 seeds, 1 source, 448 macros
[0m15:01:10.597008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0cf377f-2029-4932-94f5-7228777b88a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa46b90>]}
[0m15:01:10.597946 [info ] [MainThread]: 
[0m15:01:10.598285 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:01:10.598747 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:01:10.605054 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:01:10.605304 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:01:10.605489 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:01:11.151863 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.546 seconds
[0m15:01:11.154010 [debug] [ThreadPool]: On list_LB: Close
[0m15:01:11.368598 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_RAW)
[0m15:01:11.374747 [debug] [ThreadPool]: Using snowflake connection "list_LB_RAW"
[0m15:01:11.375058 [debug] [ThreadPool]: On list_LB_RAW: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_RAW"} */
show objects in LB.RAW limit 10000
[0m15:01:11.375198 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:01:12.568792 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.193 seconds
[0m15:01:12.571262 [debug] [ThreadPool]: On list_LB_RAW: Close
[0m15:01:12.697934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0cf377f-2029-4932-94f5-7228777b88a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ac14210>]}
[0m15:01:12.699427 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:01:12.700218 [info ] [MainThread]: 
[0m15:01:12.704085 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:01:12.704425 [info ] [Thread-1 (]: 1 of 1 START sql incremental model RAW.stg_contract ............................ [RUN]
[0m15:01:12.704665 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_RAW, now model.snowflake_airflow_dbt.stg_contract)
[0m15:01:12.704800 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:01:12.709210 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:01:12.709710 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:01:12.718923 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:01:12.719160 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:01:12.719301 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:01:13.570207 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.851 seconds
[0m15:01:13.572588 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:01:13.573602 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:01:13.574042 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:01:13.694207 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.120 seconds
[0m15:01:13.720924 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:01:13.722163 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:01:13.722419 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.RAW.stg_contract
         as
        (

with source as (
    select * from lb.raw.contracts
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental;
[0m15:01:14.238843 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58dad-0202-cf6b-0000-0002d4463619
[0m15:01:14.239460 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 28 at position 25 unexpected ';'.
[0m15:01:14.239927 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:01:14.342364 [debug] [Thread-1 (]: Database Error in model stg_contract (models/stage/stg_contract.sql)
  001003 (42000): SQL compilation error:
  syntax error line 28 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:01:14.343775 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0cf377f-2029-4932-94f5-7228777b88a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae19610>]}
[0m15:01:14.344302 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model RAW.stg_contract ................... [[31mERROR[0m in 1.64s]
[0m15:01:14.344777 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:01:14.346289 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:01:14.346498 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_contract' was properly closed.
[0m15:01:14.346656 [info ] [MainThread]: 
[0m15:01:14.346807 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.75 seconds (3.75s).
[0m15:01:14.347099 [debug] [MainThread]: Command end result
[0m15:01:14.369129 [info ] [MainThread]: 
[0m15:01:14.369623 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:01:14.369838 [info ] [MainThread]: 
[0m15:01:14.370061 [error] [MainThread]:   Database Error in model stg_contract (models/stage/stg_contract.sql)
  001003 (42000): SQL compilation error:
  syntax error line 28 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:01:14.370244 [info ] [MainThread]: 
[0m15:01:14.370644 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:01:14.373818 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.388906, "process_user_time": 3.088206, "process_kernel_time": 0.590136, "process_mem_max_rss": "192299008", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:01:14.375677 [debug] [MainThread]: Command `dbt run` failed at 15:01:14.375625 after 5.39 seconds
[0m15:01:14.376445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1024d6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f607d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102550050>]}
[0m15:01:14.376686 [debug] [MainThread]: Flushing usage events
[0m15:04:30.820932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14edf0910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f2bd290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f2bd8d0>]}


============================== 15:04:30.824923 | df0b7bd8-c146-474f-bbe2-969ca9086a79 ==============================
[0m15:04:30.824923 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:04:30.825348 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:04:31.580387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df0b7bd8-c146-474f-bbe2-969ca9086a79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1532ff650>]}
[0m15:04:31.602302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df0b7bd8-c146-474f-bbe2-969ca9086a79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ebfcad0>]}
[0m15:04:31.606960 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:04:31.624161 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:04:31.683902 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:04:31.684393 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/_stg_sources.yml
[0m15:04:31.684574 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m15:04:31.896725 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:04:31.901823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'df0b7bd8-c146-474f-bbe2-969ca9086a79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f1881d0>]}
[0m15:04:31.949113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'df0b7bd8-c146-474f-bbe2-969ca9086a79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x157dd6f50>]}
[0m15:04:31.949399 [info ] [MainThread]: Found 3 seeds, 1 model, 1 source, 448 macros
[0m15:04:31.949553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df0b7bd8-c146-474f-bbe2-969ca9086a79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1680e6b10>]}
[0m15:04:31.950362 [info ] [MainThread]: 
[0m15:04:31.950612 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:04:31.951007 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:04:31.957247 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:04:31.957495 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:04:31.957751 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:04:32.746663 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.788 seconds
[0m15:04:32.751446 [debug] [ThreadPool]: On list_LB: Close
[0m15:04:32.863702 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_RAW)
[0m15:04:32.869501 [debug] [ThreadPool]: Using snowflake connection "list_LB_RAW"
[0m15:04:32.869799 [debug] [ThreadPool]: On list_LB_RAW: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_RAW"} */
show objects in LB.RAW limit 10000
[0m15:04:32.869956 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:04:33.352223 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.482 seconds
[0m15:04:33.357177 [debug] [ThreadPool]: On list_LB_RAW: Close
[0m15:04:33.463254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df0b7bd8-c146-474f-bbe2-969ca9086a79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168006a10>]}
[0m15:04:33.463754 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:04:33.463934 [info ] [MainThread]: 
[0m15:04:33.465518 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:04:33.465835 [info ] [Thread-1 (]: 1 of 1 START sql incremental model RAW.stg_contract ............................ [RUN]
[0m15:04:33.466073 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_RAW, now model.snowflake_airflow_dbt.stg_contract)
[0m15:04:33.466215 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:04:33.470131 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:04:33.470719 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:04:33.480602 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:04:33.480866 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:04:33.481013 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:04:33.951118 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.470 seconds
[0m15:04:33.952436 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:04:33.953025 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:04:33.953308 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:04:34.118950 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.165 seconds
[0m15:04:34.135358 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:04:34.136699 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:04:34.136876 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.RAW.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental;
[0m15:04:34.255750 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58db0-0202-cf68-0000-0002d4462679
[0m15:04:34.256060 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 28 at position 25 unexpected ';'.
[0m15:04:34.256309 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:04:34.362198 [debug] [Thread-1 (]: Database Error in model stg_contract (models/stage/stg_contract.sql)
  001003 (42000): SQL compilation error:
  syntax error line 28 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:04:34.363057 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df0b7bd8-c146-474f-bbe2-969ca9086a79', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168668c90>]}
[0m15:04:34.363380 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model RAW.stg_contract ................... [[31mERROR[0m in 0.90s]
[0m15:04:34.363650 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:04:34.364653 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:04:34.364822 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_contract' was properly closed.
[0m15:04:34.364964 [info ] [MainThread]: 
[0m15:04:34.365106 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.41 seconds (2.41s).
[0m15:04:34.365393 [debug] [MainThread]: Command end result
[0m15:04:34.377807 [info ] [MainThread]: 
[0m15:04:34.378057 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:04:34.378177 [info ] [MainThread]: 
[0m15:04:34.378327 [error] [MainThread]:   Database Error in model stg_contract (models/stage/stg_contract.sql)
  001003 (42000): SQL compilation error:
  syntax error line 28 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:04:34.378450 [info ] [MainThread]: 
[0m15:04:34.378584 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:04:34.379932 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.6022832, "process_user_time": 2.310273, "process_kernel_time": 1.652045, "process_mem_max_rss": "192774144", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:04:34.380243 [debug] [MainThread]: Command `dbt run` failed at 15:04:34.380207 after 3.60 seconds
[0m15:04:34.380474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cd6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f2bf690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f2bdc50>]}
[0m15:04:34.380627 [debug] [MainThread]: Flushing usage events
[0m15:05:59.484910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d25a610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d281490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d281a90>]}


============================== 15:05:59.488208 | 628c9fd1-f349-49e8-9a16-729aa607e90c ==============================
[0m15:05:59.488208 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:05:59.488565 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:06:00.450913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '628c9fd1-f349-49e8-9a16-729aa607e90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ce86cd0>]}
[0m15:06:00.511916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '628c9fd1-f349-49e8-9a16-729aa607e90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c800b90>]}
[0m15:06:00.512713 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:06:00.524851 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:06:00.604280 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:06:00.604882 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m15:06:00.823698 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:06:00.829558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '628c9fd1-f349-49e8-9a16-729aa607e90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fe44690>]}
[0m15:06:00.889598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '628c9fd1-f349-49e8-9a16-729aa607e90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fee7e90>]}
[0m15:06:00.889909 [info ] [MainThread]: Found 3 seeds, 1 model, 1 source, 448 macros
[0m15:06:00.890066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '628c9fd1-f349-49e8-9a16-729aa607e90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16803f850>]}
[0m15:06:00.890940 [info ] [MainThread]: 
[0m15:06:00.891222 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:06:00.891616 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:06:00.897579 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:06:00.898142 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:06:00.899841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:06:01.427492 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.527 seconds
[0m15:06:01.431609 [debug] [ThreadPool]: On list_LB: Close
[0m15:06:01.568142 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_RAW)
[0m15:06:01.581317 [debug] [ThreadPool]: Using snowflake connection "list_LB_RAW"
[0m15:06:01.581945 [debug] [ThreadPool]: On list_LB_RAW: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_RAW"} */
show objects in LB.RAW limit 10000
[0m15:06:01.582649 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:06:02.083128 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.500 seconds
[0m15:06:02.086667 [debug] [ThreadPool]: On list_LB_RAW: Close
[0m15:06:02.231794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '628c9fd1-f349-49e8-9a16-729aa607e90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15f97a090>]}
[0m15:06:02.232922 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:06:02.233419 [info ] [MainThread]: 
[0m15:06:02.236795 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:06:02.237655 [info ] [Thread-1 (]: 1 of 1 START sql incremental model RAW.stg_contract ............................ [RUN]
[0m15:06:02.238213 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_RAW, now model.snowflake_airflow_dbt.stg_contract)
[0m15:06:02.238565 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:06:02.250552 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:06:02.251135 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:06:02.263186 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:06:02.263468 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:06:02.263626 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:06:02.602365 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.339 seconds
[0m15:06:02.604792 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:06:02.605417 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:06:02.605739 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:06:02.709469 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.103 seconds
[0m15:06:02.742071 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:06:02.742987 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:06:02.743271 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.RAW.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m15:06:02.884746 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58db2-0202-cf68-0000-0002d4462681
[0m15:06:02.885769 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.

[0m15:06:02.886608 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:06:03.005398 [debug] [Thread-1 (]: Database Error in model stg_contract (models/stage/stg_contract.sql)
  000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.
  
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:06:03.007811 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '628c9fd1-f349-49e8-9a16-729aa607e90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168222190>]}
[0m15:06:03.008605 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model RAW.stg_contract ................... [[31mERROR[0m in 0.77s]
[0m15:06:03.009279 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:06:03.011504 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:06:03.011867 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_contract' was properly closed.
[0m15:06:03.012065 [info ] [MainThread]: 
[0m15:06:03.012256 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.12 seconds (2.12s).
[0m15:06:03.012611 [debug] [MainThread]: Command end result
[0m15:06:03.032212 [info ] [MainThread]: 
[0m15:06:03.032479 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:06:03.032602 [info ] [MainThread]: 
[0m15:06:03.032766 [error] [MainThread]:   Database Error in model stg_contract (models/stage/stg_contract.sql)
  000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.
  
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:06:03.032886 [info ] [MainThread]: 
[0m15:06:03.033025 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:06:03.034751 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.5935326, "process_user_time": 2.633866, "process_kernel_time": 1.529715, "process_mem_max_rss": "192872448", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:06:03.035053 [debug] [MainThread]: Command `dbt run` failed at 15:06:03.035020 after 3.59 seconds
[0m15:06:03.035630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d281090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bf2d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cdfb650>]}
[0m15:06:03.035832 [debug] [MainThread]: Flushing usage events
[0m15:08:38.574737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e7571d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e7bd690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e7bdcd0>]}


============================== 15:08:38.577271 | 5cffd7ce-ee07-4f13-a6dc-c35c84bc3db8 ==============================
[0m15:08:38.577271 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:08:38.577538 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:08:38.579031 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'snowflake_airflow_dbt'
[0m15:08:38.580401 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.03447154, "process_user_time": 1.65339, "process_kernel_time": 1.597718, "process_mem_max_rss": "109461504", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:08:38.580760 [debug] [MainThread]: Command `dbt run` failed at 15:08:38.580707 after 0.03 seconds
[0m15:08:38.580953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103176d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e7bdb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031e7fd0>]}
[0m15:08:38.581127 [debug] [MainThread]: Flushing usage events
[0m15:08:49.768628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133097d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1330b53d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1330b59d0>]}


============================== 15:08:49.771240 | 0cfb4d0e-acf2-4a3b-ae55-fa0d0fe55dd5 ==============================
[0m15:08:49.771240 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:08:49.771527 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:08:50.466399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0cfb4d0e-acf2-4a3b-ae55-fa0d0fe55dd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14074bbd0>]}
[0m15:08:50.498218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0cfb4d0e-acf2-4a3b-ae55-fa0d0fe55dd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b00c10>]}
[0m15:08:50.499137 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:08:50.510972 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:08:50.558371 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:08:50.558692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0cfb4d0e-acf2-4a3b-ae55-fa0d0fe55dd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13192ed50>]}
[0m15:08:51.056375 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.staging
[0m15:08:51.060581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0cfb4d0e-acf2-4a3b-ae55-fa0d0fe55dd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131695f10>]}
[0m15:08:51.104932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0cfb4d0e-acf2-4a3b-ae55-fa0d0fe55dd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140887710>]}
[0m15:08:51.105193 [info ] [MainThread]: Found 1 model, 3 seeds, 1 source, 448 macros
[0m15:08:51.105339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0cfb4d0e-acf2-4a3b-ae55-fa0d0fe55dd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140d60d90>]}
[0m15:08:51.106092 [info ] [MainThread]: 
[0m15:08:51.106328 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:08:51.106697 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:08:51.112016 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:08:51.112235 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:08:51.112359 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:08:51.749449 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.637 seconds
[0m15:08:51.752550 [debug] [ThreadPool]: On list_LB: Close
[0m15:08:51.865034 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_RAW)
[0m15:08:51.877295 [debug] [ThreadPool]: Using snowflake connection "list_LB_RAW"
[0m15:08:51.877734 [debug] [ThreadPool]: On list_LB_RAW: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_RAW"} */
show objects in LB.RAW limit 10000
[0m15:08:51.878005 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:08:52.389020 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.511 seconds
[0m15:08:52.390817 [debug] [ThreadPool]: On list_LB_RAW: Close
[0m15:08:52.506720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0cfb4d0e-acf2-4a3b-ae55-fa0d0fe55dd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140e24a90>]}
[0m15:08:52.507727 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:08:52.508145 [info ] [MainThread]: 
[0m15:08:52.511069 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:08:52.511760 [info ] [Thread-1 (]: 1 of 1 START sql incremental model RAW.stg_contract ............................ [RUN]
[0m15:08:52.512224 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_RAW, now model.snowflake_airflow_dbt.stg_contract)
[0m15:08:52.512620 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:08:52.519697 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:08:52.520874 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:08:52.536312 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:08:52.536643 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:08:52.536850 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:08:52.927945 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.391 seconds
[0m15:08:52.931380 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:08:52.932780 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:08:52.933490 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:08:53.039385 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.105 seconds
[0m15:08:53.075417 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:08:53.077062 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:08:53.077349 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.RAW.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m15:08:53.384540 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58db4-0202-cf69-0000-0002d4465679
[0m15:08:53.385347 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.

[0m15:08:53.385978 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:08:53.583870 [debug] [Thread-1 (]: Database Error in model stg_contract (models/stage/stg_contract.sql)
  000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.
  
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:08:53.585499 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0cfb4d0e-acf2-4a3b-ae55-fa0d0fe55dd5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141218f10>]}
[0m15:08:53.586138 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model RAW.stg_contract ................... [[31mERROR[0m in 1.07s]
[0m15:08:53.586700 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:08:53.588384 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:08:53.588655 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_contract' was properly closed.
[0m15:08:53.588931 [info ] [MainThread]: 
[0m15:08:53.589210 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.48 seconds (2.48s).
[0m15:08:53.589757 [debug] [MainThread]: Command end result
[0m15:08:53.611010 [info ] [MainThread]: 
[0m15:08:53.611307 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:08:53.611437 [info ] [MainThread]: 
[0m15:08:53.611597 [error] [MainThread]:   Database Error in model stg_contract (models/stage/stg_contract.sql)
  000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.
  
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:08:53.611719 [info ] [MainThread]: 
[0m15:08:53.611846 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:08:53.613257 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.8815222, "process_user_time": 2.476609, "process_kernel_time": 2.465057, "process_mem_max_rss": "202473472", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:08:53.613544 [debug] [MainThread]: Command `dbt run` failed at 15:08:53.613509 after 3.88 seconds
[0m15:08:53.613739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133055d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1317b0250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132cf04d0>]}
[0m15:08:53.613890 [debug] [MainThread]: Flushing usage events
[0m15:09:45.166743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16881f1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168881950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168881f90>]}


============================== 15:09:45.169859 | ea1a0d01-e6b5-482f-b486-94b3ab51d793 ==============================
[0m15:09:45.169859 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:09:45.170208 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:09:46.009573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ea1a0d01-e6b5-482f-b486-94b3ab51d793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16856da90>]}
[0m15:09:46.031394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ea1a0d01-e6b5-482f-b486-94b3ab51d793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168100910>]}
[0m15:09:46.033030 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:09:46.048723 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:09:46.090923 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:09:46.091267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ea1a0d01-e6b5-482f-b486-94b3ab51d793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f12e950>]}
[0m15:09:46.665526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ea1a0d01-e6b5-482f-b486-94b3ab51d793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e83cc50>]}
[0m15:09:46.734666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ea1a0d01-e6b5-482f-b486-94b3ab51d793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ed53dd0>]}
[0m15:09:46.735507 [info ] [MainThread]: Found 1 model, 3 seeds, 1 source, 448 macros
[0m15:09:46.735819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ea1a0d01-e6b5-482f-b486-94b3ab51d793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16eab8610>]}
[0m15:09:46.738350 [info ] [MainThread]: 
[0m15:09:46.738815 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:09:46.739394 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:09:46.747112 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:09:46.748007 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:09:46.748236 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:09:47.508671 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.757 seconds
[0m15:09:47.511856 [debug] [ThreadPool]: On list_LB: Close
[0m15:09:47.650061 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:09:47.660787 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:09:47.661313 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:09:47.661534 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:09:48.209121 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.547 seconds
[0m15:09:48.211579 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:09:48.461760 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_RAW)
[0m15:09:48.465353 [debug] [ThreadPool]: Using snowflake connection "list_LB_RAW"
[0m15:09:48.466219 [debug] [ThreadPool]: On list_LB_RAW: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_RAW"} */
show objects in LB.RAW limit 10000
[0m15:09:48.466549 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:09:48.849613 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.383 seconds
[0m15:09:48.853175 [debug] [ThreadPool]: On list_LB_RAW: Close
[0m15:09:48.994950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ea1a0d01-e6b5-482f-b486-94b3ab51d793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ea1f610>]}
[0m15:09:48.996233 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:09:48.996569 [info ] [MainThread]: 
[0m15:09:48.998496 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:09:48.998837 [info ] [Thread-1 (]: 1 of 1 START sql incremental model stage.stg_contract .......................... [RUN]
[0m15:09:48.999071 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_RAW, now model.snowflake_airflow_dbt.stg_contract)
[0m15:09:48.999217 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:09:49.003596 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:09:49.004822 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:09:49.018104 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:09:49.018620 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:09:49.018934 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:09:49.620618 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.602 seconds
[0m15:09:49.624180 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:09:49.625308 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:09:49.625771 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:09:49.694733 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.068 seconds
[0m15:09:49.725164 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:09:49.726236 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:09:49.726427 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m15:09:50.219014 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58db5-0202-cf54-0000-0002d4464639
[0m15:09:50.219614 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.

[0m15:09:50.220258 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:09:50.350870 [debug] [Thread-1 (]: Database Error in model stg_contract (models/stage/stg_contract.sql)
  000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.
  
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:09:50.353931 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ea1a0d01-e6b5-482f-b486-94b3ab51d793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137510250>]}
[0m15:09:50.355463 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model stage.stg_contract ................. [[31mERROR[0m in 1.35s]
[0m15:09:50.356497 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:09:50.365955 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:09:50.366475 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_contract' was properly closed.
[0m15:09:50.367696 [info ] [MainThread]: 
[0m15:09:50.368557 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.63 seconds (3.63s).
[0m15:09:50.369670 [debug] [MainThread]: Command end result
[0m15:09:50.413677 [info ] [MainThread]: 
[0m15:09:50.414201 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:09:50.414438 [info ] [MainThread]: 
[0m15:09:50.414799 [error] [MainThread]:   Database Error in model stg_contract (models/stage/stg_contract.sql)
  000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.
  
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:09:50.415144 [info ] [MainThread]: 
[0m15:09:50.415736 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:09:50.424744 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.296309, "process_user_time": 2.962291, "process_kernel_time": 1.708977, "process_mem_max_rss": "184844288", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:09:50.428756 [debug] [MainThread]: Command `dbt run` failed at 15:09:50.428184 after 5.30 seconds
[0m15:09:50.430480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051bad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168882290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b4690>]}
[0m15:09:50.430728 [debug] [MainThread]: Flushing usage events
[0m15:12:24.020307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1279f9d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15bcbd450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15bcbdad0>]}


============================== 15:12:24.022853 | e62f7aa7-3801-40ad-909b-5ea4aef57c59 ==============================
[0m15:12:24.022853 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:12:24.023150 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:12:24.772804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e62f7aa7-3801-40ad-909b-5ea4aef57c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16890d8d0>]}
[0m15:12:24.797046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e62f7aa7-3801-40ad-909b-5ea4aef57c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15b500850>]}
[0m15:12:24.798006 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:12:24.810525 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:12:24.856340 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:12:24.856761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e62f7aa7-3801-40ad-909b-5ea4aef57c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a42e810>]}
[0m15:12:25.536739 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:12:25.541587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e62f7aa7-3801-40ad-909b-5ea4aef57c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168c06210>]}
[0m15:12:25.591290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e62f7aa7-3801-40ad-909b-5ea4aef57c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169054950>]}
[0m15:12:25.591563 [info ] [MainThread]: Found 1 model, 3 seeds, 1 source, 448 macros
[0m15:12:25.591714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e62f7aa7-3801-40ad-909b-5ea4aef57c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168f5bc90>]}
[0m15:12:25.592525 [info ] [MainThread]: 
[0m15:12:25.592784 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:12:25.593194 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:12:25.598845 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:12:25.599093 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:12:25.599236 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:12:26.181905 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.582 seconds
[0m15:12:26.185268 [debug] [ThreadPool]: On list_LB: Close
[0m15:12:26.314069 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_RAW)
[0m15:12:26.327003 [debug] [ThreadPool]: Using snowflake connection "list_LB_RAW"
[0m15:12:26.327362 [debug] [ThreadPool]: On list_LB_RAW: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_RAW"} */
show objects in LB.RAW limit 10000
[0m15:12:26.327544 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:12:26.817036 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.489 seconds
[0m15:12:26.826641 [debug] [ThreadPool]: On list_LB_RAW: Close
[0m15:12:26.931386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e62f7aa7-3801-40ad-909b-5ea4aef57c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169022fd0>]}
[0m15:12:26.932633 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:12:26.932960 [info ] [MainThread]: 
[0m15:12:26.938012 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:12:26.938374 [info ] [Thread-1 (]: 1 of 1 START sql incremental model RAW.stg_contract ............................ [RUN]
[0m15:12:26.938647 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_RAW, now model.snowflake_airflow_dbt.stg_contract)
[0m15:12:26.938941 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:12:26.945890 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:12:26.951319 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:12:26.962576 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:12:26.962817 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:12:26.962965 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:27.356193 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.393 seconds
[0m15:12:27.359091 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:12:27.360381 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:12:27.360901 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:12:27.487331 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.126 seconds
[0m15:12:27.521138 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:12:27.522432 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:12:27.522722 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.RAW.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m15:12:27.661641 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58db8-0202-cf69-0000-0002d4465685
[0m15:12:27.662332 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.

[0m15:12:27.662985 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:12:27.767884 [debug] [Thread-1 (]: Database Error in model stg_contract (models/stage/stg_contract.sql)
  000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.
  
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:12:27.769792 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e62f7aa7-3801-40ad-909b-5ea4aef57c59', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169014390>]}
[0m15:12:27.770432 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model RAW.stg_contract ................... [[31mERROR[0m in 0.83s]
[0m15:12:27.770990 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:12:27.772865 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:12:27.773198 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_contract' was properly closed.
[0m15:12:27.773495 [info ] [MainThread]: 
[0m15:12:27.773798 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.18 seconds (2.18s).
[0m15:12:27.774363 [debug] [MainThread]: Command end result
[0m15:12:27.792746 [info ] [MainThread]: 
[0m15:12:27.793060 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:12:27.793207 [info ] [MainThread]: 
[0m15:12:27.793385 [error] [MainThread]:   Database Error in model stg_contract (models/stage/stg_contract.sql)
  000606 (57P03): No active warehouse selected in the current session.  Select an active warehouse with the 'use warehouse' command.
  
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_contract.sql
[0m15:12:27.793516 [info ] [MainThread]: 
[0m15:12:27.793648 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:12:27.795349 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.8093488, "process_user_time": 2.44062, "process_kernel_time": 2.538251, "process_mem_max_rss": "186892288", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:12:27.795715 [debug] [MainThread]: Command `dbt run` failed at 15:12:27.795675 after 3.81 seconds
[0m15:12:27.796002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15bcbd210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10059ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100614090>]}
[0m15:12:27.796180 [debug] [MainThread]: Flushing usage events
[0m15:14:14.906197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14715a490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147180d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14715acd0>]}


============================== 15:14:14.909029 | 18f1f357-b8d4-48dc-b34c-f934805e69b3 ==============================
[0m15:14:14.909029 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:14:14.909333 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:14:15.901589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '18f1f357-b8d4-48dc-b34c-f934805e69b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fb00750>]}
[0m15:14:15.929206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '18f1f357-b8d4-48dc-b34c-f934805e69b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146a008d0>]}
[0m15:14:15.930071 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:14:15.946880 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:14:15.999683 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m15:14:16.000135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '18f1f357-b8d4-48dc-b34c-f934805e69b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13772e950>]}
[0m15:14:16.821679 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:14:16.828877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18f1f357-b8d4-48dc-b34c-f934805e69b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fbc76d0>]}
[0m15:14:16.923732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18f1f357-b8d4-48dc-b34c-f934805e69b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168253e50>]}
[0m15:14:16.924143 [info ] [MainThread]: Found 1 model, 3 seeds, 1 source, 448 macros
[0m15:14:16.924319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18f1f357-b8d4-48dc-b34c-f934805e69b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff85210>]}
[0m15:14:16.927390 [info ] [MainThread]: 
[0m15:14:16.928313 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:14:16.929035 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:14:16.938798 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:14:16.939084 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:14:16.939231 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:14:17.600236 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.660 seconds
[0m15:14:17.606672 [debug] [ThreadPool]: On list_LB: Close
[0m15:14:17.716992 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_RAW)
[0m15:14:17.728268 [debug] [ThreadPool]: Using snowflake connection "list_LB_RAW"
[0m15:14:17.728833 [debug] [ThreadPool]: On list_LB_RAW: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_RAW"} */
show objects in LB.RAW limit 10000
[0m15:14:17.729033 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:14:18.178002 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.449 seconds
[0m15:14:18.181781 [debug] [ThreadPool]: On list_LB_RAW: Close
[0m15:14:18.312064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18f1f357-b8d4-48dc-b34c-f934805e69b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168228a50>]}
[0m15:14:18.312567 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:14:18.312768 [info ] [MainThread]: 
[0m15:14:18.314349 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:14:18.314616 [info ] [Thread-1 (]: 1 of 1 START sql incremental model RAW.stg_contract ............................ [RUN]
[0m15:14:18.314827 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_RAW, now model.snowflake_airflow_dbt.stg_contract)
[0m15:14:18.314968 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:14:18.319094 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:14:18.320028 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:14:18.330544 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:14:18.330802 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:14:18.330973 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:14:18.689312 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.358 seconds
[0m15:14:18.690074 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:14:18.690391 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:14:18.690538 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:14:18.853514 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.163 seconds
[0m15:14:18.875218 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:14:18.876126 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:14:18.876325 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.RAW.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m15:14:20.522359 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.646 seconds
[0m15:14:20.527823 [debug] [Thread-1 (]: Applying DROP to: LB.RAW.stg_contract__dbt_tmp
[0m15:14:20.531070 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:14:20.531304 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.RAW.stg_contract__dbt_tmp cascade
[0m15:14:20.593932 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.062 seconds
[0m15:14:20.605349 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:14:20.713440 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18f1f357-b8d4-48dc-b34c-f934805e69b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168230450>]}
[0m15:14:20.714089 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model RAW.stg_contract ....................... [[32mSUCCESS 1[0m in 2.40s]
[0m15:14:20.714500 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:14:20.716701 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:14:20.717290 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_contract' was properly closed.
[0m15:14:20.718151 [info ] [MainThread]: 
[0m15:14:20.718823 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.79 seconds (3.79s).
[0m15:14:20.719621 [debug] [MainThread]: Command end result
[0m15:14:20.739071 [info ] [MainThread]: 
[0m15:14:20.739634 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:14:20.739808 [info ] [MainThread]: 
[0m15:14:20.740571 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:14:20.748037 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.872878, "process_user_time": 3.410119, "process_kernel_time": 1.672643, "process_mem_max_rss": "183042048", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:14:20.750057 [debug] [MainThread]: Command `dbt run` succeeded at 15:14:20.749983 after 5.88 seconds
[0m15:14:20.750661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146387dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b8690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dbecd0>]}
[0m15:14:20.750925 [debug] [MainThread]: Flushing usage events
[0m15:16:19.119538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168757650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1687bd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1687bd990>]}


============================== 15:16:19.122095 | b82d9616-4c8c-4dfb-9fa5-e1db932af30f ==============================
[0m15:16:19.122095 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:16:19.122362 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:16:19.764436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b82d9616-4c8c-4dfb-9fa5-e1db932af30f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e2fb4d0>]}
[0m15:16:19.783554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b82d9616-4c8c-4dfb-9fa5-e1db932af30f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1680fca50>]}
[0m15:16:19.784163 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:16:19.794684 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:16:19.848299 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:16:19.848642 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/_stg_sources.yml
[0m15:16:20.011313 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/stage/stg_contract.sql) depends on a source named 'raw.contract' which was not found
[0m15:16:20.013231 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.921577, "process_user_time": 1.964413, "process_kernel_time": 2.035529, "process_mem_max_rss": "192446464", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:16:20.013532 [debug] [MainThread]: Command `dbt run` failed at 15:16:20.013483 after 0.92 seconds
[0m15:16:20.013709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10513ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e603b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051b8090>]}
[0m15:16:20.013874 [debug] [MainThread]: Flushing usage events
[0m15:16:38.535384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12105ad50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1210bd350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1210bd9d0>]}


============================== 15:16:38.538037 | 97939eb0-ae1b-48a7-bb72-1a86603cb466 ==============================
[0m15:16:38.538037 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:16:38.538350 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:16:39.137742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '97939eb0-ae1b-48a7-bb72-1a86603cb466', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141269090>]}
[0m15:16:39.155631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '97939eb0-ae1b-48a7-bb72-1a86603cb466', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1208fca50>]}
[0m15:16:39.156237 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:16:39.166306 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:16:39.219337 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:16:39.219725 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/_stg_sources.yml
[0m15:16:39.219884 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m15:16:39.360916 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/stage/stg_contract.sql) depends on a source named 'name.contract' which was not found
[0m15:16:39.362783 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.85669607, "process_user_time": 2.112782, "process_kernel_time": 1.630535, "process_mem_max_rss": "193396736", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:16:39.363050 [debug] [MainThread]: Command `dbt run` failed at 15:16:39.363007 after 0.86 seconds
[0m15:16:39.363225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102292d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10230c090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146ccca90>]}
[0m15:16:39.363390 [debug] [MainThread]: Flushing usage events
[0m15:17:03.461909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c44c490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c481110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c481790>]}


============================== 15:17:03.465112 | 75d9c2a4-179b-4808-b864-224637823d26 ==============================
[0m15:17:03.465112 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:17:03.465532 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:17:04.235205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '75d9c2a4-179b-4808-b864-224637823d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12bd00490>]}
[0m15:17:04.253682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '75d9c2a4-179b-4808-b864-224637823d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12bafca90>]}
[0m15:17:04.254283 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:17:04.266462 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:17:04.320245 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:17:04.320597 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/_stg_sources.yml
[0m15:17:04.320739 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m15:17:04.480392 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:17:04.484607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '75d9c2a4-179b-4808-b864-224637823d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab6e890>]}
[0m15:17:04.523993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '75d9c2a4-179b-4808-b864-224637823d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aeb6650>]}
[0m15:17:04.524246 [info ] [MainThread]: Found 3 seeds, 1 model, 1 source, 448 macros
[0m15:17:04.524395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75d9c2a4-179b-4808-b864-224637823d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aaa1810>]}
[0m15:17:04.525099 [info ] [MainThread]: 
[0m15:17:04.525330 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:17:04.525668 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:17:04.530872 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:17:04.531028 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:17:04.531143 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:05.067306 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.536 seconds
[0m15:17:05.071119 [debug] [ThreadPool]: On list_LB: Close
[0m15:17:05.192705 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_RAW)
[0m15:17:05.203824 [debug] [ThreadPool]: Using snowflake connection "list_LB_RAW"
[0m15:17:05.204228 [debug] [ThreadPool]: On list_LB_RAW: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_RAW"} */
show objects in LB.RAW limit 10000
[0m15:17:05.204497 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:05.722619 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.518 seconds
[0m15:17:05.723938 [debug] [ThreadPool]: On list_LB_RAW: Close
[0m15:17:05.834793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75d9c2a4-179b-4808-b864-224637823d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae12c10>]}
[0m15:17:05.835289 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:17:05.835478 [info ] [MainThread]: 
[0m15:17:05.837381 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:17:05.837667 [info ] [Thread-1 (]: 1 of 1 START sql incremental model RAW.stg_contract ............................ [RUN]
[0m15:17:05.837889 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_RAW, now model.snowflake_airflow_dbt.stg_contract)
[0m15:17:05.838052 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:17:05.843469 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:17:05.844357 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:17:05.855048 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:17:05.855401 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:17:05.855838 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:17:06.280321 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.424 seconds
[0m15:17:06.283535 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:17:06.284844 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:17:06.285495 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:17:06.383503 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.097 seconds
[0m15:17:06.414338 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:17:06.414838 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace  temporary view LB.RAW.stg_contract__dbt_tmp
  
   as (
    

with source as (
    select * from lb.stage.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
        where modificationdate > (select max(modificationdate) from LB.RAW.stg_contract)
    
)

select * from incremental
  );
[0m15:17:06.580650 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58dbd-0202-cf54-0000-0002d4464695
[0m15:17:06.581358 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.STAGE.CONTRACT' does not exist or not authorized.
[0m15:17:06.581900 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:17:06.707736 [debug] [Thread-1 (]: Database Error in model stg_contract (models/stage/stg_contract.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.STAGE.CONTRACT' does not exist or not authorized.
[0m15:17:06.710084 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75d9c2a4-179b-4808-b864-224637823d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c44fd10>]}
[0m15:17:06.711168 [error] [Thread-1 (]: 1 of 1 ERROR creating sql incremental model RAW.stg_contract ................... [[31mERROR[0m in 0.87s]
[0m15:17:06.711832 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:17:06.713770 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:17:06.714177 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_contract' was properly closed.
[0m15:17:06.714478 [info ] [MainThread]: 
[0m15:17:06.714869 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 2.19 seconds (2.19s).
[0m15:17:06.715536 [debug] [MainThread]: Command end result
[0m15:17:06.730761 [info ] [MainThread]: 
[0m15:17:06.731035 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:17:06.731177 [info ] [MainThread]: 
[0m15:17:06.731344 [error] [MainThread]:   Database Error in model stg_contract (models/stage/stg_contract.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.STAGE.CONTRACT' does not exist or not authorized.
[0m15:17:06.731469 [info ] [MainThread]: 
[0m15:17:06.731599 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:17:06.733518 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.3048646, "process_user_time": 2.194396, "process_kernel_time": 1.827294, "process_mem_max_rss": "201359360", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:17:06.733876 [debug] [MainThread]: Command `dbt run` failed at 15:17:06.733834 after 3.31 seconds
[0m15:17:06.734092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c460fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1026a6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1027a0710>]}
[0m15:17:06.734248 [debug] [MainThread]: Flushing usage events
[0m15:23:17.586441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd33bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd95590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd95c10>]}


============================== 15:23:17.589816 | 0192a64a-16c6-4dc5-ab4c-261543a72166 ==============================
[0m15:23:17.589816 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:23:17.590239 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:23:18.654197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0192a64a-16c6-4dc5-ab4c-261543a72166', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fdb1dd0>]}
[0m15:23:18.691197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0192a64a-16c6-4dc5-ab4c-261543a72166', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d8fca10>]}
[0m15:23:18.691917 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:23:18.706157 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:23:18.748041 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m15:23:18.748395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0192a64a-16c6-4dc5-ab4c-261543a72166', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c932a50>]}
[0m15:23:19.276385 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/stage/stg_contract.sql) depends on a source named 'stage.contract' which was not found
[0m15:23:19.277984 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.7406656, "process_user_time": 2.543517, "process_kernel_time": 1.71178, "process_mem_max_rss": "183910400", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:23:19.278274 [debug] [MainThread]: Command `dbt run` failed at 15:23:19.278226 after 1.74 seconds
[0m15:23:19.278448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1023d2d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12dbec9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12dbec110>]}
[0m15:23:19.278608 [debug] [MainThread]: Flushing usage events
[0m15:23:53.221162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135af0110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135fbd410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135fbda90>]}


============================== 15:23:53.224228 | e1ccbb61-2dfa-4d5c-a99b-748ea91468c9 ==============================
[0m15:23:53.224228 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:23:53.224530 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:23:53.888038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e1ccbb61-2dfa-4d5c-a99b-748ea91468c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135fe0290>]}
[0m15:23:53.908045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e1ccbb61-2dfa-4d5c-a99b-748ea91468c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1358009d0>]}
[0m15:23:53.908749 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:23:53.920332 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:23:53.960449 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m15:23:53.960828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e1ccbb61-2dfa-4d5c-a99b-748ea91468c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1348329d0>]}
[0m15:23:54.535460 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:23:54.540632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1ccbb61-2dfa-4d5c-a99b-748ea91468c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b0d8350>]}
[0m15:23:54.606193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1ccbb61-2dfa-4d5c-a99b-748ea91468c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b353bd0>]}
[0m15:23:54.606535 [info ] [MainThread]: Found 1 model, 3 seeds, 1 source, 448 macros
[0m15:23:54.606700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1ccbb61-2dfa-4d5c-a99b-748ea91468c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b0b0c90>]}
[0m15:23:54.607816 [info ] [MainThread]: 
[0m15:23:54.608411 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:23:54.609624 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:23:54.616268 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:23:54.616885 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:23:54.617380 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:23:55.135118 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.518 seconds
[0m15:23:55.138633 [debug] [ThreadPool]: On list_LB: Close
[0m15:23:55.258104 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m15:23:55.263428 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m15:23:55.263676 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m15:23:55.263805 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:23:55.607121 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.343 seconds
[0m15:23:55.608114 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m15:23:55.709685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1ccbb61-2dfa-4d5c-a99b-748ea91468c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16adee950>]}
[0m15:23:55.710180 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:23:55.710357 [info ] [MainThread]: 
[0m15:23:55.711859 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:23:55.712172 [info ] [Thread-1 (]: 1 of 1 START sql incremental model STAGE.stg_contract .......................... [RUN]
[0m15:23:55.712410 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.stg_contract)
[0m15:23:55.712566 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:23:55.717013 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:23:55.717866 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:23:55.727709 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:23:55.727997 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:23:55.728156 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:23:56.127186 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.399 seconds
[0m15:23:56.128871 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:23:56.129581 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:23:56.129917 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:23:56.223547 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m15:23:56.244791 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:23:56.245734 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:23:56.245936 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.STAGE.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m15:23:57.435315 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.189 seconds
[0m15:23:57.441893 [debug] [Thread-1 (]: Applying DROP to: LB.STAGE.stg_contract__dbt_tmp
[0m15:23:57.445651 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:23:57.446112 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.STAGE.stg_contract__dbt_tmp cascade
[0m15:23:57.518502 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.072 seconds
[0m15:23:57.528845 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:23:57.632445 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ccbb61-2dfa-4d5c-a99b-748ea91468c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b691fd0>]}
[0m15:23:57.633333 [info ] [Thread-1 (]: 1 of 1 OK created sql incremental model STAGE.stg_contract ..................... [[32mSUCCESS 1[0m in 1.92s]
[0m15:23:57.633930 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:23:57.635564 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:23:57.635827 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_contract' was properly closed.
[0m15:23:57.636123 [info ] [MainThread]: 
[0m15:23:57.636387 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 3.03 seconds (3.03s).
[0m15:23:57.636873 [debug] [MainThread]: Command end result
[0m15:23:57.658803 [info ] [MainThread]: 
[0m15:23:57.659157 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:23:57.659303 [info ] [MainThread]: 
[0m15:23:57.659461 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:23:57.661077 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.474277, "process_user_time": 2.785273, "process_kernel_time": 1.539547, "process_mem_max_rss": "191184896", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:23:57.661520 [debug] [MainThread]: Command `dbt run` succeeded at 15:23:57.661479 after 4.47 seconds
[0m15:23:57.661820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135fbf250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135fbfa50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102cb86d0>]}
[0m15:23:57.661999 [debug] [MainThread]: Flushing usage events
[0m15:43:32.381547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b5b910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132bbd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132bbd950>]}


============================== 15:43:32.383960 | cc757127-99ce-425b-96b9-79e9a8aa3c09 ==============================
[0m15:43:32.383960 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:43:32.384226 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:43:33.047201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc757127-99ce-425b-96b9-79e9a8aa3c09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132bbd8d0>]}
[0m15:43:33.066172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc757127-99ce-425b-96b9-79e9a8aa3c09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1325009d0>]}
[0m15:43:33.066783 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:43:33.078398 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:43:33.135509 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 3 files changed.
[0m15:43:33.135805 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/stg_prices.sql
[0m15:43:33.135940 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/stage/stg_products.sql
[0m15:43:33.136103 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/_stg_models.yml
[0m15:43:33.136313 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/_stg_sources.yml
[0m15:43:33.136448 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m15:43:33.323632 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:43:33.328256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc757127-99ce-425b-96b9-79e9a8aa3c09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142ec4050>]}
[0m15:43:33.373188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc757127-99ce-425b-96b9-79e9a8aa3c09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14390aa90>]}
[0m15:43:33.373482 [info ] [MainThread]: Found 3 seeds, 3 models, 3 sources, 448 macros
[0m15:43:33.373634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc757127-99ce-425b-96b9-79e9a8aa3c09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142c82210>]}
[0m15:43:33.374582 [info ] [MainThread]: 
[0m15:43:33.374844 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:43:33.376598 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:43:33.382023 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:43:33.382241 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:43:33.382380 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:43:33.901057 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.518 seconds
[0m15:43:33.904230 [debug] [ThreadPool]: On list_LB: Close
[0m15:43:34.015898 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m15:43:34.029113 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m15:43:34.029369 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m15:43:34.029497 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:43:34.469799 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.440 seconds
[0m15:43:34.473071 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m15:43:34.604618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc757127-99ce-425b-96b9-79e9a8aa3c09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122224190>]}
[0m15:43:34.605834 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:43:34.606440 [info ] [MainThread]: 
[0m15:43:34.610566 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:43:34.611592 [info ] [Thread-1 (]: 1 of 3 START sql incremental model STAGE.stg_contract .......................... [RUN]
[0m15:43:34.612196 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.stg_contract)
[0m15:43:34.612688 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:43:34.623551 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:34.624512 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:43:34.641905 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:34.642245 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:43:34.642480 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:43:35.076234 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.433 seconds
[0m15:43:35.079462 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:43:35.080823 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:35.081483 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:43:35.171260 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.089 seconds
[0m15:43:35.200924 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:35.201347 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace  temporary view LB.STAGE.stg_contract__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
        where createdat > (select max(createdat) from LB.STAGE.stg_contract)
    
)

select * from incremental
  );
[0m15:43:35.680258 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.478 seconds
[0m15:43:35.693878 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:35.694472 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.STAGE.stg_contract__dbt_tmp
[0m15:43:35.785823 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.091 seconds
[0m15:43:35.793137 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:35.794535 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.STAGE.stg_contract
[0m15:43:35.886759 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.091 seconds
[0m15:43:35.899593 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:35.900167 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table "LB"."STAGE"."STG_CONTRACT"
[0m15:43:35.971768 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.071 seconds
[0m15:43:35.999967 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:36.001306 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:36.001567 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m15:43:36.293722 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.292 seconds
[0m15:43:36.294502 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:36.295122 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
merge into LB.STAGE.stg_contract as DBT_INTERNAL_DEST
        using LB.STAGE.stg_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","TYPE" = DBT_INTERNAL_SOURCE."TYPE","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","USAGE" = DBT_INTERNAL_SOURCE."USAGE","USAGENET" = DBT_INTERNAL_SOURCE."USAGENET","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","STARTDATE" = DBT_INTERNAL_SOURCE."STARTDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","FILLINGDATECANCELLATION" = DBT_INTERNAL_SOURCE."FILLINGDATECANCELLATION","CANCELLATIONREASON" = DBT_INTERNAL_SOURCE."CANCELLATIONREASON","CITY" = DBT_INTERNAL_SOURCE."CITY","STATUS" = DBT_INTERNAL_SOURCE."STATUS","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")
    values
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")

;
[0m15:43:37.026568 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.731 seconds
[0m15:43:37.027626 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:37.028173 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
COMMIT
[0m15:43:37.253367 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.225 seconds
[0m15:43:37.265829 [debug] [Thread-1 (]: Applying DROP to: LB.STAGE.stg_contract__dbt_tmp
[0m15:43:37.279284 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:37.279611 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.STAGE.stg_contract__dbt_tmp cascade
[0m15:43:37.412318 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.132 seconds
[0m15:43:37.423382 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:43:37.541919 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc757127-99ce-425b-96b9-79e9a8aa3c09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143a27ed0>]}
[0m15:43:37.542947 [info ] [Thread-1 (]: 1 of 3 OK created sql incremental model STAGE.stg_contract ..................... [[32mSUCCESS 0[0m in 2.93s]
[0m15:43:37.543815 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:43:37.544421 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:43:37.545297 [info ] [Thread-1 (]: 2 of 3 START sql incremental model STAGE.stg_prices ............................ [RUN]
[0m15:43:37.545984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:43:37.546546 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:43:37.553017 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:43:37.553751 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:43:37.554925 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:43:37.555113 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m15:43:37.555275 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:43:37.870724 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.315 seconds
[0m15:43:37.872668 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m15:43:37.873692 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:43:37.874396 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m15:43:37.965273 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.090 seconds
[0m15:43:37.973236 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:43:37.975457 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:43:37.976017 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.STAGE.stg_prices
         as
        (

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
)

select * from incremental;
[0m15:43:38.050476 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58dd7-0202-cf6b-0000-0002d446370d
[0m15:43:38.050771 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 23 at position 25 unexpected ';'.
[0m15:43:38.050988 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:43:38.175786 [debug] [Thread-1 (]: Database Error in model stg_prices (models/stage/stg_prices.sql)
  001003 (42000): SQL compilation error:
  syntax error line 23 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_prices.sql
[0m15:43:38.176514 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc757127-99ce-425b-96b9-79e9a8aa3c09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144030c90>]}
[0m15:43:38.177175 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model STAGE.stg_prices ................... [[31mERROR[0m in 0.63s]
[0m15:43:38.177981 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:43:38.178546 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:43:38.180161 [info ] [Thread-1 (]: 3 of 3 START sql incremental model STAGE.stg_products .......................... [RUN]
[0m15:43:38.180698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:43:38.181053 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:43:38.184868 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:43:38.185317 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:43:38.186354 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:43:38.186584 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m15:43:38.186734 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:43:38.577809 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.391 seconds
[0m15:43:38.579875 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m15:43:38.580509 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:43:38.580832 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m15:43:38.664041 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.083 seconds
[0m15:43:38.666261 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:43:38.667779 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:43:38.668371 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.STAGE.stg_products
         as
        (

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
)

select * from incremental;
[0m15:43:38.757091 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58dd7-0202-cf54-0000-0002d4464701
[0m15:43:38.757593 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 25 unexpected ';'.
[0m15:43:38.758076 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:43:38.888617 [debug] [Thread-1 (]: Database Error in model stg_products (models/stage/stg_products.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_products.sql
[0m15:43:38.889615 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc757127-99ce-425b-96b9-79e9a8aa3c09', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046b4710>]}
[0m15:43:38.890628 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model STAGE.stg_products ................. [[31mERROR[0m in 0.71s]
[0m15:43:38.891565 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:43:38.893532 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:43:38.894002 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m15:43:38.894492 [info ] [MainThread]: 
[0m15:43:38.894887 [info ] [MainThread]: Finished running 3 incremental models in 0 hours 0 minutes and 5.52 seconds (5.52s).
[0m15:43:38.895964 [debug] [MainThread]: Command end result
[0m15:43:38.913267 [info ] [MainThread]: 
[0m15:43:38.913550 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m15:43:38.913688 [info ] [MainThread]: 
[0m15:43:38.913854 [error] [MainThread]:   Database Error in model stg_prices (models/stage/stg_prices.sql)
  001003 (42000): SQL compilation error:
  syntax error line 23 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_prices.sql
[0m15:43:38.913976 [info ] [MainThread]: 
[0m15:43:38.914118 [error] [MainThread]:   Database Error in model stg_products (models/stage/stg_products.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_products.sql
[0m15:43:38.914238 [info ] [MainThread]: 
[0m15:43:38.914389 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
[0m15:43:38.916113 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.5631485, "process_user_time": 2.775107, "process_kernel_time": 1.458727, "process_mem_max_rss": "191709184", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:43:38.916542 [debug] [MainThread]: Command `dbt run` failed at 15:43:38.916498 after 6.56 seconds
[0m15:43:38.916811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132bbca50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104786d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116f4bcd0>]}
[0m15:43:38.916979 [debug] [MainThread]: Flushing usage events
[0m15:44:53.913749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16811f290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168160150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168181590>]}


============================== 15:44:53.916208 | 4e86ff60-bd91-4dcf-9f94-7772b5544c98 ==============================
[0m15:44:53.916208 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:44:53.916493 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:44:54.571738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4e86ff60-bd91-4dcf-9f94-7772b5544c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1689cae50>]}
[0m15:44:54.589884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4e86ff60-bd91-4dcf-9f94-7772b5544c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1379fca10>]}
[0m15:44:54.590372 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:44:54.600720 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:44:54.652874 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:44:54.653214 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_prices.sql
[0m15:44:54.653399 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_products.sql
[0m15:44:54.791516 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:44:54.796406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4e86ff60-bd91-4dcf-9f94-7772b5544c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16dea1310>]}
[0m15:44:54.836758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4e86ff60-bd91-4dcf-9f94-7772b5544c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x170e4bb50>]}
[0m15:44:54.837012 [info ] [MainThread]: Found 3 seeds, 3 models, 3 sources, 448 macros
[0m15:44:54.837160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e86ff60-bd91-4dcf-9f94-7772b5544c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16812bfd0>]}
[0m15:44:54.837955 [info ] [MainThread]: 
[0m15:44:54.838177 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:44:54.839950 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:44:54.845220 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:44:54.845389 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:44:54.845501 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:44:55.495984 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.650 seconds
[0m15:44:55.498879 [debug] [ThreadPool]: On list_LB: Close
[0m15:44:55.620860 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m15:44:55.625198 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m15:44:55.625446 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m15:44:55.625584 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:44:56.080865 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.455 seconds
[0m15:44:56.084655 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m15:44:56.228458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e86ff60-bd91-4dcf-9f94-7772b5544c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135613910>]}
[0m15:44:56.230741 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:44:56.232514 [info ] [MainThread]: 
[0m15:44:56.241780 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:44:56.242478 [info ] [Thread-1 (]: 1 of 3 START sql incremental model STAGE.stg_contract .......................... [RUN]
[0m15:44:56.242954 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.stg_contract)
[0m15:44:56.243139 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:44:56.249027 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:56.249862 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:44:56.259828 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:56.260088 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:44:56.260243 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:44:56.732097 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.472 seconds
[0m15:44:56.734212 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:44:56.735064 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:56.735419 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:44:56.837892 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.102 seconds
[0m15:44:56.866480 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:56.866950 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace  temporary view LB.STAGE.stg_contract__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
        where createdat > (select max(createdat) from LB.STAGE.stg_contract)
    
)

select * from incremental
  );
[0m15:44:57.293903 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.426 seconds
[0m15:44:57.306374 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:57.306906 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.STAGE.stg_contract__dbt_tmp
[0m15:44:57.397937 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.091 seconds
[0m15:44:57.405270 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:57.405772 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.STAGE.stg_contract
[0m15:44:57.480992 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.075 seconds
[0m15:44:57.493754 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:57.494211 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table "LB"."STAGE"."STG_CONTRACT"
[0m15:44:57.573764 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.079 seconds
[0m15:44:57.602269 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:57.603713 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:57.603924 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m15:44:57.718140 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.114 seconds
[0m15:44:57.719145 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:57.719790 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
merge into LB.STAGE.stg_contract as DBT_INTERNAL_DEST
        using LB.STAGE.stg_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","TYPE" = DBT_INTERNAL_SOURCE."TYPE","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","USAGE" = DBT_INTERNAL_SOURCE."USAGE","USAGENET" = DBT_INTERNAL_SOURCE."USAGENET","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","STARTDATE" = DBT_INTERNAL_SOURCE."STARTDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","FILLINGDATECANCELLATION" = DBT_INTERNAL_SOURCE."FILLINGDATECANCELLATION","CANCELLATIONREASON" = DBT_INTERNAL_SOURCE."CANCELLATIONREASON","CITY" = DBT_INTERNAL_SOURCE."CITY","STATUS" = DBT_INTERNAL_SOURCE."STATUS","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")
    values
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")

;
[0m15:44:58.419605 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.699 seconds
[0m15:44:58.420594 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:58.421216 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
COMMIT
[0m15:44:58.524384 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.103 seconds
[0m15:44:58.528957 [debug] [Thread-1 (]: Applying DROP to: LB.STAGE.stg_contract__dbt_tmp
[0m15:44:58.532530 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:44:58.532793 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.STAGE.stg_contract__dbt_tmp cascade
[0m15:44:58.644389 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.111 seconds
[0m15:44:58.655742 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:44:58.763225 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e86ff60-bd91-4dcf-9f94-7772b5544c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16de8f990>]}
[0m15:44:58.764223 [info ] [Thread-1 (]: 1 of 3 OK created sql incremental model STAGE.stg_contract ..................... [[32mSUCCESS 0[0m in 2.52s]
[0m15:44:58.764995 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:44:58.765628 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:44:58.766461 [info ] [Thread-1 (]: 2 of 3 START sql incremental model STAGE.stg_prices ............................ [RUN]
[0m15:44:58.767038 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:44:58.767439 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:44:58.772567 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:44:58.773902 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:44:58.776649 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:44:58.776917 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m15:44:58.777075 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:44:59.137379 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.360 seconds
[0m15:44:59.139376 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m15:44:59.140419 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:44:59.140897 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m15:44:59.268506 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.127 seconds
[0m15:44:59.287520 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:44:59.288424 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:44:59.288626 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.STAGE.stg_prices
         as
        (

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
)

select * from incremental;
[0m15:44:59.379605 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58dd8-0202-cf6c-0000-0002d44667dd
[0m15:44:59.380247 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 23 at position 25 unexpected ';'.
[0m15:44:59.380846 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:44:59.524991 [debug] [Thread-1 (]: Database Error in model stg_prices (models/stage/stg_prices.sql)
  001003 (42000): SQL compilation error:
  syntax error line 23 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_prices.sql
[0m15:44:59.525814 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e86ff60-bd91-4dcf-9f94-7772b5544c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x170ecac90>]}
[0m15:44:59.526667 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model STAGE.stg_prices ................... [[31mERROR[0m in 0.76s]
[0m15:44:59.527388 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:44:59.527844 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:44:59.529120 [info ] [Thread-1 (]: 3 of 3 START sql incremental model STAGE.stg_products .......................... [RUN]
[0m15:44:59.529642 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:44:59.529971 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:44:59.533079 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:44:59.534217 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:44:59.539227 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:44:59.539502 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m15:44:59.539664 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:44:59.887744 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.348 seconds
[0m15:44:59.889387 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m15:44:59.890027 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:44:59.890348 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m15:44:59.975417 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m15:44:59.979014 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:44:59.981905 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:44:59.982556 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.STAGE.stg_products
         as
        (

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
)

select * from incremental;
[0m15:45:00.063871 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58dd9-0202-cf54-0000-0002d4464719
[0m15:45:00.064459 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 25 unexpected ';'.
[0m15:45:00.065043 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:45:00.174883 [debug] [Thread-1 (]: Database Error in model stg_products (models/stage/stg_products.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_products.sql
[0m15:45:00.175373 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e86ff60-bd91-4dcf-9f94-7772b5544c98', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x177bef050>]}
[0m15:45:00.175780 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model STAGE.stg_products ................. [[31mERROR[0m in 0.65s]
[0m15:45:00.176075 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:45:00.176907 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:45:00.177046 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m15:45:00.177249 [info ] [MainThread]: 
[0m15:45:00.177395 [info ] [MainThread]: Finished running 3 incremental models in 0 hours 0 minutes and 5.34 seconds (5.34s).
[0m15:45:00.177808 [debug] [MainThread]: Command end result
[0m15:45:00.199781 [info ] [MainThread]: 
[0m15:45:00.200609 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m15:45:00.201170 [info ] [MainThread]: 
[0m15:45:00.201834 [error] [MainThread]:   Database Error in model stg_prices (models/stage/stg_prices.sql)
  001003 (42000): SQL compilation error:
  syntax error line 23 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_prices.sql
[0m15:45:00.202084 [info ] [MainThread]: 
[0m15:45:00.202368 [error] [MainThread]:   Database Error in model stg_products (models/stage/stg_products.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_products.sql
[0m15:45:00.202513 [info ] [MainThread]: 
[0m15:45:00.202669 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
[0m15:45:00.205778 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.3256135, "process_user_time": 1.986078, "process_kernel_time": 2.607368, "process_mem_max_rss": "205766656", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:45:00.207403 [debug] [MainThread]: Command `dbt run` failed at 15:45:00.207150 after 6.33 seconds
[0m15:45:00.208274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a7bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b04750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a0acd0>]}
[0m15:45:00.208795 [debug] [MainThread]: Flushing usage events
[0m15:46:18.136085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c1ebd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c80f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c81610>]}


============================== 15:46:18.138229 | df31bc50-4dd3-4572-8acc-872cbace0e8f ==============================
[0m15:46:18.138229 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:46:18.138487 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:46:18.825186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df31bc50-4dd3-4572-8acc-872cbace0e8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1688b1fd0>]}
[0m15:46:18.847020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df31bc50-4dd3-4572-8acc-872cbace0e8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168ee2590>]}
[0m15:46:18.848017 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:46:18.868388 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:46:18.929078 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:46:18.929417 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_products.sql
[0m15:46:19.051346 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_products' (models/stage/stg_products.sql) depends on a source named 'raw.products' which was not found
[0m15:46:19.053180 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.9446578, "process_user_time": 1.885127, "process_kernel_time": 1.8714, "process_mem_max_rss": "189628416", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:46:19.053430 [debug] [MainThread]: Command `dbt run` failed at 15:46:19.053388 after 0.94 seconds
[0m15:46:19.053595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100912b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10098c050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1694d0090>]}
[0m15:46:19.053757 [debug] [MainThread]: Flushing usage events
[0m15:46:39.475608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1322435d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132280e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132281490>]}


============================== 15:46:39.477912 | c6a0b1eb-9894-40fb-ab16-b0255b8ea4d9 ==============================
[0m15:46:39.477912 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:46:39.478178 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:46:40.113025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c6a0b1eb-9894-40fb-ab16-b0255b8ea4d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1412217d0>]}
[0m15:46:40.130983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c6a0b1eb-9894-40fb-ab16-b0255b8ea4d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1318fcad0>]}
[0m15:46:40.131517 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:46:40.141891 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:46:40.209026 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:46:40.209399 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_products.sql
[0m15:46:40.350645 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:46:40.355845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c6a0b1eb-9894-40fb-ab16-b0255b8ea4d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142b43190>]}
[0m15:46:40.402198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c6a0b1eb-9894-40fb-ab16-b0255b8ea4d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142de8090>]}
[0m15:46:40.402628 [info ] [MainThread]: Found 3 seeds, 3 models, 3 sources, 448 macros
[0m15:46:40.402799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6a0b1eb-9894-40fb-ab16-b0255b8ea4d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132ab7690>]}
[0m15:46:40.403829 [info ] [MainThread]: 
[0m15:46:40.404778 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:46:40.406577 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:46:40.412373 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:46:40.412678 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:46:40.412920 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:46:41.018575 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.605 seconds
[0m15:46:41.021354 [debug] [ThreadPool]: On list_LB: Close
[0m15:46:41.141563 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m15:46:41.153439 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m15:46:41.153865 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m15:46:41.154132 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:46:41.688832 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.535 seconds
[0m15:46:41.691470 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m15:46:41.813989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6a0b1eb-9894-40fb-ab16-b0255b8ea4d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142e0f410>]}
[0m15:46:41.814397 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:46:41.814586 [info ] [MainThread]: 
[0m15:46:41.816162 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:46:41.816409 [info ] [Thread-1 (]: 1 of 3 START sql incremental model STAGE.stg_contract .......................... [RUN]
[0m15:46:41.816616 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.stg_contract)
[0m15:46:41.816773 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:46:41.823334 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:41.824075 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:46:41.835953 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:41.836303 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:46:41.836529 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:46:42.243638 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.407 seconds
[0m15:46:42.246323 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:46:42.247406 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:42.248279 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:46:42.397520 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.149 seconds
[0m15:46:42.419264 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:42.419628 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace  temporary view LB.STAGE.stg_contract__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
        where createdat > (select max(createdat) from LB.STAGE.stg_contract)
    
)

select * from incremental
  );
[0m15:46:42.869419 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.449 seconds
[0m15:46:42.874104 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:42.874389 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.STAGE.stg_contract__dbt_tmp
[0m15:46:42.965925 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.091 seconds
[0m15:46:42.967845 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:42.968046 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.STAGE.stg_contract
[0m15:46:43.055797 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.088 seconds
[0m15:46:43.060932 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:43.061197 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table "LB"."STAGE"."STG_CONTRACT"
[0m15:46:43.245096 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.183 seconds
[0m15:46:43.271941 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:43.272913 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:43.273106 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m15:46:43.393101 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.119 seconds
[0m15:46:43.394165 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:43.394862 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
merge into LB.STAGE.stg_contract as DBT_INTERNAL_DEST
        using LB.STAGE.stg_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","TYPE" = DBT_INTERNAL_SOURCE."TYPE","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","USAGE" = DBT_INTERNAL_SOURCE."USAGE","USAGENET" = DBT_INTERNAL_SOURCE."USAGENET","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","STARTDATE" = DBT_INTERNAL_SOURCE."STARTDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","FILLINGDATECANCELLATION" = DBT_INTERNAL_SOURCE."FILLINGDATECANCELLATION","CANCELLATIONREASON" = DBT_INTERNAL_SOURCE."CANCELLATIONREASON","CITY" = DBT_INTERNAL_SOURCE."CITY","STATUS" = DBT_INTERNAL_SOURCE."STATUS","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")
    values
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")

;
[0m15:46:43.996187 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.601 seconds
[0m15:46:43.996904 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:43.997239 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
COMMIT
[0m15:46:44.095319 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m15:46:44.106095 [debug] [Thread-1 (]: Applying DROP to: LB.STAGE.stg_contract__dbt_tmp
[0m15:46:44.112373 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:46:44.112817 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.STAGE.stg_contract__dbt_tmp cascade
[0m15:46:44.212992 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.100 seconds
[0m15:46:44.221950 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:46:44.322069 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6a0b1eb-9894-40fb-ab16-b0255b8ea4d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130419210>]}
[0m15:46:44.322707 [info ] [Thread-1 (]: 1 of 3 OK created sql incremental model STAGE.stg_contract ..................... [[32mSUCCESS 0[0m in 2.50s]
[0m15:46:44.323070 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:46:44.323277 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:46:44.323473 [info ] [Thread-1 (]: 2 of 3 START sql incremental model STAGE.stg_prices ............................ [RUN]
[0m15:46:44.323777 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:46:44.323986 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:46:44.326472 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:46:44.327267 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:46:44.328418 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:46:44.328664 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m15:46:44.328891 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:46:44.728377 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.399 seconds
[0m15:46:44.730617 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m15:46:44.731565 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:46:44.732108 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m15:46:44.829714 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.097 seconds
[0m15:46:44.847045 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:46:44.847685 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:46:44.847852 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.STAGE.stg_prices
         as
        (

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
)

select * from incremental;
[0m15:46:44.955170 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58dda-0202-cf6a-0000-0002d446773d
[0m15:46:44.955734 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 23 at position 25 unexpected ';'.
[0m15:46:44.956267 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:46:45.068372 [debug] [Thread-1 (]: Database Error in model stg_prices (models/stage/stg_prices.sql)
  001003 (42000): SQL compilation error:
  syntax error line 23 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_prices.sql
[0m15:46:45.069154 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6a0b1eb-9894-40fb-ab16-b0255b8ea4d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1312d3750>]}
[0m15:46:45.069832 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model STAGE.stg_prices ................... [[31mERROR[0m in 0.75s]
[0m15:46:45.070455 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:46:45.070911 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:46:45.072150 [info ] [Thread-1 (]: 3 of 3 START sql incremental model STAGE.stg_products .......................... [RUN]
[0m15:46:45.072640 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:46:45.072959 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:46:45.076920 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:46:45.077701 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:46:45.078881 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:46:45.079066 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m15:46:45.079217 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:46:45.488519 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.409 seconds
[0m15:46:45.493330 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m15:46:45.494778 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:46:45.495198 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m15:46:45.737303 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.242 seconds
[0m15:46:45.740994 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:46:45.742886 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:46:45.743529 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.STAGE.stg_products
         as
        (

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m15:46:46.576407 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.832 seconds
[0m15:46:46.589080 [debug] [Thread-1 (]: Applying DROP to: LB.STAGE.stg_products__dbt_tmp
[0m15:46:46.589623 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:46:46.589825 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
drop view if exists LB.STAGE.stg_products__dbt_tmp cascade
[0m15:46:46.676736 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.087 seconds
[0m15:46:46.678225 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:46:46.806488 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6a0b1eb-9894-40fb-ab16-b0255b8ea4d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142b9e610>]}
[0m15:46:46.808688 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model STAGE.stg_products ..................... [[32mSUCCESS 1[0m in 1.73s]
[0m15:46:46.809637 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:46:46.818605 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:46:46.818951 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m15:46:46.821290 [info ] [MainThread]: 
[0m15:46:46.821786 [info ] [MainThread]: Finished running 3 incremental models in 0 hours 0 minutes and 6.41 seconds (6.41s).
[0m15:46:46.822583 [debug] [MainThread]: Command end result
[0m15:46:46.847782 [info ] [MainThread]: 
[0m15:46:46.848079 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:46:46.848216 [info ] [MainThread]: 
[0m15:46:46.848385 [error] [MainThread]:   Database Error in model stg_prices (models/stage/stg_prices.sql)
  001003 (42000): SQL compilation error:
  syntax error line 23 at position 25 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/stage/stg_prices.sql
[0m15:46:46.848514 [info ] [MainThread]: 
[0m15:46:46.848657 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m15:46:46.850498 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.4042773, "process_user_time": 2.037931, "process_kernel_time": 2.195068, "process_mem_max_rss": "196460544", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:46:46.850921 [debug] [MainThread]: Command `dbt run` failed at 15:46:46.850875 after 7.40 seconds
[0m15:46:46.851215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104beed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132260ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1434bb350>]}
[0m15:46:46.851396 [debug] [MainThread]: Flushing usage events
[0m15:47:38.926707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14471f2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144781550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144781bd0>]}


============================== 15:47:38.929501 | b1e53d22-e5be-4b63-9a01-b1bd26df7a9a ==============================
[0m15:47:38.929501 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:47:38.929806 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:47:39.603944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b1e53d22-e5be-4b63-9a01-b1bd26df7a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c23690>]}
[0m15:47:39.624266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b1e53d22-e5be-4b63-9a01-b1bd26df7a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125b73210>]}
[0m15:47:39.624931 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:47:39.638203 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:47:39.692656 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:47:39.692970 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_prices.sql
[0m15:47:39.835698 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.snowflake_airflow_dbt.transform
[0m15:47:39.840490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b1e53d22-e5be-4b63-9a01-b1bd26df7a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14406f310>]}
[0m15:47:39.883594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b1e53d22-e5be-4b63-9a01-b1bd26df7a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1695c5d10>]}
[0m15:47:39.883867 [info ] [MainThread]: Found 3 seeds, 3 models, 3 sources, 448 macros
[0m15:47:39.884012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1e53d22-e5be-4b63-9a01-b1bd26df7a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169ad1e10>]}
[0m15:47:39.884823 [info ] [MainThread]: 
[0m15:47:39.885048 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:47:39.886942 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:47:39.892394 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:47:39.892596 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:47:39.892716 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:47:40.441546 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.549 seconds
[0m15:47:40.444357 [debug] [ThreadPool]: On list_LB: Close
[0m15:47:40.562501 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m15:47:40.574559 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m15:47:40.575059 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m15:47:40.575228 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:47:41.085178 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.510 seconds
[0m15:47:41.089147 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m15:47:41.201956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1e53d22-e5be-4b63-9a01-b1bd26df7a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125b44050>]}
[0m15:47:41.203605 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:47:41.204132 [info ] [MainThread]: 
[0m15:47:41.209801 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:47:41.210998 [info ] [Thread-1 (]: 1 of 3 START sql incremental model STAGE.stg_contract .......................... [RUN]
[0m15:47:41.212248 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.stg_contract)
[0m15:47:41.213060 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:47:41.225009 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:41.226573 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:47:41.244588 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:41.245056 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m15:47:41.245240 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:47:41.718016 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.472 seconds
[0m15:47:41.720526 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m15:47:41.721636 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:41.722053 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m15:47:41.812912 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.090 seconds
[0m15:47:41.839169 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:41.839879 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace  temporary view LB.STAGE.stg_contract__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
        where createdat > (select max(createdat) from LB.STAGE.stg_contract)
    
)

select * from incremental
  );
[0m15:47:42.191565 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.351 seconds
[0m15:47:42.202453 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:42.202870 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.STAGE.stg_contract__dbt_tmp
[0m15:47:42.325138 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.122 seconds
[0m15:47:42.335503 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:42.336128 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.STAGE.stg_contract
[0m15:47:42.409834 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.073 seconds
[0m15:47:42.413179 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:42.413362 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table "LB"."STAGE"."STG_CONTRACT"
[0m15:47:42.473768 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.060 seconds
[0m15:47:42.488665 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:42.490073 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:42.490257 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m15:47:42.606394 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.116 seconds
[0m15:47:42.607191 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:42.607837 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
merge into LB.STAGE.stg_contract as DBT_INTERNAL_DEST
        using LB.STAGE.stg_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","TYPE" = DBT_INTERNAL_SOURCE."TYPE","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","USAGE" = DBT_INTERNAL_SOURCE."USAGE","USAGENET" = DBT_INTERNAL_SOURCE."USAGENET","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","STARTDATE" = DBT_INTERNAL_SOURCE."STARTDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","FILLINGDATECANCELLATION" = DBT_INTERNAL_SOURCE."FILLINGDATECANCELLATION","CANCELLATIONREASON" = DBT_INTERNAL_SOURCE."CANCELLATIONREASON","CITY" = DBT_INTERNAL_SOURCE."CITY","STATUS" = DBT_INTERNAL_SOURCE."STATUS","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")
    values
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")

;
[0m15:47:43.197363 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.589 seconds
[0m15:47:43.198338 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:43.198905 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
COMMIT
[0m15:47:43.306274 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.107 seconds
[0m15:47:43.318825 [debug] [Thread-1 (]: Applying DROP to: LB.STAGE.stg_contract__dbt_tmp
[0m15:47:43.326256 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:47:43.326825 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.STAGE.stg_contract__dbt_tmp cascade
[0m15:47:43.459624 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.132 seconds
[0m15:47:43.476282 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:47:43.578782 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1e53d22-e5be-4b63-9a01-b1bd26df7a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169edf410>]}
[0m15:47:43.579357 [info ] [Thread-1 (]: 1 of 3 OK created sql incremental model STAGE.stg_contract ..................... [[32mSUCCESS 0[0m in 2.37s]
[0m15:47:43.579726 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:47:43.579964 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:47:43.580183 [info ] [Thread-1 (]: 2 of 3 START sql incremental model STAGE.stg_prices ............................ [RUN]
[0m15:47:43.580533 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:47:43.580758 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:47:43.582755 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:47:43.583597 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:47:43.584902 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:47:43.585100 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m15:47:43.585274 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:47:43.997778 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.412 seconds
[0m15:47:44.000241 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m15:47:44.000928 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:47:44.001274 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m15:47:44.091513 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.090 seconds
[0m15:47:44.102982 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:47:44.104347 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:47:44.104909 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.STAGE.stg_prices
         as
        (

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m15:47:45.145517 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.040 seconds
[0m15:47:45.152056 [debug] [Thread-1 (]: Applying DROP to: LB.STAGE.stg_prices__dbt_tmp
[0m15:47:45.153231 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:47:45.153752 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
drop view if exists LB.STAGE.stg_prices__dbt_tmp cascade
[0m15:47:45.216809 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.062 seconds
[0m15:47:45.220520 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:47:45.327892 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1e53d22-e5be-4b63-9a01-b1bd26df7a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1697b40d0>]}
[0m15:47:45.329078 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model STAGE.stg_prices ....................... [[32mSUCCESS 1[0m in 1.75s]
[0m15:47:45.329979 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:47:45.330648 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:47:45.331535 [info ] [Thread-1 (]: 3 of 3 START sql incremental model STAGE.stg_products .......................... [RUN]
[0m15:47:45.332264 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:47:45.332746 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:47:45.337879 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:47:45.339365 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:47:45.341326 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:47:45.341610 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m15:47:45.341777 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:47:45.738303 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.396 seconds
[0m15:47:45.741131 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m15:47:45.743308 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:47:45.744069 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m15:47:45.820838 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.075 seconds
[0m15:47:45.825668 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:47:45.826420 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace  temporary view LB.STAGE.stg_products__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
        where modificationdate > (select max(modificationdate) from LB.STAGE.stg_products)
    
)

select * from incremental
  );
[0m15:47:46.083925 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.257 seconds
[0m15:47:46.089557 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:47:46.090142 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table LB.STAGE.stg_products__dbt_tmp
[0m15:47:46.364486 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.274 seconds
[0m15:47:46.371886 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:47:46.372672 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table LB.STAGE.stg_products
[0m15:47:46.435345 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.062 seconds
[0m15:47:46.442754 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:47:46.443391 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table "LB"."STAGE"."STG_PRODUCTS"
[0m15:47:46.519157 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.075 seconds
[0m15:47:46.525413 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:47:46.528932 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:47:46.529522 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
-- back compat for old kwarg name
  
  begin;
[0m15:47:46.641529 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.111 seconds
[0m15:47:46.642806 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:47:46.643574 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
merge into LB.STAGE.stg_products as DBT_INTERNAL_DEST
        using LB.STAGE.stg_products__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "MODIFICATIONDATE")
    values
        ("ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "MODIFICATIONDATE")

;
[0m15:47:47.192181 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.548 seconds
[0m15:47:47.193477 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:47:47.194011 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
COMMIT
[0m15:47:47.426762 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.232 seconds
[0m15:47:47.428534 [debug] [Thread-1 (]: Applying DROP to: LB.STAGE.stg_products__dbt_tmp
[0m15:47:47.428898 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:47:47.429088 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
drop view if exists LB.STAGE.stg_products__dbt_tmp cascade
[0m15:47:47.601875 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.172 seconds
[0m15:47:47.605609 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:47:47.736758 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1e53d22-e5be-4b63-9a01-b1bd26df7a9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1442cfc10>]}
[0m15:47:47.738050 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model STAGE.stg_products ..................... [[32mSUCCESS 0[0m in 2.40s]
[0m15:47:47.738871 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:47:47.741062 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:47:47.741518 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m15:47:47.742040 [info ] [MainThread]: 
[0m15:47:47.742453 [info ] [MainThread]: Finished running 3 incremental models in 0 hours 0 minutes and 7.86 seconds (7.86s).
[0m15:47:47.743428 [debug] [MainThread]: Command end result
[0m15:47:47.773438 [info ] [MainThread]: 
[0m15:47:47.774245 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:47:47.774551 [info ] [MainThread]: 
[0m15:47:47.774792 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m15:47:47.778309 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.885428, "process_user_time": 2.181203, "process_kernel_time": 2.58274, "process_mem_max_rss": "201244672", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:47:47.779465 [debug] [MainThread]: Command `dbt run` succeeded at 15:47:47.779297 after 8.89 seconds
[0m15:47:47.780316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1010fc690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101002d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10107c090>]}
[0m15:47:47.780812 [debug] [MainThread]: Flushing usage events
[0m16:26:27.603244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1220978d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1220bd250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1220bd8d0>]}


============================== 16:26:27.605662 | 4008c9e5-359e-456f-a571-da2d15a6f452 ==============================
[0m16:26:27.605662 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:26:27.605932 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m16:26:28.362602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4008c9e5-359e-456f-a571-da2d15a6f452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14137c7d0>]}
[0m16:26:28.381753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4008c9e5-359e-456f-a571-da2d15a6f452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1220895d0>]}
[0m16:26:28.382350 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:26:28.393577 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m16:26:28.434424 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m16:26:28.434755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4008c9e5-359e-456f-a571-da2d15a6f452', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120932a10>]}
[0m16:26:28.967744 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:26:28.968094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '4008c9e5-359e-456f-a571-da2d15a6f452', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121db0f90>]}
[0m16:26:29.019231 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_contract' (models/mart/fact_contract.sql) depends on a node named 'stg_contracts' which was not found
[0m16:26:29.020857 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4452922, "process_user_time": 2.229959, "process_kernel_time": 2.126462, "process_mem_max_rss": "189399040", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:26:29.021245 [debug] [MainThread]: Command `dbt run` failed at 16:26:29.021197 after 1.45 seconds
[0m16:26:29.021449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1220bd690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10440ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122095750>]}
[0m16:26:29.021628 [debug] [MainThread]: Flushing usage events
[0m16:27:03.443080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130b19790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1305ec790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130b5acd0>]}


============================== 16:27:03.445495 | acadf476-d844-47ca-b24f-527b22f85961 ==============================
[0m16:27:03.445495 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:27:03.445761 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m16:27:04.095025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1522cc210>]}
[0m16:27:04.113433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130400b50>]}
[0m16:27:04.114024 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:27:04.124957 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m16:27:04.162253 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m16:27:04.162544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f432c10>]}
[0m16:27:04.641468 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:27:04.641749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152721410>]}
[0m16:27:04.720031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1525cd850>]}
[0m16:27:04.767314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153336f10>]}
[0m16:27:04.767573 [info ] [MainThread]: Found 6 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m16:27:04.767721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1531ba510>]}
[0m16:27:04.768530 [info ] [MainThread]: 
[0m16:27:04.768754 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:27:04.770509 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m16:27:04.775596 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:27:04.775771 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:27:04.775890 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:27:05.273545 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.497 seconds
[0m16:27:05.276928 [debug] [ThreadPool]: On list_LB: Close
[0m16:27:05.404525 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:27:05.405008 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:27:05.405247 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:27:05.775189 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.370 seconds
[0m16:27:05.778162 [debug] [ThreadPool]: On list_LB: Close
[0m16:27:05.909188 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m16:27:05.919515 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m16:27:05.919948 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m16:27:05.920231 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:27:06.330225 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.410 seconds
[0m16:27:06.332606 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m16:27:06.443614 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m16:27:06.445699 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m16:27:06.446266 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m16:27:06.446532 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:27:06.920650 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.474 seconds
[0m16:27:06.939806 [debug] [ThreadPool]: On list_LB_stage: Close
[0m16:27:07.050654 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m16:27:07.056811 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m16:27:07.057397 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m16:27:07.057824 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:27:07.393421 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.336 seconds
[0m16:27:07.394704 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m16:27:07.499978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152766bd0>]}
[0m16:27:07.500550 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:27:07.500724 [info ] [MainThread]: 
[0m16:27:07.504439 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m16:27:07.504928 [info ] [Thread-1 (]: 1 of 6 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m16:27:07.505284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m16:27:07.505502 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m16:27:07.510395 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m16:27:07.511025 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m16:27:07.520130 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:27:07.520526 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m16:27:07.520747 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:27:07.830544 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.310 seconds
[0m16:27:07.831913 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m16:27:07.832484 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:27:07.832760 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m16:27:07.910326 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.077 seconds
[0m16:27:07.919692 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m16:27:07.920618 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:27:07.920813 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m16:27:08.934694 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.013 seconds
[0m16:27:08.955398 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m16:27:09.059759 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15369bb50>]}
[0m16:27:09.060927 [info ] [Thread-1 (]: 1 of 6 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.55s]
[0m16:27:09.061642 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m16:27:09.062195 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m16:27:09.062937 [info ] [Thread-1 (]: 2 of 6 START sql incremental model stage.stg_contract .......................... [RUN]
[0m16:27:09.063548 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m16:27:09.063978 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m16:27:09.069588 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:09.070746 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m16:27:09.079385 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:09.079677 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m16:27:09.079826 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:27:09.480861 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.401 seconds
[0m16:27:09.482386 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m16:27:09.483007 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:09.483302 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m16:27:09.570726 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.087 seconds
[0m16:27:09.590026 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:09.590317 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace  temporary view LB.stage.stg_contract__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
        where createdat > (select max(createdat) from LB.stage.stg_contract)
    
)

select * from incremental
  );
[0m16:27:09.918920 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.328 seconds
[0m16:27:09.925636 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:09.925926 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.stage.stg_contract__dbt_tmp
[0m16:27:10.011306 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.085 seconds
[0m16:27:10.015792 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:10.016076 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.stage.stg_contract
[0m16:27:10.077267 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.061 seconds
[0m16:27:10.086258 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:10.086727 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table "LB"."STAGE"."STG_CONTRACT"
[0m16:27:10.188386 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.101 seconds
[0m16:27:10.213618 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:10.215615 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:10.215876 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:27:10.314243 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m16:27:10.314977 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:10.315474 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
merge into LB.stage.stg_contract as DBT_INTERNAL_DEST
        using LB.stage.stg_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","TYPE" = DBT_INTERNAL_SOURCE."TYPE","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","USAGE" = DBT_INTERNAL_SOURCE."USAGE","USAGENET" = DBT_INTERNAL_SOURCE."USAGENET","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","STARTDATE" = DBT_INTERNAL_SOURCE."STARTDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","FILLINGDATECANCELLATION" = DBT_INTERNAL_SOURCE."FILLINGDATECANCELLATION","CANCELLATIONREASON" = DBT_INTERNAL_SOURCE."CANCELLATIONREASON","CITY" = DBT_INTERNAL_SOURCE."CITY","STATUS" = DBT_INTERNAL_SOURCE."STATUS","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")
    values
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")

;
[0m16:27:10.709320 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.391 seconds
[0m16:27:10.710983 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:10.711349 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
COMMIT
[0m16:27:10.829836 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.118 seconds
[0m16:27:10.848511 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_contract__dbt_tmp
[0m16:27:10.852127 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:27:10.852365 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.stage.stg_contract__dbt_tmp cascade
[0m16:27:10.963125 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.110 seconds
[0m16:27:10.976078 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m16:27:11.102299 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15322bfd0>]}
[0m16:27:11.103264 [info ] [Thread-1 (]: 2 of 6 OK created sql incremental model stage.stg_contract ..................... [[32mSUCCESS 0[0m in 2.04s]
[0m16:27:11.103767 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m16:27:11.104112 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m16:27:11.104800 [info ] [Thread-1 (]: 3 of 6 START sql incremental model stage.stg_prices ............................ [RUN]
[0m16:27:11.105146 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m16:27:11.105327 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m16:27:11.107583 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:11.108260 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m16:27:11.109287 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:11.109454 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m16:27:11.109607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:27:11.422737 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.313 seconds
[0m16:27:11.425626 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m16:27:11.426774 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:11.427312 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m16:27:11.514479 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.087 seconds
[0m16:27:11.518542 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:11.519122 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace  temporary view LB.stage.stg_prices__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
        where modificationdate > (select max(modificationdate) from LB.stage.stg_prices)
    
)

select * from incremental
  );
[0m16:27:11.830832 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.311 seconds
[0m16:27:11.834719 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:11.835212 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
describe table LB.stage.stg_prices__dbt_tmp
[0m16:27:11.957478 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.122 seconds
[0m16:27:11.964729 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:11.965385 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
describe table LB.stage.stg_prices
[0m16:27:12.044141 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.078 seconds
[0m16:27:12.051461 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:12.052105 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
describe table "LB"."STAGE"."STG_PRICES"
[0m16:27:12.132192 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.079 seconds
[0m16:27:12.139468 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:12.147279 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:12.147831 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
-- back compat for old kwarg name
  
  begin;
[0m16:27:12.255097 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.107 seconds
[0m16:27:12.255718 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:12.256132 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
merge into LB.stage.stg_prices as DBT_INTERNAL_DEST
        using LB.stage.stg_prices__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRICECOMPONENTID" = DBT_INTERNAL_SOURCE."PRICECOMPONENTID","PRODUCTCOMPONENT" = DBT_INTERNAL_SOURCE."PRODUCTCOMPONENT","PRICE" = DBT_INTERNAL_SOURCE."PRICE","UNIT" = DBT_INTERNAL_SOURCE."UNIT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_UNTIL" = DBT_INTERNAL_SOURCE."VALID_UNTIL","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "PRODUCTID", "PRICECOMPONENTID", "PRODUCTCOMPONENT", "PRICE", "UNIT", "VALID_FROM", "VALID_UNTIL", "MODIFICATIONDATE")
    values
        ("ID", "PRODUCTID", "PRICECOMPONENTID", "PRODUCTCOMPONENT", "PRICE", "UNIT", "VALID_FROM", "VALID_UNTIL", "MODIFICATIONDATE")

;
[0m16:27:12.753143 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.496 seconds
[0m16:27:12.754492 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:12.755175 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
COMMIT
[0m16:27:13.059162 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.303 seconds
[0m16:27:13.063498 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_prices__dbt_tmp
[0m16:27:13.064356 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:27:13.064764 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
drop view if exists LB.stage.stg_prices__dbt_tmp cascade
[0m16:27:13.182290 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.117 seconds
[0m16:27:13.185633 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m16:27:13.291545 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1536ad090>]}
[0m16:27:13.292841 [info ] [Thread-1 (]: 3 of 6 OK created sql incremental model stage.stg_prices ....................... [[32mSUCCESS 0[0m in 2.19s]
[0m16:27:13.293824 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m16:27:13.294533 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m16:27:13.295411 [info ] [Thread-1 (]: 4 of 6 START sql incremental model stage.stg_products .......................... [RUN]
[0m16:27:13.296195 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m16:27:13.296675 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m16:27:13.302394 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m16:27:13.305996 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m16:27:13.311166 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:27:13.311607 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m16:27:13.311918 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:27:13.724622 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.413 seconds
[0m16:27:13.726671 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m16:27:13.727517 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:27:13.730577 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m16:27:13.819406 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.088 seconds
[0m16:27:13.823976 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:27:13.824444 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace  temporary view LB.stage.stg_products__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
        where modificationdate > (select max(modificationdate) from LB.stage.stg_products)
    
)

select * from incremental
  );
[0m16:27:14.085113 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.260 seconds
[0m16:27:14.091445 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:27:14.092115 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table LB.stage.stg_products__dbt_tmp
[0m16:27:14.177493 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.085 seconds
[0m16:27:14.184643 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:27:14.185284 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table LB.stage.stg_products
[0m16:27:14.259627 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.074 seconds
[0m16:27:14.267196 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:27:14.267980 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table "LB"."STAGE"."STG_PRODUCTS"
[0m16:27:14.332040 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.063 seconds
[0m16:27:14.337970 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m16:27:14.342590 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:27:14.343170 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
-- back compat for old kwarg name
  
  begin;
[0m16:27:14.444173 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.100 seconds
[0m16:27:14.444748 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:27:14.445079 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
merge into LB.stage.stg_products as DBT_INTERNAL_DEST
        using LB.stage.stg_products__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "MODIFICATIONDATE")
    values
        ("ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "MODIFICATIONDATE")

;
[0m16:27:15.188415 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.743 seconds
[0m16:27:15.189214 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:27:15.189668 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
COMMIT
[0m16:27:15.519631 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.329 seconds
[0m16:27:15.525768 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_products__dbt_tmp
[0m16:27:15.527324 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:27:15.527836 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
drop view if exists LB.stage.stg_products__dbt_tmp cascade
[0m16:27:15.634750 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.106 seconds
[0m16:27:15.638175 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m16:27:15.746184 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15305b290>]}
[0m16:27:15.747554 [info ] [Thread-1 (]: 4 of 6 OK created sql incremental model stage.stg_products ..................... [[32mSUCCESS 0[0m in 2.45s]
[0m16:27:15.748468 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m16:27:15.749273 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m16:27:15.750278 [info ] [Thread-1 (]: 5 of 6 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m16:27:15.750794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_contract)
[0m16:27:15.751135 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m16:27:15.755943 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:27:15.757153 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m16:27:15.759679 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:27:15.760087 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m16:27:15.760394 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:27:16.158649 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.398 seconds
[0m16:27:16.161091 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m16:27:16.162140 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:27:16.162652 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m16:27:16.240131 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.077 seconds
[0m16:27:16.244389 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:27:16.246697 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:27:16.247406 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace transient table LB.dwh_mart.fact_contract
         as
        (

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
)

select * from incremental
        );
[0m16:27:16.850729 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.602 seconds
[0m16:27:16.857191 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m16:27:16.858634 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:27:16.859253 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m16:27:16.928514 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.069 seconds
[0m16:27:16.931564 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m16:27:17.035347 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15388aa50>]}
[0m16:27:17.036877 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 1[0m in 1.28s]
[0m16:27:17.037795 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m16:27:17.038537 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m16:27:17.039313 [info ] [Thread-1 (]: 6 of 6 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m16:27:17.039953 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_contract, now model.snowflake_airflow_dbt.dim_product)
[0m16:27:17.040486 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m16:27:17.046246 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m16:27:17.047787 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m16:27:17.053754 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:27:17.054410 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m16:27:17.054786 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:27:17.459389 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.404 seconds
[0m16:27:17.461694 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m16:27:17.462617 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:27:17.463107 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m16:27:17.536775 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.073 seconds
[0m16:27:17.540752 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m16:27:17.544370 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:27:17.545003 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m16:27:17.637052 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e03-0202-cf6b-0000-0002d44637d1
[0m16:27:17.637643 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
[0m16:27:17.638177 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m16:27:17.744723 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m16:27:17.745551 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acadf476-d844-47ca-b24f-527b22f85961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1530ab550>]}
[0m16:27:17.746310 [error] [Thread-1 (]: 6 of 6 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 0.71s]
[0m16:27:17.746959 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m16:27:17.749122 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:27:17.749454 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m16:27:17.749815 [info ] [MainThread]: 
[0m16:27:17.750125 [info ] [MainThread]: Finished running 1 table model, 5 incremental models in 0 hours 0 minutes and 12.98 seconds (12.98s).
[0m16:27:17.751228 [debug] [MainThread]: Command end result
[0m16:27:17.768098 [info ] [MainThread]: 
[0m16:27:17.768432 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:27:17.768564 [info ] [MainThread]: 
[0m16:27:17.768745 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m16:27:17.768892 [info ] [MainThread]: 
[0m16:27:17.769063 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m16:27:17.771143 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 14.355843, "process_user_time": 3.007023, "process_kernel_time": 2.665292, "process_mem_max_rss": "211632128", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:27:17.771482 [debug] [MainThread]: Command `dbt run` failed at 16:27:17.771443 after 14.36 seconds
[0m16:27:17.771678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102706d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1527770d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102780090>]}
[0m16:27:17.771860 [debug] [MainThread]: Flushing usage events
[0m16:32:36.825021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144657b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1446bd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1446bd950>]}


============================== 16:32:36.828333 | aedeb227-3530-404d-bf2d-8c5013cebdfd ==============================
[0m16:32:36.828333 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:32:36.828676 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:32:36.831112 [error] [MainThread]: Encountered an error:
Runtime Error
  outputs not specified in profile 'default'
[0m16:32:36.833036 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.057970334, "process_user_time": 1.756873, "process_kernel_time": 1.315988, "process_mem_max_rss": "112689152", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:32:36.833420 [debug] [MainThread]: Command `dbt run` failed at 16:32:36.833355 after 0.06 seconds
[0m16:32:36.833636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14456c810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f6ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1441f0350>]}
[0m16:32:36.833855 [debug] [MainThread]: Flushing usage events
[0m16:33:56.366331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16811ad50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168180dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168181450>]}


============================== 16:33:56.368681 | aed14a8c-c2f9-4c5d-8e03-c92fc6b25b6b ==============================
[0m16:33:56.368681 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:33:56.368951 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:33:56.370384 [error] [MainThread]: Encountered an error:
Runtime Error
  The profile 'default' does not have a target named 'devv'. The valid target names for this profile are:
   - dev
[0m16:33:56.371675 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.033973165, "process_user_time": 1.079519, "process_kernel_time": 2.34033, "process_mem_max_rss": "114917376", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:33:56.371943 [debug] [MainThread]: Command `dbt run` failed at 16:33:56.371905 after 0.03 seconds
[0m16:33:56.372102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fcf0510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a46d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ac0090>]}
[0m16:33:56.372242 [debug] [MainThread]: Flushing usage events
[0m16:34:12.261514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c41ca10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c481150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c481790>]}


============================== 16:34:12.264084 | 6e8471e3-c42e-440f-ab99-2fe9a123a8c2 ==============================
[0m16:34:12.264084 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:34:12.264403 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m16:34:13.132959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14947ecd0>]}
[0m16:34:13.154032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fbfc9d0>]}
[0m16:34:13.154699 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:34:13.167227 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m16:34:13.232136 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:34:13.232360 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:34:13.252956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1495d42d0>]}
[0m16:34:13.303121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1494d6a90>]}
[0m16:34:13.303410 [info ] [MainThread]: Found 6 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m16:34:13.303569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1495c7e10>]}
[0m16:34:13.304624 [info ] [MainThread]: 
[0m16:34:13.304909 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:34:13.306795 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m16:34:13.313061 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:34:13.313333 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:34:13.313466 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:34:13.924501 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.611 seconds
[0m16:34:13.927005 [debug] [ThreadPool]: On list_LB: Close
[0m16:34:14.078472 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:34:14.079074 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:34:14.079409 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:14.524971 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.445 seconds
[0m16:34:14.528033 [debug] [ThreadPool]: On list_LB: Close
[0m16:34:14.646275 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m16:34:14.656172 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m16:34:14.656407 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m16:34:14.656538 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:15.007685 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.351 seconds
[0m16:34:15.011043 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m16:34:15.118680 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m16:34:15.123267 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m16:34:15.123907 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m16:34:15.124287 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:15.486297 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.362 seconds
[0m16:34:15.489336 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m16:34:15.596887 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m16:34:15.601760 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m16:34:15.602180 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m16:34:15.602439 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:16.339933 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.737 seconds
[0m16:34:16.342201 [debug] [ThreadPool]: On list_LB_stage: Close
[0m16:34:16.963444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f210290>]}
[0m16:34:16.965414 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:34:16.965987 [info ] [MainThread]: 
[0m16:34:16.969834 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m16:34:16.973098 [info ] [Thread-1 (]: 1 of 6 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m16:34:16.973791 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m16:34:16.974211 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m16:34:16.986013 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m16:34:16.987689 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m16:34:16.996213 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:34:16.996561 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m16:34:16.996793 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:17.454099 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.457 seconds
[0m16:34:17.457631 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m16:34:17.458813 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:34:17.459232 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m16:34:17.541112 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.081 seconds
[0m16:34:17.564572 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m16:34:17.566734 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:34:17.567053 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m16:34:18.472701 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.905 seconds
[0m16:34:18.497723 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m16:34:18.594491 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1495a0950>]}
[0m16:34:18.595394 [info ] [Thread-1 (]: 1 of 6 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.62s]
[0m16:34:18.596054 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m16:34:18.596475 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m16:34:18.597069 [info ] [Thread-1 (]: 2 of 6 START sql incremental model stage.stg_contract .......................... [RUN]
[0m16:34:18.597605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m16:34:18.598008 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m16:34:18.606687 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:18.607745 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m16:34:18.621149 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:18.621527 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m16:34:18.622112 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:18.972545 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.351 seconds
[0m16:34:18.975431 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m16:34:18.976480 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:18.976978 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m16:34:19.078702 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.101 seconds
[0m16:34:19.098878 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:19.099311 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace  temporary view LB.stage.stg_contract__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
        where createdat > (select max(createdat) from LB.stage.stg_contract)
    
)

select * from incremental
  );
[0m16:34:19.462572 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.363 seconds
[0m16:34:19.475860 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:19.476577 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.stage.stg_contract__dbt_tmp
[0m16:34:19.557514 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.080 seconds
[0m16:34:19.561815 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:19.562226 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.stage.stg_contract
[0m16:34:19.631952 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.069 seconds
[0m16:34:19.645338 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:19.646403 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table "LB"."STAGE"."STG_CONTRACT"
[0m16:34:19.720264 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.073 seconds
[0m16:34:19.743360 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:19.744832 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:19.745075 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:34:19.834249 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.089 seconds
[0m16:34:19.834899 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:19.835385 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
merge into LB.stage.stg_contract as DBT_INTERNAL_DEST
        using LB.stage.stg_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","TYPE" = DBT_INTERNAL_SOURCE."TYPE","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","USAGE" = DBT_INTERNAL_SOURCE."USAGE","USAGENET" = DBT_INTERNAL_SOURCE."USAGENET","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","STARTDATE" = DBT_INTERNAL_SOURCE."STARTDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","FILLINGDATECANCELLATION" = DBT_INTERNAL_SOURCE."FILLINGDATECANCELLATION","CANCELLATIONREASON" = DBT_INTERNAL_SOURCE."CANCELLATIONREASON","CITY" = DBT_INTERNAL_SOURCE."CITY","STATUS" = DBT_INTERNAL_SOURCE."STATUS","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")
    values
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")

;
[0m16:34:20.487963 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.652 seconds
[0m16:34:20.488980 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:20.489574 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
COMMIT
[0m16:34:20.611436 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.121 seconds
[0m16:34:20.626133 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_contract__dbt_tmp
[0m16:34:20.633361 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:34:20.633813 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.stage.stg_contract__dbt_tmp cascade
[0m16:34:20.792764 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.159 seconds
[0m16:34:20.794372 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m16:34:20.896026 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149863dd0>]}
[0m16:34:20.896614 [info ] [Thread-1 (]: 2 of 6 OK created sql incremental model stage.stg_contract ..................... [[32mSUCCESS 0[0m in 2.30s]
[0m16:34:20.896976 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m16:34:20.897220 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m16:34:20.897572 [info ] [Thread-1 (]: 3 of 6 START sql incremental model stage.stg_prices ............................ [RUN]
[0m16:34:20.897972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m16:34:20.898190 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m16:34:20.901487 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:20.902665 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m16:34:20.904803 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:20.905169 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m16:34:20.905467 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:21.292719 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.387 seconds
[0m16:34:21.293647 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m16:34:21.294009 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:21.294174 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m16:34:21.388072 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m16:34:21.392882 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:21.393574 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace  temporary view LB.stage.stg_prices__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
        where modificationdate > (select max(modificationdate) from LB.stage.stg_prices)
    
)

select * from incremental
  );
[0m16:34:22.638947 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.245 seconds
[0m16:34:22.647632 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:22.648282 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
describe table LB.stage.stg_prices__dbt_tmp
[0m16:34:22.726130 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.077 seconds
[0m16:34:22.734686 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:22.735482 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
describe table LB.stage.stg_prices
[0m16:34:22.821766 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.086 seconds
[0m16:34:22.828882 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:22.829709 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
describe table "LB"."STAGE"."STG_PRICES"
[0m16:34:22.903006 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.073 seconds
[0m16:34:22.906380 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:22.908278 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:22.908630 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
-- back compat for old kwarg name
  
  begin;
[0m16:34:23.036168 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.127 seconds
[0m16:34:23.036847 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:23.037260 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
merge into LB.stage.stg_prices as DBT_INTERNAL_DEST
        using LB.stage.stg_prices__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRICECOMPONENTID" = DBT_INTERNAL_SOURCE."PRICECOMPONENTID","PRODUCTCOMPONENT" = DBT_INTERNAL_SOURCE."PRODUCTCOMPONENT","PRICE" = DBT_INTERNAL_SOURCE."PRICE","UNIT" = DBT_INTERNAL_SOURCE."UNIT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_UNTIL" = DBT_INTERNAL_SOURCE."VALID_UNTIL","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "PRODUCTID", "PRICECOMPONENTID", "PRODUCTCOMPONENT", "PRICE", "UNIT", "VALID_FROM", "VALID_UNTIL", "MODIFICATIONDATE")
    values
        ("ID", "PRODUCTID", "PRICECOMPONENTID", "PRODUCTCOMPONENT", "PRICE", "UNIT", "VALID_FROM", "VALID_UNTIL", "MODIFICATIONDATE")

;
[0m16:34:23.662596 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.625 seconds
[0m16:34:23.663680 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:23.664249 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
COMMIT
[0m16:34:24.273633 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.609 seconds
[0m16:34:24.278861 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_prices__dbt_tmp
[0m16:34:24.279923 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:34:24.280276 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
drop view if exists LB.stage.stg_prices__dbt_tmp cascade
[0m16:34:24.383241 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.103 seconds
[0m16:34:24.386026 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m16:34:24.487170 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149f2f910>]}
[0m16:34:24.488468 [info ] [Thread-1 (]: 3 of 6 OK created sql incremental model stage.stg_prices ....................... [[32mSUCCESS 0[0m in 3.59s]
[0m16:34:24.489528 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m16:34:24.490286 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m16:34:24.491186 [info ] [Thread-1 (]: 4 of 6 START sql incremental model stage.stg_products .......................... [RUN]
[0m16:34:24.491860 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m16:34:24.492283 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m16:34:24.496640 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m16:34:24.497405 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m16:34:24.498688 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:34:24.498892 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m16:34:24.499048 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:24.908903 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.409 seconds
[0m16:34:24.912006 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m16:34:24.913158 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:34:24.913702 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m16:34:24.994862 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.080 seconds
[0m16:34:25.000386 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:34:25.001431 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace  temporary view LB.stage.stg_products__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
        where modificationdate > (select max(modificationdate) from LB.stage.stg_products)
    
)

select * from incremental
  );
[0m16:34:25.298876 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.296 seconds
[0m16:34:25.305167 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:34:25.305887 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table LB.stage.stg_products__dbt_tmp
[0m16:34:25.384594 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.078 seconds
[0m16:34:25.390573 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:34:25.391721 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table LB.stage.stg_products
[0m16:34:25.464580 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.072 seconds
[0m16:34:25.466990 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:34:25.467239 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table "LB"."STAGE"."STG_PRODUCTS"
[0m16:34:25.526661 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.059 seconds
[0m16:34:25.529097 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m16:34:25.530308 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:34:25.530452 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
-- back compat for old kwarg name
  
  begin;
[0m16:34:25.619224 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.088 seconds
[0m16:34:25.620215 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:34:25.620851 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
merge into LB.stage.stg_products as DBT_INTERNAL_DEST
        using LB.stage.stg_products__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "MODIFICATIONDATE")
    values
        ("ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "MODIFICATIONDATE")

;
[0m16:34:26.222864 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.601 seconds
[0m16:34:26.224125 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:34:26.224541 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
COMMIT
[0m16:34:26.527561 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.302 seconds
[0m16:34:26.533315 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_products__dbt_tmp
[0m16:34:26.534453 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:34:26.535023 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
drop view if exists LB.stage.stg_products__dbt_tmp cascade
[0m16:34:26.663905 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.128 seconds
[0m16:34:26.665877 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m16:34:26.766197 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149f50810>]}
[0m16:34:26.766850 [info ] [Thread-1 (]: 4 of 6 OK created sql incremental model stage.stg_products ..................... [[32mSUCCESS 0[0m in 2.27s]
[0m16:34:26.767263 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m16:34:26.767573 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m16:34:26.768137 [info ] [Thread-1 (]: 5 of 6 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m16:34:26.768612 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_contract)
[0m16:34:26.768863 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m16:34:26.771070 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:26.772903 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m16:34:26.774217 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:26.774903 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m16:34:26.775105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:27.463802 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.689 seconds
[0m16:34:27.464542 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m16:34:27.464846 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:27.465001 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m16:34:27.543503 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.078 seconds
[0m16:34:27.544824 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:27.545010 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m16:34:27.799627 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.254 seconds
[0m16:34:27.804655 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:27.805196 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m16:34:27.963183 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.157 seconds
[0m16:34:27.971503 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:27.972261 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m16:34:28.052440 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.079 seconds
[0m16:34:28.058720 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:28.059355 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m16:34:28.142269 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.082 seconds
[0m16:34:28.151759 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:28.153828 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:28.154356 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:34:28.238142 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.083 seconds
[0m16:34:28.239239 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:28.240029 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m16:34:28.677182 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.437 seconds
[0m16:34:28.677879 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:28.678221 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m16:34:28.813203 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.135 seconds
[0m16:34:28.817318 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m16:34:28.818286 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:34:28.818757 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m16:34:28.941886 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.122 seconds
[0m16:34:28.945210 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m16:34:29.047945 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149cd2b50>]}
[0m16:34:29.049200 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 2.28s]
[0m16:34:29.050067 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m16:34:29.050476 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m16:34:29.051138 [info ] [Thread-1 (]: 6 of 6 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m16:34:29.051918 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_contract, now model.snowflake_airflow_dbt.dim_product)
[0m16:34:29.052253 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m16:34:29.056657 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m16:34:29.057512 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m16:34:29.060570 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:34:29.061098 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m16:34:29.061323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:29.411579 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.350 seconds
[0m16:34:29.413247 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m16:34:29.414074 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:34:29.414660 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m16:34:29.511875 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.097 seconds
[0m16:34:29.515911 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m16:34:29.520866 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:34:29.521564 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m16:34:29.613933 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e0a-0202-cf69-0000-0002d4465859
[0m16:34:29.614534 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
[0m16:34:29.615076 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m16:34:29.728236 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m16:34:29.729224 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e8471e3-c42e-440f-ab99-2fe9a123a8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149c63510>]}
[0m16:34:29.729998 [error] [Thread-1 (]: 6 of 6 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 0.68s]
[0m16:34:29.730622 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m16:34:29.733172 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:34:29.733519 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m16:34:29.733920 [info ] [MainThread]: 
[0m16:34:29.734233 [info ] [MainThread]: Finished running 1 table model, 5 incremental models in 0 hours 0 minutes and 16.43 seconds (16.43s).
[0m16:34:29.735382 [debug] [MainThread]: Command end result
[0m16:34:29.771347 [info ] [MainThread]: 
[0m16:34:29.771632 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:34:29.771763 [info ] [MainThread]: 
[0m16:34:29.771934 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m16:34:29.772064 [info ] [MainThread]: 
[0m16:34:29.772219 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m16:34:29.774386 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 17.542181, "process_user_time": 3.046571, "process_kernel_time": 1.9636, "process_mem_max_rss": "197328896", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:34:29.774819 [debug] [MainThread]: Command `dbt run` failed at 16:34:29.774772 after 17.54 seconds
[0m16:34:29.775183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10472ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c43fe90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fbeb0d0>]}
[0m16:34:29.775349 [debug] [MainThread]: Flushing usage events
[0m16:36:59.024486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128554290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1285bd250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1285bd8d0>]}


============================== 16:36:59.026755 | 88a99e13-f52a-4f3c-bac7-02389fe987dd ==============================
[0m16:36:59.026755 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:36:59.027009 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m16:36:59.687323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f210790>]}
[0m16:36:59.705543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe00910>]}
[0m16:36:59.706067 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:36:59.716855 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m16:36:59.762228 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m16:36:59.762552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ed2ead0>]}
[0m16:37:00.355433 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m16:37:00.355758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1383534d0>]}
[0m16:37:00.487536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13871cc50>]}
[0m16:37:00.568528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138a362d0>]}
[0m16:37:00.568901 [info ] [MainThread]: Found 6 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m16:37:00.569063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13867d410>]}
[0m16:37:00.570099 [info ] [MainThread]: 
[0m16:37:00.570394 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:37:00.572548 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m16:37:00.578587 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:37:00.578818 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:37:00.578951 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:37:01.142617 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.563 seconds
[0m16:37:01.145798 [debug] [ThreadPool]: On list_LB: Close
[0m16:37:01.271157 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:37:01.271842 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:37:01.272188 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:37:01.627695 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.355 seconds
[0m16:37:01.630702 [debug] [ThreadPool]: On list_LB: Close
[0m16:37:01.750455 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m16:37:01.760136 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m16:37:01.760500 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m16:37:01.760697 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:37:02.259660 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.499 seconds
[0m16:37:02.263398 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m16:37:02.367685 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m16:37:02.371003 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m16:37:02.371482 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m16:37:02.371849 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:37:02.726335 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.354 seconds
[0m16:37:02.728853 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m16:37:02.827771 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m16:37:02.830127 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m16:37:02.830334 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m16:37:02.830500 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:37:03.273404 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.443 seconds
[0m16:37:03.276320 [debug] [ThreadPool]: On list_LB_stage: Close
[0m16:37:03.385535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138669f10>]}
[0m16:37:03.387322 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:37:03.388339 [info ] [MainThread]: 
[0m16:37:03.400928 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m16:37:03.402493 [info ] [Thread-1 (]: 1 of 6 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m16:37:03.402985 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m16:37:03.403429 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m16:37:03.414224 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m16:37:03.415439 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m16:37:03.426243 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:37:03.426633 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m16:37:03.426859 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:37:03.792601 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.366 seconds
[0m16:37:03.794327 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m16:37:03.795141 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:37:03.795608 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m16:37:03.881572 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m16:37:03.899250 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m16:37:03.901646 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:37:03.901869 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m16:37:04.506597 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.604 seconds
[0m16:37:04.525128 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m16:37:04.623404 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138481410>]}
[0m16:37:04.623914 [info ] [Thread-1 (]: 1 of 6 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.22s]
[0m16:37:04.624250 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m16:37:04.624451 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m16:37:04.624639 [info ] [Thread-1 (]: 2 of 6 START sql incremental model stage.stg_contract .......................... [RUN]
[0m16:37:04.624936 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m16:37:04.625115 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m16:37:04.627625 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:04.628308 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m16:37:04.635515 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:04.635746 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m16:37:04.635896 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:37:04.961777 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.325 seconds
[0m16:37:04.963928 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m16:37:04.964529 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:04.964859 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m16:37:05.046404 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.081 seconds
[0m16:37:05.066248 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:05.066543 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace  temporary view LB.stage.stg_contract__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
        where createdat > (select max(createdat) from LB.stage.stg_contract)
    
)

select * from incremental
  );
[0m16:37:05.458404 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.391 seconds
[0m16:37:05.474550 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:05.475137 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.stage.stg_contract__dbt_tmp
[0m16:37:05.550311 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.075 seconds
[0m16:37:05.556005 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:05.556741 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table LB.stage.stg_contract
[0m16:37:05.621548 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.064 seconds
[0m16:37:05.629901 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:05.630184 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
describe table "LB"."STAGE"."STG_CONTRACT"
[0m16:37:05.688277 [debug] [Thread-1 (]: SQL status: SUCCESS 14 in 0.058 seconds
[0m16:37:05.703667 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:05.704572 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:05.704733 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:37:05.798258 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m16:37:05.798558 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:05.798775 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
merge into LB.stage.stg_contract as DBT_INTERNAL_DEST
        using LB.stage.stg_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","TYPE" = DBT_INTERNAL_SOURCE."TYPE","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","USAGE" = DBT_INTERNAL_SOURCE."USAGE","USAGENET" = DBT_INTERNAL_SOURCE."USAGENET","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","STARTDATE" = DBT_INTERNAL_SOURCE."STARTDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","FILLINGDATECANCELLATION" = DBT_INTERNAL_SOURCE."FILLINGDATECANCELLATION","CANCELLATIONREASON" = DBT_INTERNAL_SOURCE."CANCELLATIONREASON","CITY" = DBT_INTERNAL_SOURCE."CITY","STATUS" = DBT_INTERNAL_SOURCE."STATUS","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")
    values
        ("ID", "TYPE", "ENERGY", "USAGE", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "FILLINGDATECANCELLATION", "CANCELLATIONREASON", "CITY", "STATUS", "PRODUCTID", "MODIFICATIONDATE")

;
[0m16:37:06.376908 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.578 seconds
[0m16:37:06.377737 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:06.377938 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
COMMIT
[0m16:37:06.492579 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.114 seconds
[0m16:37:06.497034 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_contract__dbt_tmp
[0m16:37:06.499937 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:37:06.500182 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.stage.stg_contract__dbt_tmp cascade
[0m16:37:06.682426 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.182 seconds
[0m16:37:06.685118 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m16:37:06.809835 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138712810>]}
[0m16:37:06.812088 [info ] [Thread-1 (]: 2 of 6 OK created sql incremental model stage.stg_contract ..................... [[32mSUCCESS 0[0m in 2.18s]
[0m16:37:06.814022 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m16:37:06.815479 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m16:37:06.817985 [info ] [Thread-1 (]: 3 of 6 START sql incremental model stage.stg_prices ............................ [RUN]
[0m16:37:06.818617 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m16:37:06.819126 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m16:37:06.826172 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:06.827358 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m16:37:06.828686 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:06.828861 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m16:37:06.829035 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:37:07.545442 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.715 seconds
[0m16:37:07.548742 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m16:37:07.550036 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:07.550430 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m16:37:07.636230 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.085 seconds
[0m16:37:07.641945 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:07.642783 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace  temporary view LB.stage.stg_prices__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
        where modificationdate > (select max(modificationdate) from LB.stage.stg_prices)
    
)

select * from incremental
  );
[0m16:37:08.015330 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.372 seconds
[0m16:37:08.022224 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:08.023108 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
describe table LB.stage.stg_prices__dbt_tmp
[0m16:37:08.100916 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.077 seconds
[0m16:37:08.103109 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:08.103363 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
describe table LB.stage.stg_prices
[0m16:37:08.165535 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.062 seconds
[0m16:37:08.167584 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:08.167794 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
describe table "LB"."STAGE"."STG_PRICES"
[0m16:37:08.235170 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.067 seconds
[0m16:37:08.236910 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:08.238213 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:08.238455 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
-- back compat for old kwarg name
  
  begin;
[0m16:37:08.345604 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.107 seconds
[0m16:37:08.346127 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:08.346517 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
merge into LB.stage.stg_prices as DBT_INTERNAL_DEST
        using LB.stage.stg_prices__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRICECOMPONENTID" = DBT_INTERNAL_SOURCE."PRICECOMPONENTID","PRODUCTCOMPONENT" = DBT_INTERNAL_SOURCE."PRODUCTCOMPONENT","PRICE" = DBT_INTERNAL_SOURCE."PRICE","UNIT" = DBT_INTERNAL_SOURCE."UNIT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_UNTIL" = DBT_INTERNAL_SOURCE."VALID_UNTIL","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "PRODUCTID", "PRICECOMPONENTID", "PRODUCTCOMPONENT", "PRICE", "UNIT", "VALID_FROM", "VALID_UNTIL", "MODIFICATIONDATE")
    values
        ("ID", "PRODUCTID", "PRICECOMPONENTID", "PRODUCTCOMPONENT", "PRICE", "UNIT", "VALID_FROM", "VALID_UNTIL", "MODIFICATIONDATE")

;
[0m16:37:08.937683 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.590 seconds
[0m16:37:08.939186 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:08.939730 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
COMMIT
[0m16:37:09.244596 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.304 seconds
[0m16:37:09.248497 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_prices__dbt_tmp
[0m16:37:09.249327 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:37:09.249685 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
drop view if exists LB.stage.stg_prices__dbt_tmp cascade
[0m16:37:09.359451 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.109 seconds
[0m16:37:09.363546 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m16:37:09.475169 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf0d450>]}
[0m16:37:09.477082 [info ] [Thread-1 (]: 3 of 6 OK created sql incremental model stage.stg_prices ....................... [[32mSUCCESS 0[0m in 2.66s]
[0m16:37:09.478224 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m16:37:09.478924 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m16:37:09.479843 [info ] [Thread-1 (]: 4 of 6 START sql incremental model stage.stg_products .......................... [RUN]
[0m16:37:09.480371 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m16:37:09.480746 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m16:37:09.487221 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m16:37:09.488402 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m16:37:09.493271 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:37:09.493637 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m16:37:09.493943 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:37:10.004880 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.511 seconds
[0m16:37:10.007423 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m16:37:10.008469 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:37:10.009005 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m16:37:10.093441 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m16:37:10.097211 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:37:10.097803 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace  temporary view LB.stage.stg_products__dbt_tmp
  
   as (
    

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
        where modificationdate > (select max(modificationdate) from LB.stage.stg_products)
    
)

select * from incremental
  );
[0m16:37:10.337237 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.239 seconds
[0m16:37:10.343806 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:37:10.344429 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table LB.stage.stg_products__dbt_tmp
[0m16:37:10.418247 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.073 seconds
[0m16:37:10.424274 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:37:10.424991 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table LB.stage.stg_products
[0m16:37:10.501751 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.076 seconds
[0m16:37:10.517387 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:37:10.518654 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
describe table "LB"."STAGE"."STG_PRODUCTS"
[0m16:37:10.614519 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.094 seconds
[0m16:37:10.619197 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m16:37:10.621634 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:37:10.622214 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
-- back compat for old kwarg name
  
  begin;
[0m16:37:10.747220 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.124 seconds
[0m16:37:10.747995 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:37:10.748600 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
merge into LB.stage.stg_products as DBT_INTERNAL_DEST
        using LB.stage.stg_products__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.id = DBT_INTERNAL_DEST.id
            )

    
    when matched then update set
        "ID" = DBT_INTERNAL_SOURCE."ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "MODIFICATIONDATE")
    values
        ("ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "MODIFICATIONDATE")

;
[0m16:37:11.496825 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.747 seconds
[0m16:37:11.497851 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:37:11.498544 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
COMMIT
[0m16:37:11.804018 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.305 seconds
[0m16:37:11.807525 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_products__dbt_tmp
[0m16:37:11.808580 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:37:11.809081 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
drop view if exists LB.stage.stg_products__dbt_tmp cascade
[0m16:37:11.923694 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.114 seconds
[0m16:37:11.927327 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m16:37:12.031535 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf1b810>]}
[0m16:37:12.033088 [info ] [Thread-1 (]: 4 of 6 OK created sql incremental model stage.stg_products ..................... [[32mSUCCESS 0[0m in 2.55s]
[0m16:37:12.034136 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m16:37:12.034863 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m16:37:12.035910 [info ] [Thread-1 (]: 5 of 6 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m16:37:12.036644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_contract)
[0m16:37:12.037182 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m16:37:12.042319 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:12.043430 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m16:37:12.045811 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:12.046244 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m16:37:12.046614 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:37:12.400777 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.352 seconds
[0m16:37:12.412330 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m16:37:12.414256 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:12.414476 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m16:37:12.507211 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.092 seconds
[0m16:37:12.511018 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:12.511481 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m16:37:12.807133 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.295 seconds
[0m16:37:12.820904 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:12.821532 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m16:37:12.887748 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.066 seconds
[0m16:37:12.894918 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:12.895858 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m16:37:12.983941 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.087 seconds
[0m16:37:12.997708 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:12.998606 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m16:37:13.068693 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.069 seconds
[0m16:37:13.072833 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:13.074618 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:13.074984 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:37:13.314347 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.239 seconds
[0m16:37:13.315070 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:13.315480 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m16:37:13.646071 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.330 seconds
[0m16:37:13.646480 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:13.646674 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m16:37:13.783307 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.136 seconds
[0m16:37:13.788205 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m16:37:13.789079 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:37:13.789490 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m16:37:13.922743 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.133 seconds
[0m16:37:13.926248 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m16:37:14.034775 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1386a2f90>]}
[0m16:37:14.036149 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 2.00s]
[0m16:37:14.037042 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m16:37:14.037562 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m16:37:14.038310 [info ] [Thread-1 (]: 6 of 6 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m16:37:14.038886 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_contract, now model.snowflake_airflow_dbt.dim_product)
[0m16:37:14.039374 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m16:37:14.043585 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m16:37:14.044351 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m16:37:14.046333 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:37:14.046608 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m16:37:14.046848 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:37:14.399659 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.352 seconds
[0m16:37:14.402436 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m16:37:14.403170 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:37:14.403483 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m16:37:14.500586 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.096 seconds
[0m16:37:14.505388 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m16:37:14.510963 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:37:14.511621 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m16:37:14.617222 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e0d-0202-cf54-0000-0002d446485d
[0m16:37:14.617990 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
[0m16:37:14.618628 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m16:37:14.731133 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m16:37:14.731939 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88a99e13-f52a-4f3c-bac7-02389fe987dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1386e29d0>]}
[0m16:37:14.732645 [error] [Thread-1 (]: 6 of 6 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 0.69s]
[0m16:37:14.733248 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m16:37:14.735566 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:37:14.735974 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m16:37:14.736450 [info ] [MainThread]: 
[0m16:37:14.736849 [info ] [MainThread]: Finished running 1 table model, 5 incremental models in 0 hours 0 minutes and 14.17 seconds (14.17s).
[0m16:37:14.738345 [debug] [MainThread]: Command end result
[0m16:37:14.774130 [info ] [MainThread]: 
[0m16:37:14.774425 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:37:14.774560 [info ] [MainThread]: 
[0m16:37:14.774726 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m16:37:14.774859 [info ] [MainThread]: 
[0m16:37:14.775000 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m16:37:14.776773 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 15.780481, "process_user_time": 3.190926, "process_kernel_time": 2.597351, "process_mem_max_rss": "194772992", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:37:14.777173 [debug] [MainThread]: Command `dbt run` failed at 16:37:14.777132 after 15.78 seconds
[0m16:37:14.777497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a16d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12859cd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12859cb10>]}
[0m16:37:14.777724 [debug] [MainThread]: Flushing usage events
[0m16:43:03.820883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12345b3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1234966d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1234bdbd0>]}


============================== 16:43:03.823727 | 2e0dd50f-1366-47b2-9759-8113fd79fcb9 ==============================
[0m16:43:03.823727 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:43:03.824036 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:43:04.577510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2e0dd50f-1366-47b2-9759-8113fd79fcb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1642b2510>]}
[0m16:43:04.604608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2e0dd50f-1366-47b2-9759-8113fd79fcb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122f00c50>]}
[0m16:43:04.605353 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:43:04.623806 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m16:43:04.717554 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:43:04.717852 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:43:04.739917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2e0dd50f-1366-47b2-9759-8113fd79fcb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16811c6d0>]}
[0m16:43:04.791980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2e0dd50f-1366-47b2-9759-8113fd79fcb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b8b5ad0>]}
[0m16:43:04.792273 [info ] [MainThread]: Found 6 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m16:43:04.792431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2e0dd50f-1366-47b2-9759-8113fd79fcb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b717010>]}
[0m16:43:04.793164 [info ] [MainThread]: 
[0m16:43:04.793441 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:43:04.795342 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m16:43:04.801591 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:43:04.801843 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:43:04.801976 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:43:05.367008 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.565 seconds
[0m16:43:05.369379 [debug] [ThreadPool]: On list_LB: Close
[0m16:43:05.475292 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m16:43:05.481150 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m16:43:05.481402 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m16:43:05.481536 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:43:05.951597 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.470 seconds
[0m16:43:05.954526 [debug] [ThreadPool]: On list_LB_stage: Close
[0m16:43:06.062454 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m16:43:06.066162 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m16:43:06.066566 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m16:43:06.066873 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:43:06.533112 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.466 seconds
[0m16:43:06.534239 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m16:43:06.645553 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m16:43:06.649810 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m16:43:06.650115 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m16:43:06.650454 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:43:07.054926 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.401 seconds
[0m16:43:07.065487 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m16:43:07.173195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2e0dd50f-1366-47b2-9759-8113fd79fcb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1688414d0>]}
[0m16:43:07.174121 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:43:07.174470 [info ] [MainThread]: 
[0m16:43:07.179854 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m16:43:07.181640 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m16:43:07.182531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m16:43:07.182887 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m16:43:07.187828 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m16:43:07.188863 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m16:43:07.196329 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:43:07.196662 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m16:43:07.196847 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:43:07.543638 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.347 seconds
[0m16:43:07.544984 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m16:43:07.545561 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:43:07.545719 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m16:43:07.620239 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.074 seconds
[0m16:43:07.629047 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m16:43:07.630081 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:43:07.630287 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m16:43:08.265197 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.635 seconds
[0m16:43:08.283485 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m16:43:08.425330 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2e0dd50f-1366-47b2-9759-8113fd79fcb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b8dc8d0>]}
[0m16:43:08.426285 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.24s]
[0m16:43:08.426984 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m16:43:08.427470 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m16:43:08.428215 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m16:43:08.428714 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m16:43:08.429063 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m16:43:08.433513 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m16:43:08.434397 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m16:43:08.444030 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:43:08.444337 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m16:43:08.444500 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:43:08.767366 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.323 seconds
[0m16:43:08.769898 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m16:43:08.771030 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:43:08.771623 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m16:43:08.850577 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.078 seconds
[0m16:43:08.866099 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m16:43:08.867578 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:43:08.867831 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m16:43:08.947295 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e13-0202-cf6a-0000-0002d4467875
[0m16:43:08.947679 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
[0m16:43:08.948203 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m16:43:09.064455 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m16:43:09.065464 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2e0dd50f-1366-47b2-9759-8113fd79fcb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc79f50>]}
[0m16:43:09.066271 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 0.64s]
[0m16:43:09.066979 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m16:43:09.067481 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m16:43:09.069109 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m16:43:09.069699 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m16:43:09.070042 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m16:43:09.076306 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:09.077560 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m16:43:09.079202 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:09.079468 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m16:43:09.079667 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:43:09.462737 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.383 seconds
[0m16:43:09.464494 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m16:43:09.465365 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:09.466021 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m16:43:09.548284 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.082 seconds
[0m16:43:09.552541 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:09.552788 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m16:43:09.896309 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.343 seconds
[0m16:43:09.907222 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:09.907669 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m16:43:10.010032 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.102 seconds
[0m16:43:10.015236 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:10.015816 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m16:43:10.075430 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.059 seconds
[0m16:43:10.090470 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:10.091093 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m16:43:10.184854 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.093 seconds
[0m16:43:10.214638 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:10.216414 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:10.216709 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:43:10.324079 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.107 seconds
[0m16:43:10.324768 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:10.325159 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m16:43:10.675822 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.350 seconds
[0m16:43:10.676936 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:10.677470 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m16:43:10.779904 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.102 seconds
[0m16:43:10.786702 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m16:43:10.791830 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:43:10.792093 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m16:43:10.906062 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.114 seconds
[0m16:43:10.907583 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m16:43:11.009059 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2e0dd50f-1366-47b2-9759-8113fd79fcb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1688a0e10>]}
[0m16:43:11.009578 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 1.94s]
[0m16:43:11.009891 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m16:43:11.010854 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:43:11.011028 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m16:43:11.011232 [info ] [MainThread]: 
[0m16:43:11.011387 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.22 seconds (6.22s).
[0m16:43:11.011784 [debug] [MainThread]: Command end result
[0m16:43:11.033814 [info ] [MainThread]: 
[0m16:43:11.034122 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:43:11.034270 [info ] [MainThread]: 
[0m16:43:11.034880 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m16:43:11.035488 [info ] [MainThread]: 
[0m16:43:11.035869 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:43:11.041520 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.2526946, "process_user_time": 2.117718, "process_kernel_time": 1.8114, "process_mem_max_rss": "192643072", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:43:11.043400 [debug] [MainThread]: Command `dbt run` failed at 16:43:11.043317 after 7.26 seconds
[0m16:43:11.044830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122f30d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1004e6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123447650>]}
[0m16:43:11.045066 [debug] [MainThread]: Flushing usage events
[0m16:49:09.166279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133d1f6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1338f4110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133d5a4d0>]}


============================== 16:49:09.168884 | eab796a6-3c65-4223-9804-ca6098afd45e ==============================
[0m16:49:09.168884 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:49:09.169165 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m16:49:09.819677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eab796a6-3c65-4223-9804-ca6098afd45e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133da48d0>]}
[0m16:49:09.837731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eab796a6-3c65-4223-9804-ca6098afd45e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133500d10>]}
[0m16:49:09.838295 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:49:09.849479 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m16:49:09.917577 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:49:09.918045 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m16:49:10.013948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eab796a6-3c65-4223-9804-ca6098afd45e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1421b2bd0>]}
[0m16:49:10.100985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eab796a6-3c65-4223-9804-ca6098afd45e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14213c490>]}
[0m16:49:10.101262 [info ] [MainThread]: Found 6 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m16:49:10.101418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eab796a6-3c65-4223-9804-ca6098afd45e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f53210>]}
[0m16:49:10.102103 [info ] [MainThread]: 
[0m16:49:10.102328 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:49:10.104164 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m16:49:10.109416 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:49:10.109583 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:49:10.109701 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:49:10.688663 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.579 seconds
[0m16:49:10.691762 [debug] [ThreadPool]: On list_LB: Close
[0m16:49:10.807282 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m16:49:10.820818 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m16:49:10.821375 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m16:49:10.821715 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:49:11.222599 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.401 seconds
[0m16:49:11.226027 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m16:49:11.344885 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m16:49:11.350542 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m16:49:11.351091 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m16:49:11.351428 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:49:11.775700 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.424 seconds
[0m16:49:11.777805 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m16:49:11.878746 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m16:49:11.884081 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m16:49:11.884565 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m16:49:11.884820 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:49:12.332151 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.447 seconds
[0m16:49:12.334293 [debug] [ThreadPool]: On list_LB_stage: Close
[0m16:49:12.442849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eab796a6-3c65-4223-9804-ca6098afd45e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c24290>]}
[0m16:49:12.443853 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:49:12.444222 [info ] [MainThread]: 
[0m16:49:12.446604 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m16:49:12.447047 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m16:49:12.447398 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m16:49:12.447642 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m16:49:12.453395 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m16:49:12.454423 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m16:49:12.462995 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:49:12.463397 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m16:49:12.463601 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:49:12.786936 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.323 seconds
[0m16:49:12.789578 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m16:49:12.790634 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:49:12.791192 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m16:49:12.935888 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.144 seconds
[0m16:49:12.955875 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m16:49:12.957233 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:49:12.957478 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m16:49:13.686102 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.728 seconds
[0m16:49:13.696143 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m16:49:13.800929 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eab796a6-3c65-4223-9804-ca6098afd45e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1421d7dd0>]}
[0m16:49:13.801453 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.35s]
[0m16:49:13.801792 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m16:49:13.802016 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m16:49:13.802228 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m16:49:13.802528 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m16:49:13.802714 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m16:49:13.804426 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m16:49:13.804841 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m16:49:13.813059 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:49:13.813420 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m16:49:13.813584 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:49:14.253307 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.439 seconds
[0m16:49:14.256150 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m16:49:14.257125 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:49:14.257614 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m16:49:14.345145 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.087 seconds
[0m16:49:14.352566 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m16:49:14.354462 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m16:49:14.354683 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m16:49:14.447691 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e19-0202-cf6a-0000-0002d44678b1
[0m16:49:14.448038 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
[0m16:49:14.448337 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m16:49:14.555155 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m16:49:14.555717 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eab796a6-3c65-4223-9804-ca6098afd45e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1422b5910>]}
[0m16:49:14.556311 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 0.75s]
[0m16:49:14.556831 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m16:49:14.557197 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m16:49:14.558391 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m16:49:14.558801 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m16:49:14.559112 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m16:49:14.564973 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:14.566093 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m16:49:14.567790 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:14.568034 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m16:49:14.568248 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:49:14.932968 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.364 seconds
[0m16:49:14.935885 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m16:49:14.937044 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:14.937587 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m16:49:15.027528 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.089 seconds
[0m16:49:15.030930 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:15.031135 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m16:49:15.375435 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.344 seconds
[0m16:49:15.387660 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:15.388173 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m16:49:15.480498 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.092 seconds
[0m16:49:15.486742 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:15.487389 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m16:49:15.565827 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.078 seconds
[0m16:49:15.577550 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:15.578066 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m16:49:15.642344 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.064 seconds
[0m16:49:15.666404 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:15.667457 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:15.667640 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:49:15.776329 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.108 seconds
[0m16:49:15.777227 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:15.777871 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m16:49:16.106785 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.328 seconds
[0m16:49:16.108041 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:16.108559 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m16:49:16.241437 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.132 seconds
[0m16:49:16.253656 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m16:49:16.258770 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:49:16.259021 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m16:49:16.374750 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.115 seconds
[0m16:49:16.378117 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m16:49:16.491091 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eab796a6-3c65-4223-9804-ca6098afd45e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1424be610>]}
[0m16:49:16.492225 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 1.93s]
[0m16:49:16.493108 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m16:49:16.494937 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:49:16.495477 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m16:49:16.496111 [info ] [MainThread]: 
[0m16:49:16.496755 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.39 seconds (6.39s).
[0m16:49:16.497891 [debug] [MainThread]: Command end result
[0m16:49:16.525887 [info ] [MainThread]: 
[0m16:49:16.526318 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:49:16.526555 [info ] [MainThread]: 
[0m16:49:16.527130 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m16:49:16.527267 [info ] [MainThread]: 
[0m16:49:16.527476 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:49:16.531086 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.3926454, "process_user_time": 2.355246, "process_kernel_time": 2.425405, "process_mem_max_rss": "196296704", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:49:16.531961 [debug] [MainThread]: Command `dbt run` failed at 16:49:16.531909 after 7.39 seconds
[0m16:49:16.532713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133d1dd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103186cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1327763d0>]}
[0m16:49:16.532929 [debug] [MainThread]: Flushing usage events
[0m16:49:58.983025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e21af10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e281150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e2817d0>]}


============================== 16:49:58.985254 | d8f9daf9-23cf-4cbe-89e1-eb3effabce37 ==============================
[0m16:49:58.985254 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:49:58.985518 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:49:59.632892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd8f9daf9-23cf-4cbe-89e1-eb3effabce37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12edb7090>]}
[0m16:49:59.650855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd8f9daf9-23cf-4cbe-89e1-eb3effabce37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11db00c50>]}
[0m16:49:59.651342 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:49:59.661349 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m16:49:59.764651 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m16:49:59.765040 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/mart/dim_products.sql
[0m16:49:59.765180 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m16:49:59.897433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd8f9daf9-23cf-4cbe-89e1-eb3effabce37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f175b10>]}
[0m16:49:59.955302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8f9daf9-23cf-4cbe-89e1-eb3effabce37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f088850>]}
[0m16:49:59.955596 [info ] [MainThread]: Found 6 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m16:49:59.955758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8f9daf9-23cf-4cbe-89e1-eb3effabce37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12edadad0>]}
[0m16:49:59.956501 [info ] [MainThread]: 
[0m16:49:59.956750 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:49:59.958750 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m16:49:59.964668 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:49:59.964885 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:49:59.965018 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:50:00.431044 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.466 seconds
[0m16:50:00.433077 [debug] [ThreadPool]: On list_LB: Close
[0m16:50:00.548880 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m16:50:00.559495 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m16:50:00.559916 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m16:50:00.560158 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:50:01.063911 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.504 seconds
[0m16:50:01.064947 [debug] [ThreadPool]: On list_LB_stage: Close
[0m16:50:01.172024 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m16:50:01.178470 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m16:50:01.178960 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m16:50:01.179263 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:50:01.610215 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.431 seconds
[0m16:50:01.613328 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m16:50:01.739603 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m16:50:01.743257 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m16:50:01.743678 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m16:50:01.744001 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:50:02.085055 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.341 seconds
[0m16:50:02.087338 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m16:50:02.204846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8f9daf9-23cf-4cbe-89e1-eb3effabce37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c3f7bd0>]}
[0m16:50:02.205834 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:50:02.206167 [info ] [MainThread]: 
[0m16:50:02.209990 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m16:50:02.210695 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m16:50:02.211203 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m16:50:02.211636 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m16:50:02.218320 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m16:50:02.219026 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m16:50:02.225730 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:50:02.226094 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m16:50:02.226309 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:50:02.642687 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.416 seconds
[0m16:50:02.644909 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m16:50:02.645948 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:50:02.646486 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m16:50:02.752800 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.106 seconds
[0m16:50:02.770453 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m16:50:02.771435 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:50:02.771682 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m16:50:03.709894 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.938 seconds
[0m16:50:03.734737 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m16:50:03.899997 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8f9daf9-23cf-4cbe-89e1-eb3effabce37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ede9890>]}
[0m16:50:03.901074 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.69s]
[0m16:50:03.901832 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m16:50:03.902382 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m16:50:03.903143 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_products ....................... [RUN]
[0m16:50:03.903675 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_products)
[0m16:50:03.904229 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m16:50:03.907370 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m16:50:03.907956 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m16:50:03.920581 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m16:50:03.921018 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
show parameters like 'query_tag' in session
[0m16:50:03.921269 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:50:04.505536 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.584 seconds
[0m16:50:04.506259 [debug] [Thread-1 (]: Setting query_tag to 'dim_products'. Will reset to '' after materialization.
[0m16:50:04.506562 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m16:50:04.506717 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
alter session set query_tag = 'dim_products'
[0m16:50:04.589304 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.082 seconds
[0m16:50:04.596604 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m16:50:04.597937 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m16:50:04.598153 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.dwh_mart.dim_products
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_products
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m16:50:04.689013 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e1a-0202-cf6c-0000-0002d44669bd
[0m16:50:04.689337 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.DIM_PRODUCTS' does not exist or not authorized.
[0m16:50:04.689579 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m16:50:04.818708 [debug] [Thread-1 (]: Database Error in model dim_products (models/mart/dim_products.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCTS' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_products.sql
[0m16:50:04.819561 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8f9daf9-23cf-4cbe-89e1-eb3effabce37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f174150>]}
[0m16:50:04.820344 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_products .............. [[31mERROR[0m in 0.92s]
[0m16:50:04.820999 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m16:50:04.821470 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m16:50:04.823128 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m16:50:04.823673 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_products, now model.snowflake_airflow_dbt.fact_contract)
[0m16:50:04.824032 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m16:50:04.830043 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:04.830869 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m16:50:04.832189 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:04.832433 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m16:50:04.832630 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:50:05.139739 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.307 seconds
[0m16:50:05.142794 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m16:50:05.143939 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:05.144456 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m16:50:05.222964 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.078 seconds
[0m16:50:05.226327 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:05.226521 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m16:50:05.475542 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.249 seconds
[0m16:50:05.487434 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:05.487975 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m16:50:05.561566 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.073 seconds
[0m16:50:05.568716 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:05.569404 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m16:50:05.632474 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.062 seconds
[0m16:50:05.646349 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:05.646899 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m16:50:05.717139 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.070 seconds
[0m16:50:05.742446 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:05.743413 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:05.743578 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:50:05.869357 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.126 seconds
[0m16:50:05.869882 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:05.870233 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m16:50:06.151476 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.281 seconds
[0m16:50:06.152111 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:06.152432 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m16:50:06.278818 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.126 seconds
[0m16:50:06.284435 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m16:50:06.289823 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:50:06.290072 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m16:50:06.392643 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.102 seconds
[0m16:50:06.396328 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m16:50:06.497942 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8f9daf9-23cf-4cbe-89e1-eb3effabce37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f874090>]}
[0m16:50:06.499091 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 1.67s]
[0m16:50:06.499795 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m16:50:06.501484 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:50:06.501893 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m16:50:06.502381 [info ] [MainThread]: 
[0m16:50:06.502786 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.55 seconds (6.55s).
[0m16:50:06.503792 [debug] [MainThread]: Command end result
[0m16:50:06.524087 [info ] [MainThread]: 
[0m16:50:06.524419 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:50:06.524627 [info ] [MainThread]: 
[0m16:50:06.524806 [error] [MainThread]:   Database Error in model dim_products (models/mart/dim_products.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCTS' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_products.sql
[0m16:50:06.525039 [info ] [MainThread]: 
[0m16:50:06.525423 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:50:06.531294 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.5789113, "process_user_time": 2.450562, "process_kernel_time": 2.271116, "process_mem_max_rss": "196362240", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:50:06.533105 [debug] [MainThread]: Command `dbt run` failed at 16:50:06.532979 after 7.58 seconds
[0m16:50:06.534850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f56cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dcf0850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e20b6d0>]}
[0m16:50:06.535105 [debug] [MainThread]: Flushing usage events
[0m16:54:21.942746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142a96690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142ab5810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142ab5e90>]}


============================== 16:54:21.945205 | a7bead72-abb0-4c0e-9618-9e0af49d8e91 ==============================
[0m16:54:21.945205 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:54:21.945476 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m16:54:22.628589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a7bead72-abb0-4c0e-9618-9e0af49d8e91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154aeae50>]}
[0m16:54:22.647464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a7bead72-abb0-4c0e-9618-9e0af49d8e91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142400c10>]}
[0m16:54:22.648086 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:54:22.659860 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m16:54:22.726703 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:54:22.727101 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_products.sql
[0m16:54:22.900565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a7bead72-abb0-4c0e-9618-9e0af49d8e91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15401e890>]}
[0m16:54:22.950720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a7bead72-abb0-4c0e-9618-9e0af49d8e91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154df1090>]}
[0m16:54:22.951005 [info ] [MainThread]: Found 6 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m16:54:22.951156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7bead72-abb0-4c0e-9618-9e0af49d8e91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154e6bad0>]}
[0m16:54:22.951834 [info ] [MainThread]: 
[0m16:54:22.952070 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:54:22.953822 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m16:54:22.959257 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:54:22.959471 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:54:22.959601 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:54:23.468035 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.508 seconds
[0m16:54:23.470564 [debug] [ThreadPool]: On list_LB: Close
[0m16:54:23.580559 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m16:54:23.592725 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m16:54:23.593220 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m16:54:23.593499 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:54:24.044702 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.451 seconds
[0m16:54:24.049066 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m16:54:24.161293 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m16:54:24.169209 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m16:54:24.169792 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m16:54:24.170137 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:54:24.592432 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.422 seconds
[0m16:54:24.594292 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m16:54:24.712366 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m16:54:24.716674 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m16:54:24.717241 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m16:54:24.717709 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:54:25.179611 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.462 seconds
[0m16:54:25.183073 [debug] [ThreadPool]: On list_LB_stage: Close
[0m16:54:25.294366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7bead72-abb0-4c0e-9618-9e0af49d8e91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154e6bad0>]}
[0m16:54:25.295874 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:54:25.296522 [info ] [MainThread]: 
[0m16:54:25.301227 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m16:54:25.301952 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m16:54:25.302781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m16:54:25.303288 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m16:54:25.311904 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m16:54:25.313082 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m16:54:25.322961 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:54:25.323445 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m16:54:25.323990 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:54:25.742747 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.418 seconds
[0m16:54:25.745955 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m16:54:25.747239 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:54:25.747855 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m16:54:25.832337 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m16:54:25.851740 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m16:54:25.852508 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:54:25.852694 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m16:54:26.472620 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.620 seconds
[0m16:54:26.499638 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m16:54:26.606504 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7bead72-abb0-4c0e-9618-9e0af49d8e91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154f3c450>]}
[0m16:54:26.607626 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.30s]
[0m16:54:26.608522 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m16:54:26.609102 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m16:54:26.609759 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_products ....................... [RUN]
[0m16:54:26.610316 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_products)
[0m16:54:26.610685 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m16:54:26.615352 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m16:54:26.616419 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m16:54:26.633822 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m16:54:26.634313 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
show parameters like 'query_tag' in session
[0m16:54:26.634570 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:54:27.045659 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.411 seconds
[0m16:54:27.048381 [debug] [Thread-1 (]: Setting query_tag to 'dim_products'. Will reset to '' after materialization.
[0m16:54:27.049447 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m16:54:27.050067 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
alter session set query_tag = 'dim_products'
[0m16:54:27.135840 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.085 seconds
[0m16:54:27.152870 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m16:54:27.154571 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m16:54:27.154840 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.dwh_mart.dim_products
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_products
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m16:54:27.242670 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e1e-0202-cf54-0000-0002d44648cd
[0m16:54:27.243237 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.DIM_PRODUCTS' does not exist or not authorized.
[0m16:54:27.243770 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m16:54:27.390829 [debug] [Thread-1 (]: Database Error in model dim_products (models/mart/dim_products.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCTS' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_products.sql
[0m16:54:27.391700 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7bead72-abb0-4c0e-9618-9e0af49d8e91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x157d76a50>]}
[0m16:54:27.392428 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_products .............. [[31mERROR[0m in 0.78s]
[0m16:54:27.393153 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m16:54:27.393708 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m16:54:27.395749 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m16:54:27.396350 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_products, now model.snowflake_airflow_dbt.fact_contract)
[0m16:54:27.396727 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m16:54:27.401740 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:27.402200 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m16:54:27.403331 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:27.403516 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m16:54:27.403655 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:54:27.906067 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.502 seconds
[0m16:54:27.908049 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m16:54:27.908901 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:27.909333 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m16:54:28.005349 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.095 seconds
[0m16:54:28.017494 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:28.018007 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m16:54:28.312232 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.293 seconds
[0m16:54:28.325473 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:28.326084 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m16:54:28.406410 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.080 seconds
[0m16:54:28.413501 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:28.414039 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m16:54:28.478423 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.064 seconds
[0m16:54:28.491514 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:28.492239 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m16:54:28.556743 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.064 seconds
[0m16:54:28.589784 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:28.590967 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:28.591228 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:54:28.689275 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m16:54:28.689871 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:28.690316 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m16:54:29.034310 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.343 seconds
[0m16:54:29.035420 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:29.035942 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m16:54:29.151301 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.115 seconds
[0m16:54:29.164077 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m16:54:29.171066 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:54:29.171534 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m16:54:29.340767 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.169 seconds
[0m16:54:29.344000 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m16:54:29.446604 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7bead72-abb0-4c0e-9618-9e0af49d8e91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x157d69550>]}
[0m16:54:29.447029 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 2.05s]
[0m16:54:29.447311 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m16:54:29.448065 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:54:29.448196 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m16:54:29.448369 [info ] [MainThread]: 
[0m16:54:29.448511 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.50 seconds (6.50s).
[0m16:54:29.448877 [debug] [MainThread]: Command end result
[0m16:54:29.469392 [info ] [MainThread]: 
[0m16:54:29.469947 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:54:29.470106 [info ] [MainThread]: 
[0m16:54:29.470307 [error] [MainThread]:   Database Error in model dim_products (models/mart/dim_products.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DIM_PRODUCTS' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_products.sql
[0m16:54:29.470441 [info ] [MainThread]: 
[0m16:54:29.470683 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:54:29.473403 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.559879, "process_user_time": 2.940135, "process_kernel_time": 1.621988, "process_mem_max_rss": "196444160", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:54:29.473921 [debug] [MainThread]: Command `dbt run` failed at 16:54:29.473866 after 7.56 seconds
[0m16:54:29.474296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142a9d210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165968750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10473bf10>]}
[0m16:54:29.474490 [debug] [MainThread]: Flushing usage events
[0m16:56:29.395081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143c56dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143cbcc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143cbd290>]}


============================== 16:56:29.397663 | dc1058dc-4257-428b-880e-f55509db1122 ==============================
[0m16:56:29.397663 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:56:29.397951 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:56:30.076435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dc1058dc-4257-428b-880e-f55509db1122', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147772c90>]}
[0m16:56:30.098021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dc1058dc-4257-428b-880e-f55509db1122', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143700b10>]}
[0m16:56:30.098707 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:56:30.112158 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m16:56:30.323253 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 0 files changed.
[0m16:56:30.323764 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/mart/dim_products.sql
[0m16:56:30.371133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dc1058dc-4257-428b-880e-f55509db1122', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168c3bc90>]}
[0m16:56:30.536606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dc1058dc-4257-428b-880e-f55509db1122', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168c16a10>]}
[0m16:56:30.537804 [info ] [MainThread]: Found 5 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m16:56:30.538606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc1058dc-4257-428b-880e-f55509db1122', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168c96e90>]}
[0m16:56:30.540402 [info ] [MainThread]: 
[0m16:56:30.542179 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:56:30.548431 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m16:56:30.575520 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:56:30.576684 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:56:30.578636 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:56:31.295488 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.717 seconds
[0m16:56:31.297532 [debug] [ThreadPool]: On list_LB: Close
[0m16:56:31.404531 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m16:56:31.415053 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m16:56:31.415535 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m16:56:31.415833 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:56:31.878122 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.462 seconds
[0m16:56:31.880541 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m16:56:31.995543 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m16:56:31.999577 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m16:56:32.000100 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m16:56:32.000463 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:56:32.456140 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.455 seconds
[0m16:56:32.458558 [debug] [ThreadPool]: On list_LB_stage: Close
[0m16:56:32.579477 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m16:56:32.583380 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m16:56:32.583780 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m16:56:32.584071 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:56:33.104525 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.520 seconds
[0m16:56:33.114931 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m16:56:33.237028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc1058dc-4257-428b-880e-f55509db1122', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168c01b10>]}
[0m16:56:33.237780 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:56:33.238029 [info ] [MainThread]: 
[0m16:56:33.241972 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m16:56:33.243368 [info ] [Thread-1 (]: 1 of 2 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m16:56:33.244712 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m16:56:33.245627 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m16:56:33.272508 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m16:56:33.274160 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m16:56:33.286275 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:56:33.286624 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m16:56:33.286840 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:56:33.709750 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.423 seconds
[0m16:56:33.711249 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m16:56:33.711902 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:56:33.712222 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m16:56:33.791879 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.079 seconds
[0m16:56:33.812405 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m16:56:33.815239 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:56:33.815578 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m16:56:34.438020 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.621 seconds
[0m16:56:34.484297 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m16:56:34.589243 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc1058dc-4257-428b-880e-f55509db1122', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168f55c50>]}
[0m16:56:34.590756 [info ] [Thread-1 (]: 1 of 2 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.34s]
[0m16:56:34.591807 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m16:56:34.592533 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m16:56:34.593654 [info ] [Thread-1 (]: 2 of 2 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m16:56:34.594231 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.fact_contract)
[0m16:56:34.594742 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m16:56:34.606896 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:34.607815 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m16:56:34.619394 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:34.619834 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m16:56:34.620021 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:56:34.973674 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.353 seconds
[0m16:56:34.978573 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m16:56:34.979358 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:34.979701 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m16:56:35.092486 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.112 seconds
[0m16:56:35.118101 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:35.118467 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m16:56:35.376606 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.258 seconds
[0m16:56:35.388360 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:35.388915 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m16:56:35.463951 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.074 seconds
[0m16:56:35.470534 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:35.471877 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m16:56:35.554518 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.082 seconds
[0m16:56:35.567214 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:35.567762 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m16:56:35.631001 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.063 seconds
[0m16:56:35.679202 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:35.680635 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:35.681057 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:56:35.803625 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.122 seconds
[0m16:56:35.804126 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:35.804447 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m16:56:36.098902 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.294 seconds
[0m16:56:36.099565 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:36.099967 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m16:56:36.214882 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.114 seconds
[0m16:56:36.226465 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m16:56:36.233840 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:56:36.234613 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m16:56:36.400620 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.166 seconds
[0m16:56:36.403167 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m16:56:36.520254 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc1058dc-4257-428b-880e-f55509db1122', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1693d40d0>]}
[0m16:56:36.521404 [info ] [Thread-1 (]: 2 of 2 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 1.93s]
[0m16:56:36.522326 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m16:56:36.525092 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:56:36.525535 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m16:56:36.526149 [info ] [MainThread]: 
[0m16:56:36.526889 [info ] [MainThread]: Finished running 1 table model, 1 incremental model in 0 hours 0 minutes and 5.98 seconds (5.98s).
[0m16:56:36.528141 [debug] [MainThread]: Command end result
[0m16:56:36.587145 [info ] [MainThread]: 
[0m16:56:36.588050 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:56:36.588296 [info ] [MainThread]: 
[0m16:56:36.588917 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m16:56:36.594108 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.2306156, "process_user_time": 2.413862, "process_kernel_time": 2.165171, "process_mem_max_rss": "185532416", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:56:36.595516 [debug] [MainThread]: Command `dbt run` succeeded at 16:56:36.595406 after 7.23 seconds
[0m16:56:36.597017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143cbc8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100764890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10066ae50>]}
[0m16:56:36.597322 [debug] [MainThread]: Flushing usage events
[0m16:57:49.079394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128c5b290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128c6d690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128c6dd10>]}


============================== 16:57:49.081798 | f2184242-474d-4ec3-95c2-06f7a81640fa ==============================
[0m16:57:49.081798 [info ] [MainThread]: Running with dbt=1.8.0
[0m16:57:49.082063 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m16:57:49.783183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f2184242-474d-4ec3-95c2-06f7a81640fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12bd42f50>]}
[0m16:57:49.803237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f2184242-474d-4ec3-95c2-06f7a81640fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128500b90>]}
[0m16:57:49.804143 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:57:49.816127 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m16:57:49.888468 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m16:57:49.888802 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/mart/dm_product.sql
[0m16:57:50.031565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2184242-474d-4ec3-95c2-06f7a81640fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e6be950>]}
[0m16:57:50.086267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2184242-474d-4ec3-95c2-06f7a81640fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e700090>]}
[0m16:57:50.087249 [info ] [MainThread]: Found 6 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m16:57:50.088106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2184242-474d-4ec3-95c2-06f7a81640fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e69a290>]}
[0m16:57:50.088971 [info ] [MainThread]: 
[0m16:57:50.089256 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:57:50.091138 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m16:57:50.099455 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:57:50.099708 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:57:50.099843 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:50.640902 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.541 seconds
[0m16:57:50.643991 [debug] [ThreadPool]: On list_LB: Close
[0m16:57:50.779874 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m16:57:50.790343 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m16:57:50.790913 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m16:57:50.791124 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:57:51.145547 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.354 seconds
[0m16:57:51.147446 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m16:57:51.258287 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m16:57:51.260789 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m16:57:51.261025 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m16:57:51.261171 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:57:51.599411 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.338 seconds
[0m16:57:51.600370 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m16:57:51.708863 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m16:57:51.713256 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m16:57:51.713757 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m16:57:51.714083 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:57:52.219228 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.505 seconds
[0m16:57:52.220477 [debug] [ThreadPool]: On list_LB_stage: Close
[0m16:57:52.332005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2184242-474d-4ec3-95c2-06f7a81640fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d465110>]}
[0m16:57:52.332830 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:57:52.333218 [info ] [MainThread]: 
[0m16:57:52.336536 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m16:57:52.337207 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m16:57:52.337657 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m16:57:52.337995 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m16:57:52.345218 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m16:57:52.346454 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m16:57:52.358581 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:57:52.359016 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m16:57:52.359280 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:57:52.827601 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.468 seconds
[0m16:57:52.830888 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m16:57:52.832174 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:57:52.832779 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m16:57:52.914683 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.081 seconds
[0m16:57:52.936813 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m16:57:52.937716 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m16:57:52.937917 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m16:57:53.838743 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.900 seconds
[0m16:57:53.863102 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m16:57:54.000564 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2184242-474d-4ec3-95c2-06f7a81640fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e48cf90>]}
[0m16:57:54.002889 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.66s]
[0m16:57:54.003654 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m16:57:54.004663 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dm_product
[0m16:57:54.006111 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dm_product ......................... [RUN]
[0m16:57:54.006688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dm_product)
[0m16:57:54.007025 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dm_product
[0m16:57:54.015653 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dm_product"
[0m16:57:54.016369 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dm_product
[0m16:57:54.029212 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dm_product"
[0m16:57:54.029591 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dm_product"} */
show parameters like 'query_tag' in session
[0m16:57:54.029904 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:57:54.656011 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.626 seconds
[0m16:57:54.658662 [debug] [Thread-1 (]: Setting query_tag to 'dm_product'. Will reset to '' after materialization.
[0m16:57:54.659775 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dm_product"
[0m16:57:54.660267 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dm_product"} */
alter session set query_tag = 'dm_product'
[0m16:57:54.759859 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.099 seconds
[0m16:57:54.782280 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dm_product"
[0m16:57:54.785270 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dm_product"
[0m16:57:54.785707 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dm_product"} */
create or replace transient table LB.dwh_mart.dm_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dm_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m16:57:54.887910 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e21-0202-cf54-0000-0002d44648f1
[0m16:57:54.888722 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.DM_PRODUCT' does not exist or not authorized.
[0m16:57:54.889326 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: Close
[0m16:57:55.021128 [debug] [Thread-1 (]: Database Error in model dm_product (models/mart/dm_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dm_product.sql
[0m16:57:55.022096 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2184242-474d-4ec3-95c2-06f7a81640fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e779390>]}
[0m16:57:55.022864 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dm_product ................ [[31mERROR[0m in 1.02s]
[0m16:57:55.023532 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dm_product
[0m16:57:55.024115 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m16:57:55.025769 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m16:57:55.026338 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dm_product, now model.snowflake_airflow_dbt.fact_contract)
[0m16:57:55.026725 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m16:57:55.033526 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:55.034350 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m16:57:55.036315 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:55.036643 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m16:57:55.036910 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:57:55.488562 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.451 seconds
[0m16:57:55.490920 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m16:57:55.491950 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:55.492516 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m16:57:55.580588 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.087 seconds
[0m16:57:55.592213 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:55.592834 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m16:57:55.885973 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.293 seconds
[0m16:57:55.896406 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:55.896909 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m16:57:55.978200 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.081 seconds
[0m16:57:55.985376 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:55.986048 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m16:57:56.057821 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.071 seconds
[0m16:57:56.069941 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:56.070481 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m16:57:56.139948 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.069 seconds
[0m16:57:56.153741 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:56.154480 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:56.154642 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m16:57:56.247192 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.092 seconds
[0m16:57:56.247504 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:56.247704 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m16:57:56.604352 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.356 seconds
[0m16:57:56.605458 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:56.605963 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m16:57:56.760650 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.154 seconds
[0m16:57:56.774591 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m16:57:56.779110 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m16:57:56.779491 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m16:57:56.894388 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.115 seconds
[0m16:57:56.895810 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m16:57:57.002483 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2184242-474d-4ec3-95c2-06f7a81640fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12eba4c90>]}
[0m16:57:57.003203 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 1.98s]
[0m16:57:57.003643 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m16:57:57.005281 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:57:57.005595 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m16:57:57.005924 [info ] [MainThread]: 
[0m16:57:57.006180 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.92 seconds (6.92s).
[0m16:57:57.006857 [debug] [MainThread]: Command end result
[0m16:57:57.034153 [info ] [MainThread]: 
[0m16:57:57.034659 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:57:57.034830 [info ] [MainThread]: 
[0m16:57:57.035054 [error] [MainThread]:   Database Error in model dm_product (models/mart/dm_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dm_product.sql
[0m16:57:57.035217 [info ] [MainThread]: 
[0m16:57:57.035417 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:57:57.038241 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.987247, "process_user_time": 2.152667, "process_kernel_time": 2.604074, "process_mem_max_rss": "194035712", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:57:57.038944 [debug] [MainThread]: Command `dbt run` failed at 16:57:57.038873 after 7.99 seconds
[0m16:57:57.039531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f69e810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1026dacd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102754250>]}
[0m16:57:57.039765 [debug] [MainThread]: Flushing usage events
[0m17:02:07.183774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12431f050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1243812d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124381950>]}


============================== 17:02:07.188513 | 0b265d94-5bd3-48ea-8878-e88256923879 ==============================
[0m17:02:07.188513 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:02:07.188947 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:02:07.867969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0b265d94-5bd3-48ea-8878-e88256923879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136de1650>]}
[0m17:02:07.886084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0b265d94-5bd3-48ea-8878-e88256923879', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117d00d10>]}
[0m17:02:07.886729 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:02:07.898244 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:02:07.963170 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m17:02:07.963495 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dm_product.sql
[0m17:02:07.963656 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m17:02:08.018159 [error] [MainThread]: Encountered an error:
Compilation Error in model dm_product (models/mart/dm_product.sql)
  expected token ',', got 'unique_key'
    line 5
      unique_key='product_id'
[0m17:02:08.019457 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.90020376, "process_user_time": 2.185563, "process_kernel_time": 1.580072, "process_mem_max_rss": "190365696", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:02:08.019709 [debug] [MainThread]: Command `dbt run` failed at 17:02:08.019667 after 0.90 seconds
[0m17:02:08.019883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124361150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100836cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124383390>]}
[0m17:02:08.020037 [debug] [MainThread]: Flushing usage events
[0m17:02:16.097336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121a57ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121abd090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121abd6d0>]}


============================== 17:02:16.100052 | ae26764f-9059-4384-88c2-93ec86f410e6 ==============================
[0m17:02:16.100052 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:02:16.100384 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:02:16.703059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ae26764f-9059-4384-88c2-93ec86f410e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121a7f310>]}
[0m17:02:16.722733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ae26764f-9059-4384-88c2-93ec86f410e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121400a90>]}
[0m17:02:16.723449 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:02:16.733924 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:02:16.828339 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m17:02:16.829547 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dm_product.sql
[0m17:02:16.829771 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m17:02:16.904065 [error] [MainThread]: Encountered an error:
keyword argument repeated: materialized (<template>, line 14)
[0m17:02:16.909108 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 320, in wrapper
    ctx.obj["manifest"] = parse_manifest(
                          ^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/parser/manifest.py", line 1898, in parse_manifest
    manifest = ManifestLoader.get_full_manifest(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/parser/manifest.py", line 330, in get_full_manifest
    manifest = loader.load()
               ^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/parser/manifest.py", line 435, in load
    self.parse_project(
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/parser/manifest.py", line 733, in parse_project
    parser.parse_file(block)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/parser/base.py", line 484, in parse_file
    self.parse_node(file_block)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/parser/base.py", line 445, in parse_node
    self.render_update(node, config)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/parser/models.py", line 348, in render_update
    super().render_update(node, config)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/parser/base.py", line 421, in render_update
    context = self.render_with_context(node, config)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/parser/base.py", line 270, in render_with_context
    get_rendered(parsed_node.raw_code, context, parsed_node, capture_macros=True)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/clients/jinja.py", line 138, in get_rendered
    template = get_template(
               ^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt_common/clients/jinja.py", line 534, in get_template
    return env.from_string(template_source, globals=ctx)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/jinja2/environment.py", line 1108, in from_string
    return cls.from_code(self, self.compile(source), gs, None)
                               ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/jinja2/environment.py", line 766, in compile
    return self._compile(source, filename)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt_common/clients/jinja.py", line 107, in _compile
    return super()._compile(source, filename)  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/jinja2/environment.py", line 706, in _compile
    return compile(source, filename, "exec")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<template>", line 14
SyntaxError: keyword argument repeated: materialized

[0m17:02:16.912431 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8471037, "process_user_time": 1.62983, "process_kernel_time": 1.738304, "process_mem_max_rss": "191791104", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:02:16.913127 [debug] [MainThread]: Command `dbt run` failed at 17:02:16.913056 after 0.85 seconds
[0m17:02:16.913526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121a97f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1274e9250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121abd950>]}
[0m17:02:16.913728 [debug] [MainThread]: Flushing usage events
[0m17:02:32.847460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16021ae90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1602790d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160279750>]}


============================== 17:02:32.849571 | a43c6636-f256-4750-ad32-57ea4410bd27 ==============================
[0m17:02:32.849571 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:02:32.849829 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:02:33.443964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a43c6636-f256-4750-ad32-57ea4410bd27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1676c7ed0>]}
[0m17:02:33.461553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a43c6636-f256-4750-ad32-57ea4410bd27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fb00bd0>]}
[0m17:02:33.462039 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:02:33.472130 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:02:33.532646 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m17:02:33.532975 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dm_product.sql
[0m17:02:33.533136 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m17:02:33.664246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a43c6636-f256-4750-ad32-57ea4410bd27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168811190>]}
[0m17:02:33.709206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a43c6636-f256-4750-ad32-57ea4410bd27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167d3c0d0>]}
[0m17:02:33.709466 [info ] [MainThread]: Found 6 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m17:02:33.709619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a43c6636-f256-4750-ad32-57ea4410bd27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167adf810>]}
[0m17:02:33.710255 [info ] [MainThread]: 
[0m17:02:33.710469 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:02:33.712102 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:02:33.717186 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:02:33.717344 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:02:33.717458 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:02:34.281611 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.564 seconds
[0m17:02:34.284202 [debug] [ThreadPool]: On list_LB: Close
[0m17:02:34.419184 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m17:02:34.430631 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:02:34.431036 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:02:34.431304 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:02:35.188062 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.757 seconds
[0m17:02:35.192093 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:02:35.329697 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m17:02:35.336737 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:02:35.337249 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:02:35.337486 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:02:35.840564 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.503 seconds
[0m17:02:35.844726 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:02:36.030598 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m17:02:36.037144 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m17:02:36.037717 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m17:02:36.038111 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:02:36.875410 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.837 seconds
[0m17:02:36.877743 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m17:02:36.992869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a43c6636-f256-4750-ad32-57ea4410bd27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f3dced0>]}
[0m17:02:36.994384 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:02:36.995039 [info ] [MainThread]: 
[0m17:02:36.999007 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:02:36.999772 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m17:02:37.000407 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m17:02:37.000827 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:02:37.007935 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:02:37.008742 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:02:37.018146 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:02:37.018466 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:02:37.018631 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:02:37.327902 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.309 seconds
[0m17:02:37.328812 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:02:37.329198 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:02:37.329353 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:02:37.461989 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.132 seconds
[0m17:02:37.471630 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:02:37.472445 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:02:37.472644 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:02:38.182458 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.709 seconds
[0m17:02:38.207922 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:02:38.314315 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a43c6636-f256-4750-ad32-57ea4410bd27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1679d6f50>]}
[0m17:02:38.315881 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.31s]
[0m17:02:38.316968 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:02:38.317564 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dm_product
[0m17:02:38.318335 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dm_product ......................... [RUN]
[0m17:02:38.318989 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dm_product)
[0m17:02:38.319470 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dm_product
[0m17:02:38.325977 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dm_product"
[0m17:02:38.326977 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dm_product
[0m17:02:38.346323 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dm_product"
[0m17:02:38.346744 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dm_product"} */
show parameters like 'query_tag' in session
[0m17:02:38.347001 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:02:38.909549 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.562 seconds
[0m17:02:38.911724 [debug] [Thread-1 (]: Setting query_tag to 'dm_product'. Will reset to '' after materialization.
[0m17:02:38.912522 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dm_product"
[0m17:02:38.912974 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dm_product"} */
alter session set query_tag = 'dm_product'
[0m17:02:39.009872 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.096 seconds
[0m17:02:39.026976 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dm_product"
[0m17:02:39.028394 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dm_product"
[0m17:02:39.028630 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dm_product"} */
create or replace transient table LB.dwh_mart.dm_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dm_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m17:02:39.240860 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e26-0202-cf6b-0000-0002d44638c5
[0m17:02:39.241415 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.DM_PRODUCT' does not exist or not authorized.
[0m17:02:39.241935 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: Close
[0m17:02:39.389999 [debug] [Thread-1 (]: Database Error in model dm_product (models/mart/dm_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dm_product.sql
[0m17:02:39.390873 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a43c6636-f256-4750-ad32-57ea4410bd27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167da43d0>]}
[0m17:02:39.391574 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dm_product ................ [[31mERROR[0m in 1.07s]
[0m17:02:39.392221 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dm_product
[0m17:02:39.392642 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:02:39.393808 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m17:02:39.394394 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dm_product, now model.snowflake_airflow_dbt.fact_contract)
[0m17:02:39.394798 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:02:39.398835 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:39.399312 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:02:39.400392 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:39.400557 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:02:39.400700 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:02:39.735324 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.334 seconds
[0m17:02:39.737421 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:02:39.738330 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:39.738844 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:02:39.811722 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.072 seconds
[0m17:02:39.815149 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:39.815431 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m17:02:40.154835 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.339 seconds
[0m17:02:40.166638 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:40.167125 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m17:02:40.260399 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.093 seconds
[0m17:02:40.265549 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:40.266241 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m17:02:40.335962 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.069 seconds
[0m17:02:40.345148 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:40.345634 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m17:02:40.408715 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.063 seconds
[0m17:02:40.461404 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:40.463229 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:40.463438 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m17:02:40.568825 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.105 seconds
[0m17:02:40.569361 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:40.569710 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m17:02:40.870007 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.300 seconds
[0m17:02:40.871021 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:40.871299 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m17:02:41.002229 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.130 seconds
[0m17:02:41.016035 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m17:02:41.020887 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:02:41.021131 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m17:02:41.162637 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.141 seconds
[0m17:02:41.165895 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:02:41.276258 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a43c6636-f256-4750-ad32-57ea4410bd27', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1679bbf10>]}
[0m17:02:41.277159 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 1.88s]
[0m17:02:41.277836 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:02:41.280509 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:02:41.280904 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m17:02:41.281400 [info ] [MainThread]: 
[0m17:02:41.281776 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 7.57 seconds (7.57s).
[0m17:02:41.282929 [debug] [MainThread]: Command end result
[0m17:02:41.308528 [info ] [MainThread]: 
[0m17:02:41.309121 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:02:41.309322 [info ] [MainThread]: 
[0m17:02:41.309509 [error] [MainThread]:   Database Error in model dm_product (models/mart/dm_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dm_product.sql
[0m17:02:41.309651 [info ] [MainThread]: 
[0m17:02:41.309848 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:02:41.315175 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.49826, "process_user_time": 2.089351, "process_kernel_time": 2.559035, "process_mem_max_rss": "198393856", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:02:41.315839 [debug] [MainThread]: Command `dbt run` failed at 17:02:41.315773 after 8.50 seconds
[0m17:02:41.316481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1602607d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104aeecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104df0250>]}
[0m17:02:41.316700 [debug] [MainThread]: Flushing usage events
[0m17:27:53.304789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f2f0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e4bd550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e4bdbd0>]}


============================== 17:27:53.307750 | d284b60e-5362-40ce-8a5f-e661ef243e2a ==============================
[0m17:27:53.307750 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:27:53.308119 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:27:54.126004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b3ead50>]}
[0m17:27:54.149208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df00c90>]}
[0m17:27:54.149935 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:27:54.162966 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:27:54.223850 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m17:27:54.224185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ce2ead0>]}
[0m17:27:54.755620 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m17:27:54.755919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d447650>]}
[0m17:27:54.829445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c6f52d0>]}
[0m17:27:54.886927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f8d60d0>]}
[0m17:27:54.887213 [info ] [MainThread]: Found 6 models, 3 seeds, 2 data tests, 3 sources, 448 macros
[0m17:27:54.887364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d6fe950>]}
[0m17:27:54.888054 [info ] [MainThread]: 
[0m17:27:54.888288 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:27:54.890083 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:27:54.895325 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:27:54.895490 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:27:54.895610 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:27:55.427879 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.532 seconds
[0m17:27:55.432661 [debug] [ThreadPool]: On list_LB: Close
[0m17:27:55.556168 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:27:55.556887 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:27:55.557292 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:27:56.529548 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.972 seconds
[0m17:27:56.531967 [debug] [ThreadPool]: On list_LB: Close
[0m17:27:56.643047 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m17:27:56.654932 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:27:56.655395 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:27:56.655667 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:27:57.111050 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.455 seconds
[0m17:27:57.114672 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:27:57.221481 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m17:27:57.226502 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m17:27:57.226975 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m17:27:57.227307 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:27:57.694957 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.467 seconds
[0m17:27:57.696393 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m17:27:57.801730 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m17:27:57.804020 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:27:57.804316 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:27:57.804490 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:27:58.131324 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.327 seconds
[0m17:27:58.132265 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:27:58.245177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d646350>]}
[0m17:27:58.246592 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:27:58.247016 [info ] [MainThread]: 
[0m17:27:58.250642 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:27:58.251551 [info ] [Thread-1 (]: 1 of 3 START sql table model stage.dim_date .................................... [RUN]
[0m17:27:58.252123 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m17:27:58.252568 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:27:58.262059 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:27:58.263827 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:27:58.277793 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:27:58.278460 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:27:58.278876 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:27:58.680170 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.401 seconds
[0m17:27:58.682306 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:27:58.683952 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:27:58.684432 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:27:58.761065 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.076 seconds
[0m17:27:58.782311 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:27:58.783737 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:27:58.784011 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:27:59.809443 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.025 seconds
[0m17:27:59.835391 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:27:59.937648 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d4eb010>]}
[0m17:27:59.938590 [info ] [Thread-1 (]: 1 of 3 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 1.68s]
[0m17:27:59.939262 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:27:59.939737 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dm_product
[0m17:27:59.940416 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dm_product ......................... [RUN]
[0m17:27:59.941013 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dm_product)
[0m17:27:59.941389 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dm_product
[0m17:27:59.946575 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dm_product"
[0m17:27:59.948236 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dm_product
[0m17:27:59.963942 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dm_product"
[0m17:27:59.964352 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dm_product"} */
show parameters like 'query_tag' in session
[0m17:27:59.964595 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:28:00.301139 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.336 seconds
[0m17:28:00.304472 [debug] [Thread-1 (]: Setting query_tag to 'dm_product'. Will reset to '' after materialization.
[0m17:28:00.306140 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dm_product"
[0m17:28:00.306537 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dm_product"} */
alter session set query_tag = 'dm_product'
[0m17:28:00.380074 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.073 seconds
[0m17:28:00.395702 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dm_product"
[0m17:28:00.398055 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dm_product"
[0m17:28:00.398348 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dm_product"} */
create or replace transient table LB.dwh_mart.dm_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dm_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m17:28:00.497235 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e40-0202-cf54-0000-0002d44649a1
[0m17:28:00.497612 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.DM_PRODUCT' does not exist or not authorized.
[0m17:28:00.497961 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dm_product: Close
[0m17:28:00.597451 [debug] [Thread-1 (]: Database Error in model dm_product (models/mart/dm_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dm_product.sql
[0m17:28:00.597852 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fcaad90>]}
[0m17:28:00.598308 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dm_product ................ [[31mERROR[0m in 0.66s]
[0m17:28:00.598653 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dm_product
[0m17:28:00.598863 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:28:00.599778 [info ] [Thread-1 (]: 3 of 3 START sql incremental model stage.fact_contract ......................... [RUN]
[0m17:28:00.600123 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dm_product, now model.snowflake_airflow_dbt.fact_contract)
[0m17:28:00.600376 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:28:00.602701 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:28:00.603712 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:28:00.604924 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:28:00.605128 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:28:00.605303 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:28:01.075990 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.470 seconds
[0m17:28:01.078288 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:28:01.079063 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:28:01.079420 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:28:01.185300 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.105 seconds
[0m17:28:01.189759 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:28:01.193017 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:28:01.193609 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace transient table LB.stage.fact_contract
         as
        (

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
)

select * from incremental
        );
[0m17:28:01.650115 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.456 seconds
[0m17:28:01.662550 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_contract__dbt_tmp
[0m17:28:01.670439 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:28:01.670761 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.stage.fact_contract__dbt_tmp cascade
[0m17:28:01.764193 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m17:28:01.766727 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:28:01.875691 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd284b60e-5362-40ce-8a5f-e661ef243e2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ab8c210>]}
[0m17:28:01.876977 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model stage.fact_contract .................... [[32mSUCCESS 1[0m in 1.28s]
[0m17:28:01.877925 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:28:01.880123 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:28:01.880702 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m17:28:01.881294 [info ] [MainThread]: 
[0m17:28:01.881599 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.99 seconds (6.99s).
[0m17:28:01.882571 [debug] [MainThread]: Command end result
[0m17:28:01.907342 [info ] [MainThread]: 
[0m17:28:01.907627 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:28:01.907761 [info ] [MainThread]: 
[0m17:28:01.907949 [error] [MainThread]:   Database Error in model dm_product (models/mart/dm_product.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.DM_PRODUCT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dm_product.sql
[0m17:28:01.908083 [info ] [MainThread]: 
[0m17:28:01.908434 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:28:01.911725 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.638518, "process_user_time": 2.849837, "process_kernel_time": 2.535263, "process_mem_max_rss": "190185472", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:28:01.912367 [debug] [MainThread]: Command `dbt run` failed at 17:28:01.912323 after 8.64 seconds
[0m17:28:01.913202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100962cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e4bded0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d570810>]}
[0m17:28:01.913362 [debug] [MainThread]: Flushing usage events
[0m17:35:46.212529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16865b990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168680cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168681350>]}


============================== 17:35:46.215067 | 132e8163-ccd6-4303-8dd3-b06fb6d12190 ==============================
[0m17:35:46.215067 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:35:46.215329 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:35:46.902177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '132e8163-ccd6-4303-8dd3-b06fb6d12190', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16beb65d0>]}
[0m17:35:46.920986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '132e8163-ccd6-4303-8dd3-b06fb6d12190', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ff00c50>]}
[0m17:35:46.921554 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:35:46.934197 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:35:47.001071 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 1 files changed.
[0m17:35:47.001368 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/mart/sasasa.sql
[0m17:35:47.001581 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/_stg_models.yml
[0m17:35:47.001700 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/mart/dm_product.sql
[0m17:35:47.144356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '132e8163-ccd6-4303-8dd3-b06fb6d12190', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ff00310>]}
[0m17:35:47.185953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '132e8163-ccd6-4303-8dd3-b06fb6d12190', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e74a8d0>]}
[0m17:35:47.186203 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m17:35:47.186351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '132e8163-ccd6-4303-8dd3-b06fb6d12190', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f916110>]}
[0m17:35:47.186976 [info ] [MainThread]: 
[0m17:35:47.187190 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:35:47.188818 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:35:47.193972 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:35:47.194134 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:35:47.194249 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:35:48.272069 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.077 seconds
[0m17:35:48.277547 [debug] [ThreadPool]: On list_LB: Close
[0m17:35:48.391938 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m17:35:48.408187 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:35:48.408465 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:35:48.408716 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:35:48.871634 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.463 seconds
[0m17:35:48.874088 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:35:48.980266 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m17:35:48.985440 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:35:48.985863 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:35:48.986106 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:35:49.459178 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.473 seconds
[0m17:35:49.461696 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:35:49.577550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '132e8163-ccd6-4303-8dd3-b06fb6d12190', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e3e36d0>]}
[0m17:35:49.578458 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:35:49.578868 [info ] [MainThread]: 
[0m17:35:49.582599 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:35:49.583378 [info ] [Thread-1 (]: 1 of 3 START sql table model stage.dim_date .................................... [RUN]
[0m17:35:49.583915 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m17:35:49.584347 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:35:49.591445 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:35:49.592408 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:35:49.600002 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:35:49.600306 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:35:49.600466 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:35:49.916441 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.316 seconds
[0m17:35:49.919197 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:35:49.920297 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:35:49.920847 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:35:49.987103 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.066 seconds
[0m17:35:50.008215 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:35:50.010997 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:35:50.011337 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:35:50.863534 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.851 seconds
[0m17:35:50.900638 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:35:51.007592 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132e8163-ccd6-4303-8dd3-b06fb6d12190', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fd01150>]}
[0m17:35:51.010666 [info ] [Thread-1 (]: 1 of 3 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 1.42s]
[0m17:35:51.011159 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:35:51.011666 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:35:51.012696 [info ] [Thread-1 (]: 2 of 3 START sql incremental model stage.fact_contract ......................... [RUN]
[0m17:35:51.013020 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.fact_contract)
[0m17:35:51.013208 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:35:51.020830 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:51.021696 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:35:51.030578 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:51.030862 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:35:51.031033 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:35:51.344665 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.314 seconds
[0m17:35:51.346391 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:35:51.347162 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:51.347557 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:35:51.419204 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.071 seconds
[0m17:35:51.438879 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:51.439158 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.stage.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.stage.fact_contract)
    
)

select * from incremental
  );
[0m17:35:51.776931 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.337 seconds
[0m17:35:51.787133 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:51.787752 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.stage.fact_contract__dbt_tmp
[0m17:35:51.871076 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.083 seconds
[0m17:35:51.876655 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:51.877197 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.stage.fact_contract
[0m17:35:51.948057 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.070 seconds
[0m17:35:51.958327 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:51.958773 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."STAGE"."FACT_CONTRACT"
[0m17:35:52.059927 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.101 seconds
[0m17:35:52.086949 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:52.087920 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:52.088106 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m17:35:52.176462 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.088 seconds
[0m17:35:52.176949 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:52.177267 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.stage.fact_contract as DBT_INTERNAL_DEST
        using LB.stage.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m17:35:52.803616 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.626 seconds
[0m17:35:52.804745 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:52.805268 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m17:35:52.909219 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.103 seconds
[0m17:35:52.921804 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_contract__dbt_tmp
[0m17:35:52.927858 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:35:52.928146 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.stage.fact_contract__dbt_tmp cascade
[0m17:35:53.045544 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.117 seconds
[0m17:35:53.047486 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:35:53.173417 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132e8163-ccd6-4303-8dd3-b06fb6d12190', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e0b6210>]}
[0m17:35:53.174869 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model stage.fact_contract .................... [[32mSUCCESS 0[0m in 2.16s]
[0m17:35:53.175841 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:35:53.176634 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.sasasa
[0m17:35:53.177656 [info ] [Thread-1 (]: 3 of 3 START sql incremental model stage.sasasa ................................ [RUN]
[0m17:35:53.178306 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_contract, now model.snowflake_airflow_dbt.sasasa)
[0m17:35:53.178758 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.sasasa
[0m17:35:53.183887 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.sasasa"
[0m17:35:53.184920 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.sasasa
[0m17:35:53.187679 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.sasasa"
[0m17:35:53.188188 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.sasasa: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.sasasa"} */
show parameters like 'query_tag' in session
[0m17:35:53.188565 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:35:53.546142 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.357 seconds
[0m17:35:53.548530 [debug] [Thread-1 (]: Setting query_tag to 'sasasa'. Will reset to '' after materialization.
[0m17:35:53.549725 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.sasasa"
[0m17:35:53.550307 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.sasasa: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.sasasa"} */
alter session set query_tag = 'sasasa'
[0m17:35:53.643983 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m17:35:53.647290 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.sasasa"
[0m17:35:53.651842 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.sasasa"
[0m17:35:53.652512 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.sasasa: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.sasasa"} */
create or replace transient table LB.stage.sasasa
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.stage.sasasa
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m17:35:53.747707 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e47-0202-cf69-0000-0002d4465a11
[0m17:35:53.748347 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.STAGE.SASASA' does not exist or not authorized.
[0m17:35:53.749486 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.sasasa: Close
[0m17:35:53.873991 [debug] [Thread-1 (]: Database Error in model sasasa (models/mart/sasasa.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.STAGE.SASASA' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/sasasa.sql
[0m17:35:53.874654 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '132e8163-ccd6-4303-8dd3-b06fb6d12190', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e093f50>]}
[0m17:35:53.875210 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model stage.sasasa ....................... [[31mERROR[0m in 0.70s]
[0m17:35:53.875763 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.sasasa
[0m17:35:53.879400 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:35:53.879823 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.sasasa' was properly closed.
[0m17:35:53.880336 [info ] [MainThread]: 
[0m17:35:53.880708 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.69 seconds (6.69s).
[0m17:35:53.881625 [debug] [MainThread]: Command end result
[0m17:35:53.926315 [info ] [MainThread]: 
[0m17:35:53.926710 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:35:53.926913 [info ] [MainThread]: 
[0m17:35:53.927117 [error] [MainThread]:   Database Error in model sasasa (models/mart/sasasa.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.STAGE.SASASA' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/sasasa.sql
[0m17:35:53.927268 [info ] [MainThread]: 
[0m17:35:53.927564 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:35:53.933724 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.7488866, "process_user_time": 2.458336, "process_kernel_time": 2.088881, "process_mem_max_rss": "198033408", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:35:53.934817 [debug] [MainThread]: Command `dbt run` failed at 17:35:53.934764 after 7.75 seconds
[0m17:35:53.936024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f370450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e66cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ee0250>]}
[0m17:35:53.936268 [debug] [MainThread]: Flushing usage events
[0m17:36:23.969978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e65ac50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e69cf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e69c810>]}


============================== 17:36:23.972600 | b577079b-e029-4a98-b8c1-aca186e6fa96 ==============================
[0m17:36:23.972600 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:36:23.972943 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:36:24.661664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b577079b-e029-4a98-b8c1-aca186e6fa96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e69c810>]}
[0m17:36:24.687827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b577079b-e029-4a98-b8c1-aca186e6fa96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14defc9d0>]}
[0m17:36:24.688580 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:36:24.701829 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:36:24.769155 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m17:36:24.769772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b577079b-e029-4a98-b8c1-aca186e6fa96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cef51d0>]}
[0m17:36:25.779366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b577079b-e029-4a98-b8c1-aca186e6fa96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b5e2910>]}
[0m17:36:25.836506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b577079b-e029-4a98-b8c1-aca186e6fa96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ba8df10>]}
[0m17:36:25.836821 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m17:36:25.836993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b577079b-e029-4a98-b8c1-aca186e6fa96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b588e90>]}
[0m17:36:25.837882 [info ] [MainThread]: 
[0m17:36:25.838206 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:36:25.840159 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:36:25.847919 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:36:25.848463 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:36:25.848889 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:36:26.349553 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.501 seconds
[0m17:36:26.350965 [debug] [ThreadPool]: On list_LB: Close
[0m17:36:26.455600 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m17:36:26.460469 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:36:26.460676 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:36:26.460815 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:36:26.806195 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.345 seconds
[0m17:36:26.810238 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:36:26.914497 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m17:36:26.919712 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:36:26.920229 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:36:26.920587 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:36:27.367466 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.447 seconds
[0m17:36:27.370131 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:36:27.475037 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m17:36:27.481111 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m17:36:27.481752 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m17:36:27.482095 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:36:27.930873 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.448 seconds
[0m17:36:27.934523 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m17:36:28.046243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b577079b-e029-4a98-b8c1-aca186e6fa96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b8e0d90>]}
[0m17:36:28.048634 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:36:28.049243 [info ] [MainThread]: 
[0m17:36:28.058037 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:36:28.059371 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m17:36:28.059903 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m17:36:28.060091 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:36:28.066738 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:36:28.067662 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:36:28.074129 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:36:28.074392 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:36:28.074560 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:36:28.397502 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.323 seconds
[0m17:36:28.398400 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:36:28.398761 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:36:28.398916 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:36:28.472250 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.073 seconds
[0m17:36:28.487115 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:36:28.487949 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:36:28.488136 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:36:29.248590 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.760 seconds
[0m17:36:29.269849 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:36:29.374710 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b577079b-e029-4a98-b8c1-aca186e6fa96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ba418d0>]}
[0m17:36:29.375874 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.31s]
[0m17:36:29.376784 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:36:29.377434 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:36:29.378318 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m17:36:29.378926 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.fact_contract)
[0m17:36:29.379331 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:36:29.386078 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:29.386596 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:36:29.395249 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:29.395539 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:36:29.395688 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:36:29.719973 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.324 seconds
[0m17:36:29.722515 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:36:29.723504 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:29.724076 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:36:29.801777 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.077 seconds
[0m17:36:29.823785 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:29.824118 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m17:36:30.072220 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.248 seconds
[0m17:36:30.089196 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:30.089575 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m17:36:30.159365 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.069 seconds
[0m17:36:30.165945 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:30.166494 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m17:36:30.258200 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.091 seconds
[0m17:36:30.271145 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:30.271691 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m17:36:30.338753 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.066 seconds
[0m17:36:30.368992 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:30.370634 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:30.370901 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m17:36:30.458189 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.087 seconds
[0m17:36:30.458562 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:30.458780 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m17:36:30.740970 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.282 seconds
[0m17:36:30.742158 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:30.742714 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m17:36:30.878061 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.135 seconds
[0m17:36:30.887896 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m17:36:30.896300 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:36:30.896690 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m17:36:31.030014 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.133 seconds
[0m17:36:31.033946 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:36:31.145723 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b577079b-e029-4a98-b8c1-aca186e6fa96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b726fd0>]}
[0m17:36:31.147406 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 1.77s]
[0m17:36:31.148571 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:36:31.149271 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.sasasa
[0m17:36:31.150128 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.sasasa ............................. [RUN]
[0m17:36:31.150786 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_contract, now model.snowflake_airflow_dbt.sasasa)
[0m17:36:31.151229 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.sasasa
[0m17:36:31.156776 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.sasasa"
[0m17:36:31.157702 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.sasasa
[0m17:36:31.160295 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.sasasa"
[0m17:36:31.160641 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.sasasa: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.sasasa"} */
show parameters like 'query_tag' in session
[0m17:36:31.160962 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:36:31.567174 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.406 seconds
[0m17:36:31.569448 [debug] [Thread-1 (]: Setting query_tag to 'sasasa'. Will reset to '' after materialization.
[0m17:36:31.570244 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.sasasa"
[0m17:36:31.570580 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.sasasa: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.sasasa"} */
alter session set query_tag = 'sasasa'
[0m17:36:31.654844 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m17:36:31.657825 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.sasasa"
[0m17:36:31.661082 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.sasasa"
[0m17:36:31.661631 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.sasasa: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.sasasa"} */
create or replace transient table LB.dwh_mart.sasasa
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.sasasa
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m17:36:31.775115 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e48-0202-cf68-0000-0002d4462a15
[0m17:36:31.775650 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.SASASA' does not exist or not authorized.
[0m17:36:31.776081 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.sasasa: Close
[0m17:36:31.889666 [debug] [Thread-1 (]: Database Error in model sasasa (models/mart/sasasa.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.SASASA' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/sasasa.sql
[0m17:36:31.890720 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b577079b-e029-4a98-b8c1-aca186e6fa96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bee21d0>]}
[0m17:36:31.891713 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.sasasa .................... [[31mERROR[0m in 0.74s]
[0m17:36:31.892433 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.sasasa
[0m17:36:31.895136 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:36:31.895603 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.sasasa' was properly closed.
[0m17:36:31.896099 [info ] [MainThread]: 
[0m17:36:31.896670 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.06 seconds (6.06s).
[0m17:36:31.897723 [debug] [MainThread]: Command end result
[0m17:36:31.925705 [info ] [MainThread]: 
[0m17:36:31.926004 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:36:31.926152 [info ] [MainThread]: 
[0m17:36:31.926331 [error] [MainThread]:   Database Error in model sasasa (models/mart/sasasa.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.SASASA' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/sasasa.sql
[0m17:36:31.926472 [info ] [MainThread]: 
[0m17:36:31.926623 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:36:31.928896 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.98889, "process_user_time": 3.198901, "process_kernel_time": 2.516748, "process_mem_max_rss": "184270848", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:36:31.929401 [debug] [MainThread]: Command `dbt run` failed at 17:36:31.929348 after 7.99 seconds
[0m17:36:31.929715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e6bd1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f1acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e697c50>]}
[0m17:36:31.929947 [debug] [MainThread]: Flushing usage events
[0m17:37:52.348670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12481f850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124871590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12485acd0>]}


============================== 17:37:52.350995 | 108c8d0c-d1f4-4263-afec-17def3331bb3 ==============================
[0m17:37:52.350995 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:37:52.351273 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:37:53.070377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '108c8d0c-d1f4-4263-afec-17def3331bb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12483f950>]}
[0m17:37:53.094680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '108c8d0c-d1f4-4263-afec-17def3331bb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124000d10>]}
[0m17:37:53.095396 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:37:53.118293 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:37:53.216800 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m17:37:53.217237 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m17:37:53.217389 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/mart/sasasa.sql
[0m17:37:53.342380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '108c8d0c-d1f4-4263-afec-17def3331bb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141742550>]}
[0m17:37:53.434992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '108c8d0c-d1f4-4263-afec-17def3331bb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1242f0c10>]}
[0m17:37:53.435323 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m17:37:53.435483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '108c8d0c-d1f4-4263-afec-17def3331bb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140cdb050>]}
[0m17:37:53.436199 [info ] [MainThread]: 
[0m17:37:53.436448 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:37:53.438420 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:37:53.444433 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:37:53.444670 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:37:53.444801 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:37:54.025637 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.579 seconds
[0m17:37:54.031699 [debug] [ThreadPool]: On list_LB: Close
[0m17:37:54.153640 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m17:37:54.158912 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:37:54.159140 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:37:54.159277 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:37:54.514112 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.355 seconds
[0m17:37:54.516443 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:37:54.625015 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m17:37:54.626575 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m17:37:54.626732 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m17:37:54.626849 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:37:55.029985 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.403 seconds
[0m17:37:55.033062 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m17:37:55.128770 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m17:37:55.130398 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:37:55.130587 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:37:55.130715 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:37:55.467010 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.336 seconds
[0m17:37:55.470532 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:37:55.573848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '108c8d0c-d1f4-4263-afec-17def3331bb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14177c710>]}
[0m17:37:55.575963 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:37:55.576669 [info ] [MainThread]: 
[0m17:37:55.583078 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:37:55.584427 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m17:37:55.585415 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m17:37:55.586149 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:37:55.602617 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:37:55.604494 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:37:55.620006 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:37:55.620444 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:37:55.621093 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:37:56.058740 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.438 seconds
[0m17:37:56.060461 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:37:56.061195 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:37:56.061520 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:37:56.131136 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.069 seconds
[0m17:37:56.146084 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:37:56.146976 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:37:56.147183 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:37:57.019190 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.871 seconds
[0m17:37:57.038235 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:37:57.156832 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108c8d0c-d1f4-4263-afec-17def3331bb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1417fee90>]}
[0m17:37:57.158110 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.57s]
[0m17:37:57.158969 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:37:57.159600 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m17:37:57.160614 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m17:37:57.161269 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m17:37:57.161745 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m17:37:57.167568 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m17:37:57.168165 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m17:37:57.186367 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:37:57.187210 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m17:37:57.187856 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:37:57.685950 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.498 seconds
[0m17:37:57.688511 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m17:37:57.689531 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:37:57.689997 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m17:37:57.817535 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.127 seconds
[0m17:37:57.838361 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m17:37:57.839226 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:37:57.839401 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
)
        );
[0m17:37:57.927382 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e49-0202-cf68-0000-0002d4462a1d
[0m17:37:57.927703 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 8 at position 8 unexpected ')'.
[0m17:37:57.928088 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m17:37:58.063198 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 8 unexpected ')'.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m17:37:58.065245 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108c8d0c-d1f4-4263-afec-17def3331bb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141feb950>]}
[0m17:37:58.066957 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 0.90s]
[0m17:37:58.068136 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m17:37:58.068926 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:37:58.071834 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m17:37:58.072699 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m17:37:58.073220 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:37:58.088887 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:58.089714 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:37:58.096029 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:58.096919 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:37:58.097707 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:37:58.495568 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.398 seconds
[0m17:37:58.497649 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:37:58.498582 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:58.498924 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:37:58.579885 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.080 seconds
[0m17:37:58.589372 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:58.589855 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m17:37:58.887405 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.297 seconds
[0m17:37:58.899198 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:58.899761 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m17:37:58.980420 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.080 seconds
[0m17:37:58.987008 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:58.987706 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m17:37:59.044617 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.056 seconds
[0m17:37:59.055956 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:59.056517 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m17:37:59.156894 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.100 seconds
[0m17:37:59.181858 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:59.182920 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:59.183128 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m17:37:59.286861 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.104 seconds
[0m17:37:59.287159 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:59.287378 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m17:37:59.677126 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.389 seconds
[0m17:37:59.677560 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:59.677731 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m17:37:59.839773 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.162 seconds
[0m17:37:59.854008 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m17:37:59.861832 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:37:59.862118 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m17:38:00.029611 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.167 seconds
[0m17:38:00.033140 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:38:00.245486 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108c8d0c-d1f4-4263-afec-17def3331bb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1417b0050>]}
[0m17:38:00.246160 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 2.17s]
[0m17:38:00.246566 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:38:00.247692 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:38:00.247873 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m17:38:00.248108 [info ] [MainThread]: 
[0m17:38:00.248280 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.81 seconds (6.81s).
[0m17:38:00.248702 [debug] [MainThread]: Command end result
[0m17:38:00.274633 [info ] [MainThread]: 
[0m17:38:00.274952 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:38:00.275088 [info ] [MainThread]: 
[0m17:38:00.275249 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 8 unexpected ')'.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m17:38:00.275376 [info ] [MainThread]: 
[0m17:38:00.275521 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:38:00.279240 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.971033, "process_user_time": 2.78943, "process_kernel_time": 1.589922, "process_mem_max_rss": "193871872", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:38:00.280077 [debug] [MainThread]: Command `dbt run` failed at 17:38:00.280027 after 7.97 seconds
[0m17:38:00.280538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12485ab90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047decd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142261590>]}
[0m17:38:00.280759 [debug] [MainThread]: Flushing usage events
[0m17:38:39.609402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12221f990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12227d010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12227d690>]}


============================== 17:38:39.612048 | 41acb5c5-fbcb-4ee7-889e-950e4ec3c8c2 ==============================
[0m17:38:39.612048 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:38:39.612332 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:38:40.415387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '41acb5c5-fbcb-4ee7-889e-950e4ec3c8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126f36d50>]}
[0m17:38:40.434747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '41acb5c5-fbcb-4ee7-889e-950e4ec3c8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121300c50>]}
[0m17:38:40.435387 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:38:40.465656 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:38:40.604284 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:38:40.604652 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m17:38:40.691711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41acb5c5-fbcb-4ee7-889e-950e4ec3c8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126ed3490>]}
[0m17:38:40.791508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41acb5c5-fbcb-4ee7-889e-950e4ec3c8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1270b98d0>]}
[0m17:38:40.791833 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m17:38:40.791999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41acb5c5-fbcb-4ee7-889e-950e4ec3c8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127090250>]}
[0m17:38:40.792741 [info ] [MainThread]: 
[0m17:38:40.793013 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:38:40.795145 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:38:40.801634 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:38:40.801857 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:38:40.802008 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:38:41.271906 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.470 seconds
[0m17:38:41.274619 [debug] [ThreadPool]: On list_LB: Close
[0m17:38:41.407274 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m17:38:41.417740 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:38:41.418248 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:38:41.418590 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:38:41.870200 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.452 seconds
[0m17:38:41.874352 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:38:41.999576 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m17:38:42.004814 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:38:42.005379 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:38:42.005679 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:38:42.353884 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.348 seconds
[0m17:38:42.356901 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:38:42.849077 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m17:38:42.853092 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m17:38:42.853559 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m17:38:42.853884 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:38:43.250311 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.396 seconds
[0m17:38:43.251749 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m17:38:43.367723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41acb5c5-fbcb-4ee7-889e-950e4ec3c8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1272c7610>]}
[0m17:38:43.368291 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:38:43.368561 [info ] [MainThread]: 
[0m17:38:43.371601 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:38:43.372064 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m17:38:43.372416 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m17:38:43.372678 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:38:43.378756 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:38:43.379556 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:38:43.388699 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:38:43.389080 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:38:43.389439 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:43.721970 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.332 seconds
[0m17:38:43.724995 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:38:43.726104 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:38:43.726679 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:38:43.864559 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.137 seconds
[0m17:38:43.885142 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:38:43.886393 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:38:43.886667 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:38:44.530832 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.644 seconds
[0m17:38:44.559122 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:38:44.667012 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41acb5c5-fbcb-4ee7-889e-950e4ec3c8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1277ee1d0>]}
[0m17:38:44.668564 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.29s]
[0m17:38:44.669504 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:38:44.670048 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m17:38:44.670783 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m17:38:44.671433 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m17:38:44.671850 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m17:38:44.675057 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m17:38:44.676302 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m17:38:44.692423 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:38:44.692812 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m17:38:44.693150 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:45.046436 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.353 seconds
[0m17:38:45.047428 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m17:38:45.047839 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:38:45.048047 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m17:38:45.116498 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.068 seconds
[0m17:38:45.133067 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m17:38:45.133693 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:38:45.133845 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
)
select * from source
        );
[0m17:38:45.863764 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.729 seconds
[0m17:38:45.884584 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m17:38:45.902289 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:38:45.903043 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m17:38:45.958100 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.054 seconds
[0m17:38:45.959720 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m17:38:46.065833 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41acb5c5-fbcb-4ee7-889e-950e4ec3c8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12776fe90>]}
[0m17:38:46.067052 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 1[0m in 1.39s]
[0m17:38:46.067851 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m17:38:46.068389 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:38:46.069224 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m17:38:46.069822 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m17:38:46.070377 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:38:46.081040 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:46.081567 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:38:46.082729 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:46.082952 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:38:46.083152 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:38:46.478271 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.395 seconds
[0m17:38:46.481576 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:38:46.482251 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:46.482656 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:38:46.565511 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.082 seconds
[0m17:38:46.574675 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:46.575124 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m17:38:46.884605 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.309 seconds
[0m17:38:46.892823 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:46.893143 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m17:38:46.973742 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.080 seconds
[0m17:38:46.978506 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:46.979020 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m17:38:47.055911 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.076 seconds
[0m17:38:47.065560 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:47.066111 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m17:38:47.122834 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.056 seconds
[0m17:38:47.148707 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:47.149780 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:47.149973 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m17:38:47.263479 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.113 seconds
[0m17:38:47.264048 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:47.264452 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m17:38:47.603209 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.338 seconds
[0m17:38:47.604512 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:47.605060 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m17:38:47.785636 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.180 seconds
[0m17:38:47.790615 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m17:38:47.791797 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:38:47.792333 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m17:38:47.920663 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.128 seconds
[0m17:38:47.925762 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:38:48.040365 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41acb5c5-fbcb-4ee7-889e-950e4ec3c8c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12727c250>]}
[0m17:38:48.041418 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 1.97s]
[0m17:38:48.042153 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:38:48.046218 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:38:48.046717 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m17:38:48.047377 [info ] [MainThread]: 
[0m17:38:48.047803 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 7.25 seconds (7.25s).
[0m17:38:48.050475 [debug] [MainThread]: Command end result
[0m17:38:48.095927 [info ] [MainThread]: 
[0m17:38:48.097089 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:38:48.097275 [info ] [MainThread]: 
[0m17:38:48.097849 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m17:38:48.102755 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.528841, "process_user_time": 2.355046, "process_kernel_time": 2.60701, "process_mem_max_rss": "191512576", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:38:48.118700 [debug] [MainThread]: Command `dbt run` succeeded at 17:38:48.112929 after 8.54 seconds
[0m17:38:48.135478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12227f050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12227d550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104656e50>]}
[0m17:38:48.138906 [debug] [MainThread]: Flushing usage events
[0m17:39:17.941743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146a5a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146a1fd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146a7df10>]}


============================== 17:39:17.944840 | 5a76fbb1-3862-446f-b20f-8763d3975ea6 ==============================
[0m17:39:17.944840 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:39:17.945162 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:39:18.700645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5a76fbb1-3862-446f-b20f-8763d3975ea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b55e750>]}
[0m17:39:18.724747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5a76fbb1-3862-446f-b20f-8763d3975ea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144a731d0>]}
[0m17:39:18.725638 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:39:18.739769 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:39:18.810061 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:39:18.810474 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m17:39:18.913987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5a76fbb1-3862-446f-b20f-8763d3975ea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bb29e90>]}
[0m17:39:19.015225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5a76fbb1-3862-446f-b20f-8763d3975ea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b5aa550>]}
[0m17:39:19.015569 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m17:39:19.015781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5a76fbb1-3862-446f-b20f-8763d3975ea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b8f23d0>]}
[0m17:39:19.016654 [info ] [MainThread]: 
[0m17:39:19.016999 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:39:19.019392 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:39:19.025333 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:39:19.025572 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:39:19.025703 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:39:19.550734 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.525 seconds
[0m17:39:19.552162 [debug] [ThreadPool]: On list_LB: Close
[0m17:39:19.695425 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m17:39:19.701448 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m17:39:19.701717 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m17:39:19.701899 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:39:20.145761 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.444 seconds
[0m17:39:20.148665 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m17:39:20.258355 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m17:39:20.264120 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:39:20.264816 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:39:20.265295 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:39:20.674951 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.410 seconds
[0m17:39:20.677681 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:39:20.784996 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m17:39:20.790997 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:39:20.791381 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:39:20.791645 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:39:21.160447 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.369 seconds
[0m17:39:21.163573 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:39:21.276688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5a76fbb1-3862-446f-b20f-8763d3975ea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b94f690>]}
[0m17:39:21.277644 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:39:21.278162 [info ] [MainThread]: 
[0m17:39:21.281673 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:39:21.282404 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m17:39:21.282863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m17:39:21.283247 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:39:21.290335 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:39:21.291227 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:39:21.301523 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:39:21.301934 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:39:21.302209 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:39:21.625654 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.323 seconds
[0m17:39:21.628392 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:39:21.629540 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:39:21.630066 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:39:21.707070 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.076 seconds
[0m17:39:21.730945 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:39:21.732466 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:39:21.732820 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:39:22.417945 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.685 seconds
[0m17:39:22.428325 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:39:22.606463 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a76fbb1-3862-446f-b20f-8763d3975ea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b4cce10>]}
[0m17:39:22.606993 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.32s]
[0m17:39:22.607307 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:39:22.607518 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m17:39:22.607717 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m17:39:22.608043 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m17:39:22.608245 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m17:39:22.610050 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m17:39:22.610527 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m17:39:22.620155 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:39:22.620682 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m17:39:22.620909 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:39:23.056729 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.435 seconds
[0m17:39:23.059161 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m17:39:23.060337 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:39:23.060950 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m17:39:23.140076 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.079 seconds
[0m17:39:23.161820 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:39:23.162206 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
)

select * from final
  );
[0m17:39:23.311387 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e4b-0202-cf6c-0000-0002d4466b25
[0m17:39:23.311943 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 10
invalid identifier 'IS_CURRENT'
[0m17:39:23.312367 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m17:39:23.429091 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  000904 (42000): SQL compilation error: error line 12 at position 10
  invalid identifier 'IS_CURRENT'
[0m17:39:23.430115 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a76fbb1-3862-446f-b20f-8763d3975ea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b545010>]}
[0m17:39:23.430892 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 0.82s]
[0m17:39:23.431567 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m17:39:23.432124 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:39:23.433643 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m17:39:23.434237 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m17:39:23.434601 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:39:23.443869 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:23.444687 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:39:23.446769 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:23.447098 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:39:23.447356 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:39:24.964894 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.517 seconds
[0m17:39:24.968912 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:39:24.969979 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:24.970385 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:39:25.038677 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.067 seconds
[0m17:39:25.044325 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:25.044942 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m17:39:25.387132 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.342 seconds
[0m17:39:25.393024 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:25.393295 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m17:39:25.484118 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.091 seconds
[0m17:39:25.486724 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:25.486980 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m17:39:25.545632 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.058 seconds
[0m17:39:25.551101 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:25.551345 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m17:39:25.608143 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.057 seconds
[0m17:39:25.627880 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:25.628857 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:25.629051 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m17:39:25.722090 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m17:39:25.722481 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:25.723127 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m17:39:26.219625 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.496 seconds
[0m17:39:26.220508 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:26.220909 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m17:39:26.348976 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.128 seconds
[0m17:39:26.359023 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m17:39:26.365773 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:39:26.366243 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m17:39:26.514658 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.148 seconds
[0m17:39:26.517629 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:39:26.700856 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a76fbb1-3862-446f-b20f-8763d3975ea6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fa0a890>]}
[0m17:39:26.702453 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 3.27s]
[0m17:39:26.703548 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:39:26.705543 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:39:26.705963 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m17:39:26.706453 [info ] [MainThread]: 
[0m17:39:26.706780 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 7.69 seconds (7.69s).
[0m17:39:26.707588 [debug] [MainThread]: Command end result
[0m17:39:26.732077 [info ] [MainThread]: 
[0m17:39:26.732446 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:39:26.732580 [info ] [MainThread]: 
[0m17:39:26.732762 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  000904 (42000): SQL compilation error: error line 12 at position 10
  invalid identifier 'IS_CURRENT'
[0m17:39:26.732888 [info ] [MainThread]: 
[0m17:39:26.733027 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:39:26.734807 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.835146, "process_user_time": 2.717042, "process_kernel_time": 1.931061, "process_mem_max_rss": "197279744", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:39:26.735321 [debug] [MainThread]: Command `dbt run` failed at 17:39:26.735253 after 8.84 seconds
[0m17:39:26.735662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146a1e810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031a6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b5a9550>]}
[0m17:39:26.735856 [debug] [MainThread]: Flushing usage events
[0m17:42:51.346858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14df5b590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dfbd250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dfbd890>]}


============================== 17:42:51.349186 | 2392732e-91a5-45ba-913f-04ff20902270 ==============================
[0m17:42:51.349186 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:42:51.349462 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:42:52.107644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2392732e-91a5-45ba-913f-04ff20902270', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169322650>]}
[0m17:42:52.129869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2392732e-91a5-45ba-913f-04ff20902270', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14da00b50>]}
[0m17:42:52.130736 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:42:52.148237 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:42:52.230834 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:42:52.231233 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m17:42:52.325550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2392732e-91a5-45ba-913f-04ff20902270', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d348910>]}
[0m17:42:52.424593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2392732e-91a5-45ba-913f-04ff20902270', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b0b2e90>]}
[0m17:42:52.424894 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m17:42:52.425058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2392732e-91a5-45ba-913f-04ff20902270', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b227ad0>]}
[0m17:42:52.425795 [info ] [MainThread]: 
[0m17:42:52.426053 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:42:52.428178 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:42:52.433816 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:42:52.434041 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:42:52.434168 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:42:53.081313 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.647 seconds
[0m17:42:53.084837 [debug] [ThreadPool]: On list_LB: Close
[0m17:42:53.209567 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m17:42:53.225661 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:42:53.226332 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:42:53.226657 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:42:53.995371 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.768 seconds
[0m17:42:53.999554 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:42:54.108921 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m17:42:54.114308 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m17:42:54.114729 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m17:42:54.115053 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:42:54.498143 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.383 seconds
[0m17:42:54.500163 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m17:42:54.621684 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m17:42:54.627883 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:42:54.628362 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:42:54.628687 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:42:55.057451 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.429 seconds
[0m17:42:55.059075 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:42:55.160499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2392732e-91a5-45ba-913f-04ff20902270', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ad4f5d0>]}
[0m17:42:55.160949 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:42:55.161136 [info ] [MainThread]: 
[0m17:42:55.162697 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:42:55.163015 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m17:42:55.163238 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m17:42:55.163385 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:42:55.166832 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:42:55.167454 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:42:55.173833 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:42:55.174108 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:42:55.174271 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:42:55.613750 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.439 seconds
[0m17:42:55.615845 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:42:55.616974 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:42:55.617546 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:42:55.721868 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.104 seconds
[0m17:42:55.740987 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:42:55.741825 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:42:55.742019 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:42:56.336239 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.594 seconds
[0m17:42:56.359720 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:42:56.477699 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2392732e-91a5-45ba-913f-04ff20902270', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2e8490>]}
[0m17:42:56.478296 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.31s]
[0m17:42:56.478626 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:42:56.478945 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m17:42:56.479368 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m17:42:56.479605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m17:42:56.479767 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m17:42:56.482245 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m17:42:56.483200 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m17:42:56.495700 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:42:56.496197 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m17:42:56.496381 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:42:56.868931 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.371 seconds
[0m17:42:56.879198 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m17:42:56.881723 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:42:56.882256 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m17:42:56.976474 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.094 seconds
[0m17:42:56.999440 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:42:56.999805 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m17:42:57.192490 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e4e-0202-cf6a-0000-0002d4467a21
[0m17:42:57.193166 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 10
invalid identifier 'IS_CURRENT'
[0m17:42:57.193742 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m17:42:57.301324 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  000904 (42000): SQL compilation error: error line 12 at position 10
  invalid identifier 'IS_CURRENT'
[0m17:42:57.302150 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2392732e-91a5-45ba-913f-04ff20902270', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b390910>]}
[0m17:42:57.302817 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 0.82s]
[0m17:42:57.303381 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m17:42:57.303910 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:42:57.305402 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m17:42:57.305863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m17:42:57.306217 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:42:57.314317 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:57.314989 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:42:57.316598 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:57.316867 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:42:57.317060 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:42:57.800145 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.483 seconds
[0m17:42:57.803284 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:42:57.804266 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:57.804795 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:42:57.912856 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.108 seconds
[0m17:42:57.915760 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:57.916244 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m17:42:58.283253 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.366 seconds
[0m17:42:58.296683 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:58.297258 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m17:42:58.374650 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.077 seconds
[0m17:42:58.382455 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:58.383091 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m17:42:58.455185 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.071 seconds
[0m17:42:58.468481 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:58.469145 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m17:42:58.530417 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.061 seconds
[0m17:42:58.556694 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:58.557844 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:58.558049 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m17:42:58.706916 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.149 seconds
[0m17:42:58.707733 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:58.708326 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m17:42:58.967287 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.258 seconds
[0m17:42:58.968141 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:58.968654 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m17:42:59.077509 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.108 seconds
[0m17:42:59.090543 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m17:42:59.097821 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:42:59.098272 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m17:42:59.225989 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.127 seconds
[0m17:42:59.229171 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:42:59.334330 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2392732e-91a5-45ba-913f-04ff20902270', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b6175d0>]}
[0m17:42:59.335447 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 2.03s]
[0m17:42:59.336069 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:42:59.337682 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:42:59.338241 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m17:42:59.338916 [info ] [MainThread]: 
[0m17:42:59.339464 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.91 seconds (6.91s).
[0m17:42:59.340601 [debug] [MainThread]: Command end result
[0m17:42:59.366667 [info ] [MainThread]: 
[0m17:42:59.366936 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:42:59.367070 [info ] [MainThread]: 
[0m17:42:59.367233 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  000904 (42000): SQL compilation error: error line 12 at position 10
  invalid identifier 'IS_CURRENT'
[0m17:42:59.367439 [info ] [MainThread]: 
[0m17:42:59.367582 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:42:59.369449 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.0499735, "process_user_time": 2.575291, "process_kernel_time": 1.930662, "process_mem_max_rss": "193593344", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:42:59.369904 [debug] [MainThread]: Command `dbt run` failed at 17:42:59.369860 after 8.05 seconds
[0m17:42:59.370188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14df9cb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029becd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14df47790>]}
[0m17:42:59.370357 [debug] [MainThread]: Flushing usage events
[0m17:44:48.218529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d857c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d8bd550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d8bdb90>]}


============================== 17:44:48.223333 | 303b4255-ceb7-448f-a667-0e5204498af3 ==============================
[0m17:44:48.223333 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:44:48.223679 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:44:49.037834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '303b4255-ceb7-448f-a667-0e5204498af3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e290bd0>]}
[0m17:44:49.057441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '303b4255-ceb7-448f-a667-0e5204498af3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d100b50>]}
[0m17:44:49.058305 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:44:49.071448 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:44:49.132344 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:44:49.132595 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:44:49.149563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '303b4255-ceb7-448f-a667-0e5204498af3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cae7a90>]}
[0m17:44:49.192016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '303b4255-ceb7-448f-a667-0e5204498af3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ca8e050>]}
[0m17:44:49.192298 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m17:44:49.192454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '303b4255-ceb7-448f-a667-0e5204498af3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cae7410>]}
[0m17:44:49.193176 [info ] [MainThread]: 
[0m17:44:49.193427 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:44:49.195213 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:44:49.201251 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:44:49.201524 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:44:49.201645 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:44:49.783120 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.581 seconds
[0m17:44:49.784842 [debug] [ThreadPool]: On list_LB: Close
[0m17:44:49.908225 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m17:44:49.918567 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m17:44:49.919041 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m17:44:49.919350 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:44:50.326795 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.407 seconds
[0m17:44:50.329371 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m17:44:50.443822 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m17:44:50.451390 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:44:50.451973 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:44:50.452335 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:44:50.907694 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.455 seconds
[0m17:44:50.910669 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:44:51.037350 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m17:44:51.043047 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:44:51.043551 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:44:51.043947 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:44:51.479648 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.436 seconds
[0m17:44:51.481899 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:44:51.602735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '303b4255-ceb7-448f-a667-0e5204498af3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d864b50>]}
[0m17:44:51.603712 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:44:51.604272 [info ] [MainThread]: 
[0m17:44:51.607915 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:44:51.608744 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m17:44:51.609311 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m17:44:51.609710 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:44:51.619060 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:44:51.619970 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:44:51.627928 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:44:51.628216 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:44:51.628372 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:44:51.972377 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.344 seconds
[0m17:44:51.975296 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:44:51.978415 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:44:51.979018 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:44:52.090889 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.111 seconds
[0m17:44:52.098741 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:44:52.101889 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:44:52.102130 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:44:52.878322 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.775 seconds
[0m17:44:52.897661 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:44:53.010403 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '303b4255-ceb7-448f-a667-0e5204498af3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10fa10990>]}
[0m17:44:53.011064 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.40s]
[0m17:44:53.011412 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:44:53.012127 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m17:44:53.012466 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m17:44:53.012668 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m17:44:53.012842 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m17:44:53.015401 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m17:44:53.016078 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m17:44:53.027360 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:44:53.027680 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m17:44:53.027985 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:44:53.457795 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.430 seconds
[0m17:44:53.459868 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m17:44:53.460710 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:44:53.461097 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m17:44:53.563517 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.102 seconds
[0m17:44:53.590267 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:44:53.590788 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m17:44:53.748958 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e50-0202-cf6a-0000-0002d4467a3d
[0m17:44:53.749912 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002140 (42601): SQL compilation error:
Unknown function NOW
[0m17:44:53.750924 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m17:44:53.869773 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  002140 (42601): SQL compilation error:
  Unknown function NOW
[0m17:44:53.870617 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '303b4255-ceb7-448f-a667-0e5204498af3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cd85090>]}
[0m17:44:53.871454 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 0.86s]
[0m17:44:53.872103 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m17:44:53.872580 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:44:53.874797 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m17:44:53.875385 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m17:44:53.875800 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:44:53.881103 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:53.882173 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:44:53.883574 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:53.883810 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:44:53.883997 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:44:54.288580 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.404 seconds
[0m17:44:54.291543 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:44:54.292580 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:54.293154 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:44:54.391780 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m17:44:54.395235 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:54.395711 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m17:44:54.713338 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.317 seconds
[0m17:44:54.726909 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:54.727423 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m17:44:54.812692 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.085 seconds
[0m17:44:54.817221 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:54.817625 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m17:44:54.880551 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.062 seconds
[0m17:44:54.894001 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:54.894544 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m17:44:54.954192 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.059 seconds
[0m17:44:54.974432 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:54.975611 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:54.975966 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m17:44:55.106541 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.130 seconds
[0m17:44:55.107332 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:55.107969 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m17:44:55.429620 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.321 seconds
[0m17:44:55.430243 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:55.430620 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m17:44:55.547838 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.117 seconds
[0m17:44:55.552429 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m17:44:55.559535 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:44:55.559974 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m17:44:55.704765 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.145 seconds
[0m17:44:55.707087 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:44:55.841671 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '303b4255-ceb7-448f-a667-0e5204498af3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d4d0550>]}
[0m17:44:55.843400 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 1.97s]
[0m17:44:55.844193 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:44:55.848113 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:44:55.848349 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m17:44:55.849073 [info ] [MainThread]: 
[0m17:44:55.849344 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.66 seconds (6.66s).
[0m17:44:55.850074 [debug] [MainThread]: Command end result
[0m17:44:55.870214 [info ] [MainThread]: 
[0m17:44:55.870868 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:44:55.871045 [info ] [MainThread]: 
[0m17:44:55.871229 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  002140 (42601): SQL compilation error:
  Unknown function NOW
[0m17:44:55.871355 [info ] [MainThread]: 
[0m17:44:55.871521 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:44:55.875451 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.7007732, "process_user_time": 2.981846, "process_kernel_time": 1.660449, "process_mem_max_rss": "199016448", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:44:55.876826 [debug] [MainThread]: Command `dbt run` failed at 17:44:55.876761 after 7.70 seconds
[0m17:44:55.877561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10478ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d8bdb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f83df90>]}
[0m17:44:55.877792 [debug] [MainThread]: Flushing usage events
[0m17:46:21.158552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145c1f350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145c7d250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145c7d8d0>]}


============================== 17:46:21.161157 | a497c0b6-7429-4726-92fe-9a0ba5689616 ==============================
[0m17:46:21.161157 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:46:21.161444 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:46:21.858875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a497c0b6-7429-4726-92fe-9a0ba5689616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145c43110>]}
[0m17:46:21.883748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a497c0b6-7429-4726-92fe-9a0ba5689616', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145500c10>]}
[0m17:46:21.884530 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:46:21.897172 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:46:21.959472 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:46:21.959832 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m17:46:22.015608 [error] [MainThread]: Encountered an error:
Compilation Error in model dim_product (models/mart/dim_product.sql)
  unexpected char '#' at 95
    line 4
      schema='dwh_mart'  # Ensure this is the correct schema for your models
[0m17:46:22.017098 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.903652, "process_user_time": 1.979232, "process_kernel_time": 1.867845, "process_mem_max_rss": "186040320", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:46:22.017374 [debug] [MainThread]: Command `dbt run` failed at 17:46:22.017329 after 0.90 seconds
[0m17:46:22.017562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145c7d550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103012cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b8e2ad0>]}
[0m17:46:22.017720 [debug] [MainThread]: Flushing usage events
[0m17:46:39.926087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14645acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1461f8110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1464b9750>]}


============================== 17:46:39.928531 | e0e24733-3956-4876-9a09-692fdae5a94e ==============================
[0m17:46:39.928531 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:46:39.928812 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m17:46:40.502142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e0e24733-3956-4876-9a09-692fdae5a94e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165cb2f10>]}
[0m17:46:40.526033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e0e24733-3956-4876-9a09-692fdae5a94e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f5fca90>]}
[0m17:46:40.526766 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:46:40.552350 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:46:40.625235 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:46:40.625574 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m17:46:40.718997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0e24733-3956-4876-9a09-692fdae5a94e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165dd4f10>]}
[0m17:46:40.857000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0e24733-3956-4876-9a09-692fdae5a94e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd49fd0>]}
[0m17:46:40.857315 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m17:46:40.857477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0e24733-3956-4876-9a09-692fdae5a94e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165e8e250>]}
[0m17:46:40.858194 [info ] [MainThread]: 
[0m17:46:40.858439 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:46:40.860613 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:46:40.866329 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:46:40.866607 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:46:40.866749 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:46:41.449657 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.583 seconds
[0m17:46:41.451801 [debug] [ThreadPool]: On list_LB: Close
[0m17:46:41.560443 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m17:46:41.572861 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:46:41.573317 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:46:41.573577 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:46:42.135217 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.562 seconds
[0m17:46:42.137459 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:46:42.262043 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m17:46:42.265130 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:46:42.265392 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:46:42.265553 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:46:42.620519 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.355 seconds
[0m17:46:42.622467 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:46:42.727250 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m17:46:42.735903 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m17:46:42.736333 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m17:46:42.736615 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:46:43.119680 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.383 seconds
[0m17:46:43.122924 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m17:46:43.809102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0e24733-3956-4876-9a09-692fdae5a94e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1464b96d0>]}
[0m17:46:43.810319 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:46:43.810859 [info ] [MainThread]: 
[0m17:46:43.814321 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:46:43.815131 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m17:46:43.815695 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m17:46:43.816135 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:46:43.826054 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:46:43.827362 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:46:43.833521 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:46:43.833772 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:46:43.833928 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:46:44.238197 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.404 seconds
[0m17:46:44.241274 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:46:44.242382 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:46:44.242934 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:46:44.326941 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.083 seconds
[0m17:46:44.345442 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:46:44.346145 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:46:44.346312 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:46:45.102861 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.756 seconds
[0m17:46:45.119087 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:46:45.220079 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e24733-3956-4876-9a09-692fdae5a94e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x166db13d0>]}
[0m17:46:45.221016 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.40s]
[0m17:46:45.221620 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:46:45.222059 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m17:46:45.222659 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m17:46:45.223119 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m17:46:45.223462 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m17:46:45.227039 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m17:46:45.228159 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m17:46:45.240860 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:46:45.241171 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m17:46:45.241381 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:46:45.596027 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.354 seconds
[0m17:46:45.598475 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m17:46:45.599150 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:46:45.600021 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m17:46:45.686724 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m17:46:45.697813 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:46:45.698157 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m17:46:46.105662 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.407 seconds
[0m17:46:46.114611 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:46:46.115053 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m17:46:46.206967 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.091 seconds
[0m17:46:46.213533 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:46:46.214244 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m17:46:46.307027 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.092 seconds
[0m17:46:46.321644 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:46:46.322267 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m17:46:46.947738 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.625 seconds
[0m17:46:46.978907 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m17:46:46.981149 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:46:46.981386 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m17:46:47.119720 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.138 seconds
[0m17:46:47.120938 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:46:47.121743 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m17:46:47.870889 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.748 seconds
[0m17:46:47.872183 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:46:47.873114 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m17:46:48.092269 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.218 seconds
[0m17:46:48.107427 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m17:46:48.114726 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:46:48.115233 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m17:46:48.219649 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.104 seconds
[0m17:46:48.223611 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m17:46:48.362168 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e24733-3956-4876-9a09-692fdae5a94e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165d90810>]}
[0m17:46:48.363364 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 6[0m in 3.14s]
[0m17:46:48.364271 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m17:46:48.364950 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:46:48.365808 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m17:46:48.366641 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m17:46:48.367217 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:46:48.376294 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:48.378964 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:46:48.381788 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:48.382209 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:46:48.382528 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:46:48.764651 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.382 seconds
[0m17:46:48.767173 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:46:48.767719 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:48.768062 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:46:48.842467 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.074 seconds
[0m17:46:48.847970 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:48.848730 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
        where c.modificationdate > (select max(contract_modificationdate) from LB.dwh_mart.fact_contract)
    
)

select * from incremental
  );
[0m17:46:49.199486 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.350 seconds
[0m17:46:49.205142 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:49.205823 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m17:46:49.291384 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.085 seconds
[0m17:46:49.296977 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:49.297659 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m17:46:49.363445 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.065 seconds
[0m17:46:49.370419 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:49.371120 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m17:46:49.436210 [debug] [Thread-1 (]: SQL status: SUCCESS 6 in 0.065 seconds
[0m17:46:49.442685 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:49.444809 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:49.445266 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m17:46:49.549258 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.104 seconds
[0m17:46:49.549586 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:49.549769 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "CONTRACT_MODIFICATIONDATE")

;
[0m17:46:49.917643 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.367 seconds
[0m17:46:49.918749 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:49.919356 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m17:46:50.035383 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.115 seconds
[0m17:46:50.039334 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m17:46:50.040147 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:46:50.040468 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m17:46:50.177047 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.136 seconds
[0m17:46:50.180685 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:46:50.307606 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e24733-3956-4876-9a09-692fdae5a94e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167194250>]}
[0m17:46:50.309319 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 0[0m in 1.94s]
[0m17:46:50.310364 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:46:50.312773 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:46:50.313266 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m17:46:50.313885 [info ] [MainThread]: 
[0m17:46:50.314385 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 9.46 seconds (9.46s).
[0m17:46:50.315486 [debug] [MainThread]: Command end result
[0m17:46:50.343480 [info ] [MainThread]: 
[0m17:46:50.343887 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:46:50.344080 [info ] [MainThread]: 
[0m17:46:50.344332 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m17:46:50.346236 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.446946, "process_user_time": 2.558496, "process_kernel_time": 2.289888, "process_mem_max_rss": "194052096", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:46:50.346656 [debug] [MainThread]: Command `dbt run` succeeded at 17:46:50.346604 after 10.45 seconds
[0m17:46:50.346998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146497f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f69190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f19810>]}
[0m17:46:50.347195 [debug] [MainThread]: Flushing usage events
[0m17:57:28.777151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f91b050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f981150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f95acd0>]}


============================== 17:57:28.779856 | bb1419eb-552c-4c37-a77c-95fc6efb57f3 ==============================
[0m17:57:28.779856 [info ] [MainThread]: Running with dbt=1.8.0
[0m17:57:28.780142 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --full-refresh', 'send_anonymous_usage_stats': 'True'}
[0m17:57:29.447892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125effed0>]}
[0m17:57:29.466475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f100b90>]}
[0m17:57:29.467010 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m17:57:29.477281 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m17:57:29.531919 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:57:29.532130 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:57:29.548271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127292990>]}
[0m17:57:29.589030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127208d90>]}
[0m17:57:29.589302 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m17:57:29.589453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1272df050>]}
[0m17:57:29.590364 [info ] [MainThread]: 
[0m17:57:29.590608 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:57:29.592439 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m17:57:29.598314 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:57:29.598532 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:57:29.598660 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:57:30.182352 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.583 seconds
[0m17:57:30.186012 [debug] [ThreadPool]: On list_LB: Close
[0m17:57:30.298466 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m17:57:30.299213 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m17:57:30.299555 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:57:30.742483 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.443 seconds
[0m17:57:30.745432 [debug] [ThreadPool]: On list_LB: Close
[0m17:57:30.873807 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m17:57:30.887253 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m17:57:30.887574 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m17:57:30.887758 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:57:31.257220 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.369 seconds
[0m17:57:31.259572 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m17:57:31.369692 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m17:57:31.375081 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m17:57:31.375483 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m17:57:31.375801 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:57:31.800328 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.424 seconds
[0m17:57:31.802704 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m17:57:31.920622 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m17:57:31.924922 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m17:57:31.925412 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m17:57:31.925746 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:57:32.362337 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.437 seconds
[0m17:57:32.363535 [debug] [ThreadPool]: On list_LB_stage: Close
[0m17:57:32.458742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12728e850>]}
[0m17:57:32.459180 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:57:32.459359 [info ] [MainThread]: 
[0m17:57:32.460842 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m17:57:32.461131 [info ] [Thread-1 (]: 1 of 6 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m17:57:32.461337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m17:57:32.461483 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m17:57:32.464978 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m17:57:32.465849 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m17:57:32.511715 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:57:32.512120 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m17:57:32.512286 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:33.243125 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.730 seconds
[0m17:57:33.246484 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m17:57:33.247732 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:57:33.248539 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m17:57:33.354670 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.105 seconds
[0m17:57:33.378681 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m17:57:33.380609 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m17:57:33.380991 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m17:57:34.199534 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.818 seconds
[0m17:57:34.221598 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m17:57:34.321866 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d810f10>]}
[0m17:57:34.323258 [info ] [Thread-1 (]: 1 of 6 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.86s]
[0m17:57:34.324063 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m17:57:34.324622 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m17:57:34.325433 [info ] [Thread-1 (]: 2 of 6 START sql incremental model stage.stg_contract .......................... [RUN]
[0m17:57:34.326054 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m17:57:34.326470 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m17:57:34.337119 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m17:57:34.338789 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m17:57:34.351961 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m17:57:34.352278 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m17:57:34.352488 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:34.748850 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.396 seconds
[0m17:57:34.750931 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m17:57:34.751717 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m17:57:34.752107 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m17:57:34.835115 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.082 seconds
[0m17:57:34.856277 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m17:57:34.857611 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m17:57:34.857979 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m17:57:36.030677 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.172 seconds
[0m17:57:36.047391 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_contract__dbt_tmp
[0m17:57:36.051862 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m17:57:36.052153 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.stage.stg_contract__dbt_tmp cascade
[0m17:57:36.116837 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.064 seconds
[0m17:57:36.119217 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m17:57:36.215511 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1279c4050>]}
[0m17:57:36.216895 [info ] [Thread-1 (]: 2 of 6 OK created sql incremental model stage.stg_contract ..................... [[32mSUCCESS 1[0m in 1.89s]
[0m17:57:36.217812 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m17:57:36.218317 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m17:57:36.219626 [info ] [Thread-1 (]: 3 of 6 START sql incremental model stage.stg_prices ............................ [RUN]
[0m17:57:36.220443 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m17:57:36.221000 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m17:57:36.226061 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m17:57:36.227640 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m17:57:36.229355 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m17:57:36.229598 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m17:57:36.229763 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:36.529950 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.300 seconds
[0m17:57:36.531883 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m17:57:36.532844 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m17:57:36.533379 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m17:57:36.613006 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.079 seconds
[0m17:57:36.617133 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m17:57:36.619670 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m17:57:36.620336 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m17:57:38.280700 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.660 seconds
[0m17:57:38.285581 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_prices__dbt_tmp
[0m17:57:38.286977 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m17:57:38.287488 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
drop view if exists LB.stage.stg_prices__dbt_tmp cascade
[0m17:57:38.343232 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.055 seconds
[0m17:57:38.345399 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m17:57:38.449406 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12744f8d0>]}
[0m17:57:38.450947 [info ] [Thread-1 (]: 3 of 6 OK created sql incremental model stage.stg_prices ....................... [[32mSUCCESS 1[0m in 2.23s]
[0m17:57:38.451902 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m17:57:38.452575 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m17:57:38.453487 [info ] [Thread-1 (]: 4 of 6 START sql incremental model stage.stg_products .......................... [RUN]
[0m17:57:38.454207 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m17:57:38.454635 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m17:57:38.460514 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m17:57:38.462158 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m17:57:38.464998 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m17:57:38.465472 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m17:57:38.465807 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:38.788309 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.322 seconds
[0m17:57:38.789369 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m17:57:38.789751 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m17:57:38.789918 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m17:57:38.882480 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.092 seconds
[0m17:57:38.884072 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m17:57:38.885392 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m17:57:38.885652 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m17:57:39.714996 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.829 seconds
[0m17:57:39.720837 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_products__dbt_tmp
[0m17:57:39.721921 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m17:57:39.722472 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
drop view if exists LB.stage.stg_products__dbt_tmp cascade
[0m17:57:39.778674 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.056 seconds
[0m17:57:39.782099 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m17:57:39.892208 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d810f10>]}
[0m17:57:39.893361 [info ] [Thread-1 (]: 4 of 6 OK created sql incremental model stage.stg_products ..................... [[32mSUCCESS 1[0m in 1.44s]
[0m17:57:39.893946 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m17:57:39.894378 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m17:57:39.895342 [info ] [Thread-1 (]: 5 of 6 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m17:57:39.896120 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_contract)
[0m17:57:39.896693 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m17:57:39.901976 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:57:39.903317 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m17:57:39.906001 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:57:39.906422 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m17:57:39.906608 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:40.265443 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.359 seconds
[0m17:57:40.267713 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m17:57:40.268685 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:57:40.269270 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m17:57:40.341179 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.071 seconds
[0m17:57:40.344793 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m17:57:40.347026 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:57:40.347658 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace transient table LB.dwh_mart.fact_contract
         as
        (

with contracts as (
    select * from LB.stage.stg_contract
),
incremental as (
    select
        c.id as contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        c.modificationdate as contract_modificationdate
    from contracts c
    
)

select * from incremental
        );
[0m17:57:41.107120 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.758 seconds
[0m17:57:41.113630 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m17:57:41.115021 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m17:57:41.115487 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m17:57:41.172149 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.056 seconds
[0m17:57:41.176656 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m17:57:41.283967 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12728eed0>]}
[0m17:57:41.285173 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 1[0m in 1.39s]
[0m17:57:41.285748 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m17:57:41.286142 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m17:57:41.286748 [info ] [Thread-1 (]: 6 of 6 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m17:57:41.287322 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_contract, now model.snowflake_airflow_dbt.dim_product)
[0m17:57:41.287756 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m17:57:41.292113 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m17:57:41.293348 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m17:57:41.296136 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:57:41.296459 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m17:57:41.296689 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:57:41.666716 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.369 seconds
[0m17:57:41.669810 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m17:57:41.671072 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:57:41.671506 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m17:57:41.754026 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.082 seconds
[0m17:57:41.759132 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m17:57:41.766208 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:57:41.766982 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m17:57:42.583779 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.816 seconds
[0m17:57:42.586171 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m17:57:42.586531 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m17:57:42.586687 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m17:57:42.651203 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.064 seconds
[0m17:57:42.653582 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m17:57:42.755620 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bb1419eb-552c-4c37-a77c-95fc6efb57f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12759f710>]}
[0m17:57:42.756348 [info ] [Thread-1 (]: 6 of 6 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 1[0m in 1.47s]
[0m17:57:42.756937 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m17:57:42.758852 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:57:42.759202 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m17:57:42.759656 [info ] [MainThread]: 
[0m17:57:42.759971 [info ] [MainThread]: Finished running 1 table model, 5 incremental models in 0 hours 0 minutes and 13.17 seconds (13.17s).
[0m17:57:42.760729 [debug] [MainThread]: Command end result
[0m17:57:42.808946 [info ] [MainThread]: 
[0m17:57:42.809483 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:57:42.809782 [info ] [MainThread]: 
[0m17:57:42.810250 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m17:57:42.814203 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 14.076402, "process_user_time": 3.04318, "process_kernel_time": 1.443756, "process_mem_max_rss": "199573504", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:57:42.815122 [debug] [MainThread]: Command `dbt run` succeeded at 17:57:42.815034 after 14.08 seconds
[0m17:57:42.815581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102547fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1024d6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1024d6cd0>]}
[0m17:57:42.815808 [debug] [MainThread]: Flushing usage events
[0m18:08:18.300455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132955ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1325f0ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1329bda10>]}


============================== 18:08:18.302756 | 78ca12ee-e8c5-415e-b5c9-d405d4619269 ==============================
[0m18:08:18.302756 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:08:18.303049 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m18:08:18.975265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '78ca12ee-e8c5-415e-b5c9-d405d4619269', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169978110>]}
[0m18:08:18.994420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '78ca12ee-e8c5-415e-b5c9-d405d4619269', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127172ed0>]}
[0m18:08:18.995055 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:08:19.006793 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:08:19.064675 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:08:19.065003 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:08:19.126839 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_contract' (models/mart/fact_contract.sql) depends on a node named 'stg_contracts' which was not found
[0m18:08:19.128584 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8567852, "process_user_time": 1.961138, "process_kernel_time": 1.856995, "process_mem_max_rss": "189743104", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:08:19.128897 [debug] [MainThread]: Command `dbt run` failed at 18:08:19.128849 after 0.86 seconds
[0m18:08:19.129089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102302cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1329bd410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16accf510>]}
[0m18:08:19.129265 [debug] [MainThread]: Flushing usage events
[0m18:08:38.312954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144757890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1447b5750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1447b5dd0>]}


============================== 18:08:38.315272 | 5c8062f1-ffda-409e-95d6-21380b6bae3d ==============================
[0m18:08:38.315272 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:08:38.315537 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:08:38.873950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c8062f1-ffda-409e-95d6-21380b6bae3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16836a110>]}
[0m18:08:38.894489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c8062f1-ffda-409e-95d6-21380b6bae3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f0b15d0>]}
[0m18:08:38.895125 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:08:38.906403 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:08:38.962822 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:08:38.963184 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:08:39.028434 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_contract' (models/mart/fact_contract.sql) depends on a node named 'stg_contracts' which was not found
[0m18:08:39.030099 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.74355036, "process_user_time": 1.985824, "process_kernel_time": 1.845384, "process_mem_max_rss": "192724992", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:08:39.030411 [debug] [MainThread]: Command `dbt run` failed at 18:08:39.030368 after 0.74 seconds
[0m18:08:39.030603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1447b6110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1010d6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169ae0a90>]}
[0m18:08:39.030778 [debug] [MainThread]: Flushing usage events
[0m18:10:36.444585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d319790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cdec790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d381d90>]}


============================== 18:10:36.447139 | ef130998-7519-4282-a8b5-b3020e87ddb7 ==============================
[0m18:10:36.447139 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:10:36.447421 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:10:37.219929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ef130998-7519-4282-a8b5-b3020e87ddb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1529a5f90>]}
[0m18:10:37.238185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ef130998-7519-4282-a8b5-b3020e87ddb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cc00b10>]}
[0m18:10:37.238689 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:10:37.249424 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:10:37.350294 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:10:37.350822 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:10:37.468002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ef130998-7519-4282-a8b5-b3020e87ddb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152a0bd50>]}
[0m18:10:37.566151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ef130998-7519-4282-a8b5-b3020e87ddb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152c444d0>]}
[0m18:10:37.566480 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:10:37.566658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ef130998-7519-4282-a8b5-b3020e87ddb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152b20550>]}
[0m18:10:37.567469 [info ] [MainThread]: 
[0m18:10:37.567755 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:10:37.570043 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:10:37.576117 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:10:37.576382 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:10:37.576525 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:10:38.178421 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.602 seconds
[0m18:10:38.181021 [debug] [ThreadPool]: On list_LB: Close
[0m18:10:38.303443 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m18:10:38.314688 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:10:38.314950 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:10:38.315081 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:10:38.857020 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.542 seconds
[0m18:10:38.860430 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:10:38.982761 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m18:10:38.985293 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:10:38.985510 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:10:38.985705 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:10:39.325705 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.340 seconds
[0m18:10:39.326809 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:10:39.432972 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m18:10:39.439671 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:10:39.440154 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:10:39.440449 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:10:39.859600 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.419 seconds
[0m18:10:39.862643 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:10:39.975138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ef130998-7519-4282-a8b5-b3020e87ddb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152aabf50>]}
[0m18:10:39.976249 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:10:39.976803 [info ] [MainThread]: 
[0m18:10:39.979942 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:10:39.980663 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:10:39.981212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m18:10:39.981633 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:10:39.988631 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:10:39.989636 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:10:40.000210 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:10:40.000569 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:10:40.000788 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:40.538007 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.537 seconds
[0m18:10:40.540808 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:10:40.541671 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:10:40.542095 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:10:40.736085 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.194 seconds
[0m18:10:40.750241 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:10:40.751392 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:10:40.751675 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:10:41.857882 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.106 seconds
[0m18:10:41.883287 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:10:41.989649 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ef130998-7519-4282-a8b5-b3020e87ddb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155cdfb50>]}
[0m18:10:41.991192 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 2.01s]
[0m18:10:41.992221 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:10:41.992968 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:10:41.993813 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:10:41.994454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:10:41.994875 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:10:41.999368 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:10:42.000104 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:10:42.011405 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:10:42.011733 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:10:42.011901 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:42.363049 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.351 seconds
[0m18:10:42.365037 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:10:42.365922 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:10:42.366354 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:10:42.436804 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.070 seconds
[0m18:10:42.460795 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:10:42.461185 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:10:42.879523 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.418 seconds
[0m18:10:42.894217 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:10:42.894584 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:10:42.995094 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.100 seconds
[0m18:10:43.000674 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:10:43.001283 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:10:43.073737 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.072 seconds
[0m18:10:43.088055 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:10:43.088674 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:10:43.178249 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.089 seconds
[0m18:10:43.214506 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:10:43.215910 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:10:43.216171 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:10:43.349813 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.133 seconds
[0m18:10:43.350459 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:10:43.350961 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:10:44.115566 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e6a-0202-cf6b-0000-0002d4463ae9
[0m18:10:44.116164 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m18:10:44.116688 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:10:44.256613 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:10:44.257453 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ef130998-7519-4282-a8b5-b3020e87ddb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fc0b290>]}
[0m18:10:44.258219 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 2.26s]
[0m18:10:44.258925 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:10:44.259459 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:10:44.260769 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:10:44.261481 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:10:44.261808 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:10:44.265681 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:10:44.266485 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:10:44.267660 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:10:44.267846 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:10:44.267993 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:10:44.662247 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.394 seconds
[0m18:10:44.664666 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:10:44.665639 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:10:44.665996 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:10:44.823480 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.157 seconds
[0m18:10:44.830552 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:10:44.831292 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace temporary table LB.dwh_mart.fact_contract__dbt_tmp
         as
        (

with source as (
    select * from LB.stage.stg_contract
),

current_records as (
    select *
    from LB.dwh_mart.fact_contract
),

new_and_updated_records as (
    select 
        src.id as contract_id,
        src.type,
        src.energy,
        src.usage,
        src.usagenet,
        src.createdat,
        src.startdate,
        src.enddate,
        src.fillingdatecancellation,
        src.cancellationreason,
        src.city,
        src.status,
        src.productid,
        src.modificationdate
    from source as src
    left join current_records as curr
    on src.id = curr.contract_id
    where curr.contract_id is null
    or (
        src.type != curr.type
        or src.energy != curr.energy
        or src.usage != curr.usage
        or src.usagenet != curr.usagenet
        or src.createdat != curr.createdat
        or src.startdate != curr.startdate
        or src.enddate != curr.enddate
        or src.fillingdatecancellation != curr.fillingdatecancellation
        or src.cancellationreason != curr.cancellationreason
        or src.city != curr.city
        or src.status != curr.status
        or src.productid != curr.productid
        or src.modificationdate != curr.modificationdate
    )
)

select *
from current_records

union all

select 
    contract_id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    fillingdatecancellation,
    cancellationreason,
    city,
    status,
    productid,
    modificationdate
from new_and_updated_records
        );
[0m18:10:44.952152 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e6a-0202-cf6a-0000-0002d4467b15
[0m18:10:44.952921 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 35 at position 20
invalid identifier 'CURR.TYPE'
[0m18:10:44.953600 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:10:45.070346 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 35 at position 20
  invalid identifier 'CURR.TYPE'
[0m18:10:45.070992 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ef130998-7519-4282-a8b5-b3020e87ddb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155c616d0>]}
[0m18:10:45.071585 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 0.81s]
[0m18:10:45.072114 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:10:45.075467 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:10:45.075925 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:10:45.076787 [info ] [MainThread]: 
[0m18:10:45.077480 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 7.51 seconds (7.51s).
[0m18:10:45.079239 [debug] [MainThread]: Command end result
[0m18:10:45.110864 [info ] [MainThread]: 
[0m18:10:45.111236 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m18:10:45.111378 [info ] [MainThread]: 
[0m18:10:45.111552 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:10:45.111683 [info ] [MainThread]: 
[0m18:10:45.111826 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 35 at position 20
  invalid identifier 'CURR.TYPE'
[0m18:10:45.111950 [info ] [MainThread]: 
[0m18:10:45.112321 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
[0m18:10:45.116469 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.702386, "process_user_time": 2.820962, "process_kernel_time": 1.858305, "process_mem_max_rss": "193019904", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:10:45.117667 [debug] [MainThread]: Command `dbt run` failed at 18:10:45.117610 after 8.70 seconds
[0m18:10:45.118739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d3288d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102636cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d323fd0>]}
[0m18:10:45.118980 [debug] [MainThread]: Flushing usage events
[0m18:15:57.161937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c55a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c581110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c581790>]}


============================== 18:15:57.164678 | 888a4528-7aa9-459c-946c-8f1920abd231 ==============================
[0m18:15:57.164678 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:15:57.164991 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:15:57.891287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '888a4528-7aa9-459c-946c-8f1920abd231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14eb07d10>]}
[0m18:15:57.911984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '888a4528-7aa9-459c-946c-8f1920abd231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137c00c10>]}
[0m18:15:57.912651 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:15:57.929642 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:15:57.994137 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:15:57.994491 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:15:58.090042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '888a4528-7aa9-459c-946c-8f1920abd231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1695a9710>]}
[0m18:15:58.179288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '888a4528-7aa9-459c-946c-8f1920abd231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c0b1450>]}
[0m18:15:58.179574 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:15:58.179733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '888a4528-7aa9-459c-946c-8f1920abd231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1693c42d0>]}
[0m18:15:58.180424 [info ] [MainThread]: 
[0m18:15:58.180656 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:15:58.183004 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:15:58.188932 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:15:58.189378 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:15:58.189977 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:15:58.758198 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.568 seconds
[0m18:15:58.759317 [debug] [ThreadPool]: On list_LB: Close
[0m18:15:58.865529 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m18:15:58.871407 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:15:58.871673 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:15:58.871820 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:15:59.313245 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.441 seconds
[0m18:15:59.317047 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:15:59.419904 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m18:15:59.421803 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:15:59.421973 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:15:59.422093 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:15:59.847466 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.425 seconds
[0m18:15:59.848321 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:15:59.990145 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m18:15:59.995861 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:15:59.996288 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:15:59.996564 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:16:00.387849 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.391 seconds
[0m18:16:00.390752 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:16:00.502753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '888a4528-7aa9-459c-946c-8f1920abd231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137648090>]}
[0m18:16:00.504326 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:16:00.504790 [info ] [MainThread]: 
[0m18:16:00.515492 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:16:00.516235 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:16:00.516524 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m18:16:00.516686 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:16:00.521920 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:16:00.523007 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:16:00.533621 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:16:00.533965 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:16:00.534136 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:16:00.903257 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.369 seconds
[0m18:16:00.904475 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:16:00.904901 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:16:00.905066 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:16:01.066360 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.161 seconds
[0m18:16:01.078250 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:16:01.079108 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:16:01.079364 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:16:01.967553 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.888 seconds
[0m18:16:01.982554 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:16:02.101413 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '888a4528-7aa9-459c-946c-8f1920abd231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1691ccc50>]}
[0m18:16:02.101873 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.58s]
[0m18:16:02.102162 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:16:02.102363 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:16:02.102549 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:16:02.102901 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:16:02.103085 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:16:02.105008 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:16:02.105774 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:16:02.113713 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:16:02.113966 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:16:02.114125 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:16:02.519376 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.405 seconds
[0m18:16:02.521027 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:16:02.521770 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:16:02.522153 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:16:02.638160 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.116 seconds
[0m18:16:02.648484 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:16:02.648802 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:16:02.994064 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.345 seconds
[0m18:16:03.013902 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:16:03.014405 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:16:03.098052 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.083 seconds
[0m18:16:03.105102 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:16:03.105788 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:16:03.189125 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.083 seconds
[0m18:16:03.201239 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:16:03.201774 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:16:03.418803 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.217 seconds
[0m18:16:03.432673 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:16:03.435488 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:16:03.435661 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:16:03.530615 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.095 seconds
[0m18:16:03.530919 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:16:03.531106 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:16:04.126676 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e70-0202-cf6b-0000-0002d4463b0d
[0m18:16:04.127235 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m18:16:04.127804 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:16:04.266352 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:16:04.267480 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '888a4528-7aa9-459c-946c-8f1920abd231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169d64a50>]}
[0m18:16:04.268512 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 2.16s]
[0m18:16:04.269232 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:16:04.269827 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:16:04.271555 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:16:04.272194 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:16:04.272742 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:16:04.277237 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:16:04.278197 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:16:04.280225 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:16:04.280551 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:16:04.280870 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:16:04.635506 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.354 seconds
[0m18:16:04.637229 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:16:04.637907 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:16:04.638274 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:16:04.761253 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.122 seconds
[0m18:16:04.768442 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:16:04.769011 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

current_records as (
    select *
    from LB.dwh_mart.fact_contract
),

new_and_updated_records as (
    select 
        src.contract_id,
        src.type,
        src.energy,
        src.usage,
        src.usagenet,
        src.createdat,
        src.startdate,
        src.enddate,
        src.fillingdatecancellation,
        src.cancellationreason,
        src.city,
        src.status,
        src.productid,
        src.modificationdate
    from source as src
    left join current_records as curr
    on src.contract_id = curr.contract_id
    where curr.contract_id is null
    or (
        src.type != curr.type
        or src.energy != curr.energy
        or src.usage != curr.usage
        or src.usagenet != curr.usagenet
        or src.createdat != curr.createdat
        or src.startdate != curr.startdate
        or src.enddate != curr.enddate
        or src.fillingdatecancellation != curr.fillingdatecancellation
        or src.cancellationreason != curr.cancellationreason
        or src.city != curr.city
        or src.status != curr.status
        or src.productid != curr.productid
        or src.modificationdate != curr.modificationdate
    )
)

select *
from current_records

union all

select 
    contract_id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    fillingdatecancellation,
    cancellationreason,
    city,
    status,
    productid,
    modificationdate
from new_and_updated_records
  );
[0m18:16:04.889087 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e70-0202-cf6c-0000-0002d4466c55
[0m18:16:04.889936 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 51 at position 20
invalid identifier 'CURR.TYPE'
[0m18:16:04.890455 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:16:04.998406 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 51 at position 20
  invalid identifier 'CURR.TYPE'
[0m18:16:04.999610 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '888a4528-7aa9-459c-946c-8f1920abd231', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169b5ec90>]}
[0m18:16:05.000576 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 0.73s]
[0m18:16:05.001277 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:16:05.003322 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:16:05.003725 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:16:05.004163 [info ] [MainThread]: 
[0m18:16:05.004511 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.82 seconds (6.82s).
[0m18:16:05.005532 [debug] [MainThread]: Command end result
[0m18:16:05.038371 [info ] [MainThread]: 
[0m18:16:05.038691 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m18:16:05.038867 [info ] [MainThread]: 
[0m18:16:05.039060 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:16:05.039186 [info ] [MainThread]: 
[0m18:16:05.039324 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 51 at position 20
  invalid identifier 'CURR.TYPE'
[0m18:16:05.039436 [info ] [MainThread]: 
[0m18:16:05.039576 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
[0m18:16:05.041546 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.913907, "process_user_time": 2.101017, "process_kernel_time": 2.308066, "process_mem_max_rss": "192102400", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:16:05.041988 [debug] [MainThread]: Command `dbt run` failed at 18:16:05.041933 after 7.91 seconds
[0m18:16:05.042308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100b96fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c50b790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c50b7d0>]}
[0m18:16:05.042508 [debug] [MainThread]: Flushing usage events
[0m18:18:55.804802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f81f750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f881050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f881690>]}


============================== 18:18:55.808063 | b36d0f5a-8eb5-4b34-bdfc-215124303fe4 ==============================
[0m18:18:55.808063 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:18:55.808520 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m18:18:56.827221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b36d0f5a-8eb5-4b34-bdfc-215124303fe4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa37450>]}
[0m18:18:56.846701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b36d0f5a-8eb5-4b34-bdfc-215124303fe4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aadd5d0>]}
[0m18:18:56.847485 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:18:56.861069 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:18:56.948437 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:18:56.949188 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:18:57.043866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b36d0f5a-8eb5-4b34-bdfc-215124303fe4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abdea10>]}
[0m18:18:57.140317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b36d0f5a-8eb5-4b34-bdfc-215124303fe4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16af85190>]}
[0m18:18:57.140605 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:18:57.140762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b36d0f5a-8eb5-4b34-bdfc-215124303fe4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abc6b10>]}
[0m18:18:57.141462 [info ] [MainThread]: 
[0m18:18:57.141719 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:18:57.143929 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:18:57.149543 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:18:57.149775 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:18:57.149901 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:18:57.784172 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.634 seconds
[0m18:18:57.787631 [debug] [ThreadPool]: On list_LB: Close
[0m18:18:57.902961 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m18:18:57.913639 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:18:57.913963 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:18:57.914187 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:18:58.433969 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.520 seconds
[0m18:18:58.435985 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:18:58.534076 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m18:18:58.540001 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:18:58.540548 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:18:58.540839 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:18:58.958590 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.418 seconds
[0m18:18:58.960991 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:18:59.067173 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m18:18:59.074677 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:18:59.075220 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:18:59.075524 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:18:59.562812 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.487 seconds
[0m18:18:59.566934 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:18:59.677955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b36d0f5a-8eb5-4b34-bdfc-215124303fe4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b1b1410>]}
[0m18:18:59.679992 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:18:59.680794 [info ] [MainThread]: 
[0m18:18:59.686687 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:18:59.687995 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:18:59.688872 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m18:18:59.689447 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:18:59.695299 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:18:59.697042 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:18:59.705679 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:18:59.706147 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:18:59.706341 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:19:00.035909 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.329 seconds
[0m18:19:00.037514 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:19:00.038286 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:19:00.038674 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:19:00.114310 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.075 seconds
[0m18:19:00.130011 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:19:00.131249 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:19:00.131458 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:19:00.901214 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.769 seconds
[0m18:19:00.924010 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:19:01.066768 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b36d0f5a-8eb5-4b34-bdfc-215124303fe4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a9e9bd0>]}
[0m18:19:01.068091 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.38s]
[0m18:19:01.068968 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:19:01.069668 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:19:01.070474 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:19:01.071147 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:19:01.071562 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:19:01.076841 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:19:01.079282 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:19:01.091616 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:19:01.091970 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:19:01.092147 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:19:01.676290 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.584 seconds
[0m18:19:01.679307 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:19:01.680480 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:19:01.681045 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:19:01.780830 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.099 seconds
[0m18:19:01.803662 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:19:01.804059 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:19:02.116613 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.312 seconds
[0m18:19:02.133580 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:19:02.133868 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:19:02.206332 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.072 seconds
[0m18:19:02.211622 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:19:02.212135 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:19:02.272496 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.060 seconds
[0m18:19:02.282291 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:19:02.282869 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:19:02.353762 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.070 seconds
[0m18:19:02.380625 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:19:02.382946 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:19:02.383195 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:19:02.495371 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.112 seconds
[0m18:19:02.495976 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:19:02.496348 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:19:03.404195 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e73-0202-cf6a-0000-0002d4467b3d
[0m18:19:03.404852 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m18:19:03.405447 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:19:03.520934 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:19:03.522433 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b36d0f5a-8eb5-4b34-bdfc-215124303fe4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b17ff10>]}
[0m18:19:03.523695 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 2.45s]
[0m18:19:03.524570 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:19:03.525225 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:19:03.527181 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:19:03.527816 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:19:03.528076 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:19:03.531199 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:19:03.532229 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:19:03.533464 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:19:03.533636 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:19:03.533798 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:19:03.882564 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.348 seconds
[0m18:19:03.884884 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:19:03.885702 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:19:03.886175 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:19:03.952882 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.066 seconds
[0m18:19:03.960778 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:19:03.961390 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

current_records as (
    select *
    from LB.dwh_mart.fact_contract
),

new_and_updated_records as (
    select 
        src.contract_id,
        src.type,
        src.energy,
        src.usage,
        src.usagenet,
        src.createdat,
        src.startdate,
        src.enddate,
        src.fillingdatecancellation,
        src.cancellationreason,
        src.city,
        src.status,
        src.productid,
        src.modificationdate
    from source as src
    left join current_records as curr
    on src.contract_id = curr.contract_id
    where curr.contract_id is null
    or (
        --src.type != curr.type
        or src.energy != curr.energy
        or src.usage != curr.usage
        or src.usagenet != curr.usagenet
        or src.createdat != curr.createdat
        or src.startdate != curr.startdate
        or src.enddate != curr.enddate
        or src.fillingdatecancellation != curr.fillingdatecancellation
        or src.cancellationreason != curr.cancellationreason
        or src.city != curr.city
        or src.status != curr.status
        or src.productid != curr.productid
        or src.modificationdate != curr.modificationdate
    )
)

select *
from current_records

union all

select 
    contract_id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    fillingdatecancellation,
    cancellationreason,
    city,
    status,
    productid,
    modificationdate
from new_and_updated_records
  );
[0m18:19:04.059488 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e73-0202-cf6c-0000-0002d4466c65
[0m18:19:04.060734 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 52 at position 8 unexpected 'or'.
[0m18:19:04.061312 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:19:04.166163 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  001003 (42000): SQL compilation error:
  syntax error line 52 at position 8 unexpected 'or'.
[0m18:19:04.167057 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b36d0f5a-8eb5-4b34-bdfc-215124303fe4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a9ce910>]}
[0m18:19:04.168087 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 0.64s]
[0m18:19:04.168802 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:19:04.174935 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:19:04.175429 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:19:04.176282 [info ] [MainThread]: 
[0m18:19:04.176740 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 7.03 seconds (7.03s).
[0m18:19:04.177920 [debug] [MainThread]: Command end result
[0m18:19:04.204488 [info ] [MainThread]: 
[0m18:19:04.204958 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m18:19:04.205111 [info ] [MainThread]: 
[0m18:19:04.205298 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:19:04.205423 [info ] [MainThread]: 
[0m18:19:04.205563 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  001003 (42000): SQL compilation error:
  syntax error line 52 at position 8 unexpected 'or'.
[0m18:19:04.205682 [info ] [MainThread]: 
[0m18:19:04.205824 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=2 SKIP=0 TOTAL=3
[0m18:19:04.207708 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.449812, "process_user_time": 3.013993, "process_kernel_time": 1.555197, "process_mem_max_rss": "192987136", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:19:04.208253 [debug] [MainThread]: Command `dbt run` failed at 18:19:04.208199 after 8.45 seconds
[0m18:19:04.208568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f880450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102abefd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f80b990>]}
[0m18:19:04.208763 [debug] [MainThread]: Flushing usage events
[0m18:23:39.345496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143718ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143781710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143781d90>]}


============================== 18:23:39.347906 | 23dac1dd-18f4-4c5c-9460-c53a827d9fb7 ==============================
[0m18:23:39.347906 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:23:39.348181 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:23:39.990805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '23dac1dd-18f4-4c5c-9460-c53a827d9fb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143719ad0>]}
[0m18:23:40.009871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '23dac1dd-18f4-4c5c-9460-c53a827d9fb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142f00b50>]}
[0m18:23:40.010553 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:23:40.020534 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:23:40.075320 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:23:40.075649 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:23:40.160038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '23dac1dd-18f4-4c5c-9460-c53a827d9fb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168f405d0>]}
[0m18:23:40.233404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '23dac1dd-18f4-4c5c-9460-c53a827d9fb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1690c92d0>]}
[0m18:23:40.233668 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:23:40.233822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23dac1dd-18f4-4c5c-9460-c53a827d9fb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168f9a390>]}
[0m18:23:40.234479 [info ] [MainThread]: 
[0m18:23:40.234716 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:23:40.236631 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:23:40.241855 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:23:40.242005 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:23:40.242120 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:23:40.859366 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.617 seconds
[0m18:23:40.862616 [debug] [ThreadPool]: On list_LB: Close
[0m18:23:40.983470 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m18:23:40.994833 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:23:40.995374 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:23:40.995712 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:23:41.513709 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.518 seconds
[0m18:23:41.516385 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:23:41.632614 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m18:23:41.638879 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:23:41.639473 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:23:41.639854 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:23:42.132526 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.492 seconds
[0m18:23:42.136656 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:23:42.244338 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m18:23:42.251516 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:23:42.251943 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:23:42.252187 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:23:42.643069 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.391 seconds
[0m18:23:42.646317 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:23:42.760951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23dac1dd-18f4-4c5c-9460-c53a827d9fb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126a63c90>]}
[0m18:23:42.762282 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:23:42.762970 [info ] [MainThread]: 
[0m18:23:42.767007 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:23:42.767758 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:23:42.768447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m18:23:42.768873 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:23:42.777885 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:23:42.779469 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:23:42.790230 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:23:42.790597 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:23:42.790804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:23:43.136549 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.345 seconds
[0m18:23:43.139932 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:23:43.141227 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:23:43.141832 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:23:43.221295 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.079 seconds
[0m18:23:43.239559 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:23:43.240404 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:23:43.240577 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:23:44.002863 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.762 seconds
[0m18:23:44.013957 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:23:44.112167 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23dac1dd-18f4-4c5c-9460-c53a827d9fb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1694429d0>]}
[0m18:23:44.112629 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.34s]
[0m18:23:44.112958 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:23:44.113172 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:23:44.113462 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:23:44.113651 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:23:44.113794 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:23:44.115629 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:23:44.116234 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:23:44.125089 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:23:44.125543 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:23:44.125738 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:23:44.486803 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.361 seconds
[0m18:23:44.489021 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:23:44.489966 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:23:44.490489 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:23:44.625879 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.135 seconds
[0m18:23:44.654265 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:23:44.654643 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:23:45.131199 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.476 seconds
[0m18:23:45.145786 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:23:45.146245 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:23:45.251560 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.105 seconds
[0m18:23:45.258253 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:23:45.258941 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:23:45.406312 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.147 seconds
[0m18:23:45.417774 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:23:45.418325 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:23:45.479687 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.061 seconds
[0m18:23:45.504946 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:23:45.505812 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:23:45.505996 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:23:45.641806 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.136 seconds
[0m18:23:45.642573 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:23:45.643035 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:23:46.213205 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e77-0202-cf6a-0000-0002d4467b51
[0m18:23:46.214072 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m18:23:46.214831 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:23:46.362778 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:23:46.364030 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23dac1dd-18f4-4c5c-9460-c53a827d9fb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1693a2d90>]}
[0m18:23:46.365061 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 2.25s]
[0m18:23:46.365832 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:23:46.368489 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:23:46.369044 [info ] [Thread-1 (]: 3 of 3 SKIP relation dwh_mart.fact_contract .................................... [[33mSKIP[0m]
[0m18:23:46.369528 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:23:46.370803 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:23:46.371127 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m18:23:46.371563 [info ] [MainThread]: 
[0m18:23:46.371912 [info ] [MainThread]: Finished running 2 table models, 1 incremental model in 0 hours 0 minutes and 6.14 seconds (6.14s).
[0m18:23:46.372682 [debug] [MainThread]: Command end result
[0m18:23:46.400060 [info ] [MainThread]: 
[0m18:23:46.400628 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:23:46.400812 [info ] [MainThread]: 
[0m18:23:46.401196 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:23:46.401394 [info ] [MainThread]: 
[0m18:23:46.401696 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
[0m18:23:46.407010 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.0931263, "process_user_time": 2.25957, "process_kernel_time": 2.137079, "process_mem_max_rss": "196804608", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:23:46.408157 [debug] [MainThread]: Command `dbt run` failed at 18:23:46.408095 after 7.09 seconds
[0m18:23:46.409603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143780c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1007bacd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14375a990>]}
[0m18:23:46.409922 [debug] [MainThread]: Flushing usage events
[0m18:30:46.476872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e5b910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137ebd0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137ebd750>]}


============================== 18:30:46.482636 | e46748f8-291a-40bb-9b37-dfa82fb8e2ee ==============================
[0m18:30:46.482636 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:30:46.482977 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:30:47.803203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e46748f8-291a-40bb-9b37-dfa82fb8e2ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169132bd0>]}
[0m18:30:47.822800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e46748f8-291a-40bb-9b37-dfa82fb8e2ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137800cd0>]}
[0m18:30:47.823496 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:30:47.838828 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:30:47.898733 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:30:47.899009 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:30:47.915732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e46748f8-291a-40bb-9b37-dfa82fb8e2ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16961e4d0>]}
[0m18:30:47.961065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e46748f8-291a-40bb-9b37-dfa82fb8e2ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16933ac50>]}
[0m18:30:47.961358 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:30:47.961515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e46748f8-291a-40bb-9b37-dfa82fb8e2ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16930b750>]}
[0m18:30:47.962228 [info ] [MainThread]: 
[0m18:30:47.962481 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:30:47.964266 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:30:47.971314 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:30:47.971581 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:30:47.971723 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:30:48.535769 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.564 seconds
[0m18:30:48.538178 [debug] [ThreadPool]: On list_LB: Close
[0m18:30:48.661750 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m18:30:48.665782 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:30:48.665952 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:30:48.666067 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:30:49.254142 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.588 seconds
[0m18:30:49.255078 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:30:49.360749 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m18:30:49.365399 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:30:49.365599 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:30:49.365716 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:30:49.716863 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.351 seconds
[0m18:30:49.717763 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:30:49.917454 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m18:30:49.919012 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:30:49.919170 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:30:49.919286 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:30:50.343927 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.425 seconds
[0m18:30:50.344803 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:30:50.451502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e46748f8-291a-40bb-9b37-dfa82fb8e2ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1682fa350>]}
[0m18:30:50.453325 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:30:50.453587 [info ] [MainThread]: 
[0m18:30:50.457443 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:30:50.457918 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:30:50.458166 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m18:30:50.458315 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:30:50.462213 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:30:50.463278 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:30:50.470177 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:30:50.470429 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:30:50.470578 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:30:51.108819 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.637 seconds
[0m18:30:51.111702 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:30:51.112644 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:30:51.113009 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:30:51.203296 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.090 seconds
[0m18:30:51.225570 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:30:51.227140 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:30:51.227534 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:30:51.835450 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.607 seconds
[0m18:30:51.859675 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:30:51.997050 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e46748f8-291a-40bb-9b37-dfa82fb8e2ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16974b050>]}
[0m18:30:51.998493 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.54s]
[0m18:30:51.999633 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:30:52.000235 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:30:52.000834 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:30:52.001330 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:30:52.001656 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:30:52.006228 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:30:52.007456 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:30:52.019962 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:30:52.020248 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:30:52.020415 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:30:52.361928 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.341 seconds
[0m18:30:52.363740 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:30:52.364412 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:30:52.364734 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:30:52.469212 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.104 seconds
[0m18:30:52.494533 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:30:52.494925 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:30:52.935705 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.440 seconds
[0m18:30:52.946498 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:30:52.947047 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:30:53.062642 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.115 seconds
[0m18:30:53.067343 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:30:53.067858 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:30:53.158006 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.090 seconds
[0m18:30:53.169919 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:30:53.170501 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:30:53.287013 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.116 seconds
[0m18:30:53.312297 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:30:53.313486 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:30:53.313671 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:30:53.419969 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.106 seconds
[0m18:30:53.420578 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:30:53.421026 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:30:53.927978 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.506 seconds
[0m18:30:53.928854 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:30:53.929430 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:30:54.142005 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.212 seconds
[0m18:30:54.147502 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:30:54.158557 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:30:54.160613 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:30:54.281253 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.120 seconds
[0m18:30:54.284467 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:30:54.424836 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e46748f8-291a-40bb-9b37-dfa82fb8e2ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16930b3d0>]}
[0m18:30:54.426076 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.42s]
[0m18:30:54.426989 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:30:54.428386 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:30:54.428948 [info ] [Thread-1 (]: 3 of 3 START sql table model dwh_mart.fact_contract ............................ [RUN]
[0m18:30:54.429411 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:30:54.429739 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:30:54.434770 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:30:54.435867 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:30:54.437668 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:30:54.437833 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:30:54.437979 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:30:54.851000 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.413 seconds
[0m18:30:54.852606 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:30:54.853223 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:30:54.853562 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:30:55.088426 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.234 seconds
[0m18:30:55.091173 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:30:55.092772 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:30:55.092993 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace transient table LB.dwh_mart.fact_contract
         as
        (-- Example dbt model: fact_contract.sql

with contracts as (
    select * from LB.stage.stg_contract
),
products as (
    select *
    from LB.dwh_mart.dim_product  -- Make sure this is the correct model name
    where is_current = true
),
joined as (
    select
        c.contract_id,
        c.product_id,
        c.anlagedatum,
        c.verbrauch,
        c.umsatz,
        p.productcode,
        p.productname
    from contracts c
    left join products p on c.product_id = p.product_id
    
)

select * from joined
        );
[0m18:30:55.222633 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e7e-0202-cf69-0000-0002d4465bb5
[0m18:30:55.223590 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 15 at position 8
invalid identifier 'C.CONTRACT_ID'
[0m18:30:55.224157 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:30:55.336472 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 15 at position 8
  invalid identifier 'C.CONTRACT_ID'
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_contract.sql
[0m18:30:55.337232 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e46748f8-291a-40bb-9b37-dfa82fb8e2ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1693a0550>]}
[0m18:30:55.337921 [error] [Thread-1 (]: 3 of 3 ERROR creating sql table model dwh_mart.fact_contract ................... [[31mERROR[0m in 0.91s]
[0m18:30:55.338499 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:30:55.342602 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:30:55.342996 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:30:55.343423 [info ] [MainThread]: 
[0m18:30:55.343849 [info ] [MainThread]: Finished running 2 table models, 1 incremental model in 0 hours 0 minutes and 7.38 seconds (7.38s).
[0m18:30:55.344757 [debug] [MainThread]: Command end result
[0m18:30:55.363951 [info ] [MainThread]: 
[0m18:30:55.364246 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:30:55.364384 [info ] [MainThread]: 
[0m18:30:55.364576 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 15 at position 8
  invalid identifier 'C.CONTRACT_ID'
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_contract.sql
[0m18:30:55.364740 [info ] [MainThread]: 
[0m18:30:55.365072 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:30:55.367254 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.950203, "process_user_time": 2.520966, "process_kernel_time": 1.732756, "process_mem_max_rss": "191102976", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:30:55.367880 [debug] [MainThread]: Command `dbt run` failed at 18:30:55.367808 after 8.95 seconds
[0m18:30:55.368186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100d62cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117928b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e47810>]}
[0m18:30:55.368380 [debug] [MainThread]: Flushing usage events
[0m18:33:02.705876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126b5ad10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126bbd150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126bbd790>]}


============================== 18:33:02.708158 | ee78c36f-7200-42c3-83ed-9850b46dce81 ==============================
[0m18:33:02.708158 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:33:02.708435 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:33:03.412031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ee78c36f-7200-42c3-83ed-9850b46dce81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1374a1d10>]}
[0m18:33:03.430348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ee78c36f-7200-42c3-83ed-9850b46dce81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123c00b50>]}
[0m18:33:03.430982 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:33:03.441263 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:33:03.494240 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:33:03.494546 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:33:03.578958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ee78c36f-7200-42c3-83ed-9850b46dce81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1372d0110>]}
[0m18:33:03.655495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ee78c36f-7200-42c3-83ed-9850b46dce81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1376403d0>]}
[0m18:33:03.655785 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:33:03.655938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ee78c36f-7200-42c3-83ed-9850b46dce81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140109a10>]}
[0m18:33:03.656630 [info ] [MainThread]: 
[0m18:33:03.656864 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:33:03.674573 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:33:03.683101 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:33:03.683426 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:33:03.683583 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:33:04.183586 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.500 seconds
[0m18:33:04.186533 [debug] [ThreadPool]: On list_LB: Close
[0m18:33:04.301995 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m18:33:04.312748 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:33:04.313267 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:33:04.313521 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:33:04.755131 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.442 seconds
[0m18:33:04.757499 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:33:04.867759 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m18:33:04.879872 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:33:04.882229 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:33:04.882944 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:33:05.321253 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.438 seconds
[0m18:33:05.323611 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:33:05.434712 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m18:33:05.441123 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:33:05.441618 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:33:05.442332 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:33:05.804736 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.362 seconds
[0m18:33:05.805685 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:33:05.916208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ee78c36f-7200-42c3-83ed-9850b46dce81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133b773d0>]}
[0m18:33:05.917002 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:33:05.917347 [info ] [MainThread]: 
[0m18:33:05.920013 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:33:05.920481 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:33:05.920838 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m18:33:05.921102 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:33:05.927581 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:33:05.928658 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:33:05.940407 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:33:05.940938 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:33:05.941188 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:33:06.498764 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.557 seconds
[0m18:33:06.502032 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:33:06.503043 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:33:06.503416 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:33:06.582164 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.078 seconds
[0m18:33:06.601469 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:33:06.602462 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:33:06.602645 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:33:07.180104 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.577 seconds
[0m18:33:07.213618 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:33:07.326313 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee78c36f-7200-42c3-83ed-9850b46dce81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140193390>]}
[0m18:33:07.326939 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.40s]
[0m18:33:07.327316 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:33:07.327583 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:33:07.328067 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:33:07.328317 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:33:07.328556 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:33:07.330768 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:33:07.331486 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:33:07.340222 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:07.340516 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:33:07.340681 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:33:08.094830 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.754 seconds
[0m18:33:08.096200 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:33:08.096598 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:08.096753 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:33:08.174470 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.078 seconds
[0m18:33:08.185263 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:08.185592 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:33:08.644343 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.458 seconds
[0m18:33:08.655980 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:08.656474 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:33:08.771883 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.115 seconds
[0m18:33:08.776898 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:08.777375 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:33:08.860386 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.082 seconds
[0m18:33:08.872392 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:08.872884 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:33:08.998451 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.125 seconds
[0m18:33:09.025398 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:33:09.026319 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:09.026507 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:33:09.120221 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m18:33:09.121110 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:09.121735 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:33:09.795283 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e81-0202-cf68-0000-0002d4462bdd
[0m18:33:09.796073 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m18:33:09.796898 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:33:09.909996 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:33:09.911155 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee78c36f-7200-42c3-83ed-9850b46dce81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1375adf10>]}
[0m18:33:09.912031 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 2.58s]
[0m18:33:09.912817 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:33:09.914995 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:33:09.915509 [info ] [Thread-1 (]: 3 of 3 SKIP relation dwh_mart.fact_contract .................................... [[33mSKIP[0m]
[0m18:33:09.915917 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:33:09.917231 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:33:09.917719 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m18:33:09.918219 [info ] [MainThread]: 
[0m18:33:09.918623 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.26 seconds (6.26s).
[0m18:33:09.919470 [debug] [MainThread]: Command end result
[0m18:33:09.956486 [info ] [MainThread]: 
[0m18:33:09.956841 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:33:09.956976 [info ] [MainThread]: 
[0m18:33:09.957143 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:33:09.957277 [info ] [MainThread]: 
[0m18:33:09.957446 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
[0m18:33:09.960133 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.2824826, "process_user_time": 2.184024, "process_kernel_time": 2.354105, "process_mem_max_rss": "197820416", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:33:09.960678 [debug] [MainThread]: Command `dbt run` failed at 18:33:09.960640 after 7.28 seconds
[0m18:33:09.961129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100266cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126b5b090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126b63fd0>]}
[0m18:33:09.961293 [debug] [MainThread]: Flushing usage events
[0m18:33:43.307812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fd57790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fdbd590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fdbdbd0>]}


============================== 18:33:43.310520 | 27cbbc21-78cc-4adb-84eb-7c671c5932ca ==============================
[0m18:33:43.310520 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:33:43.310820 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:33:44.010888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '27cbbc21-78cc-4adb-84eb-7c671c5932ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156420c90>]}
[0m18:33:44.031682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '27cbbc21-78cc-4adb-84eb-7c671c5932ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f800c10>]}
[0m18:33:44.032333 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:33:44.044594 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:33:44.111434 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:33:44.111742 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:33:44.130762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '27cbbc21-78cc-4adb-84eb-7c671c5932ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168a09e50>]}
[0m18:33:44.183261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '27cbbc21-78cc-4adb-84eb-7c671c5932ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168c0e490>]}
[0m18:33:44.183622 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:33:44.183793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27cbbc21-78cc-4adb-84eb-7c671c5932ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168a95bd0>]}
[0m18:33:44.184705 [info ] [MainThread]: 
[0m18:33:44.185033 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:33:44.187212 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:33:44.194000 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:33:44.194239 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:33:44.194372 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:33:44.795541 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.601 seconds
[0m18:33:44.797778 [debug] [ThreadPool]: On list_LB: Close
[0m18:33:44.902448 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m18:33:44.914829 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:33:44.915354 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:33:44.915687 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:33:45.370095 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.454 seconds
[0m18:33:45.376376 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:33:45.493686 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m18:33:45.504503 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:33:45.505030 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:33:45.505381 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:33:45.927395 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.422 seconds
[0m18:33:45.928391 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:33:46.029120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m18:33:46.030866 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:33:46.031017 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:33:46.031130 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:33:46.439666 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.408 seconds
[0m18:33:46.441667 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:33:46.552821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27cbbc21-78cc-4adb-84eb-7c671c5932ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1690ea150>]}
[0m18:33:46.555020 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:33:46.555671 [info ] [MainThread]: 
[0m18:33:46.560973 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:33:46.561472 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:33:46.561827 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m18:33:46.562154 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:33:46.569799 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:33:46.571036 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:33:46.580174 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:33:46.580736 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:33:46.580915 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:33:46.974037 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.392 seconds
[0m18:33:46.977284 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:33:46.978514 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:33:46.979125 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:33:47.073519 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.094 seconds
[0m18:33:47.081090 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:33:47.081733 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:33:47.081892 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:33:47.760813 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.679 seconds
[0m18:33:47.775128 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:33:47.875690 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27cbbc21-78cc-4adb-84eb-7c671c5932ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16915fe50>]}
[0m18:33:47.878180 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.31s]
[0m18:33:47.878684 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:33:47.878921 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:33:47.879888 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:33:47.880134 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:33:47.880285 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:33:47.885334 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:33:47.886237 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:33:47.896511 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:47.896831 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:33:47.897004 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:33:48.194900 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.298 seconds
[0m18:33:48.196672 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:33:48.197331 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:48.197860 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:33:48.282031 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m18:33:48.303922 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:48.304240 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:33:48.682431 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.378 seconds
[0m18:33:48.689802 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:48.690221 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:33:48.759783 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.069 seconds
[0m18:33:48.762587 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:48.762918 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:33:48.831075 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.068 seconds
[0m18:33:48.835462 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:48.835705 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:33:48.891707 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.056 seconds
[0m18:33:48.916130 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:33:48.917417 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:48.917585 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:33:49.000409 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.083 seconds
[0m18:33:49.000715 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:49.000919 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:33:49.605143 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.604 seconds
[0m18:33:49.606670 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:49.607320 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:33:49.817128 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.209 seconds
[0m18:33:49.827782 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:33:49.831876 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:33:49.832201 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:33:49.956788 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.124 seconds
[0m18:33:49.958509 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:33:50.057174 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27cbbc21-78cc-4adb-84eb-7c671c5932ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1692525d0>]}
[0m18:33:50.058368 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.18s]
[0m18:33:50.059114 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:33:50.060451 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:33:50.060968 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:33:50.061375 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:33:50.061645 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:33:50.065602 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:33:50.066427 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:33:50.068153 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:33:50.068383 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:33:50.068576 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:33:50.497014 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.428 seconds
[0m18:33:50.499567 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:33:50.500130 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:33:50.500427 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:33:50.571187 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.070 seconds
[0m18:33:50.573351 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:33:50.573680 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.id as contract_id,
        c.product_id,
        c.anlagedatum,
        c.verbrauch,
        c.umsatz,
        p.productcode,
        p.productname,
        c.contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from contracts c
    left join products p on c.product_id = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.product_id != f.product_id
        or c.anlagedatum != f.anlagedatum
        or c.verbrauch != f.verbrauch
        or c.umsatz != f.umsatz
        or p.productcode != f.productcode
        or p.productname != f.productname
        or c.contract_modificationdate != f.contract_modificationdate
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:33:50.703716 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e81-0202-cf6a-0000-0002d4467bc1
[0m18:33:50.703998 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 8
invalid identifier 'C.PRODUCT_ID'
[0m18:33:50.704215 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:33:50.813474 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 25 at position 8
  invalid identifier 'C.PRODUCT_ID'
[0m18:33:50.814247 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27cbbc21-78cc-4adb-84eb-7c671c5932ca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe10610>]}
[0m18:33:50.814850 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 0.75s]
[0m18:33:50.815479 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:33:50.817838 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:33:50.818183 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:33:50.818589 [info ] [MainThread]: 
[0m18:33:50.818930 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.63 seconds (6.63s).
[0m18:33:50.819711 [debug] [MainThread]: Command end result
[0m18:33:50.843463 [info ] [MainThread]: 
[0m18:33:50.843824 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:33:50.844034 [info ] [MainThread]: 
[0m18:33:50.844278 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 25 at position 8
  invalid identifier 'C.PRODUCT_ID'
[0m18:33:50.844409 [info ] [MainThread]: 
[0m18:33:50.844605 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:33:50.847343 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.5700145, "process_user_time": 2.244834, "process_kernel_time": 2.246346, "process_mem_max_rss": "191430656", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:33:50.847926 [debug] [MainThread]: Command `dbt run` failed at 18:33:50.847877 after 7.57 seconds
[0m18:33:50.848357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fdbd0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100666cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16928a390>]}
[0m18:33:50.848539 [debug] [MainThread]: Flushing usage events
[0m18:37:08.420968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128c1f110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128c81310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128c81990>]}


============================== 18:37:08.423916 | 4f594b0a-65d1-48ac-a0d7-236401f7ff54 ==============================
[0m18:37:08.423916 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:37:08.424192 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:37:09.081162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f594b0a-65d1-48ac-a0d7-236401f7ff54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e949910>]}
[0m18:37:09.099725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f594b0a-65d1-48ac-a0d7-236401f7ff54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fddd5d0>]}
[0m18:37:09.100275 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:37:09.111605 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:37:09.167907 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:37:09.168269 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:37:09.253425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f594b0a-65d1-48ac-a0d7-236401f7ff54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138157ed0>]}
[0m18:37:09.328863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f594b0a-65d1-48ac-a0d7-236401f7ff54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138388090>]}
[0m18:37:09.329141 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:37:09.329298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f594b0a-65d1-48ac-a0d7-236401f7ff54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ffe3650>]}
[0m18:37:09.329984 [info ] [MainThread]: 
[0m18:37:09.330242 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:37:09.332208 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:37:09.337395 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:37:09.337558 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:37:09.337678 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:37:09.821596 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.484 seconds
[0m18:37:09.824633 [debug] [ThreadPool]: On list_LB: Close
[0m18:37:09.945566 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m18:37:09.957330 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:37:09.957902 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:37:09.958249 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:37:10.415468 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.457 seconds
[0m18:37:10.418908 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:37:10.533360 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m18:37:10.537645 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:37:10.538239 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:37:10.538422 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:37:10.907588 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.369 seconds
[0m18:37:10.909042 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:37:11.012644 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m18:37:11.015082 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:37:11.015373 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:37:11.015516 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:37:11.444033 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.428 seconds
[0m18:37:11.447177 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:37:11.563976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f594b0a-65d1-48ac-a0d7-236401f7ff54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f2f8cd0>]}
[0m18:37:11.564581 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:37:11.564770 [info ] [MainThread]: 
[0m18:37:11.567960 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:37:11.568996 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:37:11.569870 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m18:37:11.570176 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:37:11.576436 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:37:11.577806 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:37:11.588735 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:37:11.589023 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:37:11.589178 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:37:12.010043 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.421 seconds
[0m18:37:12.013505 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:37:12.014793 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:37:12.015381 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:37:12.097885 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.082 seconds
[0m18:37:12.113880 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:37:12.114825 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:37:12.115134 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:37:12.978042 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.861 seconds
[0m18:37:13.005925 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:37:13.169867 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f594b0a-65d1-48ac-a0d7-236401f7ff54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13817fcd0>]}
[0m18:37:13.170750 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.60s]
[0m18:37:13.171397 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:37:13.171915 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:37:13.172593 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:37:13.173150 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:37:13.173499 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:37:13.179364 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:37:13.181214 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:37:13.192331 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:13.192628 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:37:13.192794 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:37:13.608269 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.415 seconds
[0m18:37:13.609555 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:37:13.610080 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:13.610328 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:37:13.685667 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.075 seconds
[0m18:37:13.709156 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:13.709565 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:37:14.101934 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.392 seconds
[0m18:37:14.116193 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:14.116704 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:37:14.192944 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.076 seconds
[0m18:37:14.194710 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:14.194878 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:37:14.250117 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.055 seconds
[0m18:37:14.254124 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:14.254379 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:37:14.326198 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.072 seconds
[0m18:37:14.343096 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:37:14.344231 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:14.344413 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:37:14.443476 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.099 seconds
[0m18:37:14.443753 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:14.443945 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:37:15.135034 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e85-0202-cf6c-0000-0002d4466cd5
[0m18:37:15.137107 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m18:37:15.138453 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:37:15.253250 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:37:15.254591 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f594b0a-65d1-48ac-a0d7-236401f7ff54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f42f250>]}
[0m18:37:15.255696 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 2.08s]
[0m18:37:15.256679 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:37:15.259311 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:37:15.259972 [info ] [Thread-1 (]: 3 of 3 SKIP relation dwh_mart.fact_contract .................................... [[33mSKIP[0m]
[0m18:37:15.260478 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:37:15.262959 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:37:15.263789 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m18:37:15.264581 [info ] [MainThread]: 
[0m18:37:15.264979 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 5.93 seconds (5.93s).
[0m18:37:15.266116 [debug] [MainThread]: Command end result
[0m18:37:15.305334 [info ] [MainThread]: 
[0m18:37:15.305632 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:37:15.305788 [info ] [MainThread]: 
[0m18:37:15.305973 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:37:15.306103 [info ] [MainThread]: 
[0m18:37:15.306297 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
[0m18:37:15.310523 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.919136, "process_user_time": 2.531222, "process_kernel_time": 1.295178, "process_mem_max_rss": "197574656", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:37:15.312038 [debug] [MainThread]: Command `dbt run` failed at 18:37:15.311702 after 6.92 seconds
[0m18:37:15.312936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10273acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128c60d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138126090>]}
[0m18:37:15.313381 [debug] [MainThread]: Flushing usage events
[0m18:37:32.413205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168419790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1684812d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168481950>]}


============================== 18:37:32.415939 | df1f2727-ce7a-43d6-ae61-bd451b140f6d ==============================
[0m18:37:32.415939 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:37:32.416244 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:37:33.033943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df1f2727-ce7a-43d6-ae61-bd451b140f6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16dd681d0>]}
[0m18:37:33.052070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df1f2727-ce7a-43d6-ae61-bd451b140f6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd00c50>]}
[0m18:37:33.052579 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:37:33.064096 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:37:33.120652 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:37:33.122061 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:37:33.170325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'df1f2727-ce7a-43d6-ae61-bd451b140f6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168cee910>]}
[0m18:37:33.211494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'df1f2727-ce7a-43d6-ae61-bd451b140f6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e333110>]}
[0m18:37:33.211773 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:37:33.211926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df1f2727-ce7a-43d6-ae61-bd451b140f6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e222350>]}
[0m18:37:33.212625 [info ] [MainThread]: 
[0m18:37:33.212873 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:37:33.214669 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:37:33.220860 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:37:33.221082 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:37:33.221225 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:37:33.748910 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.527 seconds
[0m18:37:33.752264 [debug] [ThreadPool]: On list_LB: Close
[0m18:37:33.869290 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m18:37:33.881815 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:37:33.882316 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:37:33.882644 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:37:34.351739 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.469 seconds
[0m18:37:34.353988 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:37:34.471490 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m18:37:34.477544 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:37:34.478064 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:37:34.478390 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:37:34.927964 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.450 seconds
[0m18:37:34.928952 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:37:35.071987 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m18:37:35.086606 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:37:35.086867 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:37:35.087008 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:37:35.452303 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.365 seconds
[0m18:37:35.455303 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:37:35.567208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df1f2727-ce7a-43d6-ae61-bd451b140f6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16849f110>]}
[0m18:37:35.567733 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:37:35.567928 [info ] [MainThread]: 
[0m18:37:35.569703 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:37:35.570060 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:37:35.570597 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m18:37:35.570753 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:37:35.575033 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:37:35.576081 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:37:35.584274 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:37:35.584569 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:37:35.584938 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:37:35.899449 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.315 seconds
[0m18:37:35.901316 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:37:35.902079 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:37:35.902429 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:37:35.987291 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m18:37:35.998995 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:37:35.999996 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:37:36.000201 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:37:36.629100 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.628 seconds
[0m18:37:36.654397 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:37:36.770171 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df1f2727-ce7a-43d6-ae61-bd451b140f6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e27a910>]}
[0m18:37:36.772028 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.20s]
[0m18:37:36.773178 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:37:36.773874 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:37:36.775564 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:37:36.775972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:37:36.776200 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:37:36.779820 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:37:36.780865 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:37:36.796405 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:36.796788 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:37:36.797003 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:37:37.139502 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.342 seconds
[0m18:37:37.142765 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:37:37.143842 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:37.144241 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:37:37.245195 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.100 seconds
[0m18:37:37.274134 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:37.274668 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:37:37.859052 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.584 seconds
[0m18:37:37.872319 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:37.872837 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:37:37.953658 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.080 seconds
[0m18:37:37.960485 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:37.961154 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:37:38.029014 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.067 seconds
[0m18:37:38.034480 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:38.034780 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:37:38.109996 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.075 seconds
[0m18:37:38.127152 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:37:38.128140 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:38.128315 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:37:38.228837 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.100 seconds
[0m18:37:38.229696 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:38.230103 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:37:38.777956 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.547 seconds
[0m18:37:38.778884 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:38.779402 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:37:39.007537 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.227 seconds
[0m18:37:39.021834 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:37:39.029346 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:37:39.029791 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:37:39.152964 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.123 seconds
[0m18:37:39.156315 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:37:39.259292 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df1f2727-ce7a-43d6-ae61-bd451b140f6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117410c50>]}
[0m18:37:39.260501 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.48s]
[0m18:37:39.261430 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:37:39.262745 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:37:39.263648 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:37:39.264321 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:37:39.264720 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:37:39.269397 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:37:39.270339 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:37:39.271446 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:37:39.271604 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:37:39.271734 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:37:39.650630 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.379 seconds
[0m18:37:39.653009 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:37:39.654005 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:37:39.654565 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:37:39.731904 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.077 seconds
[0m18:37:39.738645 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:37:39.739449 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.id as contract_id,
        c.product_id,
        c.anlagedatum,
        c.verbrauch,
        c.umsatz,
        p.productcode,
        p.productname,
        c.contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from contracts c
    left join products p on c.id = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.product_id != f.product_id
        or c.anlagedatum != f.anlagedatum
        or c.verbrauch != f.verbrauch
        or c.umsatz != f.umsatz
        or p.productcode != f.productcode
        or p.productname != f.productname
        or c.contract_modificationdate != f.contract_modificationdate
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:37:39.868899 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e85-0202-cf69-0000-0002d4465bf1
[0m18:37:39.869512 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 8
invalid identifier 'C.PRODUCT_ID'
[0m18:37:39.870042 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:37:39.978494 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 25 at position 8
  invalid identifier 'C.PRODUCT_ID'
[0m18:37:39.978827 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df1f2727-ce7a-43d6-ae61-bd451b140f6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f9dff50>]}
[0m18:37:39.979122 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 0.71s]
[0m18:37:39.979377 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:37:39.980475 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:37:39.980648 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:37:39.980841 [info ] [MainThread]: 
[0m18:37:39.980996 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.77 seconds (6.77s).
[0m18:37:39.981392 [debug] [MainThread]: Command end result
[0m18:37:39.995560 [info ] [MainThread]: 
[0m18:37:39.995815 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:37:39.995943 [info ] [MainThread]: 
[0m18:37:39.996110 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 25 at position 8
  invalid identifier 'C.PRODUCT_ID'
[0m18:37:39.996236 [info ] [MainThread]: 
[0m18:37:39.996375 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:37:39.998319 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.616718, "process_user_time": 3.144871, "process_kernel_time": 1.152075, "process_mem_max_rss": "194805760", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:37:39.998708 [debug] [MainThread]: Command `dbt run` failed at 18:37:39.998662 after 7.62 seconds
[0m18:37:39.998972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d6ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117c40810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117e74ed0>]}
[0m18:37:39.999143 [debug] [MainThread]: Flushing usage events
[0m18:38:30.828732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13931bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139381790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139381e10>]}


============================== 18:38:30.831388 | bc264027-a1fd-4f4d-995c-13d96c3f85b6 ==============================
[0m18:38:30.831388 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:38:30.831700 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:38:31.497894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bc264027-a1fd-4f4d-995c-13d96c3f85b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16d410650>]}
[0m18:38:31.517063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bc264027-a1fd-4f4d-995c-13d96c3f85b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ff00c10>]}
[0m18:38:31.517662 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:38:31.528762 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:38:31.590695 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:38:31.591066 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:38:31.685186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bc264027-a1fd-4f4d-995c-13d96c3f85b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16dcdc610>]}
[0m18:38:31.785366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bc264027-a1fd-4f4d-995c-13d96c3f85b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16d8e3d10>]}
[0m18:38:31.786224 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:38:31.786416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc264027-a1fd-4f4d-995c-13d96c3f85b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16d863e10>]}
[0m18:38:31.787484 [info ] [MainThread]: 
[0m18:38:31.787814 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:38:31.792191 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:38:31.803008 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:38:31.803301 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:38:31.803577 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:38:32.342073 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.538 seconds
[0m18:38:32.344805 [debug] [ThreadPool]: On list_LB: Close
[0m18:38:32.458276 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m18:38:32.469753 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:38:32.470221 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:38:32.470477 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:38:32.842196 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.372 seconds
[0m18:38:32.843735 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:38:32.948611 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m18:38:32.951885 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:38:32.952311 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:38:32.952739 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:38:33.424471 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.471 seconds
[0m18:38:33.428315 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:38:33.546092 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m18:38:33.554463 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:38:33.554974 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:38:33.555251 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:38:34.174838 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.619 seconds
[0m18:38:34.178074 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:38:34.292852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc264027-a1fd-4f4d-995c-13d96c3f85b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16d9c9d10>]}
[0m18:38:34.295008 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:38:34.295852 [info ] [MainThread]: 
[0m18:38:34.300501 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:38:34.300883 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:38:34.301253 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m18:38:34.301405 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:38:34.308788 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:38:34.309464 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:38:34.315795 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:38:34.316070 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:38:34.316231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:38:34.709239 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.393 seconds
[0m18:38:34.711957 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:38:34.712884 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:38:34.713220 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:38:34.826996 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.113 seconds
[0m18:38:34.852208 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:38:34.853537 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:38:34.853867 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:38:35.510366 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.656 seconds
[0m18:38:35.533637 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:38:35.648960 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc264027-a1fd-4f4d-995c-13d96c3f85b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f2275d0>]}
[0m18:38:35.650789 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.35s]
[0m18:38:35.651706 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:38:35.652343 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:38:35.653187 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:38:35.653835 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:38:35.654274 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:38:35.659723 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:38:35.661039 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:38:35.675960 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:38:35.676336 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:38:35.676699 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:38:36.007094 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.330 seconds
[0m18:38:36.009956 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:38:36.011139 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:38:36.011735 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:38:36.098744 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m18:38:36.120862 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:38:36.121277 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:38:36.535560 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.414 seconds
[0m18:38:36.548888 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:38:36.549349 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:38:36.632670 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.083 seconds
[0m18:38:36.639474 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:38:36.640021 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:38:36.705829 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.065 seconds
[0m18:38:36.718350 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:38:36.718871 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:38:36.806393 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.087 seconds
[0m18:38:36.837258 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:38:36.838752 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:38:36.839057 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:38:36.928724 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.089 seconds
[0m18:38:36.929215 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:38:36.929606 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:38:38.377407 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 1.447 seconds
[0m18:38:38.378738 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:38:38.379500 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:38:38.685274 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.305 seconds
[0m18:38:38.700692 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:38:38.706380 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:38:38.706763 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:38:38.867643 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.160 seconds
[0m18:38:38.871983 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:38:38.982623 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc264027-a1fd-4f4d-995c-13d96c3f85b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f259990>]}
[0m18:38:38.983214 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 3.33s]
[0m18:38:38.983530 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:38:38.984159 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:38:38.984461 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:38:38.984677 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:38:38.984827 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:38:38.986795 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:38:38.987571 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:38:38.988666 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:38:38.988833 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:38:38.988980 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:38:39.378107 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.389 seconds
[0m18:38:39.380982 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:38:39.382237 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:38:39.382829 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:38:39.482324 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m18:38:39.489180 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:38:39.490014 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with contracts as (
    select * from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.id as contract_id,
        p.product_id,
        c.anlagedatum,
        c.verbrauch,
        c.umsatz,
        p.productcode,
        p.productname,
        c.contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from contracts c
    left join products p on c.id = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.product_id != f.product_id
        or c.anlagedatum != f.anlagedatum
        or c.verbrauch != f.verbrauch
        or c.umsatz != f.umsatz
        or p.productcode != f.productcode
        or p.productname != f.productname
        or c.contract_modificationdate != f.contract_modificationdate
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:38:39.615831 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e86-0202-cf6c-0000-0002d4466d11
[0m18:38:39.616436 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 8
invalid identifier 'C.ANLAGEDATUM'
[0m18:38:39.616920 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:38:39.725899 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 26 at position 8
  invalid identifier 'C.ANLAGEDATUM'
[0m18:38:39.726983 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc264027-a1fd-4f4d-995c-13d96c3f85b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f429790>]}
[0m18:38:39.727899 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 0.74s]
[0m18:38:39.728573 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:38:39.731695 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:38:39.732150 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:38:39.732659 [info ] [MainThread]: 
[0m18:38:39.733021 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 7.94 seconds (7.94s).
[0m18:38:39.734051 [debug] [MainThread]: Command end result
[0m18:38:39.768093 [info ] [MainThread]: 
[0m18:38:39.768453 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:38:39.768583 [info ] [MainThread]: 
[0m18:38:39.768754 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 26 at position 8
  invalid identifier 'C.ANLAGEDATUM'
[0m18:38:39.768889 [info ] [MainThread]: 
[0m18:38:39.769032 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:38:39.771757 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.975033, "process_user_time": 2.602638, "process_kernel_time": 2.319201, "process_mem_max_rss": "192790528", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:38:39.772230 [debug] [MainThread]: Command `dbt run` failed at 18:38:39.772194 after 8.98 seconds
[0m18:38:39.772906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042cacd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043441d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139320a50>]}
[0m18:38:39.773057 [debug] [MainThread]: Flushing usage events
[0m18:44:53.014908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145e1ee50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145e81150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145e81790>]}


============================== 18:44:53.017508 | 3820b0c1-7a0c-4734-80ea-1ebd618b1752 ==============================
[0m18:44:53.017508 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:44:53.017789 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:44:53.700030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3820b0c1-7a0c-4734-80ea-1ebd618b1752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146665690>]}
[0m18:44:53.721444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3820b0c1-7a0c-4734-80ea-1ebd618b1752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145700c50>]}
[0m18:44:53.722127 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:44:53.734115 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:44:53.817674 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:44:53.818138 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:44:53.925905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3820b0c1-7a0c-4734-80ea-1ebd618b1752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f560f90>]}
[0m18:44:54.025208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3820b0c1-7a0c-4734-80ea-1ebd618b1752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145133750>]}
[0m18:44:54.025481 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:44:54.025636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3820b0c1-7a0c-4734-80ea-1ebd618b1752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1271e8690>]}
[0m18:44:54.026337 [info ] [MainThread]: 
[0m18:44:54.026577 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:44:54.028718 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:44:54.034363 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:44:54.034569 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:44:54.034694 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:44:54.753013 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.718 seconds
[0m18:44:54.755224 [debug] [ThreadPool]: On list_LB: Close
[0m18:44:54.981729 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m18:44:54.987595 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:44:54.987879 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:44:54.988034 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:44:55.379580 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.391 seconds
[0m18:44:55.382959 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:44:55.512034 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m18:44:55.517662 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:44:55.518186 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:44:55.518543 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:44:55.988966 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.470 seconds
[0m18:44:55.991467 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:44:56.099976 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m18:44:56.106039 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:44:56.106479 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:44:56.106777 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:44:56.606361 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.499 seconds
[0m18:44:56.607540 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:44:56.710875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3820b0c1-7a0c-4734-80ea-1ebd618b1752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f434310>]}
[0m18:44:56.712087 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:44:56.712552 [info ] [MainThread]: 
[0m18:44:56.715757 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:44:56.716513 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:44:56.717002 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m18:44:56.717186 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:44:56.726437 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:44:56.728437 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:44:56.744042 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:44:56.744716 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:44:56.745234 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:44:57.344546 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.599 seconds
[0m18:44:57.346262 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:44:57.346854 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:44:57.347020 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:44:57.534963 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.188 seconds
[0m18:44:57.543850 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:44:57.544663 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:44:57.544861 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:44:58.272178 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.727 seconds
[0m18:44:58.287418 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:44:58.387676 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3820b0c1-7a0c-4734-80ea-1ebd618b1752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fa170d0>]}
[0m18:44:58.388304 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.67s]
[0m18:44:58.388738 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:44:58.389048 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:44:58.389484 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:44:58.389850 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:44:58.390100 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:44:58.392655 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:44:58.393272 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:44:58.404633 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:44:58.404941 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:44:58.405168 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:44:58.715200 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.310 seconds
[0m18:44:58.718165 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:44:58.719367 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:44:58.720065 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:44:58.822655 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.102 seconds
[0m18:44:58.850802 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:44:58.851318 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:44:59.198156 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.346 seconds
[0m18:44:59.214345 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:44:59.214962 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:44:59.333830 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.118 seconds
[0m18:44:59.343014 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:44:59.343668 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:44:59.428284 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.084 seconds
[0m18:44:59.442055 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:44:59.442860 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:44:59.508624 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.065 seconds
[0m18:44:59.543885 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:44:59.546740 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:44:59.547005 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:44:59.639144 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.092 seconds
[0m18:44:59.639994 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:44:59.640363 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:45:00.232025 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e8c-0202-cf6a-0000-0002d4467c0d
[0m18:45:00.232794 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m18:45:00.233464 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:45:00.342576 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:45:00.343844 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3820b0c1-7a0c-4734-80ea-1ebd618b1752', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f3ba890>]}
[0m18:45:00.344787 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 1.95s]
[0m18:45:00.345751 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:45:00.354584 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:45:00.355143 [info ] [Thread-1 (]: 3 of 3 SKIP relation dwh_mart.fact_contract .................................... [[33mSKIP[0m]
[0m18:45:00.355673 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:45:00.357124 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:45:00.357441 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m18:45:00.358250 [info ] [MainThread]: 
[0m18:45:00.358537 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.33 seconds (6.33s).
[0m18:45:00.359425 [debug] [MainThread]: Command end result
[0m18:45:00.397483 [info ] [MainThread]: 
[0m18:45:00.397967 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:45:00.398194 [info ] [MainThread]: 
[0m18:45:00.398822 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m18:45:00.399022 [info ] [MainThread]: 
[0m18:45:00.399814 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
[0m18:45:00.405385 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.422838, "process_user_time": 2.717696, "process_kernel_time": 1.637593, "process_mem_max_rss": "192135168", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:45:00.406139 [debug] [MainThread]: Command `dbt run` failed at 18:45:00.406072 after 7.42 seconds
[0m18:45:00.407698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145e60d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042d2c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145e599d0>]}
[0m18:45:00.408027 [debug] [MainThread]: Flushing usage events
[0m18:45:31.425126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122a57ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122abd350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122abd9d0>]}


============================== 18:45:31.428605 | 0cea9e70-5728-48e5-a123-eae15999b6dd ==============================
[0m18:45:31.428605 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:45:31.429069 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:45:32.252160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0cea9e70-5728-48e5-a123-eae15999b6dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133dcea90>]}
[0m18:45:32.280313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0cea9e70-5728-48e5-a123-eae15999b6dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122500c50>]}
[0m18:45:32.282156 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:45:32.297428 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:45:32.355009 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:45:32.355225 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:45:32.371639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0cea9e70-5728-48e5-a123-eae15999b6dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133e09590>]}
[0m18:45:32.416730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0cea9e70-5728-48e5-a123-eae15999b6dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133e8be10>]}
[0m18:45:32.417016 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:45:32.417170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0cea9e70-5728-48e5-a123-eae15999b6dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134063850>]}
[0m18:45:32.417894 [info ] [MainThread]: 
[0m18:45:32.418178 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:45:32.419986 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:45:32.426106 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:45:32.426367 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:45:32.426500 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:45:32.948491 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.522 seconds
[0m18:45:32.949403 [debug] [ThreadPool]: On list_LB: Close
[0m18:45:33.064093 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m18:45:33.068741 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:45:33.068963 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:45:33.069091 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:45:33.522219 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.453 seconds
[0m18:45:33.528508 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:45:33.636423 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m18:45:33.639946 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:45:33.640216 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:45:33.640359 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:45:34.062111 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.422 seconds
[0m18:45:34.064079 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:45:34.174087 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m18:45:34.177945 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:45:34.178361 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:45:34.178664 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:45:34.548214 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.369 seconds
[0m18:45:34.550316 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:45:34.661130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0cea9e70-5728-48e5-a123-eae15999b6dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122a67050>]}
[0m18:45:34.662267 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:45:34.662721 [info ] [MainThread]: 
[0m18:45:34.680483 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:45:34.681000 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:45:34.681468 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m18:45:34.681985 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:45:34.690795 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:45:34.692018 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:45:34.705039 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:45:34.705534 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:45:34.705724 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:45:35.114378 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.400 seconds
[0m18:45:35.126320 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:45:35.131867 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:45:35.132814 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:45:35.234112 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.100 seconds
[0m18:45:35.267357 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:45:35.269722 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:45:35.270257 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:45:35.962963 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.692 seconds
[0m18:45:35.982536 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:45:36.092050 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0cea9e70-5728-48e5-a123-eae15999b6dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1344c6550>]}
[0m18:45:36.093143 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.41s]
[0m18:45:36.093901 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:45:36.094451 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:45:36.095149 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:45:36.095636 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:45:36.095869 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:45:36.098239 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:45:36.098833 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:45:36.113117 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:45:36.113834 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:45:36.114267 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:45:36.443151 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.329 seconds
[0m18:45:36.445651 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:45:36.447737 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:45:36.448467 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:45:36.533256 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m18:45:36.557655 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:45:36.558003 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:45:36.980896 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.422 seconds
[0m18:45:36.994141 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:45:36.994734 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:45:37.073767 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.079 seconds
[0m18:45:37.077869 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:45:37.078269 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:45:37.142091 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.063 seconds
[0m18:45:37.151520 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:45:37.152023 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:45:37.225009 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.072 seconds
[0m18:45:37.258423 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:45:37.259990 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:45:37.260257 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:45:37.361605 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.101 seconds
[0m18:45:37.362582 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:45:37.363072 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:45:37.912423 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.549 seconds
[0m18:45:37.913565 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:45:37.914270 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:45:38.147008 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.232 seconds
[0m18:45:38.160668 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:45:38.166100 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:45:38.166434 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:45:38.282121 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.115 seconds
[0m18:45:38.285691 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:45:38.387338 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0cea9e70-5728-48e5-a123-eae15999b6dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133deb850>]}
[0m18:45:38.389044 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.29s]
[0m18:45:38.390066 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:45:38.392190 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:45:38.393192 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:45:38.393991 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:45:38.394558 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:45:38.399927 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:45:38.401264 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:45:38.403540 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:45:38.403908 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:45:38.404207 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:45:38.731248 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.327 seconds
[0m18:45:38.734338 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:45:38.735541 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:45:38.736071 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:45:38.817947 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.081 seconds
[0m18:45:38.826221 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:45:38.827129 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.product_id != f.product_id
        or c.type != f.type
        or c.energy != f.energy
        or c.usage != f.usage
        or c.usagenet != f.usagenet
        or c.createdat != f.anlagedatum
        or c.startdate != f.startdate
        or c.enddate != f.enddate
        or c.fillingdatecancellation != f.fillingdatecancellation
        or c.cancellationreason != f.cancellationreason
        or c.city != f.city
        or c.status != f.status
        or p.productcode != f.productcode
        or p.productname != f.productname
        or c.modificationdate != f.contract_modificationdate
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:45:38.970662 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e8d-0202-cf54-0000-0002d4464b95
[0m18:45:38.971614 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 40 at position 8
invalid identifier 'C.PRODUCT_ID'
[0m18:45:38.972259 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:45:39.090250 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 40 at position 8
  invalid identifier 'C.PRODUCT_ID'
[0m18:45:39.091170 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0cea9e70-5728-48e5-a123-eae15999b6dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1346b3850>]}
[0m18:45:39.091909 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 0.70s]
[0m18:45:39.092599 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:45:39.094733 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:45:39.095139 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:45:39.095549 [info ] [MainThread]: 
[0m18:45:39.095868 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.68 seconds (6.68s).
[0m18:45:39.096715 [debug] [MainThread]: Command end result
[0m18:45:39.113409 [info ] [MainThread]: 
[0m18:45:39.113762 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:45:39.113917 [info ] [MainThread]: 
[0m18:45:39.114098 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 40 at position 8
  invalid identifier 'C.PRODUCT_ID'
[0m18:45:39.114227 [info ] [MainThread]: 
[0m18:45:39.114375 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:45:39.116209 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.722671, "process_user_time": 2.259796, "process_kernel_time": 2.369228, "process_mem_max_rss": "191594496", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:45:39.116563 [debug] [MainThread]: Command `dbt run` failed at 18:45:39.116525 after 7.72 seconds
[0m18:45:39.116820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10441ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122a9c950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134651590>]}
[0m18:45:39.116990 [debug] [MainThread]: Flushing usage events
[0m18:46:49.756969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145d1ba10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145d81610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145d81c50>]}


============================== 18:46:49.759962 | 612a6d6c-57ee-4252-82b6-fc9918c32bda ==============================
[0m18:46:49.759962 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:46:49.760304 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:46:50.488024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '612a6d6c-57ee-4252-82b6-fc9918c32bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a908610>]}
[0m18:46:50.542682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '612a6d6c-57ee-4252-82b6-fc9918c32bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145400b90>]}
[0m18:46:50.544648 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:46:50.563097 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:46:50.641969 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:46:50.642409 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:46:50.749999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '612a6d6c-57ee-4252-82b6-fc9918c32bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa79750>]}
[0m18:46:50.924937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '612a6d6c-57ee-4252-82b6-fc9918c32bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a9a2910>]}
[0m18:46:50.925804 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:46:50.926012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '612a6d6c-57ee-4252-82b6-fc9918c32bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa24c50>]}
[0m18:46:50.927593 [info ] [MainThread]: 
[0m18:46:50.928175 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:46:50.932511 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:46:50.950595 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:46:50.951209 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:46:50.951698 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:46:51.454727 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.502 seconds
[0m18:46:51.457085 [debug] [ThreadPool]: On list_LB: Close
[0m18:46:51.578146 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m18:46:51.586920 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:46:51.587209 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:46:51.587349 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:46:51.983550 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.396 seconds
[0m18:46:51.984765 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:46:52.087394 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m18:46:52.088961 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:46:52.089106 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:46:52.089216 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:46:52.426420 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.337 seconds
[0m18:46:52.427348 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:46:52.526860 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m18:46:52.530692 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:46:52.531012 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:46:52.531238 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:46:52.876054 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.345 seconds
[0m18:46:52.878729 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:46:53.007357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '612a6d6c-57ee-4252-82b6-fc9918c32bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ab11710>]}
[0m18:46:53.008160 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:46:53.008532 [info ] [MainThread]: 
[0m18:46:53.010803 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:46:53.011306 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:46:53.011675 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m18:46:53.011942 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:46:53.019292 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:46:53.020208 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:46:53.028971 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:46:53.029300 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:46:53.029538 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:46:53.440162 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.410 seconds
[0m18:46:53.442515 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:46:53.443919 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:46:53.444466 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:46:53.530561 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.085 seconds
[0m18:46:53.549476 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:46:53.550590 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:46:53.550877 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:46:54.129790 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.579 seconds
[0m18:46:54.149132 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:46:54.242826 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '612a6d6c-57ee-4252-82b6-fc9918c32bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144ccfa10>]}
[0m18:46:54.243363 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.23s]
[0m18:46:54.243697 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:46:54.243943 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:46:54.244483 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:46:54.244810 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:46:54.245005 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:46:54.247041 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:46:54.247485 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:46:54.256240 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:46:54.256506 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:46:54.256661 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:46:54.581360 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.324 seconds
[0m18:46:54.584054 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:46:54.585033 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:46:54.585406 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:46:54.673013 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.087 seconds
[0m18:46:54.701072 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:46:54.701654 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:46:55.319458 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.617 seconds
[0m18:46:55.326513 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:46:55.326822 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:46:55.411892 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.085 seconds
[0m18:46:55.418855 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:46:55.419282 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:46:55.483712 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.064 seconds
[0m18:46:55.495552 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:46:55.496125 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:46:55.558506 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.062 seconds
[0m18:46:55.587870 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:46:55.589034 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:46:55.589227 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:46:55.699634 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.110 seconds
[0m18:46:55.700583 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:46:55.701225 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:46:56.446997 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.745 seconds
[0m18:46:56.447793 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:46:56.448294 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:46:56.649664 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.201 seconds
[0m18:46:56.663708 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:46:56.669415 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:46:56.669760 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:46:56.796690 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.126 seconds
[0m18:46:56.801190 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:46:56.921121 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '612a6d6c-57ee-4252-82b6-fc9918c32bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ab13ed0>]}
[0m18:46:56.923170 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.68s]
[0m18:46:56.924500 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:46:56.926812 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:46:56.928085 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:46:56.928913 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:46:56.929586 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:46:56.933345 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:46:56.933974 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:46:56.935114 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:46:56.935286 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:46:56.935442 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:46:57.306715 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.371 seconds
[0m18:46:57.309103 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:46:57.310403 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:46:57.315871 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:46:57.397036 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.081 seconds
[0m18:46:57.399290 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:46:57.399592 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        or c.type != f.type
        or c.energy != f.energy
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
        or c.startdate != f.startdate
        or c.enddate != f.enddate
        or c.fillingdatecancellation != f.fillingdatecancellation
        or c.cancellationreason != f.cancellationreason
        or c.city != f.city
        or c.status != f.status
        or p.productcode != f.productcode
        or p.productname != f.productname
        or c.modificationdate != f.contract_modificationdate
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:46:57.517953 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e8e-0202-cf6a-0000-0002d4467c39
[0m18:46:57.518246 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 56 at position 21
invalid identifier 'F.TYPE'
[0m18:46:57.518480 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:46:57.623044 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 56 at position 21
  invalid identifier 'F.TYPE'
[0m18:46:57.623416 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '612a6d6c-57ee-4252-82b6-fc9918c32bda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ab13ed0>]}
[0m18:46:57.623724 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 0.69s]
[0m18:46:57.624135 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:46:57.625474 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:46:57.625627 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:46:57.625835 [info ] [MainThread]: 
[0m18:46:57.625973 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.70 seconds (6.70s).
[0m18:46:57.626416 [debug] [MainThread]: Command end result
[0m18:46:57.646765 [info ] [MainThread]: 
[0m18:46:57.647061 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:46:57.647196 [info ] [MainThread]: 
[0m18:46:57.647556 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 56 at position 21
  invalid identifier 'F.TYPE'
[0m18:46:57.647695 [info ] [MainThread]: 
[0m18:46:57.647869 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:46:57.649919 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.9284105, "process_user_time": 2.976933, "process_kernel_time": 1.794386, "process_mem_max_rss": "184795136", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:46:57.650385 [debug] [MainThread]: Command `dbt run` failed at 18:46:57.650333 after 7.93 seconds
[0m18:46:57.650689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1024e2cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145d60b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145d0b750>]}
[0m18:46:57.650891 [debug] [MainThread]: Flushing usage events
[0m18:49:04.039622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168888790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168896c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16872c110>]}


============================== 18:49:04.042617 | 87615df1-ac0b-499b-b120-edef8d272892 ==============================
[0m18:49:04.042617 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:49:04.042949 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:49:04.763596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '87615df1-ac0b-499b-b120-edef8d272892', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e5328d0>]}
[0m18:49:04.787608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '87615df1-ac0b-499b-b120-edef8d272892', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168100c50>]}
[0m18:49:04.788388 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:49:04.800474 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:49:04.871505 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:49:04.871779 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:49:04.894411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '87615df1-ac0b-499b-b120-edef8d272892', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e59e390>]}
[0m18:49:04.938419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '87615df1-ac0b-499b-b120-edef8d272892', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e8e9390>]}
[0m18:49:04.938742 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:49:04.938905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87615df1-ac0b-499b-b120-edef8d272892', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e75f590>]}
[0m18:49:04.939693 [info ] [MainThread]: 
[0m18:49:04.939970 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:49:04.941894 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:49:04.948169 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:49:04.948411 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:49:04.948591 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:49:05.454843 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.506 seconds
[0m18:49:05.457366 [debug] [ThreadPool]: On list_LB: Close
[0m18:49:05.839716 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m18:49:05.852166 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:49:05.852659 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:49:05.852935 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:49:06.286148 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.433 seconds
[0m18:49:06.290394 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:49:06.397115 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m18:49:06.399968 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:49:06.400226 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:49:06.400370 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:49:06.736485 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.336 seconds
[0m18:49:06.738429 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:49:06.839781 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m18:49:06.844940 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:49:06.845500 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:49:06.845870 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:49:07.323041 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.477 seconds
[0m18:49:07.325371 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:49:07.435424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '87615df1-ac0b-499b-b120-edef8d272892', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c716450>]}
[0m18:49:07.438665 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:49:07.439336 [info ] [MainThread]: 
[0m18:49:07.442916 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:49:07.443794 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:49:07.444408 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m18:49:07.444910 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:49:07.453085 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:49:07.453641 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:49:07.465182 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:49:07.465503 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:49:07.465675 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:49:07.783146 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.317 seconds
[0m18:49:07.785915 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:49:07.786857 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:49:07.787298 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:49:07.860342 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.072 seconds
[0m18:49:07.879956 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:49:07.881718 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:49:07.882267 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:49:08.643199 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.760 seconds
[0m18:49:08.663543 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:49:08.768504 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87615df1-ac0b-499b-b120-edef8d272892', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fe21410>]}
[0m18:49:08.769749 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.32s]
[0m18:49:08.770665 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:49:08.771193 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:49:08.771761 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:49:08.772540 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:49:08.773125 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:49:08.777572 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:49:08.778922 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:49:08.791406 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:08.791735 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:49:08.791898 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:49:09.115570 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.323 seconds
[0m18:49:09.117596 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:49:09.118343 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:09.118719 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:49:09.194791 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.075 seconds
[0m18:49:09.216575 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:09.216917 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:49:09.510839 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.294 seconds
[0m18:49:09.521828 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:09.522322 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:49:09.697244 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.174 seconds
[0m18:49:09.704859 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:09.705477 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:49:09.768146 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.062 seconds
[0m18:49:09.781878 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:09.782579 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:49:09.843390 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.060 seconds
[0m18:49:09.876756 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:49:09.878737 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:09.878980 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:49:09.960640 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.081 seconds
[0m18:49:09.961461 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:09.962160 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:49:10.759310 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.796 seconds
[0m18:49:10.760376 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:10.760926 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:49:10.966422 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.205 seconds
[0m18:49:10.979970 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:49:10.986633 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:10.987101 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:49:11.108327 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.121 seconds
[0m18:49:11.112467 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:49:11.224330 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87615df1-ac0b-499b-b120-edef8d272892', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x28a9ebe50>]}
[0m18:49:11.226210 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.45s]
[0m18:49:11.227311 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:49:11.229433 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:49:11.230415 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:49:11.231084 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:49:11.231452 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:49:11.236605 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:49:11.237466 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:49:11.239064 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:49:11.239321 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:49:11.239532 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:49:11.718560 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.478 seconds
[0m18:49:11.722000 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:49:11.722965 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:49:11.723403 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:49:11.799703 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.076 seconds
[0m18:49:11.804970 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:49:11.805645 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        or c.type != f.type
        or c.energy != f.energy
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
        or c.startdate != f.startdate
        or c.enddate != f.enddate
        or c.fillingdatecancellation != f.fillingdatecancellation
        or c.cancellationreason != f.cancellationreason
        or c.city != f.city
        or c.status != f.status
        or p.productcode != f.productcode
        or p.productname != f.productname
        or c.modificationdate != f.contract_modificationdate
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:49:12.023461 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e91-0202-cf6b-0000-0002d4463c09
[0m18:49:12.024127 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 56 at position 21
invalid identifier 'F.TYPE'
[0m18:49:12.024649 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:49:12.137186 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 56 at position 21
  invalid identifier 'F.TYPE'
[0m18:49:12.137988 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '87615df1-ac0b-499b-b120-edef8d272892', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ea4aa50>]}
[0m18:49:12.138699 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 0.91s]
[0m18:49:12.139286 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:49:12.141340 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:49:12.141697 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:49:12.142066 [info ] [MainThread]: 
[0m18:49:12.142391 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 7.20 seconds (7.20s).
[0m18:49:12.143033 [debug] [MainThread]: Command end result
[0m18:49:12.162896 [info ] [MainThread]: 
[0m18:49:12.163326 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:49:12.163542 [info ] [MainThread]: 
[0m18:49:12.163825 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 56 at position 21
  invalid identifier 'F.TYPE'
[0m18:49:12.164028 [info ] [MainThread]: 
[0m18:49:12.164255 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:49:12.166629 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.159922, "process_user_time": 2.931019, "process_kernel_time": 1.280648, "process_mem_max_rss": "195985408", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:49:12.167067 [debug] [MainThread]: Command `dbt run` failed at 18:49:12.167012 after 8.16 seconds
[0m18:49:12.167414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168897610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051becd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168847a10>]}
[0m18:49:12.167631 [debug] [MainThread]: Flushing usage events
[0m18:49:53.942417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ad1b690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ad7d490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ad7db10>]}


============================== 18:49:53.944848 | 77499992-6343-4f5a-a707-15a5c13ffc61 ==============================
[0m18:49:53.944848 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:49:53.945139 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:49:54.625412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '77499992-6343-4f5a-a707-15a5c13ffc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168f15310>]}
[0m18:49:54.652317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '77499992-6343-4f5a-a707-15a5c13ffc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a500c50>]}
[0m18:49:54.652987 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:49:54.664162 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:49:54.721526 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:49:54.721883 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:49:54.834113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '77499992-6343-4f5a-a707-15a5c13ffc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168f96010>]}
[0m18:49:54.936413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '77499992-6343-4f5a-a707-15a5c13ffc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16916d5d0>]}
[0m18:49:54.936712 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:49:54.936881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77499992-6343-4f5a-a707-15a5c13ffc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169473f10>]}
[0m18:49:54.937599 [info ] [MainThread]: 
[0m18:49:54.937835 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:49:54.939854 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:49:54.945630 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:49:54.945818 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:49:54.945943 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:49:55.389902 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.444 seconds
[0m18:49:55.390957 [debug] [ThreadPool]: On list_LB: Close
[0m18:49:55.490758 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m18:49:55.499123 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:49:55.499372 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:49:55.499506 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:49:55.960341 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.461 seconds
[0m18:49:55.964302 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:49:56.066887 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m18:49:56.068544 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:49:56.068725 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:49:56.068857 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:49:56.477748 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.409 seconds
[0m18:49:56.482645 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:49:56.591633 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m18:49:56.595494 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:49:56.595786 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:49:56.595921 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:49:57.010035 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.414 seconds
[0m18:49:57.012587 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:49:57.125258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77499992-6343-4f5a-a707-15a5c13ffc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fde54d0>]}
[0m18:49:57.126179 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:49:57.126443 [info ] [MainThread]: 
[0m18:49:57.130020 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:49:57.130763 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:49:57.131106 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m18:49:57.131267 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:49:57.136166 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:49:57.137278 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:49:57.145168 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:49:57.145505 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:49:57.145754 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:49:57.557402 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.412 seconds
[0m18:49:57.558609 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:49:57.559017 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:49:57.559169 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:49:57.631374 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.072 seconds
[0m18:49:57.639359 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:49:57.640090 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:49:57.640261 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:49:58.308916 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.668 seconds
[0m18:49:58.334342 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:49:58.442397 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77499992-6343-4f5a-a707-15a5c13ffc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168dd6850>]}
[0m18:49:58.443344 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.31s]
[0m18:49:58.443985 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:49:58.444498 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:49:58.445113 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:49:58.445575 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:49:58.445914 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:49:58.449283 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:49:58.450259 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:49:58.459354 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:58.459664 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:49:58.459835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:49:58.768492 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.308 seconds
[0m18:49:58.770682 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:49:58.771714 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:58.772292 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:49:58.844140 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.071 seconds
[0m18:49:58.865740 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:58.866055 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:49:59.231790 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.365 seconds
[0m18:49:59.245050 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:59.245585 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:49:59.344152 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.098 seconds
[0m18:49:59.352069 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:59.352971 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:49:59.420576 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.067 seconds
[0m18:49:59.434077 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:59.434776 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:49:59.502673 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.067 seconds
[0m18:49:59.536786 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:49:59.538021 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:59.538285 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:49:59.630399 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.092 seconds
[0m18:49:59.631191 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:49:59.631722 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:50:00.152217 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.520 seconds
[0m18:50:00.153092 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:50:00.153432 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:50:00.387848 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.234 seconds
[0m18:50:00.400692 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:50:00.405851 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:50:00.406183 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:50:00.513671 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.107 seconds
[0m18:50:00.517316 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:50:00.627291 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77499992-6343-4f5a-a707-15a5c13ffc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1697f2810>]}
[0m18:50:00.628635 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.18s]
[0m18:50:00.629423 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:50:00.630831 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:50:00.631456 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:50:00.632002 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:50:00.632342 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:50:00.637733 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:50:00.638787 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:50:00.641214 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:50:00.641581 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:50:00.641897 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:50:00.984084 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.342 seconds
[0m18:50:00.988722 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:50:00.989843 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:50:00.990451 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:50:01.068888 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.078 seconds
[0m18:50:01.071547 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:50:01.071907 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        --or c.type != f.type
        or c.energy != f.energy
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
        or c.startdate != f.startdate
        or c.enddate != f.enddate
        or c.fillingdatecancellation != f.fillingdatecancellation
        or c.cancellationreason != f.cancellationreason
        or c.city != f.city
        or c.status != f.status
        or p.productcode != f.productcode
        or p.productname != f.productname
        or c.modificationdate != f.contract_modificationdate
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:50:01.186606 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e92-0202-cf6a-0000-0002d4467c65
[0m18:50:01.186880 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 57 at position 23
invalid identifier 'F.ENERGY'
[0m18:50:01.187301 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:50:01.287011 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 57 at position 23
  invalid identifier 'F.ENERGY'
[0m18:50:01.287449 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77499992-6343-4f5a-a707-15a5c13ffc61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1699170d0>]}
[0m18:50:01.287857 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 0.66s]
[0m18:50:01.288227 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:50:01.289560 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:50:01.289779 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:50:01.290052 [info ] [MainThread]: 
[0m18:50:01.290251 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.35 seconds (6.35s).
[0m18:50:01.290790 [debug] [MainThread]: Command end result
[0m18:50:01.310278 [info ] [MainThread]: 
[0m18:50:01.310723 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:50:01.310893 [info ] [MainThread]: 
[0m18:50:01.311077 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 57 at position 23
  invalid identifier 'F.ENERGY'
[0m18:50:01.311213 [info ] [MainThread]: 
[0m18:50:01.312565 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:50:01.316049 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.403306, "process_user_time": 2.649048, "process_kernel_time": 1.910875, "process_mem_max_rss": "197378048", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:50:01.317300 [debug] [MainThread]: Command `dbt run` failed at 18:50:01.317251 after 7.40 seconds
[0m18:50:01.318343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ad4c410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a5acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ad0b950>]}
[0m18:50:01.318529 [debug] [MainThread]: Flushing usage events
[0m18:51:14.813460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12731fc90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12737d350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12737d9d0>]}


============================== 18:51:14.817504 | e7a82b4d-bab8-420c-a091-bbfcf5b63443 ==============================
[0m18:51:14.817504 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:51:14.817857 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:51:15.742447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7a82b4d-bab8-420c-a091-bbfcf5b63443', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12737d910>]}
[0m18:51:15.792481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e7a82b4d-bab8-420c-a091-bbfcf5b63443', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120500b90>]}
[0m18:51:15.793326 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:51:15.815375 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:51:15.896389 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:51:15.896808 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:51:16.003873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e7a82b4d-bab8-420c-a091-bbfcf5b63443', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17bd9abd0>]}
[0m18:51:16.110319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e7a82b4d-bab8-420c-a091-bbfcf5b63443', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17c272f10>]}
[0m18:51:16.110635 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:51:16.110800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7a82b4d-bab8-420c-a091-bbfcf5b63443', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17bfe9bd0>]}
[0m18:51:16.111567 [info ] [MainThread]: 
[0m18:51:16.111810 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:51:16.113954 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:51:16.119656 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:51:16.119891 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:51:16.120021 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:51:16.591023 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.471 seconds
[0m18:51:16.593958 [debug] [ThreadPool]: On list_LB: Close
[0m18:51:16.712183 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m18:51:16.725096 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:51:16.725659 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:51:16.725977 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:17.199276 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.473 seconds
[0m18:51:17.201575 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:51:17.570981 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m18:51:17.576547 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:51:17.577073 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:51:17.577410 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:17.980719 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.403 seconds
[0m18:51:17.982858 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:51:18.083085 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m18:51:18.086457 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:51:18.086754 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:51:18.086912 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:18.590682 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.504 seconds
[0m18:51:18.592840 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:51:18.703561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7a82b4d-bab8-420c-a091-bbfcf5b63443', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17bcc7950>]}
[0m18:51:18.705536 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:51:18.706441 [info ] [MainThread]: 
[0m18:51:18.711631 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:51:18.712459 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:51:18.712994 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m18:51:18.713374 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:51:18.722279 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:51:18.723735 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:51:18.735273 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:51:18.735701 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:51:18.735954 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:51:19.145554 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.409 seconds
[0m18:51:19.147295 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:51:19.148066 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:51:19.148446 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:51:19.216535 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.068 seconds
[0m18:51:19.240467 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:51:19.241639 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:51:19.241947 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:51:19.921594 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.679 seconds
[0m18:51:19.947732 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:51:20.050249 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7a82b4d-bab8-420c-a091-bbfcf5b63443', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17c70ac50>]}
[0m18:51:20.050753 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.34s]
[0m18:51:20.051095 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:51:20.051321 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:51:20.051650 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:51:20.051926 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:51:20.052111 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:51:20.053943 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:51:20.055941 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:51:20.066972 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:20.067298 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:51:20.067477 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:51:20.639311 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.571 seconds
[0m18:51:20.642066 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:51:20.642953 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:20.643295 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:51:20.767290 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.123 seconds
[0m18:51:20.792426 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:20.793059 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:51:21.153114 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.359 seconds
[0m18:51:21.167438 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:21.168035 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:51:21.241999 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.073 seconds
[0m18:51:21.247557 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:21.248063 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:51:21.311918 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.063 seconds
[0m18:51:21.323414 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:21.323757 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:51:21.379478 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.055 seconds
[0m18:51:21.403899 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:51:21.405503 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:21.405693 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:51:21.505915 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.100 seconds
[0m18:51:21.506226 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:21.506618 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:51:22.278072 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.771 seconds
[0m18:51:22.279455 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:22.279942 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:51:22.585308 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.305 seconds
[0m18:51:22.599182 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:51:22.603743 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:22.604067 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:51:22.729321 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.125 seconds
[0m18:51:22.732880 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:51:22.841739 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7a82b4d-bab8-420c-a091-bbfcf5b63443', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17bb9d9d0>]}
[0m18:51:22.843401 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.79s]
[0m18:51:22.844487 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:51:22.846217 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:51:22.847043 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:51:22.847651 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:51:22.848078 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:51:22.854097 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:51:22.854861 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:51:22.856452 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:51:22.856680 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:51:22.856853 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:51:23.186005 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.329 seconds
[0m18:51:23.186771 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:51:23.187061 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:51:23.187207 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:51:23.294562 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.107 seconds
[0m18:51:23.300857 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:51:23.301681 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        --or c.type != f.type
        --or c.energy != f.energy
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
        or c.startdate != f.startdate
        or c.enddate != f.enddate
        or p.productcode != f.productcode
        or p.productname != f.productname
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:51:23.777029 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e93-0202-cf6c-0000-0002d4466d8d
[0m18:51:23.777731 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 61 at position 26
invalid identifier 'F.STARTDATE'
[0m18:51:23.778305 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:51:23.920530 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 61 at position 26
  invalid identifier 'F.STARTDATE'
[0m18:51:23.921563 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7a82b4d-bab8-420c-a091-bbfcf5b63443', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17c7f9450>]}
[0m18:51:23.922446 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 1.07s]
[0m18:51:23.923158 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:51:23.926644 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:51:23.927150 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:51:23.927626 [info ] [MainThread]: 
[0m18:51:23.928016 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 7.82 seconds (7.82s).
[0m18:51:23.928996 [debug] [MainThread]: Command end result
[0m18:51:23.948594 [info ] [MainThread]: 
[0m18:51:23.949358 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:51:23.949561 [info ] [MainThread]: 
[0m18:51:23.949765 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 61 at position 26
  invalid identifier 'F.STARTDATE'
[0m18:51:23.949906 [info ] [MainThread]: 
[0m18:51:23.950060 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:51:23.952388 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 9.175494, "process_user_time": 3.123366, "process_kernel_time": 0.898613, "process_mem_max_rss": "192069632", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:51:23.953013 [debug] [MainThread]: Command `dbt run` failed at 18:51:23.952959 after 9.18 seconds
[0m18:51:23.953310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1028a6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12734c390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17bfc8490>]}
[0m18:51:23.953510 [debug] [MainThread]: Flushing usage events
[0m18:51:53.840282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12885af50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1288884d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1288bda10>]}


============================== 18:51:53.844471 | 89a044c7-fad1-4812-abdc-48988698f12d ==============================
[0m18:51:53.844471 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:51:53.844807 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m18:51:54.649924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '89a044c7-fad1-4812-abdc-48988698f12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ad09250>]}
[0m18:51:54.669875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '89a044c7-fad1-4812-abdc-48988698f12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128100bd0>]}
[0m18:51:54.670714 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:51:54.692249 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:51:54.755954 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:51:54.756402 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:51:54.846475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '89a044c7-fad1-4812-abdc-48988698f12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b099010>]}
[0m18:51:54.922406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '89a044c7-fad1-4812-abdc-48988698f12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aee2490>]}
[0m18:51:54.922673 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:51:54.922823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89a044c7-fad1-4812-abdc-48988698f12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16af1a6d0>]}
[0m18:51:54.923480 [info ] [MainThread]: 
[0m18:51:54.923720 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:51:54.925823 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:51:54.931811 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:51:54.932024 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:51:54.932154 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:51:55.371114 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.439 seconds
[0m18:51:55.372784 [debug] [ThreadPool]: On list_LB: Close
[0m18:51:55.486646 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m18:51:55.492707 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:51:55.492953 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:51:55.493131 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:55.905792 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.413 seconds
[0m18:51:55.909645 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:51:56.023106 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m18:51:56.025523 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:51:56.025846 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:51:56.026151 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:56.437265 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.411 seconds
[0m18:51:56.440529 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:51:56.554400 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m18:51:56.562368 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:51:56.562859 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:51:56.563135 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:51:56.985240 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.422 seconds
[0m18:51:56.987478 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:51:57.096703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89a044c7-fad1-4812-abdc-48988698f12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e9a9d10>]}
[0m18:51:57.098209 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:51:57.098716 [info ] [MainThread]: 
[0m18:51:57.102057 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:51:57.102794 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:51:57.103321 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m18:51:57.103629 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:51:57.112675 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:51:57.113998 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:51:57.122839 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:51:57.123412 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:51:57.124421 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:51:57.522450 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.398 seconds
[0m18:51:57.524709 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:51:57.525636 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:51:57.526088 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:51:57.603624 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.077 seconds
[0m18:51:57.625134 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:51:57.626347 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:51:57.626727 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:51:58.321587 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.694 seconds
[0m18:51:58.333049 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:51:58.439344 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89a044c7-fad1-4812-abdc-48988698f12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16accdc90>]}
[0m18:51:58.439972 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.34s]
[0m18:51:58.440281 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:51:58.440517 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:51:58.440956 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:51:58.441262 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:51:58.441470 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:51:58.444172 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:51:58.444889 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:51:58.454168 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:58.454559 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:51:58.454977 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:51:58.767628 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.313 seconds
[0m18:51:58.769192 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:51:58.769850 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:58.770118 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:51:58.849066 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.077 seconds
[0m18:51:58.879724 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:58.880454 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:51:59.137053 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.256 seconds
[0m18:51:59.146505 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:59.146968 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:51:59.226532 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.079 seconds
[0m18:51:59.228504 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:59.228681 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:51:59.282700 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.054 seconds
[0m18:51:59.287489 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:59.287722 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:51:59.342581 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.055 seconds
[0m18:51:59.371541 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:51:59.373037 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:59.373236 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:51:59.466447 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m18:51:59.466971 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:51:59.467276 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:52:00.063889 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.596 seconds
[0m18:52:00.064690 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:52:00.065028 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:52:00.473017 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.407 seconds
[0m18:52:00.484974 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:52:00.490414 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:52:00.490656 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:52:00.593271 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.102 seconds
[0m18:52:00.595559 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:52:00.698557 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89a044c7-fad1-4812-abdc-48988698f12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b05b390>]}
[0m18:52:00.699507 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.26s]
[0m18:52:00.700452 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:52:00.701777 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:52:00.702604 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:52:00.703306 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:52:00.703838 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:52:00.711267 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:52:00.712129 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:52:00.714819 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:52:00.715092 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:52:00.715247 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:52:01.104758 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.389 seconds
[0m18:52:01.107590 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:52:01.108527 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:52:01.108893 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:52:01.201417 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.092 seconds
[0m18:52:01.204470 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:52:01.204860 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        --or c.type != f.type
        --or c.energy != f.energy
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
        or c.enddate != f.enddate
        or p.productcode != f.productcode
        or p.productname != f.productname
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:52:01.912528 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e94-0202-cf69-0000-0002d4465c9d
[0m18:52:01.912947 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 61 at position 24
invalid identifier 'F.ENDDATE'
[0m18:52:01.913310 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:52:02.025039 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 61 at position 24
  invalid identifier 'F.ENDDATE'
[0m18:52:02.026496 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89a044c7-fad1-4812-abdc-48988698f12d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b7838d0>]}
[0m18:52:02.027806 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 1.32s]
[0m18:52:02.028649 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:52:02.031790 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:52:02.032249 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:52:02.032732 [info ] [MainThread]: 
[0m18:52:02.033108 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 7.11 seconds (7.11s).
[0m18:52:02.034131 [debug] [MainThread]: Command end result
[0m18:52:02.061382 [info ] [MainThread]: 
[0m18:52:02.061761 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:52:02.061920 [info ] [MainThread]: 
[0m18:52:02.062095 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  000904 (42000): SQL compilation error: error line 61 at position 24
  invalid identifier 'F.ENDDATE'
[0m18:52:02.062225 [info ] [MainThread]: 
[0m18:52:02.062365 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:52:02.064370 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.299928, "process_user_time": 2.935467, "process_kernel_time": 0.977724, "process_mem_max_rss": "197115904", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:52:02.064828 [debug] [MainThread]: Command `dbt run` failed at 18:52:02.064780 after 8.30 seconds
[0m18:52:02.065152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102906fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1288bd810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c081d0>]}
[0m18:52:02.065366 [debug] [MainThread]: Flushing usage events
[0m18:54:36.778674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c18a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c60c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c5acd0>]}


============================== 18:54:36.781244 | fdb55144-659d-45ae-af90-74e6067b6313 ==============================
[0m18:54:36.781244 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:54:36.781541 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:54:37.471754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fdb55144-659d-45ae-af90-74e6067b6313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c43050>]}
[0m18:54:37.490791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fdb55144-659d-45ae-af90-74e6067b6313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134400bd0>]}
[0m18:54:37.491421 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:54:37.502284 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:54:37.558376 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:54:37.558774 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:54:37.684999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fdb55144-659d-45ae-af90-74e6067b6313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13734c2d0>]}
[0m18:54:37.793882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fdb55144-659d-45ae-af90-74e6067b6313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142431b90>]}
[0m18:54:37.794175 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:54:37.794339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fdb55144-659d-45ae-af90-74e6067b6313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1425a00d0>]}
[0m18:54:37.795046 [info ] [MainThread]: 
[0m18:54:37.795289 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:54:37.797505 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:54:37.803389 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:54:37.803636 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:54:37.803786 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:54:38.260335 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.456 seconds
[0m18:54:38.263182 [debug] [ThreadPool]: On list_LB: Close
[0m18:54:38.369626 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m18:54:38.374958 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:54:38.375221 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:54:38.375369 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:54:38.843947 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.468 seconds
[0m18:54:38.846221 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:54:38.950297 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m18:54:38.952732 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:54:38.952921 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:54:38.953051 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:54:39.344028 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.391 seconds
[0m18:54:39.346194 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:54:39.449805 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m18:54:39.455073 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:54:39.455552 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:54:39.455781 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:54:39.787404 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.331 seconds
[0m18:54:39.790430 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:54:39.903652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fdb55144-659d-45ae-af90-74e6067b6313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1348e4ed0>]}
[0m18:54:39.904697 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:54:39.905248 [info ] [MainThread]: 
[0m18:54:39.908296 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:54:39.908926 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:54:39.909415 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m18:54:39.909758 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:54:39.917405 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:54:39.918451 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:54:39.924729 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:54:39.925032 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:54:39.925192 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:54:40.218513 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.293 seconds
[0m18:54:40.220300 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:54:40.221058 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:54:40.221417 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:54:40.299499 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.078 seconds
[0m18:54:40.317307 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:54:40.318040 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:54:40.318224 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:54:41.038870 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.720 seconds
[0m18:54:41.059682 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:54:41.163162 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdb55144-659d-45ae-af90-74e6067b6313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145382f10>]}
[0m18:54:41.164309 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.25s]
[0m18:54:41.165530 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:54:41.166351 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:54:41.167328 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:54:41.167812 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:54:41.168137 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:54:41.174701 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:54:41.176124 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:54:41.185046 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:54:41.185341 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:54:41.185499 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:54:41.479063 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.293 seconds
[0m18:54:41.481373 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:54:41.482283 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:54:41.482794 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:54:41.553161 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.070 seconds
[0m18:54:41.574045 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:54:41.574360 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:54:41.957616 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.383 seconds
[0m18:54:41.962835 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:54:41.963048 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:54:42.042385 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.079 seconds
[0m18:54:42.044506 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:54:42.044707 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:54:42.123294 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.078 seconds
[0m18:54:42.131966 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:54:42.132407 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:54:42.212677 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.080 seconds
[0m18:54:42.243245 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:54:42.244208 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:54:42.244384 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:54:42.347752 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.103 seconds
[0m18:54:42.348322 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:54:42.348741 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:54:42.881019 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.532 seconds
[0m18:54:42.881464 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:54:42.881707 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:54:43.188723 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.307 seconds
[0m18:54:43.198888 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:54:43.205053 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:54:43.205430 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:54:43.388164 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.182 seconds
[0m18:54:43.392327 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:54:43.496121 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdb55144-659d-45ae-af90-74e6067b6313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14244ea10>]}
[0m18:54:43.497514 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.33s]
[0m18:54:43.498515 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:54:43.500215 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:54:43.501082 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:54:43.501712 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:54:43.502138 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:54:43.507299 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:43.508314 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:54:43.509957 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:43.510280 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:54:43.510516 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:54:43.835170 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.324 seconds
[0m18:54:43.838542 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:54:43.839638 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:43.840250 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:54:43.932161 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.091 seconds
[0m18:54:43.938366 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:43.939170 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        --or c.type != f.type
        --or c.energy != f.energy
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:54:44.313901 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.374 seconds
[0m18:54:44.319554 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:44.320251 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m18:54:44.396848 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.076 seconds
[0m18:54:44.404732 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:44.405542 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m18:54:44.473684 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.067 seconds
[0m18:54:44.477054 [debug] [Thread-1 (]: Changing col type from character varying(50) to character varying(16777216) in table database: "LB"
schema: "dwh_mart"
identifier: "fact_contract"

[0m18:54:44.485550 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:44.486080 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter table LB.dwh_mart.fact_contract alter "PRODUCTCODE" set data type character varying(16777216);
[0m18:54:44.589820 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.103 seconds
[0m18:54:44.591621 [debug] [Thread-1 (]: Changing col type from character varying(100) to character varying(16777216) in table database: "LB"
schema: "dwh_mart"
identifier: "fact_contract"

[0m18:54:44.595777 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:44.596431 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter table LB.dwh_mart.fact_contract alter "PRODUCTNAME" set data type character varying(16777216);
[0m18:54:44.711208 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.114 seconds
[0m18:54:44.713366 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:44.713636 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m18:54:44.782445 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.069 seconds
[0m18:54:44.783760 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:44.784837 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:44.784993 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m18:54:44.873969 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.089 seconds
[0m18:54:44.874374 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:54:44.874679 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")

;
[0m18:54:45.550272 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e96-0202-cf6a-0000-0002d4467ca9
[0m18:54:45.550935 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100046 (22003): Number out of representable range: type FIXED[SB8](10,2){nullable}, value 195478564.00000
[0m18:54:45.551606 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:54:45.660760 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  100046 (22003): Number out of representable range: type FIXED[SB8](10,2){nullable}, value 195478564.00000
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_contract.sql
[0m18:54:45.661734 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fdb55144-659d-45ae-af90-74e6067b6313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1421a0850>]}
[0m18:54:45.662476 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 2.16s]
[0m18:54:45.663213 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:54:45.665726 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:54:45.666098 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:54:45.666575 [info ] [MainThread]: 
[0m18:54:45.666952 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 7.87 seconds (7.87s).
[0m18:54:45.667829 [debug] [MainThread]: Command end result
[0m18:54:45.705498 [info ] [MainThread]: 
[0m18:54:45.705861 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:54:45.706047 [info ] [MainThread]: 
[0m18:54:45.706492 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  100046 (22003): Number out of representable range: type FIXED[SB8](10,2){nullable}, value 195478564.00000
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_contract.sql
[0m18:54:45.706807 [info ] [MainThread]: 
[0m18:54:45.707167 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:54:45.711898 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.978253, "process_user_time": 2.247312, "process_kernel_time": 2.562654, "process_mem_max_rss": "193871872", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:54:45.713234 [debug] [MainThread]: Command `dbt run` failed at 18:54:45.713140 after 8.98 seconds
[0m18:54:45.714735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1026a6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c4c550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c0b5d0>]}
[0m18:54:45.714991 [debug] [MainThread]: Flushing usage events
[0m18:59:24.643016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15622f0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1562953d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156295a10>]}


============================== 18:59:24.645856 | c5c055cf-cd61-4d03-8c15-383fcf7bead1 ==============================
[0m18:59:24.645856 [info ] [MainThread]: Running with dbt=1.8.0
[0m18:59:24.646151 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:59:25.633359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c5c055cf-cd61-4d03-8c15-383fcf7bead1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae32910>]}
[0m18:59:25.658215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c5c055cf-cd61-4d03-8c15-383fcf7bead1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9fcad0>]}
[0m18:59:25.658927 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:59:25.672385 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m18:59:25.774284 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:59:25.774792 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m18:59:25.865669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c5c055cf-cd61-4d03-8c15-383fcf7bead1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b1eac10>]}
[0m18:59:25.978361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c5c055cf-cd61-4d03-8c15-383fcf7bead1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b144e90>]}
[0m18:59:25.978703 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m18:59:25.978875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5c055cf-cd61-4d03-8c15-383fcf7bead1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a8baf50>]}
[0m18:59:25.979734 [info ] [MainThread]: 
[0m18:59:25.980069 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:59:25.982620 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:59:25.989040 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:59:25.989305 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:59:25.989494 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:59:26.627441 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.638 seconds
[0m18:59:26.630451 [debug] [ThreadPool]: On list_LB: Close
[0m18:59:26.746260 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m18:59:26.757192 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m18:59:26.757661 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m18:59:26.757962 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:27.218545 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.460 seconds
[0m18:59:27.221894 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m18:59:27.326939 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m18:59:27.328617 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:59:27.328807 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:59:27.328938 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:27.695780 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.367 seconds
[0m18:59:27.698508 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:59:27.809616 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m18:59:27.816286 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m18:59:27.816720 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m18:59:27.816970 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:59:28.262883 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.446 seconds
[0m18:59:28.264886 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m18:59:28.378802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5c055cf-cd61-4d03-8c15-383fcf7bead1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11af8fd10>]}
[0m18:59:28.381895 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:59:28.387534 [info ] [MainThread]: 
[0m18:59:28.395840 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m18:59:28.397343 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m18:59:28.398526 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m18:59:28.399315 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m18:59:28.410729 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m18:59:28.411855 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m18:59:28.426833 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:59:28.427289 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m18:59:28.427530 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:59:28.829665 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.402 seconds
[0m18:59:28.831115 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m18:59:28.831706 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:59:28.831936 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m18:59:28.914452 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.082 seconds
[0m18:59:28.932071 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m18:59:28.933079 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m18:59:28.933270 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m18:59:29.605901 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.672 seconds
[0m18:59:29.633686 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m18:59:29.744944 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5c055cf-cd61-4d03-8c15-383fcf7bead1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b125c50>]}
[0m18:59:29.746309 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.35s]
[0m18:59:29.747008 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m18:59:29.747549 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m18:59:29.748238 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m18:59:29.748765 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m18:59:29.749100 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m18:59:29.753428 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m18:59:29.754668 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m18:59:29.769574 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:59:29.769998 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m18:59:29.770232 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:59:30.103145 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.333 seconds
[0m18:59:30.105428 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m18:59:30.106341 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:59:30.106737 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m18:59:30.190396 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.083 seconds
[0m18:59:30.216018 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:59:30.216563 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m18:59:30.681143 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.464 seconds
[0m18:59:30.694682 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:59:30.695285 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m18:59:30.777185 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.081 seconds
[0m18:59:30.784292 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:59:30.784864 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m18:59:30.863108 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.078 seconds
[0m18:59:30.877085 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:59:30.877731 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m18:59:30.942735 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.064 seconds
[0m18:59:30.978910 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m18:59:30.980112 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:59:30.980375 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m18:59:31.101096 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.120 seconds
[0m18:59:31.102082 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:59:31.102713 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m18:59:31.651675 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.548 seconds
[0m18:59:31.652401 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:59:31.652724 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m18:59:31.959649 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.306 seconds
[0m18:59:31.972251 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m18:59:31.977848 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m18:59:31.978082 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m18:59:32.117101 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.139 seconds
[0m18:59:32.119952 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m18:59:32.226648 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5c055cf-cd61-4d03-8c15-383fcf7bead1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ba4c310>]}
[0m18:59:32.227462 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.48s]
[0m18:59:32.228028 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m18:59:32.228773 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m18:59:32.229227 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m18:59:32.229596 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m18:59:32.230023 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m18:59:32.231955 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:59:32.232378 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m18:59:32.233426 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:59:32.233591 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m18:59:32.233742 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:59:32.586165 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.352 seconds
[0m18:59:32.592360 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m18:59:32.593651 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:59:32.594198 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m18:59:32.671275 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.077 seconds
[0m18:59:32.675126 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:59:32.675409 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m18:59:33.085647 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.410 seconds
[0m18:59:33.091495 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:59:33.092170 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m18:59:33.176014 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.083 seconds
[0m18:59:33.182216 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:59:33.182943 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m18:59:33.268999 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.085 seconds
[0m18:59:33.278506 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:59:33.279141 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m18:59:33.352569 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.072 seconds
[0m18:59:33.358101 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m18:59:33.361011 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:59:33.361480 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m18:59:33.454417 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.092 seconds
[0m18:59:33.455508 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m18:59:33.456148 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")

;
[0m18:59:34.114142 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58e9b-0202-cf68-0000-0002d4462ced
[0m18:59:34.114628 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100046 (22003): Number out of representable range: type FIXED[SB8](10,2){nullable}, value 195478564.00000
[0m18:59:34.115084 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m18:59:34.224130 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  100046 (22003): Number out of representable range: type FIXED[SB8](10,2){nullable}, value 195478564.00000
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_contract.sql
[0m18:59:34.225466 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5c055cf-cd61-4d03-8c15-383fcf7bead1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ffb65d0>]}
[0m18:59:34.226458 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 2.00s]
[0m18:59:34.227116 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m18:59:34.230025 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:59:34.230498 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m18:59:34.231000 [info ] [MainThread]: 
[0m18:59:34.231374 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 8.25 seconds (8.25s).
[0m18:59:34.232381 [debug] [MainThread]: Command end result
[0m18:59:34.271991 [info ] [MainThread]: 
[0m18:59:34.272302 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:59:34.272442 [info ] [MainThread]: 
[0m18:59:34.272630 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  100046 (22003): Number out of representable range: type FIXED[SB8](10,2){nullable}, value 195478564.00000
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_contract.sql
[0m18:59:34.272775 [info ] [MainThread]: 
[0m18:59:34.272939 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m18:59:34.275126 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 9.66449, "process_user_time": 2.749129, "process_kernel_time": 2.44098, "process_mem_max_rss": "191774720", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:59:34.275564 [debug] [MainThread]: Command `dbt run` failed at 18:59:34.275515 after 9.67 seconds
[0m18:59:34.275954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156295890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ba6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd59410>]}
[0m18:59:34.276175 [debug] [MainThread]: Flushing usage events
[0m19:03:27.167521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e4575d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e488810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e4bd750>]}


============================== 19:03:27.169807 | 793f7343-1d70-479c-9a52-9e7c7e070fdd ==============================
[0m19:03:27.169807 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:03:27.170085 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:03:27.832770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '793f7343-1d70-479c-9a52-9e7c7e070fdd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b136d50>]}
[0m19:03:27.853140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '793f7343-1d70-479c-9a52-9e7c7e070fdd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b600b90>]}
[0m19:03:27.853853 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:03:27.864379 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:03:27.930196 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:03:27.930574 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m19:03:28.016836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '793f7343-1d70-479c-9a52-9e7c7e070fdd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b40cd90>]}
[0m19:03:28.096380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '793f7343-1d70-479c-9a52-9e7c7e070fdd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b545e90>]}
[0m19:03:28.096645 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m19:03:28.096798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '793f7343-1d70-479c-9a52-9e7c7e070fdd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b56c5d0>]}
[0m19:03:28.097443 [info ] [MainThread]: 
[0m19:03:28.097675 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:03:28.099630 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m19:03:28.104857 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m19:03:28.105014 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m19:03:28.105132 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:03:28.705536 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.600 seconds
[0m19:03:28.708265 [debug] [ThreadPool]: On list_LB: Close
[0m19:03:28.836019 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m19:03:28.840382 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m19:03:28.840626 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m19:03:28.840765 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:03:29.298534 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.457 seconds
[0m19:03:29.310854 [debug] [ThreadPool]: On list_LB_stage: Close
[0m19:03:29.435917 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m19:03:29.442314 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m19:03:29.443018 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m19:03:29.443550 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:03:29.964907 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.521 seconds
[0m19:03:29.966417 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m19:03:30.074767 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m19:03:30.077755 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m19:03:30.077976 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m19:03:30.078149 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:03:30.483191 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.405 seconds
[0m19:03:30.485306 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m19:03:30.594300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '793f7343-1d70-479c-9a52-9e7c7e070fdd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e889d10>]}
[0m19:03:30.595302 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:03:30.595794 [info ] [MainThread]: 
[0m19:03:30.599094 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m19:03:30.599602 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m19:03:30.599876 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m19:03:30.600034 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m19:03:30.604442 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m19:03:30.605250 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m19:03:30.611530 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m19:03:30.611777 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m19:03:30.611934 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:03:31.026062 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.414 seconds
[0m19:03:31.028702 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m19:03:31.029403 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m19:03:31.029746 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m19:03:31.105711 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.075 seconds
[0m19:03:31.124714 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m19:03:31.128149 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m19:03:31.128356 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m19:03:31.833679 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.705 seconds
[0m19:03:31.861100 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m19:03:31.973381 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '793f7343-1d70-479c-9a52-9e7c7e070fdd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2a21d0>]}
[0m19:03:31.976334 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.37s]
[0m19:03:31.978194 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m19:03:31.978824 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m19:03:31.979427 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m19:03:31.979821 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m19:03:31.979991 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m19:03:31.987788 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m19:03:31.989302 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m19:03:32.007533 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:03:32.007878 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m19:03:32.008146 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:03:32.372580 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.364 seconds
[0m19:03:32.377689 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m19:03:32.378869 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:03:32.379193 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m19:03:32.453256 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.074 seconds
[0m19:03:32.475772 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:03:32.476200 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m19:03:32.785548 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.309 seconds
[0m19:03:32.797041 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:03:32.797527 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m19:03:32.869778 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.072 seconds
[0m19:03:32.876142 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:03:32.876653 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m19:03:32.987072 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.110 seconds
[0m19:03:32.998477 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:03:32.998963 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m19:03:33.091240 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.092 seconds
[0m19:03:33.122850 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m19:03:33.124390 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:03:33.124705 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m19:03:33.829005 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.704 seconds
[0m19:03:33.829868 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:03:33.830688 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m19:03:34.409033 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.578 seconds
[0m19:03:34.409675 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:03:34.410210 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m19:03:34.631734 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.221 seconds
[0m19:03:34.643997 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m19:03:34.649573 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:03:34.649825 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m19:03:34.748329 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m19:03:34.752109 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m19:03:34.879100 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '793f7343-1d70-479c-9a52-9e7c7e070fdd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b282b50>]}
[0m19:03:34.879892 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.90s]
[0m19:03:34.880679 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m19:03:34.882265 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m19:03:34.883169 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m19:03:34.883897 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m19:03:34.884429 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m19:03:34.889133 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:34.890189 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m19:03:34.892402 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:34.892626 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m19:03:34.892787 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:03:35.255474 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.362 seconds
[0m19:03:35.256986 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m19:03:35.257572 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:35.257777 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m19:03:35.365577 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.108 seconds
[0m19:03:35.371452 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:35.371793 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m19:03:35.777887 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.406 seconds
[0m19:03:35.784611 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:35.785225 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m19:03:35.867270 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.081 seconds
[0m19:03:35.875135 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:35.876101 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m19:03:35.972116 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.095 seconds
[0m19:03:35.979781 [debug] [Thread-1 (]: Changing col type from character varying(50) to character varying(16777216) in table database: "LB"
schema: "dwh_mart"
identifier: "fact_contract"

[0m19:03:35.987955 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:35.988641 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter table LB.dwh_mart.fact_contract alter "PRODUCTCODE" set data type character varying(16777216);
[0m19:03:36.082640 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m19:03:36.084177 [debug] [Thread-1 (]: Changing col type from character varying(100) to character varying(16777216) in table database: "LB"
schema: "dwh_mart"
identifier: "fact_contract"

[0m19:03:36.087509 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:36.087972 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter table LB.dwh_mart.fact_contract alter "PRODUCTNAME" set data type character varying(16777216);
[0m19:03:36.190515 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.102 seconds
[0m19:03:36.194638 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:36.195296 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m19:03:36.269372 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.074 seconds
[0m19:03:36.273843 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:36.276217 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:36.276918 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m19:03:36.358815 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.081 seconds
[0m19:03:36.359434 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:36.359896 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")

;
[0m19:03:37.417291 [debug] [Thread-1 (]: SQL status: SUCCESS 102848 in 1.057 seconds
[0m19:03:37.418548 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:37.419105 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m19:03:37.721343 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.301 seconds
[0m19:03:37.728860 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m19:03:37.730222 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:03:37.730750 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m19:03:37.849865 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.118 seconds
[0m19:03:37.854381 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m19:03:37.964875 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '793f7343-1d70-479c-9a52-9e7c7e070fdd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b85c210>]}
[0m19:03:37.966478 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 102848[0m in 3.08s]
[0m19:03:37.967733 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m19:03:37.970427 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:03:37.970939 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m19:03:37.971632 [info ] [MainThread]: 
[0m19:03:37.972138 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 9.87 seconds (9.87s).
[0m19:03:37.973324 [debug] [MainThread]: Command end result
[0m19:03:38.015637 [info ] [MainThread]: 
[0m19:03:38.015997 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:03:38.016171 [info ] [MainThread]: 
[0m19:03:38.016355 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m19:03:38.018383 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.880737, "process_user_time": 2.802719, "process_kernel_time": 1.755707, "process_mem_max_rss": "196116480", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:03:38.018865 [debug] [MainThread]: Command `dbt run` succeeded at 19:03:38.018814 after 10.88 seconds
[0m19:03:38.019184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e488510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e4963d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102dfd190>]}
[0m19:03:38.019358 [debug] [MainThread]: Flushing usage events
[0m19:20:47.454506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b3f0350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b95a950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b969ed0>]}


============================== 19:20:47.458701 | 905e2b0a-2fff-4283-9df9-cd5b67e7583d ==============================
[0m19:20:47.458701 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:20:47.459025 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:20:48.232613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '905e2b0a-2fff-4283-9df9-cd5b67e7583d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f3e4250>]}
[0m19:20:48.254116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '905e2b0a-2fff-4283-9df9-cd5b67e7583d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b100b50>]}
[0m19:20:48.254772 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:20:48.267714 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:20:48.350863 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:20:48.352210 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_products.sql
[0m19:20:48.629397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '905e2b0a-2fff-4283-9df9-cd5b67e7583d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140fc72d0>]}
[0m19:20:48.745783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '905e2b0a-2fff-4283-9df9-cd5b67e7583d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140cdcdd0>]}
[0m19:20:48.746171 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m19:20:48.746358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '905e2b0a-2fff-4283-9df9-cd5b67e7583d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140ec6590>]}
[0m19:20:48.747298 [info ] [MainThread]: 
[0m19:20:48.748025 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:20:48.750761 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m19:20:48.760790 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m19:20:48.761104 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m19:20:48.761259 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:20:49.274851 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.514 seconds
[0m19:20:49.276372 [debug] [ThreadPool]: On list_LB: Close
[0m19:20:49.383757 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m19:20:49.394852 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m19:20:49.395146 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m19:20:49.395297 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:20:49.825807 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.428 seconds
[0m19:20:49.832708 [debug] [ThreadPool]: On list_LB_stage: Close
[0m19:20:49.939939 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m19:20:49.941881 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m19:20:49.942040 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m19:20:49.942168 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:20:50.389055 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.447 seconds
[0m19:20:50.391143 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m19:20:50.511352 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m19:20:50.516806 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m19:20:50.517303 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m19:20:50.517664 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:20:52.903418 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 2.385 seconds
[0m19:20:52.907907 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m19:20:53.016596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '905e2b0a-2fff-4283-9df9-cd5b67e7583d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141133cd0>]}
[0m19:20:53.019655 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:20:53.020405 [info ] [MainThread]: 
[0m19:20:53.024441 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m19:20:53.025296 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m19:20:53.025841 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m19:20:53.026243 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m19:20:53.031533 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m19:20:53.032463 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m19:20:53.040027 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m19:20:53.040290 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m19:20:53.040443 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:53.652874 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.612 seconds
[0m19:20:53.658224 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m19:20:53.662471 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m19:20:53.663041 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m19:20:53.738524 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.075 seconds
[0m19:20:53.760057 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m19:20:53.761074 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m19:20:53.761457 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m19:20:54.746415 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.984 seconds
[0m19:20:54.777556 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m19:20:54.886324 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '905e2b0a-2fff-4283-9df9-cd5b67e7583d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14105f110>]}
[0m19:20:54.887994 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.86s]
[0m19:20:54.888548 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m19:20:54.888956 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m19:20:54.889572 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m19:20:54.889874 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m19:20:54.890103 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m19:20:54.895859 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m19:20:54.897225 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m19:20:54.912841 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:20:54.913351 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m19:20:54.913804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:55.408610 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.494 seconds
[0m19:20:55.413764 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m19:20:55.415511 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:20:55.415933 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m19:20:55.496156 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.080 seconds
[0m19:20:55.518171 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:20:55.518556 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m19:20:55.975485 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.456 seconds
[0m19:20:55.989566 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:20:55.990072 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m19:20:56.064476 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.074 seconds
[0m19:20:56.070395 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:20:56.070891 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m19:20:56.141489 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.070 seconds
[0m19:20:56.154611 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:20:56.155249 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m19:20:56.534142 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.378 seconds
[0m19:20:56.554454 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m19:20:56.555662 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:20:56.555843 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m19:20:56.652997 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.097 seconds
[0m19:20:56.653412 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:20:56.653762 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m19:20:58.125690 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 1.471 seconds
[0m19:20:58.127020 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:20:58.127718 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m19:20:58.444051 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.316 seconds
[0m19:20:58.457642 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m19:20:58.462908 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:20:58.463192 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m19:20:58.590999 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.127 seconds
[0m19:20:58.594441 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m19:20:58.696995 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '905e2b0a-2fff-4283-9df9-cd5b67e7583d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1415c0c50>]}
[0m19:20:58.698558 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 3.81s]
[0m19:20:58.699668 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m19:20:58.701217 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m19:20:58.701918 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m19:20:58.702588 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m19:20:58.703011 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m19:20:58.708579 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m19:20:58.710082 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m19:20:58.712482 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:20:58.712861 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m19:20:58.713205 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:20:59.076234 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.363 seconds
[0m19:20:59.079143 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m19:20:59.080304 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:20:59.080902 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m19:20:59.166110 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m19:20:59.172961 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:20:59.173776 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m19:20:59.558608 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.384 seconds
[0m19:20:59.564265 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:20:59.564868 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m19:20:59.636874 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.071 seconds
[0m19:20:59.643800 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:20:59.644450 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m19:20:59.711371 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.066 seconds
[0m19:20:59.716097 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:20:59.716560 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m19:20:59.781145 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.064 seconds
[0m19:20:59.783707 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m19:20:59.785361 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:20:59.785615 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m19:20:59.879896 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.094 seconds
[0m19:20:59.880839 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:20:59.881400 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")

;
[0m19:21:00.895566 [debug] [Thread-1 (]: SQL status: SUCCESS 102848 in 1.012 seconds
[0m19:21:00.898142 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:21:00.898576 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m19:21:01.132908 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.234 seconds
[0m19:21:01.136364 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m19:21:01.136739 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m19:21:01.136883 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m19:21:01.297468 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.160 seconds
[0m19:21:01.304489 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m19:21:01.407388 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '905e2b0a-2fff-4283-9df9-cd5b67e7583d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140f4e710>]}
[0m19:21:01.408049 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 102848[0m in 2.70s]
[0m19:21:01.408451 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m19:21:01.409619 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:21:01.409760 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m19:21:01.409982 [info ] [MainThread]: 
[0m19:21:01.410125 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 12.66 seconds (12.66s).
[0m19:21:01.410566 [debug] [MainThread]: Command end result
[0m19:21:01.442204 [info ] [MainThread]: 
[0m19:21:01.442738 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:21:01.442946 [info ] [MainThread]: 
[0m19:21:01.443496 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m19:21:01.447237 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 14.107221, "process_user_time": 2.632437, "process_kernel_time": 2.560041, "process_mem_max_rss": "188563456", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:21:01.448024 [debug] [MainThread]: Command `dbt run` succeeded at 19:21:01.447960 after 14.11 seconds
[0m19:21:01.448792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1009f4810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1008fafd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100974390>]}
[0m19:21:01.449349 [debug] [MainThread]: Flushing usage events
[0m19:21:06.162079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145f5b090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145fbcdd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145fbd450>]}


============================== 19:21:06.164510 | 2436f935-0ce8-4210-8eb2-9fa5d68e9be0 ==============================
[0m19:21:06.164510 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:21:06.164778 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:21:06.703864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2436f935-0ce8-4210-8eb2-9fa5d68e9be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153408750>]}
[0m19:21:06.721975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2436f935-0ce8-4210-8eb2-9fa5d68e9be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145a008d0>]}
[0m19:21:06.722412 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:21:06.732996 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:21:06.817905 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:21:06.818276 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:21:06.837096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2436f935-0ce8-4210-8eb2-9fa5d68e9be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1534d63d0>]}
[0m19:21:07.089950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2436f935-0ce8-4210-8eb2-9fa5d68e9be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1534360d0>]}
[0m19:21:07.090942 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m19:21:07.092033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2436f935-0ce8-4210-8eb2-9fa5d68e9be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15348e490>]}
[0m19:21:07.096712 [info ] [MainThread]: 
[0m19:21:07.098073 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:21:07.107703 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m19:21:07.134842 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m19:21:07.135485 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m19:21:07.135902 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:21:07.706923 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.571 seconds
[0m19:21:07.710438 [debug] [ThreadPool]: On list_LB: Close
[0m19:21:07.827265 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m19:21:07.838852 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m19:21:07.839355 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m19:21:07.839678 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:21:08.286702 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.447 seconds
[0m19:21:08.290541 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m19:21:08.406953 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m19:21:08.414907 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m19:21:08.415402 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m19:21:08.415676 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:21:08.871009 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.455 seconds
[0m19:21:08.874164 [debug] [ThreadPool]: On list_LB_stage: Close
[0m19:21:08.982271 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m19:21:08.987513 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m19:21:08.988125 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m19:21:08.988556 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:21:09.343944 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.355 seconds
[0m19:21:09.347321 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m19:21:09.453113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2436f935-0ce8-4210-8eb2-9fa5d68e9be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145fe4110>]}
[0m19:21:09.453916 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m19:21:09.454480 [info ] [MainThread]: 
[0m19:21:09.458566 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m19:21:09.459455 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m19:21:09.460123 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m19:21:09.460681 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m19:21:09.469343 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m19:21:09.470458 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m19:21:09.481250 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m19:21:09.481987 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m19:21:09.482523 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:21:09.958524 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.475 seconds
[0m19:21:09.961620 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m19:21:09.962893 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m19:21:09.963491 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m19:21:10.052742 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.089 seconds
[0m19:21:10.071881 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m19:21:10.072852 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m19:21:10.073062 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m19:21:10.926600 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.853 seconds
[0m19:21:10.954548 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m19:21:11.064646 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2436f935-0ce8-4210-8eb2-9fa5d68e9be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d18d50>]}
[0m19:21:11.066409 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.60s]
[0m19:21:11.067490 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m19:21:11.068193 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m19:21:11.069079 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m19:21:11.069766 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m19:21:11.070166 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m19:21:11.075832 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m19:21:11.076795 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m19:21:11.093598 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:21:11.093892 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m19:21:11.094243 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:21:11.513620 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.419 seconds
[0m19:21:11.514587 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m19:21:11.515010 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:21:11.515185 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m19:21:11.617520 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.102 seconds
[0m19:21:11.643500 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:21:11.644058 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.productcode != current_records.productcode
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then CURRENT_TIMESTAMP
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        CURRENT_TIMESTAMP as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m19:21:12.050884 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.406 seconds
[0m19:21:12.064819 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:21:12.065390 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m19:21:12.182714 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.117 seconds
[0m19:21:12.190400 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:21:12.190977 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m19:21:12.256043 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.064 seconds
[0m19:21:12.269481 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:21:12.270219 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m19:21:12.336419 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.066 seconds
[0m19:21:12.362794 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m19:21:12.363958 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:21:12.364145 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m19:21:12.454333 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.090 seconds
[0m19:21:12.454818 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m19:21:12.455186 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "IS_CURRENT", "VALID_FROM", "VALID_TO")

;
[0m19:21:13.181409 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58eb1-0202-cf54-0000-0002d4464cb1
[0m19:21:13.181809 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m19:21:13.182138 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m19:21:13.799848 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m19:21:13.800569 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2436f935-0ce8-4210-8eb2-9fa5d68e9be0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1532b9810>]}
[0m19:21:13.801176 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 2.73s]
[0m19:21:13.801680 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m19:21:13.803472 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m19:21:13.803930 [info ] [Thread-1 (]: 3 of 3 SKIP relation dwh_mart.fact_contract .................................... [[33mSKIP[0m]
[0m19:21:13.804336 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m19:21:13.805300 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:21:13.805600 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m19:21:13.805925 [info ] [MainThread]: 
[0m19:21:13.806208 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.71 seconds (6.71s).
[0m19:21:13.806944 [debug] [MainThread]: Command end result
[0m19:21:13.828955 [info ] [MainThread]: 
[0m19:21:13.829355 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m19:21:13.829487 [info ] [MainThread]: 
[0m19:21:13.829801 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/dim_product.sql
[0m19:21:13.830004 [info ] [MainThread]: 
[0m19:21:13.830290 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
[0m19:21:13.834653 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.7009478, "process_user_time": 2.569632, "process_kernel_time": 1.254568, "process_mem_max_rss": "187351040", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:21:13.835957 [debug] [MainThread]: Command `dbt run` failed at 19:21:13.835693 after 7.70 seconds
[0m19:21:13.836463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104276cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145f9cb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145f9ff50>]}
[0m19:21:13.836679 [debug] [MainThread]: Flushing usage events
[0m19:22:16.868992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cb1b1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cb4c450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cb81b10>]}


============================== 19:22:16.873061 | ceeb824b-72ce-4ee6-acc5-ef13b0b4bcc5 ==============================
[0m19:22:16.873061 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:22:16.873357 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:22:17.711131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ceeb824b-72ce-4ee6-acc5-ef13b0b4bcc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f878c90>]}
[0m19:22:17.731817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ceeb824b-72ce-4ee6-acc5-ef13b0b4bcc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c773190>]}
[0m19:22:17.732574 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:22:17.752194 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:22:17.812484 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:22:17.812864 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_products.sql
[0m19:22:17.971597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ceeb824b-72ce-4ee6-acc5-ef13b0b4bcc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cafffd0>]}
[0m19:22:18.012373 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:22:18.014777 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:22:18.016282 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1802977, "process_user_time": 2.135191, "process_kernel_time": 2.001584, "process_mem_max_rss": "183681024", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:22:18.016519 [debug] [MainThread]: Command `dbt run` failed at 19:22:18.016475 after 1.18 seconds
[0m19:22:18.016679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10243ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cb60810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148b41b10>]}
[0m19:22:18.016826 [debug] [MainThread]: Flushing usage events
[0m19:26:05.794639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117e1f450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117e81150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117e817d0>]}


============================== 19:26:05.797084 | ac708cff-17c1-4b72-9c42-1d9e9ac806ad ==============================
[0m19:26:05.797084 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:26:05.797359 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:26:06.558921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac708cff-17c1-4b72-9c42-1d9e9ac806ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168809250>]}
[0m19:26:06.577446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ac708cff-17c1-4b72-9c42-1d9e9ac806ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117700b90>]}
[0m19:26:06.577928 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:26:06.592439 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:26:06.654518 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:26:06.654799 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:26:06.674472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac708cff-17c1-4b72-9c42-1d9e9ac806ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117e4c7d0>]}
[0m19:26:06.725058 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:26:06.728492 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:26:06.730857 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.9668486, "process_user_time": 1.854351, "process_kernel_time": 1.699576, "process_mem_max_rss": "186499072", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:26:06.731285 [debug] [MainThread]: Command `dbt run` failed at 19:26:06.731220 after 0.97 seconds
[0m19:26:06.731719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100356cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117e816d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1689e2f50>]}
[0m19:26:06.731909 [debug] [MainThread]: Flushing usage events
[0m19:27:01.531150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eb57350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eb97b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ebbdc90>]}


============================== 19:27:01.535451 | cf5426d4-1617-4848-9f0b-9f3388e1810f ==============================
[0m19:27:01.535451 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:27:01.536401 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:27:02.352708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cf5426d4-1617-4848-9f0b-9f3388e1810f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aca6dd0>]}
[0m19:27:02.372272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cf5426d4-1617-4848-9f0b-9f3388e1810f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f4fca50>]}
[0m19:27:02.373078 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:27:02.386574 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:27:02.451178 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:27:02.451592 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m19:27:02.546508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cf5426d4-1617-4848-9f0b-9f3388e1810f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16af018d0>]}
[0m19:27:02.648299 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:27:02.651212 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:27:02.653975 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1745269, "process_user_time": 2.186589, "process_kernel_time": 1.916833, "process_mem_max_rss": "185958400", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:27:02.654307 [debug] [MainThread]: Command `dbt run` failed at 19:27:02.654257 after 1.17 seconds
[0m19:27:02.654503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10297ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029f81d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16af24090>]}
[0m19:27:02.654676 [debug] [MainThread]: Flushing usage events
[0m19:28:28.105557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c21bf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bf30110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bb00650>]}


============================== 19:28:28.108280 | f398d398-fa99-4df3-a451-f923526c0978 ==============================
[0m19:28:28.108280 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:28:28.108619 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m19:28:28.738541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f398d398-fa99-4df3-a451-f923526c0978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168e09950>]}
[0m19:28:28.758226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f398d398-fa99-4df3-a451-f923526c0978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b900b90>]}
[0m19:28:28.758911 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:28:28.768949 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:28:28.821672 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:28:28.821977 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m19:28:28.908325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f398d398-fa99-4df3-a451-f923526c0978', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1692cf550>]}
[0m19:28:28.992423 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:28:28.994427 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:28:28.995929 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.92464244, "process_user_time": 1.634378, "process_kernel_time": 2.418702, "process_mem_max_rss": "188121088", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:28:28.996174 [debug] [MainThread]: Command `dbt run` failed at 19:28:28.996133 after 0.92 seconds
[0m19:28:28.996340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a2acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100aa41d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169133190>]}
[0m19:28:28.996503 [debug] [MainThread]: Flushing usage events
[0m19:29:26.996856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16845ab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1684b8f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1684b9610>]}


============================== 19:29:27.000879 | b9ed32a3-1374-4bce-bf93-81e8c31b88e5 ==============================
[0m19:29:27.000879 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:29:27.001418 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m19:29:27.724472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b9ed32a3-1374-4bce-bf93-81e8c31b88e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1684b91d0>]}
[0m19:29:27.745261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b9ed32a3-1374-4bce-bf93-81e8c31b88e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fd00d50>]}
[0m19:29:27.745878 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:29:27.762867 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:29:27.849221 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:29:27.850069 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m19:29:27.955076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b9ed32a3-1374-4bce-bf93-81e8c31b88e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x170e003d0>]}
[0m19:29:28.054632 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:29:28.057514 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:29:28.061199 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.100969, "process_user_time": 1.738528, "process_kernel_time": 2.17162, "process_mem_max_rss": "185384960", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:29:28.061703 [debug] [MainThread]: Command `dbt run` failed at 19:29:28.061651 after 1.10 seconds
[0m19:29:28.061988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ebecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x171037b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168447950>]}
[0m19:29:28.062270 [debug] [MainThread]: Flushing usage events
[0m19:29:42.605426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cb19790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cb7d210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cb7d850>]}


============================== 19:29:42.607738 | d5861af5-d730-4718-99c7-2c4bce873d96 ==============================
[0m19:29:42.607738 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:29:42.608005 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m19:29:43.191498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd5861af5-d730-4718-99c7-2c4bce873d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13da36c90>]}
[0m19:29:43.210222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd5861af5-d730-4718-99c7-2c4bce873d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c300b50>]}
[0m19:29:43.210847 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:29:43.221307 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:29:43.306609 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:29:43.307305 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m19:29:43.400491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd5861af5-d730-4718-99c7-2c4bce873d96', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dd792d0>]}
[0m19:29:43.478267 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:29:43.480278 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:29:43.481789 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.90831846, "process_user_time": 1.804608, "process_kernel_time": 2.042386, "process_mem_max_rss": "192659456", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:29:43.482053 [debug] [MainThread]: Command `dbt run` failed at 19:29:43.482014 after 0.91 seconds
[0m19:29:43.482216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f66cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13db94350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cb07790>]}
[0m19:29:43.482368 [debug] [MainThread]: Flushing usage events
[0m19:51:11.465915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c1ff90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c81210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c81850>]}


============================== 19:51:11.469593 | 10d8f731-cfef-47f5-baa9-0a6db1b0345e ==============================
[0m19:51:11.469593 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:51:11.470193 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:51:12.412276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '10d8f731-cfef-47f5-baa9-0a6db1b0345e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1686d6890>]}
[0m19:51:12.431889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '10d8f731-cfef-47f5-baa9-0a6db1b0345e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127400bd0>]}
[0m19:51:12.432571 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:51:12.448281 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:51:12.564988 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:51:12.565452 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m19:51:12.675237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '10d8f731-cfef-47f5-baa9-0a6db1b0345e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16895c610>]}
[0m19:51:12.797021 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:51:12.799753 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:51:12.801585 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3797933, "process_user_time": 2.602553, "process_kernel_time": 1.213787, "process_mem_max_rss": "183664640", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:51:12.801863 [debug] [MainThread]: Command `dbt run` failed at 19:51:12.801818 after 1.38 seconds
[0m19:51:12.802042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1009becd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c0b890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c0b710>]}
[0m19:51:12.802205 [debug] [MainThread]: Flushing usage events
[0m19:51:46.975908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc57850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9f4110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc97b90>]}


============================== 19:51:46.979014 | 33ff6393-8634-4658-b4a8-6c661ad487c9 ==============================
[0m19:51:46.979014 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:51:47.055739 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m19:51:47.709486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '33ff6393-8634-4658-b4a8-6c661ad487c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x2819cc0d0>]}
[0m19:51:47.727630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '33ff6393-8634-4658-b4a8-6c661ad487c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b700b90>]}
[0m19:51:47.728117 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:51:47.738191 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:51:47.794515 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:51:47.794845 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m19:51:47.878579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '33ff6393-8634-4658-b4a8-6c661ad487c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x281ea9510>]}
[0m19:51:47.951396 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:51:47.953308 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:51:47.954778 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0306176, "process_user_time": 1.658141, "process_kernel_time": 2.359643, "process_mem_max_rss": "191987712", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:51:47.955005 [debug] [MainThread]: Command `dbt run` failed at 19:51:47.954967 after 1.03 seconds
[0m19:51:47.955153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10060ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100688250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9f4210>]}
[0m19:51:47.955291 [debug] [MainThread]: Flushing usage events
[0m19:53:54.814829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd1ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd7d050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd5acd0>]}


============================== 19:53:54.817222 | d3f1ffd1-7e76-4e90-a207-a00f3d74650c ==============================
[0m19:53:54.817222 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:53:54.817500 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:53:55.587605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd3f1ffd1-7e76-4e90-a207-a00f3d74650c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1253b4890>]}
[0m19:53:55.610014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd3f1ffd1-7e76-4e90-a207-a00f3d74650c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1254d95d0>]}
[0m19:53:55.610702 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:53:55.624703 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:53:55.710551 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:53:55.710930 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m19:53:55.805301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd3f1ffd1-7e76-4e90-a207-a00f3d74650c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1254fced0>]}
[0m19:53:55.897919 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:53:55.901024 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:53:55.903531 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1222152, "process_user_time": 1.867262, "process_kernel_time": 2.334043, "process_mem_max_rss": "190447616", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:53:55.903877 [debug] [MainThread]: Command `dbt run` failed at 19:53:55.903818 after 1.12 seconds
[0m19:53:55.904094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10072ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1007a81d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125583b90>]}
[0m19:53:55.904300 [debug] [MainThread]: Flushing usage events
[0m19:55:30.217053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c57790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c56e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121cbdf10>]}


============================== 19:55:30.222265 | fc357190-dbcb-4deb-8938-8d1864f0e9da ==============================
[0m19:55:30.222265 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:55:30.222645 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:55:31.232816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fc357190-dbcb-4deb-8938-8d1864f0e9da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141636e50>]}
[0m19:55:31.252103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fc357190-dbcb-4deb-8938-8d1864f0e9da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1215fcad0>]}
[0m19:55:31.252696 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:55:31.262707 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:55:31.318434 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:55:31.318756 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m19:55:31.406527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fc357190-dbcb-4deb-8938-8d1864f0e9da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141acf850>]}
[0m19:55:31.486554 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:55:31.489139 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:55:31.491117 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4013889, "process_user_time": 2.649968, "process_kernel_time": 1.653556, "process_mem_max_rss": "187154432", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:55:31.491407 [debug] [MainThread]: Command `dbt run` failed at 19:55:31.491361 after 1.40 seconds
[0m19:55:31.491587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10492ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c47a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c47590>]}
[0m19:55:31.491752 [debug] [MainThread]: Flushing usage events
[0m19:56:48.740139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136a59610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136a81110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136a81790>]}


============================== 19:56:48.743336 | d1650ac1-e158-43da-b75b-7409a8bf1d26 ==============================
[0m19:56:48.743336 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:56:48.743650 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:56:49.382175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd1650ac1-e158-43da-b75b-7409a8bf1d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1436ad190>]}
[0m19:56:49.400400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd1650ac1-e158-43da-b75b-7409a8bf1d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136200ad0>]}
[0m19:56:49.400890 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:56:49.411595 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:56:49.466237 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:56:49.466577 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m19:56:49.549863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd1650ac1-e158-43da-b75b-7409a8bf1d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143709f90>]}
[0m19:56:49.623266 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:56:49.625507 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:56:49.626660 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.92423725, "process_user_time": 1.545436, "process_kernel_time": 2.49961, "process_mem_max_rss": "195395584", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:56:49.626872 [debug] [MainThread]: Command `dbt run` failed at 19:56:49.626837 after 0.92 seconds
[0m19:56:49.627022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136a81110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043defd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136a5b210>]}
[0m19:56:49.627173 [debug] [MainThread]: Flushing usage events
[0m19:57:16.253652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14435b590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144381090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144381710>]}


============================== 19:57:16.256500 | bff7c3a4-f59e-4582-b64e-adb2dc20d8c6 ==============================
[0m19:57:16.256500 [info ] [MainThread]: Running with dbt=1.8.0
[0m19:57:16.256801 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --models mart', 'send_anonymous_usage_stats': 'True'}
[0m19:57:16.945806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bff7c3a4-f59e-4582-b64e-adb2dc20d8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168f40410>]}
[0m19:57:16.972503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bff7c3a4-f59e-4582-b64e-adb2dc20d8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1439fca50>]}
[0m19:57:16.973269 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m19:57:17.005339 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m19:57:17.095998 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:57:17.096352 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m19:57:17.197072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bff7c3a4-f59e-4582-b64e-adb2dc20d8c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16955d590>]}
[0m19:57:17.285570 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.stg_products
[0m19:57:17.287627 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.stg_products

[0m19:57:17.289101 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0797776, "process_user_time": 1.813579, "process_kernel_time": 2.027817, "process_mem_max_rss": "183795712", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:57:17.289331 [debug] [MainThread]: Command `dbt run` failed at 19:57:17.289292 after 1.08 seconds
[0m19:57:17.289500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100b46cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14430b710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14430b610>]}
[0m19:57:17.289659 [debug] [MainThread]: Flushing usage events
[0m20:02:01.327143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146557450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1465bd890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1465bdf10>]}


============================== 20:02:01.330332 | 3eab936a-a47a-45c4-b2f3-aabe2fcc2da6 ==============================
[0m20:02:01.330332 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:02:01.330668 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:02:02.139112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3eab936a-a47a-45c4-b2f3-aabe2fcc2da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14657b590>]}
[0m20:02:02.158659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3eab936a-a47a-45c4-b2f3-aabe2fcc2da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146000c50>]}
[0m20:02:02.159362 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:02:02.172411 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:02:02.249650 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m20:02:02.249990 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m20:02:02.250168 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_products.sql
[0m20:02:02.401873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3eab936a-a47a-45c4-b2f3-aabe2fcc2da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16100b050>]}
[0m20:02:02.443726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3eab936a-a47a-45c4-b2f3-aabe2fcc2da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x166303910>]}
[0m20:02:02.443994 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m20:02:02.444146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3eab936a-a47a-45c4-b2f3-aabe2fcc2da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14655cfd0>]}
[0m20:02:02.444811 [info ] [MainThread]: 
[0m20:02:02.445037 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:02:02.446753 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:02:02.452098 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:02:02.452270 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:02:02.452387 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:02:02.961411 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.509 seconds
[0m20:02:02.963551 [debug] [ThreadPool]: On list_LB: Close
[0m20:02:03.139192 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m20:02:03.148570 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m20:02:03.149031 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m20:02:03.149295 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:02:03.954922 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.806 seconds
[0m20:02:03.956018 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m20:02:04.071056 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m20:02:04.072704 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:02:04.072888 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:02:04.073017 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:02:04.648231 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.575 seconds
[0m20:02:04.651858 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:02:04.760384 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m20:02:04.764668 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m20:02:04.765194 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m20:02:04.765470 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:02:05.184706 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.419 seconds
[0m20:02:05.187821 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m20:02:05.301002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3eab936a-a47a-45c4-b2f3-aabe2fcc2da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1664bfb10>]}
[0m20:02:05.301948 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:02:05.302346 [info ] [MainThread]: 
[0m20:02:05.305106 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:02:05.305470 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m20:02:05.305729 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m20:02:05.305880 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:02:05.309843 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:02:05.310653 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:02:05.322411 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:02:05.322732 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m20:02:05.322890 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:02:06.001162 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.677 seconds
[0m20:02:06.005447 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m20:02:06.007165 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:02:06.007627 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m20:02:06.124237 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.116 seconds
[0m20:02:06.145974 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:02:06.147501 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:02:06.147809 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m20:02:07.186139 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.037 seconds
[0m20:02:07.223125 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:02:07.336964 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3eab936a-a47a-45c4-b2f3-aabe2fcc2da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1664415d0>]}
[0m20:02:07.338295 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 2.03s]
[0m20:02:07.343689 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:02:07.345037 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:02:07.345863 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m20:02:07.347279 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m20:02:07.347471 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:02:07.354863 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:02:07.355843 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:02:07.364671 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:02:07.365065 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m20:02:07.365300 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:02:07.716317 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.351 seconds
[0m20:02:07.717080 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m20:02:07.717369 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:02:07.717537 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m20:02:08.044568 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.327 seconds
[0m20:02:08.067436 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:02:08.067828 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.id is null
    or (
        src.id != current_records.product_id
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m20:02:08.323129 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58eda-0202-cf69-0000-0002d4465d99
[0m20:02:08.323875 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 29 at position 10
invalid identifier 'CURRENT_RECORDS.ID'
[0m20:02:08.324696 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:02:08.461596 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  000904 (42000): SQL compilation error: error line 29 at position 10
  invalid identifier 'CURRENT_RECORDS.ID'
[0m20:02:08.461996 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3eab936a-a47a-45c4-b2f3-aabe2fcc2da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1664571d0>]}
[0m20:02:08.462340 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 1.11s]
[0m20:02:08.462606 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:02:08.463617 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m20:02:08.463853 [info ] [Thread-1 (]: 3 of 3 SKIP relation dwh_mart.fact_contract .................................... [[33mSKIP[0m]
[0m20:02:08.464020 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m20:02:08.464618 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:02:08.464771 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m20:02:08.464976 [info ] [MainThread]: 
[0m20:02:08.465121 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 6.02 seconds (6.02s).
[0m20:02:08.465481 [debug] [MainThread]: Command end result
[0m20:02:08.481070 [info ] [MainThread]: 
[0m20:02:08.481316 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:02:08.481440 [info ] [MainThread]: 
[0m20:02:08.481595 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  000904 (42000): SQL compilation error: error line 29 at position 10
  invalid identifier 'CURRENT_RECORDS.ID'
[0m20:02:08.481716 [info ] [MainThread]: 
[0m20:02:08.481849 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
[0m20:02:08.483492 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.192979, "process_user_time": 2.251771, "process_kernel_time": 1.83064, "process_mem_max_rss": "193626112", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:02:08.483782 [debug] [MainThread]: Command `dbt run` failed at 20:02:08.483747 after 7.19 seconds
[0m20:02:08.484037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ffecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1465be290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146547890>]}
[0m20:02:08.484188 [debug] [MainThread]: Flushing usage events
[0m20:02:28.186371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13075bc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1307bd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1307bd950>]}


============================== 20:02:28.188931 | 7ed54607-53a3-43d7-8130-899b07c77fd4 ==============================
[0m20:02:28.188931 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:02:28.189224 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:02:28.813405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7ed54607-53a3-43d7-8130-899b07c77fd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b143b10>]}
[0m20:02:28.832487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7ed54607-53a3-43d7-8130-899b07c77fd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1300fc9d0>]}
[0m20:02:28.833112 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:02:28.844430 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:02:28.904601 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:02:28.905029 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m20:02:29.000890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7ed54607-53a3-43d7-8130-899b07c77fd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2225d0>]}
[0m20:02:29.090262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7ed54607-53a3-43d7-8130-899b07c77fd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1300ebdd0>]}
[0m20:02:29.090541 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m20:02:29.090697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ed54607-53a3-43d7-8130-899b07c77fd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2c4b90>]}
[0m20:02:29.091379 [info ] [MainThread]: 
[0m20:02:29.091613 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:02:29.093712 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:02:29.099453 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:02:29.099703 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:02:29.099834 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:02:29.604006 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.504 seconds
[0m20:02:29.605154 [debug] [ThreadPool]: On list_LB: Close
[0m20:02:29.711217 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:02:29.722393 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:02:29.722814 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:02:29.723082 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:02:30.175414 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.452 seconds
[0m20:02:30.177477 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:02:30.296900 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m20:02:30.300332 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m20:02:30.300705 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m20:02:30.300978 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:02:30.675435 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.374 seconds
[0m20:02:30.679300 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m20:02:30.801344 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m20:02:30.810014 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m20:02:30.810683 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m20:02:30.811089 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:02:31.213391 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.402 seconds
[0m20:02:31.216849 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m20:02:31.335067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ed54607-53a3-43d7-8130-899b07c77fd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130134a10>]}
[0m20:02:31.336517 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:02:31.337143 [info ] [MainThread]: 
[0m20:02:31.340894 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:02:31.341782 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m20:02:31.342591 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m20:02:31.343140 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:02:31.350594 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:02:31.351409 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:02:31.361300 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:02:31.361656 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m20:02:31.361831 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:02:31.679698 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.318 seconds
[0m20:02:31.682177 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m20:02:31.683199 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:02:31.683654 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m20:02:31.770882 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.087 seconds
[0m20:02:31.781942 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:02:31.782796 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:02:31.782978 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m20:02:32.729591 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.946 seconds
[0m20:02:32.757942 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:02:32.863928 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed54607-53a3-43d7-8130-899b07c77fd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b7f6f10>]}
[0m20:02:32.865714 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.52s]
[0m20:02:32.866699 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:02:32.867352 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:02:32.868170 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m20:02:32.868795 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m20:02:32.869218 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:02:32.874126 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:02:32.875083 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:02:32.890439 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:02:32.890775 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m20:02:32.891001 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:02:33.287979 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.397 seconds
[0m20:02:33.290371 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m20:02:33.291260 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:02:33.291745 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m20:02:33.374925 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.083 seconds
[0m20:02:33.396593 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:02:33.396932 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.id != current_records.product_id
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        now() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m20:02:33.564398 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58eda-0202-cf54-0000-0002d4464d31
[0m20:02:33.565324 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002140 (42601): SQL compilation error:
Unknown function NOW
[0m20:02:33.565840 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:02:33.681816 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  002140 (42601): SQL compilation error:
  Unknown function NOW
[0m20:02:33.682598 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed54607-53a3-43d7-8130-899b07c77fd4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b7a3950>]}
[0m20:02:33.683296 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 0.81s]
[0m20:02:33.683989 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:02:33.685919 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m20:02:33.686392 [info ] [Thread-1 (]: 3 of 3 SKIP relation dwh_mart.fact_contract .................................... [[33mSKIP[0m]
[0m20:02:33.686777 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m20:02:33.687878 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:02:33.688168 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m20:02:33.688530 [info ] [MainThread]: 
[0m20:02:33.688858 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 4.60 seconds (4.60s).
[0m20:02:33.689708 [debug] [MainThread]: Command end result
[0m20:02:33.707983 [info ] [MainThread]: 
[0m20:02:33.708274 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:02:33.708407 [info ] [MainThread]: 
[0m20:02:33.708590 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  002140 (42601): SQL compilation error:
  Unknown function NOW
[0m20:02:33.708715 [info ] [MainThread]: 
[0m20:02:33.708998 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
[0m20:02:33.711287 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.556276, "process_user_time": 2.499996, "process_kernel_time": 2.143513, "process_mem_max_rss": "202489856", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:02:33.712173 [debug] [MainThread]: Command `dbt run` failed at 20:02:33.712132 after 5.56 seconds
[0m20:02:33.712766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1307963d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102be6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13079cb10>]}
[0m20:02:33.712930 [debug] [MainThread]: Flushing usage events
[0m20:03:09.459632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12451f150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124581610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124581c90>]}


============================== 20:03:09.462276 | 776b3713-b15c-48ea-a995-70ca7cc42379 ==============================
[0m20:03:09.462276 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:03:09.462573 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:03:10.213212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '776b3713-b15c-48ea-a995-70ca7cc42379', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fe569d0>]}
[0m20:03:10.232601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '776b3713-b15c-48ea-a995-70ca7cc42379', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117d00b50>]}
[0m20:03:10.233190 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:03:10.243694 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:03:10.299660 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:03:10.300015 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m20:03:10.385293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '776b3713-b15c-48ea-a995-70ca7cc42379', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x281fee890>]}
[0m20:03:10.572579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '776b3713-b15c-48ea-a995-70ca7cc42379', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114dfc250>]}
[0m20:03:10.572899 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m20:03:10.573069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '776b3713-b15c-48ea-a995-70ca7cc42379', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x282119b50>]}
[0m20:03:10.573785 [info ] [MainThread]: 
[0m20:03:10.574047 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:03:10.576226 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:03:10.581679 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:03:10.581841 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:03:10.581951 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:03:11.108951 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.527 seconds
[0m20:03:11.109955 [debug] [ThreadPool]: On list_LB: Close
[0m20:03:11.220276 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m20:03:11.224597 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m20:03:11.224802 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m20:03:11.224926 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:03:11.680543 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.456 seconds
[0m20:03:11.681961 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m20:03:11.785144 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m20:03:11.788195 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m20:03:11.788864 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m20:03:11.789345 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:03:12.165200 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.376 seconds
[0m20:03:12.168151 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m20:03:12.267069 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m20:03:12.269473 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:03:12.269645 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:03:12.269763 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:03:12.641629 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.372 seconds
[0m20:03:12.643028 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:03:12.750482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '776b3713-b15c-48ea-a995-70ca7cc42379', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114f31f90>]}
[0m20:03:12.752294 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:03:12.752651 [info ] [MainThread]: 
[0m20:03:12.755931 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:03:12.756253 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m20:03:12.756479 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m20:03:12.756624 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:03:12.761196 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:03:12.761659 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:03:12.767754 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:03:12.768071 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m20:03:12.768232 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:13.195490 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.427 seconds
[0m20:03:13.198452 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m20:03:13.199802 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:03:13.200472 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m20:03:13.282534 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.081 seconds
[0m20:03:13.300662 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:03:13.301516 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:03:13.301717 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m20:03:14.234010 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.932 seconds
[0m20:03:14.260885 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:03:14.373596 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '776b3713-b15c-48ea-a995-70ca7cc42379', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x2825eb150>]}
[0m20:03:14.374766 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.62s]
[0m20:03:14.375392 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:03:14.375652 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:03:14.376188 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m20:03:14.376477 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m20:03:14.376751 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:03:14.380525 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:03:14.381347 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:03:14.394211 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:14.394611 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m20:03:14.394866 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:15.001116 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.606 seconds
[0m20:03:15.004267 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m20:03:15.005560 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:15.006117 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m20:03:15.099514 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m20:03:15.124949 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:15.125418 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.id != current_records.product_id
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then now()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        current_timestamp() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m20:03:15.305993 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58edb-0202-cf69-0000-0002d4465da5
[0m20:03:15.306711 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002140 (42601): SQL compilation error:
Unknown function NOW
[0m20:03:15.307250 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:03:15.418716 [debug] [Thread-1 (]: Database Error in model dim_product (models/mart/dim_product.sql)
  002140 (42601): SQL compilation error:
  Unknown function NOW
[0m20:03:15.419248 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '776b3713-b15c-48ea-a995-70ca7cc42379', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x281da0390>]}
[0m20:03:15.419946 [error] [Thread-1 (]: 2 of 3 ERROR creating sql incremental model dwh_mart.dim_product ............... [[31mERROR[0m in 1.04s]
[0m20:03:15.420254 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:03:15.423996 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m20:03:15.424516 [info ] [Thread-1 (]: 3 of 3 SKIP relation dwh_mart.fact_contract .................................... [[33mSKIP[0m]
[0m20:03:15.425070 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m20:03:15.426387 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:03:15.426641 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m20:03:15.427095 [info ] [MainThread]: 
[0m20:03:15.427600 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 4.85 seconds (4.85s).
[0m20:03:15.429131 [debug] [MainThread]: Command end result
[0m20:03:15.490569 [info ] [MainThread]: 
[0m20:03:15.493398 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:03:15.494648 [info ] [MainThread]: 
[0m20:03:15.495706 [error] [MainThread]:   Database Error in model dim_product (models/mart/dim_product.sql)
  002140 (42601): SQL compilation error:
  Unknown function NOW
[0m20:03:15.497149 [info ] [MainThread]: 
[0m20:03:15.498055 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=1 TOTAL=3
[0m20:03:15.505946 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.080734, "process_user_time": 2.736393, "process_kernel_time": 1.650649, "process_mem_max_rss": "191152128", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:03:15.506650 [debug] [MainThread]: Command `dbt run` failed at 20:03:15.506526 after 6.08 seconds
[0m20:03:15.507462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1007becd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12454c0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12414a150>]}
[0m20:03:15.508116 [debug] [MainThread]: Flushing usage events
[0m20:03:38.226101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c459f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c481810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c481e90>]}


============================== 20:03:38.228361 | e4721f53-38a1-42a0-ba32-18f7aa388807 ==============================
[0m20:03:38.228361 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:03:38.228635 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --models mart', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:03:38.814132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e4721f53-38a1-42a0-ba32-18f7aa388807', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x2807d9210>]}
[0m20:03:38.832455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e4721f53-38a1-42a0-ba32-18f7aa388807', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc00c50>]}
[0m20:03:38.833019 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:03:38.843448 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:03:38.901309 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:03:38.901786 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m20:03:38.985505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e4721f53-38a1-42a0-ba32-18f7aa388807', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x282557490>]}
[0m20:03:39.063958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e4721f53-38a1-42a0-ba32-18f7aa388807', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c41f6d0>]}
[0m20:03:39.064232 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m20:03:39.064393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4721f53-38a1-42a0-ba32-18f7aa388807', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x282671a10>]}
[0m20:03:39.065108 [info ] [MainThread]: 
[0m20:03:39.065347 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:03:39.067539 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:03:39.073009 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:03:39.073195 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:03:39.073312 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:03:39.583452 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.510 seconds
[0m20:03:39.586204 [debug] [ThreadPool]: On list_LB: Close
[0m20:03:39.802063 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m20:03:39.806798 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m20:03:39.807267 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m20:03:39.807422 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:03:40.223729 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.416 seconds
[0m20:03:40.226871 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m20:03:40.339902 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m20:03:40.346044 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m20:03:40.346626 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m20:03:40.347032 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:03:40.776720 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.429 seconds
[0m20:03:40.779670 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m20:03:40.919834 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m20:03:40.926748 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:03:40.927276 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:03:40.927530 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:03:41.382362 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.455 seconds
[0m20:03:41.386324 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:03:41.507510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4721f53-38a1-42a0-ba32-18f7aa388807', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x2826626d0>]}
[0m20:03:41.509141 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:03:41.509988 [info ] [MainThread]: 
[0m20:03:41.514678 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:03:41.515613 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m20:03:41.516337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m20:03:41.516785 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:03:41.526964 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:03:41.527926 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:03:41.538315 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:03:41.538703 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m20:03:41.538979 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:41.863989 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.325 seconds
[0m20:03:41.865788 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m20:03:41.866635 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:03:41.867072 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m20:03:42.085883 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.218 seconds
[0m20:03:42.102915 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:03:42.103722 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:03:42.103918 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m20:03:42.974990 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.871 seconds
[0m20:03:42.995707 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:03:43.092607 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e4721f53-38a1-42a0-ba32-18f7aa388807', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x2821d4fd0>]}
[0m20:03:43.093553 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.58s]
[0m20:03:43.094246 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:03:43.094750 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:03:43.095480 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m20:03:43.096004 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m20:03:43.096372 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:03:43.100552 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:03:43.101498 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:03:43.116951 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:43.117289 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m20:03:43.118480 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:43.577772 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.459 seconds
[0m20:03:43.579472 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m20:03:43.580236 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:43.580653 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m20:03:43.657578 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.076 seconds
[0m20:03:43.679241 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:43.679563 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.id != current_records.product_id
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then current_timestamp()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        current_timestamp() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m20:03:44.101304 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.421 seconds
[0m20:03:44.113018 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:44.113555 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m20:03:44.453383 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.339 seconds
[0m20:03:44.459456 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:44.459892 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m20:03:44.536342 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.076 seconds
[0m20:03:44.544710 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:44.545199 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m20:03:44.608184 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.063 seconds
[0m20:03:44.641939 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m20:03:44.642869 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:44.643041 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m20:03:44.742011 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.099 seconds
[0m20:03:44.742363 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:44.742570 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")

;
[0m20:03:45.329986 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.587 seconds
[0m20:03:45.330729 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:45.330887 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m20:03:45.583677 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.252 seconds
[0m20:03:45.600207 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m20:03:45.606483 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:45.606876 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m20:03:45.717593 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.110 seconds
[0m20:03:45.720636 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:03:45.832262 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e4721f53-38a1-42a0-ba32-18f7aa388807', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x286416e90>]}
[0m20:03:45.834018 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.74s]
[0m20:03:45.835267 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:03:45.836902 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m20:03:45.837804 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m20:03:45.838383 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m20:03:45.838815 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m20:03:45.844437 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m20:03:45.845448 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m20:03:45.847791 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:03:45.848139 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m20:03:45.848466 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:46.405797 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.557 seconds
[0m20:03:46.408101 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m20:03:46.409152 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:03:46.409713 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m20:03:46.498491 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.088 seconds
[0m20:03:46.505065 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:03:46.505702 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m20:03:46.899590 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.393 seconds
[0m20:03:46.904006 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:03:46.904674 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m20:03:46.983771 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.079 seconds
[0m20:03:46.988222 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:03:46.988699 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m20:03:47.067991 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.079 seconds
[0m20:03:47.078316 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:03:47.079036 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m20:03:47.181256 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.102 seconds
[0m20:03:47.183240 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m20:03:47.184460 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:03:47.184699 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m20:03:47.273310 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.088 seconds
[0m20:03:47.274392 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:03:47.275042 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")

;
[0m20:03:48.722233 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b58edb-0202-cf69-0000-0002d4465dc5
[0m20:03:48.723013 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 100090 (42P18): Duplicate row detected during DML action
Row Values: [redacted]
[0m20:03:48.723611 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m20:03:48.851666 [debug] [Thread-1 (]: Database Error in model fact_contract (models/mart/fact_contract.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_contract.sql
[0m20:03:48.852786 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e4721f53-38a1-42a0-ba32-18f7aa388807', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101b77650>]}
[0m20:03:48.853917 [error] [Thread-1 (]: 3 of 3 ERROR creating sql incremental model dwh_mart.fact_contract ............. [[31mERROR[0m in 3.01s]
[0m20:03:48.854739 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m20:03:48.857897 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:03:48.858393 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m20:03:48.858893 [info ] [MainThread]: 
[0m20:03:48.859287 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 9.79 seconds (9.79s).
[0m20:03:48.860312 [debug] [MainThread]: Command end result
[0m20:03:48.910694 [info ] [MainThread]: 
[0m20:03:48.911035 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:03:48.911171 [info ] [MainThread]: 
[0m20:03:48.911363 [error] [MainThread]:   Database Error in model fact_contract (models/mart/fact_contract.sql)
  100090 (42P18): Duplicate row detected during DML action
  Row Values: [redacted]
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_contract.sql
[0m20:03:48.911498 [info ] [MainThread]: 
[0m20:03:48.911749 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m20:03:48.914498 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 10.716702, "process_user_time": 2.401414, "process_kernel_time": 2.310261, "process_mem_max_rss": "203325440", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:03:48.914996 [debug] [MainThread]: Command `dbt run` failed at 20:03:48.914945 after 10.72 seconds
[0m20:03:48.915487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c4606d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100d42fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14806d590>]}
[0m20:03:48.915671 [debug] [MainThread]: Flushing usage events
[0m20:04:42.369077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13071b390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130780fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130781650>]}


============================== 20:04:42.371435 | 377156c8-a50b-4da4-96b1-2ecae21c1504 ==============================
[0m20:04:42.371435 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:04:42.371718 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models mart', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:04:43.056812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '377156c8-a50b-4da4-96b1-2ecae21c1504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1689bbcd0>]}
[0m20:04:43.084394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '377156c8-a50b-4da4-96b1-2ecae21c1504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130000b90>]}
[0m20:04:43.085170 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:04:43.098300 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:04:43.181596 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:04:43.181907 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:04:43.216163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '377156c8-a50b-4da4-96b1-2ecae21c1504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16918c090>]}
[0m20:04:43.288758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '377156c8-a50b-4da4-96b1-2ecae21c1504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1691bd290>]}
[0m20:04:43.289138 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m20:04:43.289352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '377156c8-a50b-4da4-96b1-2ecae21c1504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130729090>]}
[0m20:04:43.291382 [info ] [MainThread]: 
[0m20:04:43.292340 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:04:43.294887 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:04:43.302557 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:04:43.302879 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:04:43.303170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:04:43.834684 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.531 seconds
[0m20:04:43.836951 [debug] [ThreadPool]: On list_LB: Close
[0m20:04:43.949646 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:04:43.957562 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:04:43.957797 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:04:43.957921 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:44.409997 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.452 seconds
[0m20:04:44.412791 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:04:44.570780 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m20:04:44.575795 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m20:04:44.576026 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m20:04:44.576223 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:44.919568 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.343 seconds
[0m20:04:44.922818 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m20:04:45.044738 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m20:04:45.046945 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m20:04:45.047127 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m20:04:45.047250 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:45.489957 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.442 seconds
[0m20:04:45.495062 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m20:04:45.910344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '377156c8-a50b-4da4-96b1-2ecae21c1504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169012150>]}
[0m20:04:45.911039 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:04:45.911269 [info ] [MainThread]: 
[0m20:04:45.913491 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:04:45.913950 [info ] [Thread-1 (]: 1 of 3 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m20:04:45.914230 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.dim_date)
[0m20:04:45.914386 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:04:45.919100 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:04:45.920032 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:04:45.926749 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:04:45.927176 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m20:04:45.927573 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:04:46.329930 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.402 seconds
[0m20:04:46.332883 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m20:04:46.333899 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:04:46.334318 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m20:04:46.414998 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.080 seconds
[0m20:04:46.435126 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:04:46.436009 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:04:46.436318 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m20:04:47.182778 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.746 seconds
[0m20:04:47.203537 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:04:47.312805 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '377156c8-a50b-4da4-96b1-2ecae21c1504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169699f90>]}
[0m20:04:47.314144 [info ] [Thread-1 (]: 1 of 3 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.40s]
[0m20:04:47.315026 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:04:47.315598 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:04:47.316246 [info ] [Thread-1 (]: 2 of 3 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m20:04:47.316697 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.dim_product)
[0m20:04:47.316998 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:04:47.321693 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:04:47.322926 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:04:47.340813 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:04:47.341172 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m20:04:47.341331 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:04:47.737260 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.396 seconds
[0m20:04:47.739330 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m20:04:47.740452 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:04:47.741001 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m20:04:47.819878 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.078 seconds
[0m20:04:47.840963 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:04:47.841283 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.dwh_mart.dim_product__dbt_tmp
  
   as (
    

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.id != current_records.product_id
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then current_timestamp()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        current_timestamp() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
  );
[0m20:04:48.142669 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.301 seconds
[0m20:04:48.154872 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:04:48.155361 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product__dbt_tmp
[0m20:04:48.231350 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.076 seconds
[0m20:04:48.237392 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:04:48.238123 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.dwh_mart.dim_product
[0m20:04:48.319016 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.080 seconds
[0m20:04:48.326999 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:04:48.327298 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."DWH_MART"."DIM_PRODUCT"
[0m20:04:48.391242 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.063 seconds
[0m20:04:48.417783 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m20:04:48.418885 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:04:48.419104 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m20:04:48.517437 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m20:04:48.518198 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:04:48.518856 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.dwh_mart.dim_product as DBT_INTERNAL_DEST
        using LB.dwh_mart.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
            )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","DELETED" = DBT_INTERNAL_SOURCE."DELETED","PRODUCT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."PRODUCT_MODIFICATIONDATE","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "DELETED", "PRODUCT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")

;
[0m20:04:49.035403 [debug] [Thread-1 (]: SQL status: SUCCESS 18 in 0.516 seconds
[0m20:04:49.036167 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:04:49.036523 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m20:04:49.290437 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.253 seconds
[0m20:04:49.299584 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m20:04:49.306018 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:04:49.306528 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m20:04:49.424538 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.117 seconds
[0m20:04:49.427928 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:04:49.540239 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '377156c8-a50b-4da4-96b1-2ecae21c1504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121279fd0>]}
[0m20:04:49.541733 [info ] [Thread-1 (]: 2 of 3 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 18[0m in 2.22s]
[0m20:04:49.542903 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:04:49.544641 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m20:04:49.545343 [info ] [Thread-1 (]: 3 of 3 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m20:04:49.545895 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m20:04:49.546322 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m20:04:49.551561 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:49.552559 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m20:04:49.553808 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:49.554008 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m20:04:49.554163 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:04:49.917978 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.363 seconds
[0m20:04:49.920968 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m20:04:49.921947 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:49.922489 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m20:04:50.012785 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.090 seconds
[0m20:04:50.019162 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:50.019705 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace  temporary view LB.dwh_mart.fact_contract__dbt_tmp
  
   as (
    

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
  );
[0m20:04:50.457450 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.437 seconds
[0m20:04:50.462050 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:50.462628 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract__dbt_tmp
[0m20:04:50.546019 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.083 seconds
[0m20:04:50.550690 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:50.551225 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table LB.dwh_mart.fact_contract
[0m20:04:50.635605 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.084 seconds
[0m20:04:50.640428 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:50.641009 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
describe table "LB"."DWH_MART"."FACT_CONTRACT"
[0m20:04:50.711125 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.070 seconds
[0m20:04:50.714497 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:50.716135 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:50.716573 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
-- back compat for old kwarg name
  
  begin;
[0m20:04:50.814678 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m20:04:50.815527 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:50.816269 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
merge into LB.dwh_mart.fact_contract as DBT_INTERNAL_DEST
        using LB.dwh_mart.fact_contract__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","CONTRACT_MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."CONTRACT_MODIFICATIONDATE","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")
    values
        ("CONTRACT_ID", "PRODUCT_ID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "PRODUCTCODE", "PRODUCTNAME", "CONTRACT_MODIFICATIONDATE", "VALID_FROM", "VALID_TO", "IS_CURRENT")

;
[0m20:04:51.810491 [debug] [Thread-1 (]: SQL status: SUCCESS 102848 in 0.993 seconds
[0m20:04:51.811656 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:51.812316 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
COMMIT
[0m20:04:52.053838 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.241 seconds
[0m20:04:52.057692 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m20:04:52.058259 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:04:52.058508 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m20:04:52.161480 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.102 seconds
[0m20:04:52.165477 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m20:04:52.285879 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '377156c8-a50b-4da4-96b1-2ecae21c1504', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169786910>]}
[0m20:04:52.287627 [info ] [Thread-1 (]: 3 of 3 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 102848[0m in 2.74s]
[0m20:04:52.288623 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m20:04:52.291181 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:04:52.291574 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m20:04:52.292167 [info ] [MainThread]: 
[0m20:04:52.292624 [info ] [MainThread]: Finished running 1 table model, 2 incremental models in 0 hours 0 minutes and 9.00 seconds (9.00s).
[0m20:04:52.293736 [debug] [MainThread]: Command end result
[0m20:04:52.344394 [info ] [MainThread]: 
[0m20:04:52.344797 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:04:52.344991 [info ] [MainThread]: 
[0m20:04:52.345199 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m20:04:52.347592 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.009, "process_user_time": 2.665928, "process_kernel_time": 1.781252, "process_mem_max_rss": "192380928", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:04:52.348192 [debug] [MainThread]: Command `dbt run` succeeded at 20:04:52.348121 after 10.01 seconds
[0m20:04:52.348638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100ae6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100ae6e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100b601d0>]}
[0m20:04:52.348885 [debug] [MainThread]: Flushing usage events
[0m20:07:14.145671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f65b110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f6bd750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f696cd0>]}


============================== 20:07:14.149071 | e1ed1416-f2dc-47f6-af12-a0b9225c8209 ==============================
[0m20:07:14.149071 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:07:14.149413 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --full-refresh', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:07:15.075872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f663490>]}
[0m20:07:15.096787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f100c50>]}
[0m20:07:15.097591 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:07:15.117557 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:07:15.202195 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:07:15.202486 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:07:15.221108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e1ee310>]}
[0m20:07:15.277495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a68c3d0>]}
[0m20:07:15.277887 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m20:07:15.278064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f51dd50>]}
[0m20:07:15.279505 [info ] [MainThread]: 
[0m20:07:15.279928 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:07:15.282117 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:07:15.289251 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:07:15.289526 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:07:15.289672 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:07:16.018458 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.729 seconds
[0m20:07:16.021516 [debug] [ThreadPool]: On list_LB: Close
[0m20:07:16.148209 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:07:16.148942 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:07:16.149324 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:07:16.599043 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.449 seconds
[0m20:07:16.602123 [debug] [ThreadPool]: On list_LB: Close
[0m20:07:16.725747 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:07:16.730974 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:07:16.731241 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:07:16.731381 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:07:17.224340 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.493 seconds
[0m20:07:17.225863 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:07:17.347098 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m20:07:17.349423 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m20:07:17.349588 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m20:07:17.349703 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:07:17.728449 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.379 seconds
[0m20:07:17.731396 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m20:07:17.837023 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m20:07:17.842932 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m20:07:17.843460 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m20:07:17.843798 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:07:18.451348 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.607 seconds
[0m20:07:18.455085 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m20:07:18.565068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a6dc190>]}
[0m20:07:18.566431 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:07:18.567140 [info ] [MainThread]: 
[0m20:07:18.571469 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:07:18.572445 [info ] [Thread-1 (]: 1 of 6 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m20:07:18.573081 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m20:07:18.573513 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:07:18.581252 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:07:18.582833 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:07:18.592468 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:07:18.592803 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m20:07:18.592981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:18.989967 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.397 seconds
[0m20:07:18.992383 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m20:07:18.993473 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:07:18.994132 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m20:07:19.089434 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.095 seconds
[0m20:07:19.109455 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:07:19.110078 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:07:19.110239 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m20:07:19.864119 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.753 seconds
[0m20:07:19.894359 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:07:20.005665 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f210890>]}
[0m20:07:20.006947 [info ] [Thread-1 (]: 1 of 6 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.43s]
[0m20:07:20.007745 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:07:20.008358 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m20:07:20.009257 [info ] [Thread-1 (]: 2 of 6 START sql incremental model stage.stg_contract .......................... [RUN]
[0m20:07:20.009972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m20:07:20.010400 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m20:07:20.020723 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:07:20.022358 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m20:07:20.031581 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:07:20.031904 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m20:07:20.032064 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:20.408530 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.376 seconds
[0m20:07:20.411146 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m20:07:20.412442 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:07:20.413197 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m20:07:20.507147 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m20:07:20.531446 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:07:20.532452 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:07:20.532715 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m20:07:21.967400 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.434 seconds
[0m20:07:21.980888 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_contract__dbt_tmp
[0m20:07:21.993009 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:07:21.993414 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.stage.stg_contract__dbt_tmp cascade
[0m20:07:22.057211 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.064 seconds
[0m20:07:22.058511 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m20:07:22.182192 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fc95050>]}
[0m20:07:22.182755 [info ] [Thread-1 (]: 2 of 6 OK created sql incremental model stage.stg_contract ..................... [[32mSUCCESS 1[0m in 2.17s]
[0m20:07:22.183059 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m20:07:22.183273 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m20:07:22.183540 [info ] [Thread-1 (]: 3 of 6 START sql incremental model stage.stg_prices ............................ [RUN]
[0m20:07:22.183736 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m20:07:22.183876 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m20:07:22.185783 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:07:22.186792 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m20:07:22.187899 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:07:22.188064 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m20:07:22.188206 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:22.499791 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.311 seconds
[0m20:07:22.501678 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m20:07:22.502474 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:07:22.502799 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m20:07:22.582576 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.079 seconds
[0m20:07:22.586536 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:07:22.588570 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:07:22.589073 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m20:07:23.753117 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.164 seconds
[0m20:07:23.756965 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_prices__dbt_tmp
[0m20:07:23.757791 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:07:23.758125 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
drop view if exists LB.stage.stg_prices__dbt_tmp cascade
[0m20:07:23.846055 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.087 seconds
[0m20:07:23.849654 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m20:07:23.958632 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e5d4190>]}
[0m20:07:23.960105 [info ] [Thread-1 (]: 3 of 6 OK created sql incremental model stage.stg_prices ....................... [[32mSUCCESS 1[0m in 1.77s]
[0m20:07:23.961099 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m20:07:23.961828 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m20:07:23.962795 [info ] [Thread-1 (]: 4 of 6 START sql incremental model stage.stg_products .......................... [RUN]
[0m20:07:23.963435 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m20:07:23.963906 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m20:07:23.969949 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m20:07:23.971332 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m20:07:23.973968 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:07:23.974407 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m20:07:23.974763 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:24.317418 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.342 seconds
[0m20:07:24.320051 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m20:07:24.321159 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:07:24.321582 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m20:07:24.399511 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.078 seconds
[0m20:07:24.402409 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m20:07:24.403537 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:07:24.403907 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m20:07:26.048412 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.644 seconds
[0m20:07:26.055225 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_products__dbt_tmp
[0m20:07:26.055932 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:07:26.056123 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
drop view if exists LB.stage.stg_products__dbt_tmp cascade
[0m20:07:26.124161 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.068 seconds
[0m20:07:26.127227 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m20:07:26.256704 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dc66090>]}
[0m20:07:26.260082 [info ] [Thread-1 (]: 4 of 6 OK created sql incremental model stage.stg_products ..................... [[32mSUCCESS 1[0m in 2.29s]
[0m20:07:26.262553 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m20:07:26.264510 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:07:26.265175 [info ] [Thread-1 (]: 5 of 6 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m20:07:26.265760 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_product)
[0m20:07:26.266164 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:07:26.272171 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:07:26.273752 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:07:26.276942 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:07:26.277469 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m20:07:26.277921 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:26.632427 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.355 seconds
[0m20:07:26.633421 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m20:07:26.634167 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:07:26.634460 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m20:07:26.708367 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.074 seconds
[0m20:07:26.710293 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m20:07:26.711682 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:07:26.711965 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.id != current_records.product_id
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then current_timestamp()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        current_timestamp() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m20:07:27.550714 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.835 seconds
[0m20:07:27.559242 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m20:07:27.559792 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:07:27.559958 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m20:07:27.627965 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.068 seconds
[0m20:07:27.632602 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:07:27.734242 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a730190>]}
[0m20:07:27.735374 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 1[0m in 1.47s]
[0m20:07:27.736259 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:07:27.737759 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m20:07:27.738421 [info ] [Thread-1 (]: 6 of 6 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m20:07:27.738950 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m20:07:27.739373 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m20:07:27.745973 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m20:07:27.747014 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m20:07:27.749011 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:07:27.749301 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m20:07:27.749715 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:28.197149 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.447 seconds
[0m20:07:28.200012 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m20:07:28.201117 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:07:28.201678 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m20:07:28.277976 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.076 seconds
[0m20:07:28.282473 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m20:07:28.286723 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:07:28.287556 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace transient table LB.dwh_mart.fact_contract
         as
        (

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
        );
[0m20:07:29.567959 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.280 seconds
[0m20:07:29.574441 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m20:07:29.575632 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m20:07:29.576028 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m20:07:29.645901 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.069 seconds
[0m20:07:29.649502 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m20:07:29.760968 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ed1416-f2dc-47f6-af12-a0b9225c8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae87f10>]}
[0m20:07:29.762131 [info ] [Thread-1 (]: 6 of 6 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 1[0m in 2.02s]
[0m20:07:29.762656 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m20:07:29.764438 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:07:29.764925 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m20:07:29.765545 [info ] [MainThread]: 
[0m20:07:29.766373 [info ] [MainThread]: Finished running 1 table model, 5 incremental models in 0 hours 0 minutes and 14.49 seconds (14.49s).
[0m20:07:29.768445 [debug] [MainThread]: Command end result
[0m20:07:29.799548 [info ] [MainThread]: 
[0m20:07:29.799949 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:07:29.800187 [info ] [MainThread]: 
[0m20:07:29.800549 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m20:07:29.804525 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.691438, "process_user_time": 3.306916, "process_kernel_time": 1.677069, "process_mem_max_rss": "187219968", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:07:29.805833 [debug] [MainThread]: Command `dbt run` succeeded at 20:07:29.805760 after 15.69 seconds
[0m20:07:29.807949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f2ece50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1022e46d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1021eacd0>]}
[0m20:07:29.808596 [debug] [MainThread]: Flushing usage events
[0m22:01:47.301268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14635b4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1463bd210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1463bd850>]}


============================== 22:01:47.305475 | f70aac1a-5b9a-4cd2-af7a-a90232df71d7 ==============================
[0m22:01:47.305475 [info ] [MainThread]: Running with dbt=1.8.0
[0m22:01:47.305781 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --full-refresh', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:01:48.265845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae68ad0>]}
[0m22:01:48.287986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd00ad0>]}
[0m22:01:48.288828 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m22:01:48.331493 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m22:01:48.401972 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:01:48.402232 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:01:48.420150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b38c4d0>]}
[0m22:01:48.467651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b2c5050>]}
[0m22:01:48.468062 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m22:01:48.468422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2c7c10>]}
[0m22:01:48.470045 [info ] [MainThread]: 
[0m22:01:48.470910 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:01:48.477202 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m22:01:48.491715 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m22:01:48.492154 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m22:01:48.492346 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:01:49.111680 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.619 seconds
[0m22:01:49.112914 [debug] [ThreadPool]: On list_LB: Close
[0m22:01:50.042216 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m22:01:50.044400 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m22:01:50.044890 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:01:50.476006 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.430 seconds
[0m22:01:50.489632 [debug] [ThreadPool]: On list_LB: Close
[0m22:01:50.603560 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m22:01:50.610929 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m22:01:50.611217 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m22:01:50.611358 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:01:51.071913 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.460 seconds
[0m22:01:51.073582 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m22:01:51.181334 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m22:01:51.184170 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m22:01:51.184379 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m22:01:51.184507 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:01:51.666985 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.482 seconds
[0m22:01:51.669240 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m22:01:51.780975 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m22:01:51.783298 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m22:01:51.783506 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m22:01:51.783632 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:01:52.118881 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.335 seconds
[0m22:01:52.121120 [debug] [ThreadPool]: On list_LB_stage: Close
[0m22:01:52.228326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146363250>]}
[0m22:01:52.229356 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:01:52.229781 [info ] [MainThread]: 
[0m22:01:52.233446 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m22:01:52.233842 [info ] [Thread-1 (]: 1 of 6 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m22:01:52.234128 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m22:01:52.234336 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m22:01:52.239642 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m22:01:52.241023 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m22:01:52.250405 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m22:01:52.250732 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m22:01:52.250895 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:01:52.573584 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.323 seconds
[0m22:01:52.574468 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m22:01:52.574849 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m22:01:52.575000 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m22:01:52.665333 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.090 seconds
[0m22:01:52.672726 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m22:01:52.673549 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m22:01:52.673724 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m22:01:53.939683 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.265 seconds
[0m22:01:53.964186 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m22:01:54.085095 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b8a4110>]}
[0m22:01:54.086207 [info ] [Thread-1 (]: 1 of 6 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.85s]
[0m22:01:54.087050 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m22:01:54.087515 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m22:01:54.087950 [info ] [Thread-1 (]: 2 of 6 START sql incremental model stage.stg_contract .......................... [RUN]
[0m22:01:54.088287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m22:01:54.088491 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m22:01:54.093659 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m22:01:54.098339 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m22:01:54.110046 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m22:01:54.110733 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m22:01:54.111341 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:01:54.433913 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.322 seconds
[0m22:01:54.436169 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m22:01:54.437277 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m22:01:54.437972 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m22:01:54.551754 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.113 seconds
[0m22:01:54.560576 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m22:01:54.561307 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m22:01:54.561499 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m22:01:55.977417 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.415 seconds
[0m22:01:55.990143 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_contract__dbt_tmp
[0m22:01:55.994569 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m22:01:55.994870 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.stage.stg_contract__dbt_tmp cascade
[0m22:01:56.056483 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.061 seconds
[0m22:01:56.059242 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m22:01:56.163440 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b586ed0>]}
[0m22:01:56.164326 [info ] [Thread-1 (]: 2 of 6 OK created sql incremental model stage.stg_contract ..................... [[32mSUCCESS 1[0m in 2.07s]
[0m22:01:56.164774 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m22:01:56.165061 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m22:01:56.165492 [info ] [Thread-1 (]: 3 of 6 START sql incremental model stage.stg_prices ............................ [RUN]
[0m22:01:56.165792 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m22:01:56.165986 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m22:01:56.168317 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m22:01:56.169092 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m22:01:56.170353 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m22:01:56.170565 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m22:01:56.170759 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:01:56.578554 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.408 seconds
[0m22:01:56.580146 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m22:01:56.580851 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m22:01:56.581250 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m22:01:56.659080 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.077 seconds
[0m22:01:56.660194 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m22:01:56.660787 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m22:01:56.660956 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m22:01:57.498929 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.837 seconds
[0m22:01:57.507840 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_prices__dbt_tmp
[0m22:01:57.509018 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m22:01:57.509262 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
drop view if exists LB.stage.stg_prices__dbt_tmp cascade
[0m22:01:57.876609 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.367 seconds
[0m22:01:57.889524 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m22:01:57.992095 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12af11090>]}
[0m22:01:57.992771 [info ] [Thread-1 (]: 3 of 6 OK created sql incremental model stage.stg_prices ....................... [[32mSUCCESS 1[0m in 1.83s]
[0m22:01:57.993375 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m22:01:57.993752 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m22:01:57.995824 [info ] [Thread-1 (]: 4 of 6 START sql incremental model stage.stg_products .......................... [RUN]
[0m22:01:57.996555 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m22:01:57.998415 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m22:01:58.014764 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m22:01:58.016965 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m22:01:58.018852 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m22:01:58.019039 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m22:01:58.019455 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:01:58.358285 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.339 seconds
[0m22:01:58.360260 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m22:01:58.361334 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m22:01:58.361664 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m22:01:58.447555 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m22:01:58.450252 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m22:01:58.451576 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m22:01:58.451981 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m22:01:59.135145 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.683 seconds
[0m22:01:59.137595 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_products__dbt_tmp
[0m22:01:59.138140 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m22:01:59.138609 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
drop view if exists LB.stage.stg_products__dbt_tmp cascade
[0m22:01:59.222665 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m22:01:59.223766 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m22:01:59.324526 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a27dbd0>]}
[0m22:01:59.325287 [info ] [Thread-1 (]: 4 of 6 OK created sql incremental model stage.stg_products ..................... [[32mSUCCESS 1[0m in 1.33s]
[0m22:01:59.325926 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m22:01:59.327054 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m22:01:59.327684 [info ] [Thread-1 (]: 5 of 6 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m22:01:59.328005 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_product)
[0m22:01:59.328156 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m22:01:59.331081 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m22:01:59.331553 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m22:01:59.332741 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m22:01:59.333067 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m22:01:59.333358 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:01:59.662622 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.329 seconds
[0m22:01:59.665379 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m22:01:59.666455 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m22:01:59.667085 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m22:01:59.832572 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.165 seconds
[0m22:01:59.834361 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m22:01:59.836634 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m22:01:59.837062 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.id != current_records.product_id
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then current_timestamp()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        current_timestamp() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m22:02:00.744471 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.907 seconds
[0m22:02:00.752233 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m22:02:00.753305 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m22:02:00.753702 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m22:02:00.819378 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.065 seconds
[0m22:02:00.821770 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m22:02:00.916884 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b993cd0>]}
[0m22:02:00.918340 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 1[0m in 1.59s]
[0m22:02:00.919240 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m22:02:00.920513 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m22:02:00.921301 [info ] [Thread-1 (]: 6 of 6 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m22:02:00.921833 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m22:02:00.922213 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m22:02:00.927842 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m22:02:00.928828 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m22:02:00.930640 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m22:02:00.931013 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m22:02:00.931284 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:02:01.357747 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.426 seconds
[0m22:02:01.358640 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m22:02:01.358989 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m22:02:01.359167 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m22:02:01.425663 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.066 seconds
[0m22:02:01.427522 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m22:02:01.429389 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m22:02:01.429726 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace transient table LB.dwh_mart.fact_contract
         as
        (

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
        );
[0m22:02:03.630934 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.201 seconds
[0m22:02:03.633669 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m22:02:03.634343 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m22:02:03.634612 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m22:02:03.711096 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.076 seconds
[0m22:02:03.712612 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m22:02:03.813787 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f70aac1a-5b9a-4cd2-af7a-a90232df71d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9c3810>]}
[0m22:02:03.814281 [info ] [Thread-1 (]: 6 of 6 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 1[0m in 2.89s]
[0m22:02:03.814575 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m22:02:03.815503 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:02:03.815627 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m22:02:03.815825 [info ] [MainThread]: 
[0m22:02:03.815957 [info ] [MainThread]: Finished running 1 table model, 5 incremental models in 0 hours 0 minutes and 15.35 seconds (15.35s).
[0m22:02:03.816466 [debug] [MainThread]: Command end result
[0m22:02:03.844704 [info ] [MainThread]: 
[0m22:02:03.845133 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:02:03.845320 [info ] [MainThread]: 
[0m22:02:03.845493 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m22:02:03.883000 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 16.618738, "process_user_time": 2.528591, "process_kernel_time": 2.462161, "process_mem_max_rss": "188350464", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:02:03.883406 [debug] [MainThread]: Command `dbt run` succeeded at 22:02:03.883364 after 16.62 seconds
[0m22:02:03.883645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102bdcfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b7ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b7ecd0>]}
[0m22:02:03.883811 [debug] [MainThread]: Flushing usage events
[0m23:12:16.480067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c757410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c7bd090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c7bd6d0>]}


============================== 23:12:16.482882 | a122e719-7ad3-45b5-98a3-4e3cb8b7655b ==============================
[0m23:12:16.482882 [info ] [MainThread]: Running with dbt=1.8.0
[0m23:12:16.483143 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --full-refresh', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:12:17.338514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169554150>]}
[0m23:12:17.356730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c100b90>]}
[0m23:12:17.357270 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m23:12:17.405240 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m23:12:17.467351 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:12:17.467704 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m23:12:17.677217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1699ce010>]}
[0m23:12:17.784936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a952bd0>]}
[0m23:12:17.785309 [info ] [MainThread]: Found 6 models, 3 seeds, 3 sources, 448 macros
[0m23:12:17.785482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169509050>]}
[0m23:12:17.786309 [info ] [MainThread]: 
[0m23:12:17.786548 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:12:17.788328 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m23:12:17.793577 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m23:12:17.793748 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m23:12:17.793869 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:12:18.491916 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.698 seconds
[0m23:12:18.494236 [debug] [ThreadPool]: On list_LB: Close
[0m23:12:18.614726 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m23:12:18.615465 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m23:12:18.615940 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:19.196289 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.580 seconds
[0m23:12:19.199517 [debug] [ThreadPool]: On list_LB: Close
[0m23:12:19.321917 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m23:12:19.334254 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m23:12:19.334737 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m23:12:19.335010 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:19.819387 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.484 seconds
[0m23:12:19.822424 [debug] [ThreadPool]: On list_LB_stage: Close
[0m23:12:19.948236 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m23:12:19.954788 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m23:12:19.955581 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m23:12:19.955949 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:20.339685 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.383 seconds
[0m23:12:20.343148 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m23:12:20.454942 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_STAGE)
[0m23:12:20.456826 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m23:12:20.456991 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m23:12:20.457109 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:20.940106 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.483 seconds
[0m23:12:20.944094 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m23:12:21.060849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16996c550>]}
[0m23:12:21.062018 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:12:21.062541 [info ] [MainThread]: 
[0m23:12:21.068064 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m23:12:21.068718 [info ] [Thread-1 (]: 1 of 6 START sql table model dwh_mart.dim_date ................................. [RUN]
[0m23:12:21.069181 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.dim_date)
[0m23:12:21.069514 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m23:12:21.077174 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m23:12:21.078006 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m23:12:21.091899 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m23:12:21.092277 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
show parameters like 'query_tag' in session
[0m23:12:21.092505 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:21.466375 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.374 seconds
[0m23:12:21.469472 [debug] [Thread-1 (]: Setting query_tag to 'dim_date'. Will reset to '' after materialization.
[0m23:12:21.470767 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m23:12:21.471416 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
alter session set query_tag = 'dim_date'
[0m23:12:21.578393 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.106 seconds
[0m23:12:21.595814 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m23:12:21.597032 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m23:12:21.597349 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.dwh_mart.dim_date
         as
        (

with date_series as (
    select
        dateadd(day, seq4(), '2020-01-01') as date
    from table(generator(rowcount => 365*10))
)

select
    date as date_id,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    dayofweek(date) as day_of_week,
    dayofyear(date) as day_of_year,
    week(date) as week,
    quarter(date) as quarter
from date_series
        );
[0m23:12:22.572047 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.974 seconds
[0m23:12:22.592407 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m23:12:22.688851 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169956a10>]}
[0m23:12:22.689250 [info ] [Thread-1 (]: 1 of 6 OK created sql table model dwh_mart.dim_date ............................ [[32mSUCCESS 1[0m in 1.62s]
[0m23:12:22.689521 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m23:12:22.689703 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m23:12:22.689940 [info ] [Thread-1 (]: 2 of 6 START sql incremental model stage.stg_contract .......................... [RUN]
[0m23:12:22.690120 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m23:12:22.690257 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m23:12:22.692757 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m23:12:22.693964 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m23:12:22.701397 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m23:12:22.701618 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m23:12:22.701753 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:23.093011 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.391 seconds
[0m23:12:23.093730 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m23:12:23.094027 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m23:12:23.094176 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m23:12:23.178532 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m23:12:23.185471 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m23:12:23.188060 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m23:12:23.188873 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

with source as (
    select * from lb.raw.contract
),
incremental as (
    select
        id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m23:12:24.736262 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.543 seconds
[0m23:12:24.756175 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_contract__dbt_tmp
[0m23:12:24.766685 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m23:12:24.767388 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop view if exists LB.stage.stg_contract__dbt_tmp cascade
[0m23:12:24.834669 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.067 seconds
[0m23:12:24.836071 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m23:12:24.940944 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169ef4050>]}
[0m23:12:24.943173 [info ] [Thread-1 (]: 2 of 6 OK created sql incremental model stage.stg_contract ..................... [[32mSUCCESS 1[0m in 2.25s]
[0m23:12:24.944581 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m23:12:24.945368 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m23:12:24.946729 [info ] [Thread-1 (]: 3 of 6 START sql incremental model stage.stg_prices ............................ [RUN]
[0m23:12:24.947043 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m23:12:24.947213 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m23:12:24.949734 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m23:12:24.950899 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m23:12:24.952918 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m23:12:24.953169 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m23:12:24.953327 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:25.280812 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.327 seconds
[0m23:12:25.283531 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m23:12:25.284354 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m23:12:25.284748 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m23:12:25.364887 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.080 seconds
[0m23:12:25.368741 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m23:12:25.371142 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m23:12:25.372004 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

with source as (
    select * from lb.raw.prices
),
incremental as (
    select
        id,
        productid,
        pricecomponentid,
        productcomponent,
        price,
        unit,
        valid_from,
        valid_until,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m23:12:26.058036 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.684 seconds
[0m23:12:26.075907 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_prices__dbt_tmp
[0m23:12:26.076514 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m23:12:26.076685 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
drop view if exists LB.stage.stg_prices__dbt_tmp cascade
[0m23:12:26.139328 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.062 seconds
[0m23:12:26.145570 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m23:12:26.253474 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169681750>]}
[0m23:12:26.254640 [info ] [Thread-1 (]: 3 of 6 OK created sql incremental model stage.stg_prices ....................... [[32mSUCCESS 1[0m in 1.31s]
[0m23:12:26.255649 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m23:12:26.256256 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m23:12:26.257183 [info ] [Thread-1 (]: 4 of 6 START sql incremental model stage.stg_products .......................... [RUN]
[0m23:12:26.257959 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m23:12:26.258443 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m23:12:26.265203 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m23:12:26.266592 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m23:12:26.271008 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m23:12:26.271989 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m23:12:26.272561 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:26.771565 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.499 seconds
[0m23:12:26.773845 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m23:12:26.774886 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m23:12:26.775417 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m23:12:26.860727 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.085 seconds
[0m23:12:26.865658 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m23:12:26.867388 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m23:12:26.868333 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (

with source as (
    select * from lb.raw.products
),
incremental as (
    select
        id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        modificationdate
    from source
    
)

select * from incremental
        );
[0m23:12:27.494114 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.623 seconds
[0m23:12:27.513689 [debug] [Thread-1 (]: Applying DROP to: LB.stage.stg_products__dbt_tmp
[0m23:12:27.515105 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m23:12:27.515648 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
drop view if exists LB.stage.stg_products__dbt_tmp cascade
[0m23:12:27.581672 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.065 seconds
[0m23:12:27.584994 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m23:12:27.695753 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137a7ce50>]}
[0m23:12:27.697303 [info ] [Thread-1 (]: 4 of 6 OK created sql incremental model stage.stg_products ..................... [[32mSUCCESS 1[0m in 1.44s]
[0m23:12:27.697938 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m23:12:27.699774 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m23:12:27.700470 [info ] [Thread-1 (]: 5 of 6 START sql incremental model dwh_mart.dim_product ........................ [RUN]
[0m23:12:27.700909 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_product)
[0m23:12:27.701090 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m23:12:27.703425 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m23:12:27.704574 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m23:12:27.707068 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m23:12:27.707369 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
show parameters like 'query_tag' in session
[0m23:12:27.707867 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:28.034029 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.326 seconds
[0m23:12:28.036736 [debug] [Thread-1 (]: Setting query_tag to 'dim_product'. Will reset to '' after materialization.
[0m23:12:28.037396 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m23:12:28.038064 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
alter session set query_tag = 'dim_product'
[0m23:12:28.110364 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.071 seconds
[0m23:12:28.112733 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m23:12:28.116966 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m23:12:28.117506 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.dwh_mart.dim_product
         as
        (

with source as (
    select * from LB.stage.stg_products
),
current_records as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),
records_to_insert as (
    select
        src.id as product_id,
        src.productcode,
        src.productname,
        src.energy,
        src.consumptiontype,
        src.deleted,
        src.modificationdate as product_modificationdate,
        current_records.is_current,
        current_records.valid_from,
        current_records.valid_to
    from source as src
    left join current_records
    on src.id = current_records.product_id
    where current_records.product_id is null
    or (
        src.id != current_records.product_id
        or src.productname != current_records.productname
        or src.energy != current_records.energy
        or src.consumptiontype != current_records.consumptiontype
        or src.deleted != current_records.deleted
        or src.modificationdate != current_records.product_modificationdate
    )
),
final as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        case
            when is_current = true and valid_to is null then false
            else is_current
        end as is_current,
        valid_from,
        case
            when is_current = true and valid_to is null then current_timestamp()
            else valid_to
        end as valid_to
    from current_records
    
    union all
    
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        deleted,
        product_modificationdate,
        true as is_current,
        current_timestamp() as valid_from,
        null as valid_to
    from records_to_insert
)

select * from final
        );
[0m23:12:28.792002 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.673 seconds
[0m23:12:28.801004 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.dim_product__dbt_tmp
[0m23:12:28.802396 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m23:12:28.803153 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.dwh_mart.dim_product__dbt_tmp cascade
[0m23:12:28.903587 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.100 seconds
[0m23:12:28.907164 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m23:12:29.007762 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169592590>]}
[0m23:12:29.008941 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model dwh_mart.dim_product ................... [[32mSUCCESS 1[0m in 1.31s]
[0m23:12:29.009806 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m23:12:29.011006 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_contract
[0m23:12:29.011926 [info ] [Thread-1 (]: 6 of 6 START sql incremental model dwh_mart.fact_contract ...................... [RUN]
[0m23:12:29.012735 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_contract)
[0m23:12:29.013448 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_contract
[0m23:12:29.019514 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_contract"
[0m23:12:29.020795 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_contract
[0m23:12:29.036425 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m23:12:29.037019 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
show parameters like 'query_tag' in session
[0m23:12:29.037251 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:29.425242 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.388 seconds
[0m23:12:29.427380 [debug] [Thread-1 (]: Setting query_tag to 'fact_contract'. Will reset to '' after materialization.
[0m23:12:29.428377 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m23:12:29.428996 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
alter session set query_tag = 'fact_contract'
[0m23:12:29.503304 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.074 seconds
[0m23:12:29.509168 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_contract"
[0m23:12:29.514772 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m23:12:29.515608 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
create or replace transient table LB.dwh_mart.fact_contract
         as
        (

with source as (
    select
        id as contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        fillingdatecancellation,
        cancellationreason,
        city,
        status,
        productid,
        modificationdate
    from LB.stage.stg_contract
),

products as (
    select *
    from LB.dwh_mart.dim_product
    where is_current = true
),

current_fact_records as (
    select *
    from LB.dwh_mart.fact_contract
    where is_current = true
),

new_fact_records as (
    select
        c.contract_id,
        c.productid as product_id,
        c.createdat as anlagedatum,
        c.usage as verbrauch,
        c.usagenet as umsatz,
        p.productcode,
        p.productname,
        c.modificationdate as contract_modificationdate,
        current_timestamp() as valid_from,
        null as valid_to,
        true as is_current
    from source c
    left join products p on c.productid = p.product_id
    left join current_fact_records f on c.contract_id = f.contract_id and f.is_current = true
    where f.contract_id is null
    or (
        c.productid != f.product_id
        or c.usage != f.verbrauch
        or c.usagenet != f.umsatz
        or c.createdat != f.anlagedatum
    )
),

final as (
    select
        f.contract_id,
        f.product_id,
        f.anlagedatum,
        f.verbrauch,
        f.umsatz,
        f.productcode,
        f.productname,
        f.contract_modificationdate,
        f.valid_from,
        current_timestamp() as valid_to,
        false as is_current
    from current_fact_records f
    inner join new_fact_records nfr on f.contract_id = nfr.contract_id
    where f.is_current = true

    union all

    select * from new_fact_records
)

select * from final
        );
[0m23:12:31.491970 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.973 seconds
[0m23:12:31.507356 [debug] [Thread-1 (]: Applying DROP to: LB.dwh_mart.fact_contract__dbt_tmp
[0m23:12:31.508466 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_contract"
[0m23:12:31.508913 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_contract"} */
drop view if exists LB.dwh_mart.fact_contract__dbt_tmp cascade
[0m23:12:31.581606 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.072 seconds
[0m23:12:31.589727 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_contract: Close
[0m23:12:31.707380 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a122e719-7ad3-45b5-98a3-4e3cb8b7655b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a128bd0>]}
[0m23:12:31.709549 [info ] [Thread-1 (]: 6 of 6 OK created sql incremental model dwh_mart.fact_contract ................. [[32mSUCCESS 1[0m in 2.69s]
[0m23:12:31.711224 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_contract
[0m23:12:31.714319 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:12:31.714878 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_contract' was properly closed.
[0m23:12:31.715594 [info ] [MainThread]: 
[0m23:12:31.716208 [info ] [MainThread]: Finished running 1 table model, 5 incremental models in 0 hours 0 minutes and 13.93 seconds (13.93s).
[0m23:12:31.718398 [debug] [MainThread]: Command end result
[0m23:12:31.745658 [info ] [MainThread]: 
[0m23:12:31.746009 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:12:31.746167 [info ] [MainThread]: 
[0m23:12:31.746345 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m23:12:31.749321 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.299078, "process_user_time": 2.666491, "process_kernel_time": 2.29294, "process_mem_max_rss": "194887680", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:12:31.750072 [debug] [MainThread]: Command `dbt run` succeeded at 23:12:31.750004 after 15.30 seconds
[0m23:12:31.750510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101250650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101156d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1011c7fd0>]}
[0m23:12:31.750694 [debug] [MainThread]: Flushing usage events
[0m08:38:56.251352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13285b210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1328bd5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1328bdc10>]}


============================== 08:38:56.253754 | c291f49e-606d-4451-a0db-fe95e8ef0a2d ==============================
[0m08:38:56.253754 [info ] [MainThread]: Running with dbt=1.8.0
[0m08:38:56.254011 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:38:57.066890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c291f49e-606d-4451-a0db-fe95e8ef0a2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137eeaf50>]}
[0m08:38:57.085222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c291f49e-606d-4451-a0db-fe95e8ef0a2d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1322009d0>]}
[0m08:38:57.085743 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m08:38:57.095961 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m08:38:57.154585 [debug] [MainThread]: Partial parsing enabled: 5 files deleted, 9 files added, 0 files changed.
[0m08:38:57.154872 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m08:38:57.155026 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/_stg_models.yml
[0m08:38:57.155148 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/intermediate/int_current_data.sql
[0m08:38:57.155260 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/intermediate/int_contract_prices.sql
[0m08:38:57.155372 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/intermediate/int_changes.sql
[0m08:38:57.155493 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/intermediate/int_new_data.sql
[0m08:38:57.155601 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m08:38:57.155724 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/_stg_sources.yml
[0m08:38:57.155830 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m08:38:57.156034 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/stage/stg_contract.sql
[0m08:38:57.156167 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/stage/stg_products.sql
[0m08:38:57.156267 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/stage/stg_prices.sql
[0m08:38:57.305913 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_products' (models/staging/stg_products.sql) depends on a source named 'raw.products' which was not found
[0m08:38:57.307568 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0857905, "process_user_time": 1.381904, "process_kernel_time": 2.320642, "process_mem_max_rss": "185810944", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:38:57.307831 [debug] [MainThread]: Command `dbt run` failed at 08:38:57.307786 after 1.09 seconds
[0m08:38:57.307993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f76cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142b4bf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1441402d0>]}
[0m08:38:57.308143 [debug] [MainThread]: Flushing usage events
[0m08:39:48.679776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13715a810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137160a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137181e90>]}


============================== 08:39:48.682998 | 2a5f0067-fb4f-405c-bc8a-dbf878ace516 ==============================
[0m08:39:48.682998 [info ] [MainThread]: Running with dbt=1.8.0
[0m08:39:48.683356 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select staging', 'send_anonymous_usage_stats': 'True'}
[0m08:39:49.324994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2a5f0067-fb4f-405c-bc8a-dbf878ace516', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a60d250>]}
[0m08:39:49.343223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2a5f0067-fb4f-405c-bc8a-dbf878ace516', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130b00c10>]}
[0m08:39:49.343765 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m08:39:49.354037 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m08:39:49.390897 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m08:39:49.391202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '2a5f0067-fb4f-405c-bc8a-dbf878ace516', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127932b50>]}
[0m08:39:50.138537 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_products' (models/staging/stg_products.sql) depends on a source named 'raw.products' which was not found
[0m08:39:50.141706 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4948053, "process_user_time": 2.516424, "process_kernel_time": 1.675549, "process_mem_max_rss": "191348736", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:39:50.142184 [debug] [MainThread]: Command `dbt run` failed at 08:39:50.142125 after 1.50 seconds
[0m08:39:50.142448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1022eacd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137181a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137181ad0>]}
[0m08:39:50.142710 [debug] [MainThread]: Flushing usage events
[0m08:42:05.377798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13245b910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1324bd050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1324bd6d0>]}


============================== 08:42:05.380435 | 7084221b-cf1c-4d65-b227-abd108fe462f ==============================
[0m08:42:05.380435 [info ] [MainThread]: Running with dbt=1.8.0
[0m08:42:05.380717 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select staging', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:42:06.070836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7084221b-cf1c-4d65-b227-abd108fe462f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135a87050>]}
[0m08:42:06.088924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7084221b-cf1c-4d65-b227-abd108fe462f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127d00b10>]}
[0m08:42:06.089471 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m08:42:06.099884 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m08:42:06.139668 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m08:42:06.140012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '7084221b-cf1c-4d65-b227-abd108fe462f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1324da810>]}
[0m08:42:06.627141 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_products' (models/staging/stg_products.sql) depends on a source named 'raw.products' which was not found
[0m08:42:06.629408 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.2795027, "process_user_time": 1.904465, "process_kernel_time": 2.473801, "process_mem_max_rss": "192364544", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:42:06.629725 [debug] [MainThread]: Command `dbt run` failed at 08:42:06.629680 after 1.28 seconds
[0m08:42:06.629903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100926cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137dd9250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1324bc050>]}
[0m08:42:06.630049 [debug] [MainThread]: Flushing usage events
[0m08:42:52.179104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d157c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d1bce90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d1bd510>]}


============================== 08:42:52.181818 | c010f6ab-67d6-4fdc-88fd-b48255c705e2 ==============================
[0m08:42:52.181818 [info ] [MainThread]: Running with dbt=1.8.0
[0m08:42:52.182097 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select staging', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:42:52.884391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c010f6ab-67d6-4fdc-88fd-b48255c705e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fa67890>]}
[0m08:42:52.903823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c010f6ab-67d6-4fdc-88fd-b48255c705e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ba72fd0>]}
[0m08:42:52.904500 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m08:42:52.916193 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m08:42:52.959022 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m08:42:52.959350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c010f6ab-67d6-4fdc-88fd-b48255c705e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ba2eb10>]}
[0m08:42:53.447793 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_products' (models/staging/stg_products.sql) depends on a source named 'raw.products' which was not found
[0m08:42:53.450225 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3083276, "process_user_time": 1.891107, "process_kernel_time": 2.485979, "process_mem_max_rss": "189743104", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:42:53.450635 [debug] [MainThread]: Command `dbt run` failed at 08:42:53.450553 after 1.31 seconds
[0m08:42:53.450840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d1bd3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10251acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d197490>]}
[0m08:42:53.451018 [debug] [MainThread]: Flushing usage events
[0m08:44:18.167720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d61f3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d0ec790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d65acd0>]}


============================== 08:44:18.170295 | fdb41e34-bc09-4471-b510-be3a1d92bcf0 ==============================
[0m08:44:18.170295 [info ] [MainThread]: Running with dbt=1.8.0
[0m08:44:18.170604 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select staging', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:44:18.802556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fdb41e34-bc09-4471-b510-be3a1d92bcf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b3eb090>]}
[0m08:44:18.820343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fdb41e34-bc09-4471-b510-be3a1d92bcf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128673450>]}
[0m08:44:18.820820 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m08:44:18.831146 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m08:44:18.870418 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m08:44:18.870733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fdb41e34-bc09-4471-b510-be3a1d92bcf0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128632f90>]}
[0m08:44:19.351550 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_products' (models/staging/stg_products.sql) depends on a source named 'raw.products' which was not found
[0m08:44:19.354034 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.2166587, "process_user_time": 1.780543, "process_kernel_time": 2.502908, "process_mem_max_rss": "198918144", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:44:19.354287 [debug] [MainThread]: Command `dbt run` failed at 08:44:19.354248 after 1.22 seconds
[0m08:44:19.354447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d61d910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104afecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d6814d0>]}
[0m08:44:19.354587 [debug] [MainThread]: Flushing usage events
[0m08:46:47.050004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16871fc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168781190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1687817d0>]}


============================== 08:46:47.052540 | 4c725645-7079-4aa8-acc0-4472a3c101b9 ==============================
[0m08:46:47.052540 [info ] [MainThread]: Running with dbt=1.8.0
[0m08:46:47.052823 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:46:47.062863 [info ] [MainThread]: dbt version: 1.8.0
[0m08:46:47.063113 [info ] [MainThread]: python version: 3.11.9
[0m08:46:47.063257 [info ] [MainThread]: python path: /opt/homebrew/opt/python@3.11/bin/python3.11
[0m08:46:47.063454 [info ] [MainThread]: os info: macOS-14.1-arm64-arm-64bit
[0m08:46:47.764103 [info ] [MainThread]: Using profiles dir at /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt
[0m08:46:47.764488 [info ] [MainThread]: Using profiles.yml file at /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/profiles.yml
[0m08:46:47.764695 [info ] [MainThread]: Using dbt_project.yml file at /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_project.yml
[0m08:46:47.765135 [info ] [MainThread]: adapter type: snowflake
[0m08:46:47.765275 [info ] [MainThread]: adapter version: 1.8.3
[0m08:46:47.809466 [info ] [MainThread]: Configuration:
[0m08:46:47.810258 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m08:46:47.810709 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m08:46:47.811065 [info ] [MainThread]: Required dependencies:
[0m08:46:47.811581 [debug] [MainThread]: Executing "git --help"
[0m08:46:47.824823 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m08:46:47.826142 [debug] [MainThread]: STDERR: "b''"
[0m08:46:47.826546 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m08:46:47.827163 [info ] [MainThread]: Connection:
[0m08:46:47.827463 [info ] [MainThread]:   account: oh95089.eu-central-1
[0m08:46:47.827595 [info ] [MainThread]:   user: SCHALLADBT
[0m08:46:47.827709 [info ] [MainThread]:   database: LB
[0m08:46:47.827816 [info ] [MainThread]:   warehouse: COMPUTE_WH
[0m08:46:47.827914 [info ] [MainThread]:   role: ACCOUNTADMIN
[0m08:46:47.828022 [info ] [MainThread]:   schema: STAGE
[0m08:46:47.828123 [info ] [MainThread]:   authenticator: None
[0m08:46:47.828227 [info ] [MainThread]:   oauth_client_id: None
[0m08:46:47.828329 [info ] [MainThread]:   query_tag: None
[0m08:46:47.828430 [info ] [MainThread]:   client_session_keep_alive: False
[0m08:46:47.828530 [info ] [MainThread]:   host: None
[0m08:46:47.828933 [info ] [MainThread]:   port: None
[0m08:46:47.829107 [info ] [MainThread]:   proxy_host: None
[0m08:46:47.829226 [info ] [MainThread]:   proxy_port: None
[0m08:46:47.829336 [info ] [MainThread]:   protocol: None
[0m08:46:47.829440 [info ] [MainThread]:   connect_retries: 1
[0m08:46:47.829540 [info ] [MainThread]:   connect_timeout: None
[0m08:46:47.829643 [info ] [MainThread]:   retry_on_database_errors: False
[0m08:46:47.829746 [info ] [MainThread]:   retry_all: False
[0m08:46:47.829845 [info ] [MainThread]:   insecure_mode: False
[0m08:46:47.829951 [info ] [MainThread]:   reuse_connections: None
[0m08:46:47.830288 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m08:46:47.835636 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m08:46:47.840050 [debug] [MainThread]: Using snowflake connection "debug"
[0m08:46:47.840565 [debug] [MainThread]: On debug: select 1 as id
[0m08:46:47.841256 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:46:48.414067 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.573 seconds
[0m08:46:48.414778 [debug] [MainThread]: On debug: Close
[0m08:46:48.521023 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m08:46:48.521377 [info ] [MainThread]: [32mAll checks passed![0m
[0m08:46:48.523700 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.5065612, "process_user_time": 1.623703, "process_kernel_time": 2.222085, "process_mem_max_rss": "177717248", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:46:48.524696 [debug] [MainThread]: Command `dbt debug` succeeded at 08:46:48.524608 after 1.51 seconds
[0m08:46:48.525191 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m08:46:48.525549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10508c690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f92d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e5994d0>]}
[0m08:46:48.526241 [debug] [MainThread]: Flushing usage events
[0m08:46:53.430268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c957d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134cb9190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134cb9810>]}


============================== 08:46:53.432812 | 30f36957-8ff0-4bb8-b41f-20ff3c1c1adf ==============================
[0m08:46:53.432812 [info ] [MainThread]: Running with dbt=1.8.0
[0m08:46:53.433099 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m08:46:54.026344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '30f36957-8ff0-4bb8-b41f-20ff3c1c1adf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141935d50>]}
[0m08:46:54.045755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '30f36957-8ff0-4bb8-b41f-20ff3c1c1adf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133cfca50>]}
[0m08:46:54.046349 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m08:46:54.057187 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m08:46:54.098038 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m08:46:54.098352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '30f36957-8ff0-4bb8-b41f-20ff3c1c1adf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132d2ebd0>]}
[0m08:46:54.582086 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_products' (models/staging/stg_products.sql) depends on a source named 'raw.products' which was not found
[0m08:46:54.583327 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1820287, "process_user_time": 1.920646, "process_kernel_time": 1.994834, "process_mem_max_rss": "187432960", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:46:54.583628 [debug] [MainThread]: Command `dbt run` failed at 08:46:54.583571 after 1.18 seconds
[0m08:46:54.583799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134cb96d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103006d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141f9bc10>]}
[0m08:46:54.583950 [debug] [MainThread]: Flushing usage events
[0m08:49:54.824554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12005b2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1200ada90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1200ae110>]}


============================== 08:49:54.826804 | 46ddce5d-94d9-4ccb-8c50-43d7d90d71b5 ==============================
[0m08:49:54.826804 [info ] [MainThread]: Running with dbt=1.8.0
[0m08:49:54.827066 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:49:55.458855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '46ddce5d-94d9-4ccb-8c50-43d7d90d71b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124d37250>]}
[0m08:49:55.476327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '46ddce5d-94d9-4ccb-8c50-43d7d90d71b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fb00c10>]}
[0m08:49:55.476803 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m08:49:55.487591 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m08:49:55.525512 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m08:49:55.526006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '46ddce5d-94d9-4ccb-8c50-43d7d90d71b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e932cd0>]}
[0m08:49:56.009175 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_products' (models/staging/stg_products.sql) depends on a source named 'source.products' which was not found
[0m08:49:56.011466 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.2142403, "process_user_time": 1.915014, "process_kernel_time": 2.353013, "process_mem_max_rss": "192184320", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:49:56.011704 [debug] [MainThread]: Command `dbt run` failed at 08:49:56.011662 after 1.21 seconds
[0m08:49:56.011873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ff6cad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102672cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12005a810>]}
[0m08:49:56.012012 [debug] [MainThread]: Flushing usage events
[0m08:50:44.038816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fc1a350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fc81790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fc81e10>]}


============================== 08:50:44.041531 | 0e18a2fd-7bf0-4401-95b3-93c5025bb431 ==============================
[0m08:50:44.041531 [info ] [MainThread]: Running with dbt=1.8.0
[0m08:50:44.041792 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:50:44.718185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0e18a2fd-7bf0-4401-95b3-93c5025bb431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e214790>]}
[0m08:50:44.736905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0e18a2fd-7bf0-4401-95b3-93c5025bb431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f2fca90>]}
[0m08:50:44.737531 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m08:50:44.749233 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m08:50:44.802412 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m08:50:44.802806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0e18a2fd-7bf0-4401-95b3-93c5025bb431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e22eb90>]}
[0m08:50:45.348064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0e18a2fd-7bf0-4401-95b3-93c5025bb431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fd6ee50>]}
[0m08:50:45.392454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0e18a2fd-7bf0-4401-95b3-93c5025bb431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x282a00cd0>]}
[0m08:50:45.392730 [info ] [MainThread]: Found 10 models, 3 seeds, 3 sources, 448 macros
[0m08:50:45.392882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0e18a2fd-7bf0-4401-95b3-93c5025bb431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e431b50>]}
[0m08:50:45.393574 [info ] [MainThread]: 
[0m08:50:45.393805 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:50:45.395639 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m08:50:45.401312 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m08:50:45.401535 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m08:50:45.401667 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:50:45.974599 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.573 seconds
[0m08:50:45.977869 [debug] [ThreadPool]: On list_LB: Close
[0m08:50:46.108681 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dwh_mart)
[0m08:50:46.127642 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m08:50:46.128146 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m08:50:46.128506 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:50:46.664346 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.536 seconds
[0m08:50:46.669384 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m08:50:46.785802 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m08:50:46.791034 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m08:50:46.791607 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m08:50:46.791916 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:50:47.251109 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.459 seconds
[0m08:50:47.255144 [debug] [ThreadPool]: On list_LB_stage: Close
[0m08:50:47.369630 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_STAGE)
[0m08:50:47.375830 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m08:50:47.376385 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m08:50:47.376726 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:50:47.783862 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.407 seconds
[0m08:50:47.785652 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m08:50:47.900480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0e18a2fd-7bf0-4401-95b3-93c5025bb431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fdd6dd0>]}
[0m08:50:47.901708 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:50:47.902347 [info ] [MainThread]: 
[0m08:50:47.905851 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m08:50:47.906586 [info ] [Thread-1 (]: 1 of 3 START sql table model stage.stg_contract ................................ [RUN]
[0m08:50:47.907150 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.stg_contract)
[0m08:50:47.907578 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m08:50:47.915526 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m08:50:47.916708 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m08:50:47.927823 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m08:50:47.928112 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m08:50:47.928274 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:50:48.516961 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.588 seconds
[0m08:50:48.518312 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m08:50:48.518731 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m08:50:48.518887 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m08:50:48.595022 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.076 seconds
[0m08:50:48.603131 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m08:50:48.604431 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m08:50:48.604625 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m08:50:50.207564 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.603 seconds
[0m08:50:50.230470 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m08:50:50.340063 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e18a2fd-7bf0-4401-95b3-93c5025bb431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x283ddcbd0>]}
[0m08:50:50.341632 [info ] [Thread-1 (]: 1 of 3 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 2.43s]
[0m08:50:50.342508 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m08:50:50.343045 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m08:50:50.343797 [info ] [Thread-1 (]: 2 of 3 START sql table model stage.stg_prices .................................. [RUN]
[0m08:50:50.344448 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m08:50:50.344852 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m08:50:50.351583 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m08:50:50.352422 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m08:50:50.354461 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m08:50:50.354801 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m08:50:50.355007 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:50:50.773217 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.418 seconds
[0m08:50:50.775209 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m08:50:50.776000 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m08:50:50.776393 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m08:50:50.861137 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m08:50:50.864117 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m08:50:50.865638 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m08:50:50.866223 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m08:50:52.080757 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.214 seconds
[0m08:50:52.083693 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m08:50:52.212138 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e18a2fd-7bf0-4401-95b3-93c5025bb431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fd29dd0>]}
[0m08:50:52.213642 [info ] [Thread-1 (]: 2 of 3 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.87s]
[0m08:50:52.214576 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m08:50:52.215931 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m08:50:52.216930 [info ] [Thread-1 (]: 3 of 3 START sql table model stage.stg_products ................................ [RUN]
[0m08:50:52.220096 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m08:50:52.220670 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m08:50:52.226794 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m08:50:52.228084 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m08:50:52.232239 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m08:50:52.233003 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m08:50:52.233496 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:50:52.655108 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.421 seconds
[0m08:50:52.657833 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m08:50:52.658926 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m08:50:52.659455 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m08:50:52.746287 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m08:50:52.749963 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m08:50:52.751912 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m08:50:52.752493 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m08:50:53.533429 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.780 seconds
[0m08:50:53.534835 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m08:50:53.631569 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e18a2fd-7bf0-4401-95b3-93c5025bb431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049dbd90>]}
[0m08:50:53.632380 [info ] [Thread-1 (]: 3 of 3 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.41s]
[0m08:50:53.632829 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m08:50:53.639560 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:50:53.639885 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m08:50:53.641086 [info ] [MainThread]: 
[0m08:50:53.641793 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 8.25 seconds (8.25s).
[0m08:50:53.645518 [debug] [MainThread]: Command end result
[0m08:50:53.735708 [info ] [MainThread]: 
[0m08:50:53.736113 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:50:53.736254 [info ] [MainThread]: 
[0m08:50:53.736405 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:50:53.738158 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.729024, "process_user_time": 2.483075, "process_kernel_time": 2.630434, "process_mem_max_rss": "198246400", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:50:53.738482 [debug] [MainThread]: Command `dbt run` succeeded at 08:50:53.738436 after 9.73 seconds
[0m08:50:53.738756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fc838d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fc82110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045147d0>]}
[0m08:50:53.738916 [debug] [MainThread]: Flushing usage events
[0m08:52:41.645377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c359790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c3bd190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c3bd7d0>]}


============================== 08:52:41.647791 | 124ba24e-3b39-4aac-bacc-48c8d1209a41 ==============================
[0m08:52:41.647791 [info ] [MainThread]: Running with dbt=1.8.0
[0m08:52:41.648064 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:52:42.363781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '124ba24e-3b39-4aac-bacc-48c8d1209a41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15feaad50>]}
[0m08:52:42.383109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '124ba24e-3b39-4aac-bacc-48c8d1209a41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15bd00b90>]}
[0m08:52:42.383698 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m08:52:42.395689 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m08:52:42.454056 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:52:42.454289 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:52:42.470773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '124ba24e-3b39-4aac-bacc-48c8d1209a41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163d44f10>]}
[0m08:52:42.511770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '124ba24e-3b39-4aac-bacc-48c8d1209a41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163d893d0>]}
[0m08:52:42.512015 [info ] [MainThread]: Found 10 models, 3 seeds, 3 sources, 448 macros
[0m08:52:42.512161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '124ba24e-3b39-4aac-bacc-48c8d1209a41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163bb7ad0>]}
[0m08:52:42.512854 [info ] [MainThread]: 
[0m08:52:42.513096 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:52:42.514767 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m08:52:42.520699 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m08:52:42.520902 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m08:52:42.521031 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:52:43.149886 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.629 seconds
[0m08:52:43.151656 [debug] [ThreadPool]: On list_LB: Close
[0m08:52:43.253499 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m08:52:43.259762 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m08:52:43.259998 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m08:52:43.260169 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:52:43.756095 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.496 seconds
[0m08:52:43.757548 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m08:52:43.865075 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_dwh_mart)
[0m08:52:43.867756 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m08:52:43.867993 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m08:52:43.868189 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:52:44.337500 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.469 seconds
[0m08:52:44.339760 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m08:52:44.446644 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now list_LB_stage)
[0m08:52:44.451335 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m08:52:44.451983 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m08:52:44.452410 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:52:44.868577 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.416 seconds
[0m08:52:44.870089 [debug] [ThreadPool]: On list_LB_stage: Close
[0m08:52:44.978288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '124ba24e-3b39-4aac-bacc-48c8d1209a41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163bfbb10>]}
[0m08:52:44.979244 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m08:52:44.979647 [info ] [MainThread]: 
[0m08:52:44.982076 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m08:52:44.982420 [info ] [Thread-1 (]: 1 of 3 START sql table model stage.stg_contract ................................ [RUN]
[0m08:52:44.982670 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m08:52:44.982832 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m08:52:44.987330 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m08:52:44.987803 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m08:52:44.994045 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m08:52:44.994342 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
show parameters like 'query_tag' in session
[0m08:52:44.994497 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:52:45.421189 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.426 seconds
[0m08:52:45.424279 [debug] [Thread-1 (]: Setting query_tag to 'stg_contract'. Will reset to '' after materialization.
[0m08:52:45.425497 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m08:52:45.426074 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
alter session set query_tag = 'stg_contract'
[0m08:52:45.508347 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.082 seconds
[0m08:52:45.528761 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m08:52:45.530011 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m08:52:45.530293 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m08:52:46.581769 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.051 seconds
[0m08:52:46.602909 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m08:52:46.710667 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '124ba24e-3b39-4aac-bacc-48c8d1209a41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163e9f350>]}
[0m08:52:46.711647 [info ] [Thread-1 (]: 1 of 3 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.73s]
[0m08:52:46.712437 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m08:52:46.712946 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m08:52:46.713649 [info ] [Thread-1 (]: 2 of 3 START sql table model stage.stg_prices .................................. [RUN]
[0m08:52:46.714209 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m08:52:46.714676 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m08:52:46.717436 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m08:52:46.718240 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m08:52:46.721886 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m08:52:46.722251 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
show parameters like 'query_tag' in session
[0m08:52:46.722574 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:52:47.111156 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.388 seconds
[0m08:52:47.113215 [debug] [Thread-1 (]: Setting query_tag to 'stg_prices'. Will reset to '' after materialization.
[0m08:52:47.114412 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m08:52:47.114880 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
alter session set query_tag = 'stg_prices'
[0m08:52:47.227528 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.112 seconds
[0m08:52:47.230969 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m08:52:47.232553 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m08:52:47.232962 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m08:52:47.922573 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.689 seconds
[0m08:52:47.926631 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m08:52:48.046510 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '124ba24e-3b39-4aac-bacc-48c8d1209a41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a718f10>]}
[0m08:52:48.048231 [info ] [Thread-1 (]: 2 of 3 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.33s]
[0m08:52:48.050733 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m08:52:48.052169 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m08:52:48.053303 [info ] [Thread-1 (]: 3 of 3 START sql table model stage.stg_products ................................ [RUN]
[0m08:52:48.053879 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m08:52:48.054702 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m08:52:48.065550 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m08:52:48.066525 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m08:52:48.068681 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m08:52:48.068950 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
show parameters like 'query_tag' in session
[0m08:52:48.069105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:52:48.476819 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.408 seconds
[0m08:52:48.478208 [debug] [Thread-1 (]: Setting query_tag to 'stg_products'. Will reset to '' after materialization.
[0m08:52:48.479406 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m08:52:48.479906 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
alter session set query_tag = 'stg_products'
[0m08:52:48.564966 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.085 seconds
[0m08:52:48.565982 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m08:52:48.566476 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m08:52:48.566635 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m08:52:49.248147 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.681 seconds
[0m08:52:49.250771 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m08:52:49.358510 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '124ba24e-3b39-4aac-bacc-48c8d1209a41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x161090650>]}
[0m08:52:49.359662 [info ] [Thread-1 (]: 3 of 3 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.30s]
[0m08:52:49.360557 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m08:52:49.362695 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:52:49.363223 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m08:52:49.363801 [info ] [MainThread]: 
[0m08:52:49.364184 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.85 seconds (6.85s).
[0m08:52:49.365268 [debug] [MainThread]: Command end result
[0m08:52:49.397255 [info ] [MainThread]: 
[0m08:52:49.397752 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:52:49.397976 [info ] [MainThread]: 
[0m08:52:49.398209 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m08:52:49.400798 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.783431, "process_user_time": 2.509923, "process_kernel_time": 1.531721, "process_mem_max_rss": "192856064", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:52:49.401219 [debug] [MainThread]: Command `dbt run` succeeded at 08:52:49.401169 after 7.78 seconds
[0m08:52:49.401502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c39cd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c39d0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100d76e50>]}
[0m08:52:49.401689 [debug] [MainThread]: Flushing usage events
[0m09:00:23.393480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136f5bfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136f88450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136fbde90>]}


============================== 09:00:23.396006 | 08d98cb6-d9dd-4162-a9f5-2691f66d60c7 ==============================
[0m09:00:23.396006 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:00:23.396276 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select mart', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:00:24.128720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '08d98cb6-d9dd-4162-a9f5-2691f66d60c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136f9cfd0>]}
[0m09:00:24.147201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '08d98cb6-d9dd-4162-a9f5-2691f66d60c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136900d90>]}
[0m09:00:24.147699 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:00:24.158250 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:00:24.214643 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 1 files added, 4 files changed.
[0m09:00:24.214932 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/mart/fact_metrics.sql
[0m09:00:24.215059 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/mart/dim_product.sql
[0m09:00:24.215177 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/mart/dim_date.sql
[0m09:00:24.215284 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/mart/fact_contract.sql
[0m09:00:24.215445 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_new_data.sql
[0m09:00:24.215586 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_current_data.sql
[0m09:00:24.215722 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_contract_prices.sql
[0m09:00:24.215853 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_changes.sql
[0m09:00:24.284738 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.int_current_data' (models/intermediate/int_current_data.sql) depends on a node named 'metrics' which was not found
[0m09:00:24.286609 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.92219824, "process_user_time": 1.54439, "process_kernel_time": 2.476433, "process_mem_max_rss": "177782784", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:00:24.287140 [debug] [MainThread]: Command `dbt run` failed at 09:00:24.286867 after 0.92 seconds
[0m09:00:24.287350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042e2cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136fbd990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10435c250>]}
[0m09:00:24.287526 [debug] [MainThread]: Flushing usage events
[0m09:08:43.309317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13555a850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135596d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1355bdad0>]}


============================== 09:08:43.312113 | 818b08eb-f834-4700-bd1b-fdb5fc22a918 ==============================
[0m09:08:43.312113 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:08:43.312454 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select mart', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:08:43.957704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '818b08eb-f834-4700-bd1b-fdb5fc22a918', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e15f90>]}
[0m09:08:43.975363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '818b08eb-f834-4700-bd1b-fdb5fc22a918', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134dfca10>]}
[0m09:08:43.975857 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:08:43.986765 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:08:44.032244 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m09:08:44.032584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '818b08eb-f834-4700-bd1b-fdb5fc22a918', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142eddc90>]}
[0m09:08:44.544559 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.int_current_data' (models/intermediate/int_current_data.sql) depends on a node named 'metrics' which was not found
[0m09:08:44.546465 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.2670548, "process_user_time": 2.548576, "process_kernel_time": 1.652232, "process_mem_max_rss": "188284928", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:08:44.546737 [debug] [MainThread]: Command `dbt run` failed at 09:08:44.546691 after 1.27 seconds
[0m09:08:44.546903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135596d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135597d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142e8ecd0>]}
[0m09:08:44.547054 [debug] [MainThread]: Flushing usage events
[0m09:09:04.527775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12175b210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121797b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1217bd9d0>]}


============================== 09:09:04.530891 | 20fa1cc6-fbd0-4c91-82b5-43b73c541513 ==============================
[0m09:09:04.530891 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:09:04.531189 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select intermediate', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:09:05.245824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '20fa1cc6-fbd0-4c91-82b5-43b73c541513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131c08710>]}
[0m09:09:05.263688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '20fa1cc6-fbd0-4c91-82b5-43b73c541513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121100b90>]}
[0m09:09:05.264883 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:09:05.274723 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:09:05.313155 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m09:09:05.313461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '20fa1cc6-fbd0-4c91-82b5-43b73c541513', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ff32f50>]}
[0m09:09:05.808448 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.int_current_data' (models/intermediate/int_current_data.sql) depends on a node named 'metrics' which was not found
[0m09:09:05.810187 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.31299, "process_user_time": 1.914044, "process_kernel_time": 2.288495, "process_mem_max_rss": "186695680", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:09:05.810484 [debug] [MainThread]: Command `dbt run` failed at 09:09:05.810436 after 1.31 seconds
[0m09:09:05.810667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10449ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1217bd950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1320ff1d0>]}
[0m09:09:05.810830 [debug] [MainThread]: Flushing usage events
[0m09:10:57.186581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f997990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f9b54d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f9b5b50>]}


============================== 09:10:57.189007 | a36e6d02-f6b4-4483-837d-a09b7c1ec22f ==============================
[0m09:10:57.189007 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:10:57.189273 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select intermediate', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:10:57.837151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a36e6d02-f6b4-4483-837d-a09b7c1ec22f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f97b690>]}
[0m09:10:57.855055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a36e6d02-f6b4-4483-837d-a09b7c1ec22f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f0fca90>]}
[0m09:10:57.855541 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:10:57.865571 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:10:57.909114 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m09:10:57.909439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a36e6d02-f6b4-4483-837d-a09b7c1ec22f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f99ccd0>]}
[0m09:10:58.432128 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.int_contract_prices' (models/intermediate/int_contract_prices.sql) depends on a node named 'stg_contracts' which was not found
[0m09:10:58.433810 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.2767931, "process_user_time": 1.857876, "process_kernel_time": 2.499462, "process_mem_max_rss": "189317120", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:10:58.434095 [debug] [MainThread]: Command `dbt run` failed at 09:10:58.434050 after 1.28 seconds
[0m09:10:58.434278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f9b5a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1272a7c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f99c990>]}
[0m09:10:58.434446 [debug] [MainThread]: Flushing usage events
[0m09:12:12.036944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13165af90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1316bd3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1316bda10>]}


============================== 09:12:12.039508 | adaacb3b-f8e5-4aad-8822-1848ac4156ce ==============================
[0m09:12:12.039508 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:12:12.039783 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:12:12.942780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'adaacb3b-f8e5-4aad-8822-1848ac4156ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148e13c10>]}
[0m09:12:12.960810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'adaacb3b-f8e5-4aad-8822-1848ac4156ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127400c90>]}
[0m09:12:12.961310 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:12:12.971962 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:12:13.035724 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m09:12:13.036031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'adaacb3b-f8e5-4aad-8822-1848ac4156ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1461e2510>]}
[0m09:12:13.574397 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.int_contract_prices' (models/intermediate/int_contract_prices.sql) depends on a node named 'stg_contracts' which was not found
[0m09:12:13.575795 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.5732349, "process_user_time": 2.289486, "process_kernel_time": 2.225887, "process_mem_max_rss": "186728448", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:12:13.576042 [debug] [MainThread]: Command `dbt run` failed at 09:12:13.575998 after 1.57 seconds
[0m09:12:13.576214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1314307d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1009f6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14940bcd0>]}
[0m09:12:13.576365 [debug] [MainThread]: Flushing usage events
[0m09:12:40.247120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143997590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1439bd3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1439bda50>]}


============================== 09:12:40.249608 | 6fba15ef-5e17-4f09-9920-9b8669f6c25a ==============================
[0m09:12:40.249608 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:12:40.249884 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select mart', 'send_anonymous_usage_stats': 'True'}
[0m09:12:40.848702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6fba15ef-5e17-4f09-9920-9b8669f6c25a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149809090>]}
[0m09:12:40.866630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6fba15ef-5e17-4f09-9920-9b8669f6c25a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1432fca90>]}
[0m09:12:40.867837 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:12:40.878158 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:12:40.922048 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m09:12:40.922461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6fba15ef-5e17-4f09-9920-9b8669f6c25a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13702e9d0>]}
[0m09:12:41.523984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6fba15ef-5e17-4f09-9920-9b8669f6c25a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149ecf490>]}
[0m09:12:41.564252 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.int_changes --> model.snowflake_airflow_dbt.fact_metrics --> model.snowflake_airflow_dbt.int_current_data
[0m09:12:41.566801 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.int_changes --> model.snowflake_airflow_dbt.fact_metrics --> model.snowflake_airflow_dbt.int_current_data

[0m09:12:41.568658 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3490913, "process_user_time": 2.065494, "process_kernel_time": 2.38625, "process_mem_max_rss": "186204160", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:12:41.568958 [debug] [MainThread]: Command `dbt run` failed at 09:12:41.568906 after 1.35 seconds
[0m09:12:41.569150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100b92cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1439bd1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149f87cd0>]}
[0m09:12:41.569329 [debug] [MainThread]: Flushing usage events
[0m09:20:08.664961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122528850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1220f4110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1225816d0>]}


============================== 09:20:08.667753 | 23851ca5-0e72-42dc-84d1-0948536eb4d7 ==============================
[0m09:20:08.667753 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:20:08.668042 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select intermediate', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:20:09.346401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '23851ca5-0e72-42dc-84d1-0948536eb4d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1338fb710>]}
[0m09:20:09.363908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '23851ca5-0e72-42dc-84d1-0948536eb4d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121e00b90>]}
[0m09:20:09.364395 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:20:09.375364 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:20:09.429944 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 1 files added, 0 files changed.
[0m09:20:09.430250 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m09:20:09.430411 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_new_data.sql
[0m09:20:09.430528 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_current_data.sql
[0m09:20:09.430637 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_contract_prices.sql
[0m09:20:09.430741 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_changes.sql
[0m09:20:09.492284 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.int_view_contract' (models/intermediate/int_view_contract.sql) depends on a node named 'stg_contracts' which was not found
[0m09:20:09.493934 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.85929704, "process_user_time": 2.146484, "process_kernel_time": 1.690602, "process_mem_max_rss": "189775872", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:20:09.494253 [debug] [MainThread]: Command `dbt run` failed at 09:20:09.494212 after 0.86 seconds
[0m09:20:09.494430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12255bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051a6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122583190>]}
[0m09:20:09.494580 [debug] [MainThread]: Flushing usage events
[0m09:20:20.833803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129958ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1299bd410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1299bda90>]}


============================== 09:20:20.836020 | c1172972-51b2-4d5b-a852-c0d1648c3228 ==============================
[0m09:20:20.836020 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:20:20.836284 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select intermediate', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:20:21.413150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1172972-51b2-4d5b-a852-c0d1648c3228', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f8eaf10>]}
[0m09:20:21.437049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1172972-51b2-4d5b-a852-c0d1648c3228', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129400d10>]}
[0m09:20:21.438107 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:20:21.454635 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:20:21.553080 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 1 files added, 0 files changed.
[0m09:20:21.553396 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m09:20:21.553536 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_contract_prices.sql
[0m09:20:21.553655 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_current_data.sql
[0m09:20:21.553796 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_changes.sql
[0m09:20:21.553909 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_new_data.sql
[0m09:20:21.616922 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.int_view_contract' (models/intermediate/int_view_contract.sql) depends on a node named 'metrics' which was not found
[0m09:20:21.618350 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8119619, "process_user_time": 1.469107, "process_kernel_time": 2.227625, "process_mem_max_rss": "182992896", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:20:21.618649 [debug] [MainThread]: Command `dbt run` failed at 09:20:21.618610 after 0.81 seconds
[0m09:20:21.618824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12986cb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100742cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fddd610>]}
[0m09:20:21.618985 [debug] [MainThread]: Flushing usage events
[0m09:24:53.748977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fa55790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fab9110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fab9750>]}


============================== 09:24:53.751808 | 8c94b00b-7a7d-4b4d-ace2-d487f638a5f5 ==============================
[0m09:24:53.751808 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:24:53.752101 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select intermediate', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:24:54.442069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c94b00b-7a7d-4b4d-ace2-d487f638a5f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fa97a10>]}
[0m09:24:54.461007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c94b00b-7a7d-4b4d-ace2-d487f638a5f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e372e90>]}
[0m09:24:54.461614 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:24:54.473116 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:24:54.535996 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 1 files added, 1 files changed.
[0m09:24:54.536284 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m09:24:54.536415 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_contract_prices.sql
[0m09:24:54.536526 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_current_data.sql
[0m09:24:54.536664 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_changes.sql
[0m09:24:54.536771 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_new_data.sql
[0m09:24:54.536892 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_metrics.sql
[0m09:24:54.599033 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.int_view_contract' (models/intermediate/int_view_contract.sql) depends on a node named 'metrics' which was not found
[0m09:24:54.600581 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8849739, "process_user_time": 1.424617, "process_kernel_time": 2.338671, "process_mem_max_rss": "187072512", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:24:54.600865 [debug] [MainThread]: Command `dbt run` failed at 09:24:54.600823 after 0.89 seconds
[0m09:24:54.601038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f96c810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104422cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fcf7a90>]}
[0m09:24:54.601197 [debug] [MainThread]: Flushing usage events
[0m09:25:10.871032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c65abd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c3f4110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c6bd690>]}


============================== 09:25:10.873566 | 1a62d393-05d8-4195-98cf-d09e9dfcf65a ==============================
[0m09:25:10.873566 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:25:10.873848 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select intermediate', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:25:11.462785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a62d393-05d8-4195-98cf-d09e9dfcf65a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15fae4b10>]}
[0m09:25:11.481058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a62d393-05d8-4195-98cf-d09e9dfcf65a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c100c90>]}
[0m09:25:11.481647 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:25:11.497517 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:25:11.570140 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 1 files added, 1 files changed.
[0m09:25:11.570538 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m09:25:11.570866 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_changes.sql
[0m09:25:11.571087 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_contract_prices.sql
[0m09:25:11.571252 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_current_data.sql
[0m09:25:11.571499 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_new_data.sql
[0m09:25:11.571691 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_metrics.sql
[0m09:25:11.674970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1a62d393-05d8-4195-98cf-d09e9dfcf65a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169980d50>]}
[0m09:25:11.768758 [error] [MainThread]: Encountered an error:
Found a cycle: model.snowflake_airflow_dbt.int_view_contract --> model.snowflake_airflow_dbt.fact_metrics
[0m09:25:11.771183 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 568, in run
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 506, in run
    self._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/compile.py", line 125, in _runtime_initialize
    super()._runtime_initialize()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/runnable.py", line 147, in _runtime_initialize
    self.compile_manifest()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/base.py", line 145, in compile_manifest
    self.graph = self.compiler.compile(self.manifest)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 449, in compile
    linker.link_graph(manifest)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/compilation.py", line 192, in link_graph
    raise RuntimeError("Found a cycle: {}".format(cycle))
RuntimeError: Found a cycle: model.snowflake_airflow_dbt.int_view_contract --> model.snowflake_airflow_dbt.fact_metrics

[0m09:25:11.772967 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.92971003, "process_user_time": 1.673018, "process_kernel_time": 2.136789, "process_mem_max_rss": "186925056", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:25:11.773249 [debug] [MainThread]: Command `dbt run` failed at 09:25:11.773202 after 0.93 seconds
[0m09:25:11.773434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10101ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101098250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1693e9410>]}
[0m09:25:11.773599 [debug] [MainThread]: Flushing usage events
[0m09:30:30.186984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f41f810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f479110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f479790>]}


============================== 09:30:30.189453 | 3c5bd877-ef5c-4073-9e71-c351f13b5f51 ==============================
[0m09:30:30.189453 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:30:30.189711 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select intermediate', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:30:30.881615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3c5bd877-ef5c-4073-9e71-c351f13b5f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ecd4ad0>]}
[0m09:30:30.901772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3c5bd877-ef5c-4073-9e71-c351f13b5f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1243dd5d0>]}
[0m09:30:30.902483 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:30:30.915472 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:30:30.986251 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m09:30:30.986625 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_metrics.sql
[0m09:30:30.986799 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m09:30:31.078482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3c5bd877-ef5c-4073-9e71-c351f13b5f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1242908d0>]}
[0m09:30:31.162126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3c5bd877-ef5c-4073-9e71-c351f13b5f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1244454d0>]}
[0m09:30:31.162393 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 448 macros
[0m09:30:31.162545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3c5bd877-ef5c-4073-9e71-c351f13b5f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ecd4510>]}
[0m09:30:31.163166 [info ] [MainThread]: 
[0m09:30:31.163392 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:30:31.163754 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m09:30:31.169244 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m09:30:31.169431 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m09:30:31.169556 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:30:31.746792 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.577 seconds
[0m09:30:31.747791 [debug] [ThreadPool]: On list_LB: Close
[0m09:30:31.852689 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE)
[0m09:30:31.857617 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m09:30:31.857862 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m09:30:31.857988 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:30:33.310649 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.452 seconds
[0m09:30:33.316268 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m09:30:33.431978 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_stage)
[0m09:30:33.437307 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m09:30:33.437719 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m09:30:33.437978 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:30:34.082118 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.644 seconds
[0m09:30:34.085808 [debug] [ThreadPool]: On list_LB_stage: Close
[0m09:30:34.208631 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_dwh_mart)
[0m09:30:34.215101 [debug] [ThreadPool]: Using snowflake connection "list_LB_dwh_mart"
[0m09:30:34.215703 [debug] [ThreadPool]: On list_LB_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dwh_mart"} */
show objects in LB.dwh_mart limit 10000
[0m09:30:34.216112 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:30:34.611288 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.395 seconds
[0m09:30:34.613612 [debug] [ThreadPool]: On list_LB_dwh_mart: Close
[0m09:30:34.737857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3c5bd877-ef5c-4073-9e71-c351f13b5f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1243de150>]}
[0m09:30:34.739144 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:30:34.739733 [info ] [MainThread]: 
[0m09:30:34.743758 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m09:30:34.744603 [info ] [Thread-1 (]: 1 of 1 START sql view model dwh_mart.int_view_contract ......................... [RUN]
[0m09:30:34.745136 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dwh_mart, now model.snowflake_airflow_dbt.int_view_contract)
[0m09:30:34.745403 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m09:30:34.761048 [debug] [Thread-1 (]: Compilation Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  'dbt_utils' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m09:30:34.763205 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3c5bd877-ef5c-4073-9e71-c351f13b5f51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125cda210>]}
[0m09:30:34.763773 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model dwh_mart.int_view_contract ................ [[31mERROR[0m in 0.02s]
[0m09:30:34.764204 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m09:30:34.766401 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:30:34.766621 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m09:30:34.766841 [info ] [MainThread]: 
[0m09:30:34.767042 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.60 seconds (3.60s).
[0m09:30:34.767403 [debug] [MainThread]: Command end result
[0m09:30:34.795261 [info ] [MainThread]: 
[0m09:30:34.795592 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:30:34.795786 [info ] [MainThread]: 
[0m09:30:34.796077 [error] [MainThread]:   Compilation Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  'dbt_utils' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m09:30:34.796274 [info ] [MainThread]: 
[0m09:30:34.796758 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m09:30:34.800416 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.641782, "process_user_time": 1.80064, "process_kernel_time": 2.459923, "process_mem_max_rss": "193134592", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:30:34.801859 [debug] [MainThread]: Command `dbt run` failed at 09:30:34.801805 after 4.64 seconds
[0m09:30:34.802927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100fe2cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f45a3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d3f7fd0>]}
[0m09:30:34.803171 [debug] [MainThread]: Flushing usage events
[0m09:31:16.696628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc1f550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc81350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc81990>]}


============================== 09:31:16.699195 | 803b54dd-7620-4d14-a50a-be9e952a4a38 ==============================
[0m09:31:16.699195 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:31:16.699459 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt deps', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:31:16.809689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '803b54dd-7620-4d14-a50a-be9e952a4a38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc4c5d0>]}
[0m09:31:16.820650 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-5zwoowf1'
[0m09:31:16.820954 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:31:17.016956 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:31:17.018235 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
[0m09:31:17.134180 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
[0m09:31:17.135694 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `fishtown-analytics/dbt_utils` package is deprecated in favor of
`dbt-labs/dbt_utils`. Please update your `packages.yml` configuration to use
`dbt-labs/dbt_utils` instead.
[0m09:31:17.136381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '803b54dd-7620-4d14-a50a-be9e952a4a38', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc5a490>]}
[0m09:31:17.149374 [info ] [MainThread]: Updating lock file in file path: /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/package-lock.yml
[0m09:31:17.152962 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-3fpfr9ok'
[0m09:31:17.155187 [info ] [MainThread]: Installing fishtown-analytics/dbt_utils
[0m09:31:17.551265 [info ] [MainThread]: Installed from version 0.6.4
[0m09:31:17.551599 [info ] [MainThread]: Updated version available: 0.7.0
[0m09:31:17.551821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '803b54dd-7620-4d14-a50a-be9e952a4a38', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc5a810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc5a050>]}
[0m09:31:17.552062 [info ] [MainThread]: 
[0m09:31:17.552238 [info ] [MainThread]: Updates available for packages: ['fishtown-analytics/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m09:31:17.553904 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.88945174, "process_user_time": 1.719502, "process_kernel_time": 1.416465, "process_mem_max_rss": "113885184", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:31:17.554303 [debug] [MainThread]: Command `dbt deps` succeeded at 09:31:17.554234 after 0.89 seconds
[0m09:31:17.554525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100334990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bb30690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1003bec90>]}
[0m09:31:17.554723 [debug] [MainThread]: Flushing usage events
[0m09:32:25.125938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e21f950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e281410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e281a90>]}


============================== 09:32:25.128457 | f129d9c6-8f3d-462e-9fd1-0f9dfd695aae ==============================
[0m09:32:25.128457 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:32:25.128724 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate', 'send_anonymous_usage_stats': 'True'}
[0m09:32:25.767268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f129d9c6-8f3d-462e-9fd1-0f9dfd695aae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f8a4e50>]}
[0m09:32:25.787004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f129d9c6-8f3d-462e-9fd1-0f9dfd695aae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fb00ed0>]}
[0m09:32:25.787611 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:32:25.803694 [error] [MainThread]: Encountered an error:
Runtime Error
  Failed to read package: Runtime Error
    This version of dbt is not supported with the 'dbt_utils' package.
      Installed version of dbt: =1.8.0
      Required version of dbt for 'dbt_utils': ['>=0.18.0', '<0.20.0']
    Check for a different version of the 'dbt_utils' package, or run dbt again with --no-version-check
    
  
  Error encountered in /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_packages/dbt_utils/dbt_project.yml

Error encountered in /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_packages/dbt_utils
[0m09:32:25.805346 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.71883184, "process_user_time": 1.922003, "process_kernel_time": 1.906574, "process_mem_max_rss": "185008128", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:32:25.805671 [debug] [MainThread]: Command `dbt run` failed at 09:32:25.805625 after 0.72 seconds
[0m09:32:25.805884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e0f8450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f16cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f90250>]}
[0m09:32:25.806069 [debug] [MainThread]: Flushing usage events
[0m09:33:26.122903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe1fdd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe81210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe81850>]}


============================== 09:33:26.138853 | 55a828a4-a9e9-4cdd-bd25-0e38c071ed71 ==============================
[0m09:33:26.138853 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:33:26.139292 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:33:26.300624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55a828a4-a9e9-4cdd-bd25-0e38c071ed71', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f8eca90>]}
[0m09:33:26.320240 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-g7_tl7bi'
[0m09:33:26.320529 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:33:26.458472 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:33:26.459007 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
[0m09:33:26.771889 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
[0m09:33:26.773741 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `fishtown-analytics/dbt_utils` package is deprecated in favor of
`dbt-labs/dbt_utils`. Please update your `packages.yml` configuration to use
`dbt-labs/dbt_utils` instead.
[0m09:33:26.774390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '55a828a4-a9e9-4cdd-bd25-0e38c071ed71', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ff29410>]}
[0m09:33:26.776882 [error] [MainThread]: Encountered an error:
Could not find a matching compatible version for package fishtown-analytics/dbt_utils
  Requested range: =1.2.0, =1.2.0
  Compatible versions: ['0.0.1', '0.1.0', '0.1.1', '0.1.2', '0.1.3', '0.1.4', '0.1.5', '0.1.6', '0.1.7', '0.1.8', '0.1.9', '0.1.10', '0.1.11', '0.1.12', '0.1.13', '0.1.14', '0.1.15', '0.1.16', '0.1.17', '0.1.18', '0.1.19', '0.1.20', '0.1.21', '0.1.22', '0.1.23', '0.1.24', '0.1.25', '0.2.0', '0.2.1', '0.2.2', '0.2.3', '0.2.4', '0.2.5', '0.3.0', '0.4.0', '0.4.1', '0.5.0', '0.5.1', '0.6.0', '0.6.1', '0.6.2', '0.6.3', '0.6.4', '0.6.5', '0.6.6', '0.7.0']

  Not shown: package versions incompatible with installed version of dbt-core
  To include them, run 'dbt --no-version-check deps'
[0m09:33:26.781449 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 201, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 446, in deps
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/deps.py", line 225, in run
    self.lock()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/deps.py", line 194, in lock
    resolved_deps = resolve_packages(packages, self.project, self.cli_vars)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/deps/resolver.py", line 128, in resolve_packages
    target = final[package].resolved().fetch_metadata(project, renderer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/deps/registry.py", line 127, in resolved
    raise PackageVersionNotFoundError(
dbt.exceptions.PackageVersionNotFoundError: Could not find a matching compatible version for package fishtown-analytics/dbt_utils
  Requested range: =1.2.0, =1.2.0
  Compatible versions: ['0.0.1', '0.1.0', '0.1.1', '0.1.2', '0.1.3', '0.1.4', '0.1.5', '0.1.6', '0.1.7', '0.1.8', '0.1.9', '0.1.10', '0.1.11', '0.1.12', '0.1.13', '0.1.14', '0.1.15', '0.1.16', '0.1.17', '0.1.18', '0.1.19', '0.1.20', '0.1.21', '0.1.22', '0.1.23', '0.1.24', '0.1.25', '0.2.0', '0.2.1', '0.2.2', '0.2.3', '0.2.4', '0.2.5', '0.3.0', '0.4.0', '0.4.1', '0.5.0', '0.5.1', '0.6.0', '0.6.1', '0.6.2', '0.6.3', '0.6.4', '0.6.5', '0.6.6', '0.7.0']

  Not shown: package versions incompatible with installed version of dbt-core
  To include them, run 'dbt --no-version-check deps'

[0m09:33:26.784133 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_wall_clock_time": 0.6945475, "process_user_time": 1.181303, "process_kernel_time": 1.673845, "process_mem_max_rss": "114606080", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:33:26.784968 [debug] [MainThread]: Command `dbt deps` failed at 09:33:26.784864 after 0.70 seconds
[0m09:33:26.785202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1026cad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe81450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029c3fd0>]}
[0m09:33:26.785395 [debug] [MainThread]: Flushing usage events
[0m09:33:43.754832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156657810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1566bd010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1566bd690>]}


============================== 09:33:43.759568 | 42aca6b0-658b-4d56-a3b0-763901e54f73 ==============================
[0m09:33:43.759568 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:33:43.760460 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:33:43.793363 [error] [MainThread]: Encountered an error:
'version'
[0m09:33:43.795560 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 201, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 234, in wrapper
    project = load_project(
              ^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/config/runtime.py", line 51, in load_project
    project = Project.from_project_root(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/config/project.py", line 766, in from_project_root
    return partial.render(renderer)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/config/project.py", line 335, in render
    return self.create_project(rendered)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/config/project.py", line 482, in create_project
    packages: PackageConfig = package_config_from_data(
                              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/config/project.py", line 150, in package_config_from_data
    PackageConfig.validate(packages_data)
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/contracts/project.py", line 119, in validate
    if not package["version"]:
           ~~~~~~~^^^^^^^^^^^
KeyError: 'version'

[0m09:33:43.797252 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_wall_clock_time": 0.07416783, "process_user_time": 1.733847, "process_kernel_time": 0.984151, "process_mem_max_rss": "116883456", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:33:43.797568 [debug] [MainThread]: Command `dbt deps` failed at 09:33:43.797521 after 0.07 seconds
[0m09:33:43.797771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1566547d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103634990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156734190>]}
[0m09:33:43.797955 [debug] [MainThread]: Flushing usage events
[0m09:33:59.413479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec1b1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec60c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec81750>]}


============================== 09:33:59.415647 | 960306ac-ac50-4f80-babb-851fe6da54d5 ==============================
[0m09:33:59.415647 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:33:59.415921 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:33:59.503148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '960306ac-ac50-4f80-babb-851fe6da54d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ecd07d0>]}
[0m09:33:59.515836 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-uv_dyy2z'
[0m09:33:59.516146 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:33:59.638254 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:33:59.638699 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
[0m09:33:59.735183 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
[0m09:33:59.736336 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `fishtown-analytics/dbt_utils` package is deprecated in favor of
`dbt-labs/dbt_utils`. Please update your `packages.yml` configuration to use
`dbt-labs/dbt_utils` instead.
[0m09:33:59.736798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '960306ac-ac50-4f80-babb-851fe6da54d5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec5bed0>]}
[0m09:33:59.738059 [error] [MainThread]: Encountered an error:
Could not find a matching compatible version for package fishtown-analytics/dbt_utils
  Requested range: =1.2.0, =1.2.0
  Compatible versions: ['0.0.1', '0.1.0', '0.1.1', '0.1.2', '0.1.3', '0.1.4', '0.1.5', '0.1.6', '0.1.7', '0.1.8', '0.1.9', '0.1.10', '0.1.11', '0.1.12', '0.1.13', '0.1.14', '0.1.15', '0.1.16', '0.1.17', '0.1.18', '0.1.19', '0.1.20', '0.1.21', '0.1.22', '0.1.23', '0.1.24', '0.1.25', '0.2.0', '0.2.1', '0.2.2', '0.2.3', '0.2.4', '0.2.5', '0.3.0', '0.4.0', '0.4.1', '0.5.0', '0.5.1', '0.6.0', '0.6.1', '0.6.2', '0.6.3', '0.6.4', '0.6.5', '0.6.6', '0.7.0']

  Not shown: package versions incompatible with installed version of dbt-core
  To include them, run 'dbt --no-version-check deps'
[0m09:33:59.740049 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 201, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 446, in deps
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/deps.py", line 225, in run
    self.lock()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/deps.py", line 194, in lock
    resolved_deps = resolve_packages(packages, self.project, self.cli_vars)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/deps/resolver.py", line 128, in resolve_packages
    target = final[package].resolved().fetch_metadata(project, renderer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/deps/registry.py", line 127, in resolved
    raise PackageVersionNotFoundError(
dbt.exceptions.PackageVersionNotFoundError: Could not find a matching compatible version for package fishtown-analytics/dbt_utils
  Requested range: =1.2.0, =1.2.0
  Compatible versions: ['0.0.1', '0.1.0', '0.1.1', '0.1.2', '0.1.3', '0.1.4', '0.1.5', '0.1.6', '0.1.7', '0.1.8', '0.1.9', '0.1.10', '0.1.11', '0.1.12', '0.1.13', '0.1.14', '0.1.15', '0.1.16', '0.1.17', '0.1.18', '0.1.19', '0.1.20', '0.1.21', '0.1.22', '0.1.23', '0.1.24', '0.1.25', '0.2.0', '0.2.1', '0.2.2', '0.2.3', '0.2.4', '0.2.5', '0.3.0', '0.4.0', '0.4.1', '0.5.0', '0.5.1', '0.6.0', '0.6.1', '0.6.2', '0.6.3', '0.6.4', '0.6.5', '0.6.6', '0.7.0']

  Not shown: package versions incompatible with installed version of dbt-core
  To include them, run 'dbt --no-version-check deps'

[0m09:33:59.741333 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_wall_clock_time": 0.35457316, "process_user_time": 1.611772, "process_kernel_time": 1.64018, "process_mem_max_rss": "118079488", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:33:59.741620 [debug] [MainThread]: Command `dbt deps` failed at 09:33:59.741577 after 0.35 seconds
[0m09:33:59.741792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f26d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec59e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fa0090>]}
[0m09:33:59.741952 [debug] [MainThread]: Flushing usage events
[0m09:34:58.862223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d637290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d6362d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d5f4c90>]}


============================== 09:34:58.865853 | 95844071-045f-4206-a497-822186296595 ==============================
[0m09:34:58.865853 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:34:58.866181 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:34:58.978592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '95844071-045f-4206-a497-822186296595', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d63c210>]}
[0m09:34:58.991737 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-kga509wz'
[0m09:34:58.992039 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:34:59.158625 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:34:59.159207 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
[0m09:34:59.386784 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
[0m09:34:59.388087 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `fishtown-analytics/dbt_utils` package is deprecated in favor of
`dbt-labs/dbt_utils`. Please update your `packages.yml` configuration to use
`dbt-labs/dbt_utils` instead.
[0m09:34:59.388429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '95844071-045f-4206-a497-822186296595', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d637a10>]}
[0m09:34:59.392621 [info ] [MainThread]: Updating lock file in file path: /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/package-lock.yml
[0m09:34:59.405850 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-j87hx82d'
[0m09:34:59.407103 [info ] [MainThread]: Installing fishtown-analytics/dbt_utils
[0m09:34:59.797007 [info ] [MainThread]: Installed from version 0.7.0
[0m09:34:59.797576 [info ] [MainThread]: Up to date!
[0m09:34:59.797881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '95844071-045f-4206-a497-822186296595', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d63ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d6378d0>]}
[0m09:34:59.800429 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.9701098, "process_user_time": 1.436505, "process_kernel_time": 1.815407, "process_mem_max_rss": "115572736", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:34:59.801209 [debug] [MainThread]: Command `dbt deps` succeeded at 09:34:59.801021 after 0.97 seconds
[0m09:34:59.801776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d50c750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d1f9290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100d96cd0>]}
[0m09:34:59.802045 [debug] [MainThread]: Flushing usage events
[0m09:35:08.359811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1321574d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131ef4110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132197b90>]}


============================== 09:35:08.362326 | 5c502715-5817-4ef9-b296-c49c06059b5b ==============================
[0m09:35:08.362326 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:35:08.362628 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select intermediate', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:35:09.246201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c502715-5817-4ef9-b296-c49c06059b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132155bd0>]}
[0m09:35:09.270627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c502715-5817-4ef9-b296-c49c06059b5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131afca50>]}
[0m09:35:09.271295 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:35:09.289576 [error] [MainThread]: Encountered an error:
Runtime Error
  Failed to read package: Runtime Error
    This version of dbt is not supported with the 'dbt_utils' package.
      Installed version of dbt: =1.8.0
      Required version of dbt for 'dbt_utils': ['>=0.20.0', '<0.21.0']
    Check for a different version of the 'dbt_utils' package, or run dbt again with --no-version-check
    
  
  Error encountered in /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_packages/dbt_utils/dbt_project.yml

Error encountered in /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_packages/dbt_utils
[0m09:35:09.294145 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.96221143, "process_user_time": 1.75967, "process_kernel_time": 1.711614, "process_mem_max_rss": "175226880", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:35:09.294612 [debug] [MainThread]: Command `dbt run` failed at 09:35:09.294559 after 0.96 seconds
[0m09:35:09.295224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1321bd810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f66cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132188410>]}
[0m09:35:09.295591 [debug] [MainThread]: Flushing usage events
[0m09:35:40.482624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163e1fd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163fbd510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163fbdb90>]}


============================== 09:35:40.485741 | 0b1fc567-7593-4e75-86f8-09575c1bac03 ==============================
[0m09:35:40.485741 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:35:40.486047 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate', 'send_anonymous_usage_stats': 'True'}
[0m09:35:41.245436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0b1fc567-7593-4e75-86f8-09575c1bac03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167842650>]}
[0m09:35:41.264924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0b1fc567-7593-4e75-86f8-09575c1bac03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163900c10>]}
[0m09:35:41.265443 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:35:41.277032 [error] [MainThread]: Encountered an error:
Runtime Error
  Failed to read package: Runtime Error
    This version of dbt is not supported with the 'dbt_utils' package.
      Installed version of dbt: =1.8.0
      Required version of dbt for 'dbt_utils': ['>=0.20.0', '<0.21.0']
    Check for a different version of the 'dbt_utils' package, or run dbt again with --no-version-check
    
  
  Error encountered in /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_packages/dbt_utils/dbt_project.yml

Error encountered in /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_packages/dbt_utils
[0m09:35:41.279013 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8291086, "process_user_time": 1.255435, "process_kernel_time": 2.372503, "process_mem_max_rss": "178749440", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:35:41.279457 [debug] [MainThread]: Command `dbt run` failed at 09:35:41.279401 after 0.83 seconds
[0m09:35:41.279704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10084acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163fbd350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168ceb6d0>]}
[0m09:35:41.279898 [debug] [MainThread]: Flushing usage events
[0m09:35:44.749276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168b1f8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168b81090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168b81710>]}


============================== 09:35:44.751382 | ba6ca980-3055-4261-b4a4-4bf62e2c023b ==============================
[0m09:35:44.751382 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:35:44.751696 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt deps', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:35:44.808314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ba6ca980-3055-4261-b4a4-4bf62e2c023b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168b9e110>]}
[0m09:35:44.821277 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-g3y_ndfg'
[0m09:35:44.821581 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:35:44.939873 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:35:44.940508 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
[0m09:35:45.033068 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
[0m09:35:45.033683 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `fishtown-analytics/dbt_utils` package is deprecated in favor of
`dbt-labs/dbt_utils`. Please update your `packages.yml` configuration to use
`dbt-labs/dbt_utils` instead.
[0m09:35:45.033890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ba6ca980-3055-4261-b4a4-4bf62e2c023b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168b605d0>]}
[0m09:35:45.034761 [error] [MainThread]: Encountered an error:
Could not find a matching compatible version for package fishtown-analytics/dbt_utils
  Requested range: =0.20.1, =0.20.1
  Compatible versions: ['0.0.1', '0.1.0', '0.1.1', '0.1.2', '0.1.3', '0.1.4', '0.1.5', '0.1.6', '0.1.7', '0.1.8', '0.1.9', '0.1.10', '0.1.11', '0.1.12', '0.1.13', '0.1.14', '0.1.15', '0.1.16', '0.1.17', '0.1.18', '0.1.19', '0.1.20', '0.1.21', '0.1.22', '0.1.23', '0.1.24', '0.1.25', '0.2.0', '0.2.1', '0.2.2', '0.2.3', '0.2.4', '0.2.5', '0.3.0', '0.4.0', '0.4.1', '0.5.0', '0.5.1', '0.6.0', '0.6.1', '0.6.2', '0.6.3', '0.6.4', '0.6.5', '0.6.6', '0.7.0']

  Not shown: package versions incompatible with installed version of dbt-core
  To include them, run 'dbt --no-version-check deps'
[0m09:35:45.036916 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 201, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 446, in deps
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/deps.py", line 225, in run
    self.lock()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/deps.py", line 194, in lock
    resolved_deps = resolve_packages(packages, self.project, self.cli_vars)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/deps/resolver.py", line 128, in resolve_packages
    target = final[package].resolved().fetch_metadata(project, renderer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/deps/registry.py", line 127, in resolved
    raise PackageVersionNotFoundError(
dbt.exceptions.PackageVersionNotFoundError: Could not find a matching compatible version for package fishtown-analytics/dbt_utils
  Requested range: =0.20.1, =0.20.1
  Compatible versions: ['0.0.1', '0.1.0', '0.1.1', '0.1.2', '0.1.3', '0.1.4', '0.1.5', '0.1.6', '0.1.7', '0.1.8', '0.1.9', '0.1.10', '0.1.11', '0.1.12', '0.1.13', '0.1.14', '0.1.15', '0.1.16', '0.1.17', '0.1.18', '0.1.19', '0.1.20', '0.1.21', '0.1.22', '0.1.23', '0.1.24', '0.1.25', '0.2.0', '0.2.1', '0.2.2', '0.2.3', '0.2.4', '0.2.5', '0.3.0', '0.4.0', '0.4.1', '0.5.0', '0.5.1', '0.6.0', '0.6.1', '0.6.2', '0.6.3', '0.6.4', '0.6.5', '0.6.6', '0.7.0']

  Not shown: package versions incompatible with installed version of dbt-core
  To include them, run 'dbt --no-version-check deps'

[0m09:35:45.038078 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_wall_clock_time": 0.34499758, "process_user_time": 1.439699, "process_kernel_time": 1.331872, "process_mem_max_rss": "114180096", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:35:45.038372 [debug] [MainThread]: Command `dbt deps` failed at 09:35:45.038328 after 0.35 seconds
[0m09:35:45.038558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ba6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168b83650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168b81a10>]}
[0m09:35:45.038730 [debug] [MainThread]: Flushing usage events
[0m09:38:32.586489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a219fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a280f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a25acd0>]}


============================== 09:38:32.588844 | df06d1b5-f427-44f4-95f8-071d380fde93 ==============================
[0m09:38:32.588844 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:38:32.589113 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m09:38:32.700277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df06d1b5-f427-44f4-95f8-071d380fde93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a2f47d0>]}
[0m09:38:32.713894 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-s_in577w'
[0m09:38:32.714245 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:38:32.878499 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:38:32.879103 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
[0m09:38:33.263182 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
[0m09:38:33.265244 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `fishtown-analytics/dbt_utils` package is deprecated in favor of
`dbt-labs/dbt_utils`. Please update your `packages.yml` configuration to use
`dbt-labs/dbt_utils` instead.
[0m09:38:33.265865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'df06d1b5-f427-44f4-95f8-071d380fde93', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a328950>]}
[0m09:38:33.277354 [info ] [MainThread]: Updating lock file in file path: /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/package-lock.yml
[0m09:38:33.289216 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-mcnbk_gm'
[0m09:38:33.290364 [info ] [MainThread]: Installing fishtown-analytics/dbt_utils
[0m09:38:33.743847 [info ] [MainThread]: Installed from version 0.7.0
[0m09:38:33.744180 [info ] [MainThread]: Up to date!
[0m09:38:33.744391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'df06d1b5-f427-44f4-95f8-071d380fde93', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a280950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a328d10>]}
[0m09:38:33.747283 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 1.1905091, "process_user_time": 1.259927, "process_kernel_time": 2.071098, "process_mem_max_rss": "115245056", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:38:33.747869 [debug] [MainThread]: Command `dbt deps` succeeded at 09:38:33.747668 after 1.19 seconds
[0m09:38:33.748174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a283450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a281810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045a6cd0>]}
[0m09:38:33.748368 [debug] [MainThread]: Flushing usage events
[0m09:38:39.490257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13295bcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1329bd2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132996cd0>]}


============================== 09:38:39.492628 | 480f31f1-d617-4dc0-abf9-f09f4b761821 ==============================
[0m09:38:39.492628 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:38:39.492894 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select intermediate', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:38:40.115367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '480f31f1-d617-4dc0-abf9-f09f4b761821', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140017d50>]}
[0m09:38:40.135364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '480f31f1-d617-4dc0-abf9-f09f4b761821', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1322fc9d0>]}
[0m09:38:40.136012 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:38:40.148817 [error] [MainThread]: Encountered an error:
Runtime Error
  Failed to read package: Runtime Error
    This version of dbt is not supported with the 'dbt_utils' package.
      Installed version of dbt: =1.8.0
      Required version of dbt for 'dbt_utils': ['>=0.20.0', '<0.21.0']
    Check for a different version of the 'dbt_utils' package, or run dbt again with --no-version-check
    
  
  Error encountered in /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_packages/dbt_utils/dbt_project.yml

Error encountered in /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_packages/dbt_utils
[0m09:38:40.150661 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.68946093, "process_user_time": 1.881761, "process_kernel_time": 1.503138, "process_mem_max_rss": "176996352", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:38:40.150965 [debug] [MainThread]: Command `dbt run` failed at 09:38:40.150920 after 0.69 seconds
[0m09:38:40.151170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1329bd6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100de2cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140108d50>]}
[0m09:38:40.151347 [debug] [MainThread]: Flushing usage events
[0m09:39:14.783603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128d57810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128dbd250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128dbd8d0>]}


============================== 09:39:14.785905 | 34b0f1a4-b8f4-4526-8d63-1cfff8cab919 ==============================
[0m09:39:14.785905 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:39:14.786166 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt deps', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:39:14.896378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '34b0f1a4-b8f4-4526-8d63-1cfff8cab919', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128e01690>]}
[0m09:39:14.906484 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-hlzl7t4s'
[0m09:39:14.906726 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:39:15.015248 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:39:15.015812 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
[0m09:39:15.117897 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
[0m09:39:15.119738 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `fishtown-analytics/dbt_utils` package is deprecated in favor of
`dbt-labs/dbt_utils`. Please update your `packages.yml` configuration to use
`dbt-labs/dbt_utils` instead.
[0m09:39:15.120437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '34b0f1a4-b8f4-4526-8d63-1cfff8cab919', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128d97990>]}
[0m09:39:15.124186 [error] [MainThread]: Encountered an error:
Could not find a matching compatible version for package fishtown-analytics/dbt_utils
  Requested range: >=0.20.0, <0.21.0
  Compatible versions: ['0.0.1', '0.1.0', '0.1.1', '0.1.2', '0.1.3', '0.1.4', '0.1.5', '0.1.6', '0.1.7', '0.1.8', '0.1.9', '0.1.10', '0.1.11', '0.1.12', '0.1.13', '0.1.14', '0.1.15', '0.1.16', '0.1.17', '0.1.18', '0.1.19', '0.1.20', '0.1.21', '0.1.22', '0.1.23', '0.1.24', '0.1.25', '0.2.0', '0.2.1', '0.2.2', '0.2.3', '0.2.4', '0.2.5', '0.3.0', '0.4.0', '0.4.1', '0.5.0', '0.5.1', '0.6.0', '0.6.1', '0.6.2', '0.6.3', '0.6.4', '0.6.5', '0.6.6', '0.7.0']

  Not shown: package versions incompatible with installed version of dbt-core
  To include them, run 'dbt --no-version-check deps'
[0m09:39:15.128925 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 201, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 446, in deps
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/deps.py", line 225, in run
    self.lock()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/deps.py", line 194, in lock
    resolved_deps = resolve_packages(packages, self.project, self.cli_vars)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/deps/resolver.py", line 128, in resolve_packages
    target = final[package].resolved().fetch_metadata(project, renderer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/deps/registry.py", line 127, in resolved
    raise PackageVersionNotFoundError(
dbt.exceptions.PackageVersionNotFoundError: Could not find a matching compatible version for package fishtown-analytics/dbt_utils
  Requested range: >=0.20.0, <0.21.0
  Compatible versions: ['0.0.1', '0.1.0', '0.1.1', '0.1.2', '0.1.3', '0.1.4', '0.1.5', '0.1.6', '0.1.7', '0.1.8', '0.1.9', '0.1.10', '0.1.11', '0.1.12', '0.1.13', '0.1.14', '0.1.15', '0.1.16', '0.1.17', '0.1.18', '0.1.19', '0.1.20', '0.1.21', '0.1.22', '0.1.23', '0.1.24', '0.1.25', '0.2.0', '0.2.1', '0.2.2', '0.2.3', '0.2.4', '0.2.5', '0.3.0', '0.4.0', '0.4.1', '0.5.0', '0.5.1', '0.6.0', '0.6.1', '0.6.2', '0.6.3', '0.6.4', '0.6.5', '0.6.6', '0.7.0']

  Not shown: package versions incompatible with installed version of dbt-core
  To include them, run 'dbt --no-version-check deps'

[0m09:39:15.132219 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_wall_clock_time": 0.37854224, "process_user_time": 1.252973, "process_kernel_time": 2.095588, "process_mem_max_rss": "118226944", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:39:15.133080 [debug] [MainThread]: Command `dbt deps` failed at 09:39:15.132969 after 0.38 seconds
[0m09:39:15.133489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10315ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031d81d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031d8090>]}
[0m09:39:15.133832 [debug] [MainThread]: Flushing usage events
[0m09:40:40.920965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14635a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146380ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146381550>]}


============================== 09:40:40.924486 | 575fbc04-6d2b-4d05-84f8-aa10889e9155 ==============================
[0m09:40:40.924486 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:40:40.924792 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt --no-version-check deps', 'send_anonymous_usage_stats': 'True'}
[0m09:40:41.034478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '575fbc04-6d2b-4d05-84f8-aa10889e9155', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145df0b10>]}
[0m09:40:41.046187 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-04o2ff9b'
[0m09:40:41.046511 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:40:41.208813 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:40:41.209224 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
[0m09:40:41.523073 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
[0m09:40:41.525219 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `fishtown-analytics/dbt_utils` package is deprecated in favor of
`dbt-labs/dbt_utils`. Please update your `packages.yml` configuration to use
`dbt-labs/dbt_utils` instead.
[0m09:40:41.525807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '575fbc04-6d2b-4d05-84f8-aa10889e9155', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146442410>]}
[0m09:40:41.530067 [error] [MainThread]: Encountered an error:
Could not find a matching compatible version for package fishtown-analytics/dbt_utils
  Requested range: >=0.20.0, <0.21.0
  Compatible versions: ['0.0.1', '0.1.0', '0.1.1', '0.1.2', '0.1.3', '0.1.4', '0.1.5', '0.1.6', '0.1.7', '0.1.8', '0.1.9', '0.1.10', '0.1.11', '0.1.12', '0.1.13', '0.1.14', '0.1.15', '0.1.16', '0.1.17', '0.1.18', '0.1.19', '0.1.20', '0.1.21', '0.1.22', '0.1.23', '0.1.24', '0.1.25', '0.2.0', '0.2.1', '0.2.2', '0.2.3', '0.2.4', '0.2.5', '0.3.0', '0.4.0', '0.4.1', '0.5.0', '0.5.1', '0.6.0', '0.6.1', '0.6.2', '0.6.3', '0.6.4', '0.6.5', '0.6.6', '0.7.0']

[0m09:40:41.533837 [error] [MainThread]: Traceback (most recent call last):
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 201, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/cli/main.py", line 446, in deps
    results = task.run()
              ^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/deps.py", line 225, in run
    self.lock()
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/task/deps.py", line 194, in lock
    resolved_deps = resolve_packages(packages, self.project, self.cli_vars)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/deps/resolver.py", line 128, in resolve_packages
    target = final[package].resolved().fetch_metadata(project, renderer)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/lib/python3.11/site-packages/dbt/deps/registry.py", line 127, in resolved
    raise PackageVersionNotFoundError(
dbt.exceptions.PackageVersionNotFoundError: Could not find a matching compatible version for package fishtown-analytics/dbt_utils
  Requested range: >=0.20.0, <0.21.0
  Compatible versions: ['0.0.1', '0.1.0', '0.1.1', '0.1.2', '0.1.3', '0.1.4', '0.1.5', '0.1.6', '0.1.7', '0.1.8', '0.1.9', '0.1.10', '0.1.11', '0.1.12', '0.1.13', '0.1.14', '0.1.15', '0.1.16', '0.1.17', '0.1.18', '0.1.19', '0.1.20', '0.1.21', '0.1.22', '0.1.23', '0.1.24', '0.1.25', '0.2.0', '0.2.1', '0.2.2', '0.2.3', '0.2.4', '0.2.5', '0.3.0', '0.4.0', '0.4.1', '0.5.0', '0.5.1', '0.6.0', '0.6.1', '0.6.2', '0.6.3', '0.6.4', '0.6.5', '0.6.6', '0.7.0']


[0m09:40:41.536414 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_wall_clock_time": 0.6521749, "process_user_time": 1.51885, "process_kernel_time": 1.740023, "process_mem_max_rss": "115884032", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:40:41.537164 [debug] [MainThread]: Command `dbt deps` failed at 09:40:41.537062 after 0.65 seconds
[0m09:40:41.537578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146383390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049aed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145df06d0>]}
[0m09:40:41.538129 [debug] [MainThread]: Flushing usage events
[0m09:41:01.286593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cc1f390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cc81210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cc81850>]}


============================== 09:41:01.289042 | 807c09f8-3eb5-47c6-8aff-a7e7f5d5b97d ==============================
[0m09:41:01.289042 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:41:01.289307 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt --no-version-check deps', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:41:01.337919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '807c09f8-3eb5-47c6-8aff-a7e7f5d5b97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cc9e310>]}
[0m09:41:01.348338 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-aqcz04tj'
[0m09:41:01.348575 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:41:01.455696 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:41:01.456291 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
[0m09:41:01.552522 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
[0m09:41:01.554298 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `fishtown-analytics/dbt_utils` package is deprecated in favor of
`dbt-labs/dbt_utils`. Please update your `packages.yml` configuration to use
`dbt-labs/dbt_utils` instead.
[0m09:41:01.554897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '807c09f8-3eb5-47c6-8aff-a7e7f5d5b97d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cc1d190>]}
[0m09:41:01.563153 [info ] [MainThread]: Updating lock file in file path: /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/package-lock.yml
[0m09:41:01.580997 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-7kqhpjkr'
[0m09:41:01.581975 [info ] [MainThread]: Installing fishtown-analytics/dbt_utils
[0m09:41:02.050430 [info ] [MainThread]: Installed from version 0.7.0
[0m09:41:02.051026 [info ] [MainThread]: Up to date!
[0m09:41:02.051482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '807c09f8-3eb5-47c6-8aff-a7e7f5d5b97d', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cc9e750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cca6050>]}
[0m09:41:02.053951 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.79465264, "process_user_time": 1.545938, "process_kernel_time": 1.969026, "process_mem_max_rss": "121831424", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:41:02.054364 [debug] [MainThread]: Command `dbt deps` succeeded at 09:41:02.054294 after 0.80 seconds
[0m09:41:02.054704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cc80550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1026bad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1026bacd0>]}
[0m09:41:02.054903 [debug] [MainThread]: Flushing usage events
[0m09:41:09.209714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e696690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e3f8110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e6b9950>]}


============================== 09:41:09.212387 | f93bc5c7-9563-4f2a-ae15-112c8281e524 ==============================
[0m09:41:09.212387 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:41:09.212682 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select intermediate', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:41:09.791563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f93bc5c7-9563-4f2a-ae15-112c8281e524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12dc2ced0>]}
[0m09:41:09.810469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f93bc5c7-9563-4f2a-ae15-112c8281e524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf73050>]}
[0m09:41:09.811049 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:41:09.826629 [error] [MainThread]: Encountered an error:
Runtime Error
  Failed to read package: Runtime Error
    This version of dbt is not supported with the 'dbt_utils' package.
      Installed version of dbt: =1.8.0
      Required version of dbt for 'dbt_utils': ['>=0.20.0', '<0.21.0']
    Check for a different version of the 'dbt_utils' package, or run dbt again with --no-version-check
    
  
  Error encountered in /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_packages/dbt_utils/dbt_project.yml

Error encountered in /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_packages/dbt_utils
[0m09:41:09.828311 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.64593756, "process_user_time": 1.356063, "process_kernel_time": 2.421531, "process_mem_max_rss": "186269696", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:41:09.828650 [debug] [MainThread]: Command `dbt run` failed at 09:41:09.828604 after 0.65 seconds
[0m09:41:09.828884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10037acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e6bb210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e6b9850>]}
[0m09:41:09.829081 [debug] [MainThread]: Flushing usage events
[0m09:41:51.630749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d55b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137dbd110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137dbd790>]}


============================== 09:41:51.633478 | 071e7c25-caf6-4083-9807-2df71cd6a3ac ==============================
[0m09:41:51.633478 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:41:51.633760 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:41:51.744500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '071e7c25-caf6-4083-9807-2df71cd6a3ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d56010>]}
[0m09:41:51.755358 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-d9d91_sp'
[0m09:41:51.755652 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m09:41:51.863053 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m09:41:51.863815 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m09:41:51.962431 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m09:41:51.972420 [info ] [MainThread]: Updating lock file in file path: /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/package-lock.yml
[0m09:41:51.992512 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-v4ewvt2l'
[0m09:41:51.994296 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m09:41:52.300590 [info ] [MainThread]: Installed from version 1.2.0
[0m09:41:52.300868 [info ] [MainThread]: Up to date!
[0m09:41:52.301043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '071e7c25-caf6-4083-9807-2df71cd6a3ac', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d96310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d9c390>]}
[0m09:41:52.302764 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.70596623, "process_user_time": 2.146183, "process_kernel_time": 0.768024, "process_mem_max_rss": "119439360", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:41:52.303439 [debug] [MainThread]: Command `dbt deps` succeeded at 09:41:52.303281 after 0.71 seconds
[0m09:41:52.303842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137dbd990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137dbcbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10264acd0>]}
[0m09:41:52.304074 [debug] [MainThread]: Flushing usage events
[0m09:41:58.417802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff59750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff7cbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff7d250>]}


============================== 09:41:58.420210 | da4e2801-64a1-488b-8a6e-0c145152039b ==============================
[0m09:41:58.420210 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:41:58.420489 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select intermediate', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:41:59.013178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da4e2801-64a1-488b-8a6e-0c145152039b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff60690>]}
[0m09:41:59.032681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da4e2801-64a1-488b-8a6e-0c145152039b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f800bd0>]}
[0m09:41:59.033730 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:41:59.048953 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:41:59.091884 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m09:41:59.092184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'da4e2801-64a1-488b-8a6e-0c145152039b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e72ed90>]}
[0m09:41:59.624129 [error] [MainThread]: Encountered an error:
Compilation Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The snowflake_airflow_dbt.int_view_contract model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model int_view_contract (models/intermediate/int_view_contract.sql)
[0m09:41:59.625488 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.239092, "process_user_time": 1.862799, "process_kernel_time": 2.101278, "process_mem_max_rss": "187351040", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:41:59.625782 [debug] [MainThread]: Command `dbt run` failed at 09:41:59.625735 after 1.24 seconds
[0m09:41:59.625957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d270450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16dba9250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff59550>]}
[0m09:41:59.626119 [debug] [MainThread]: Flushing usage events
[0m09:44:54.511942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12081f790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120861150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120881e50>]}


============================== 09:44:54.514298 | 910ee3b1-21e4-4d7c-afab-d55797ffd6a6 ==============================
[0m09:44:54.514298 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:44:54.514566 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate', 'send_anonymous_usage_stats': 'True'}
[0m09:44:55.331975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '910ee3b1-21e4-4d7c-afab-d55797ffd6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14035fd50>]}
[0m09:44:55.350911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '910ee3b1-21e4-4d7c-afab-d55797ffd6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120100bd0>]}
[0m09:44:55.351411 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:44:55.363446 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:44:55.400730 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m09:44:55.401006 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m09:44:55.401166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '910ee3b1-21e4-4d7c-afab-d55797ffd6a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f02ebd0>]}
[0m09:44:55.875113 [error] [MainThread]: Encountered an error:
Compilation Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The snowflake_airflow_dbt.int_view_contract model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model int_view_contract (models/intermediate/int_view_contract.sql)
[0m09:44:55.876667 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3953599, "process_user_time": 2.005399, "process_kernel_time": 2.285246, "process_mem_max_rss": "185581568", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:44:55.876924 [debug] [MainThread]: Command `dbt run` failed at 09:44:55.876881 after 1.40 seconds
[0m09:44:55.877085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ab2cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1208838d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14055a3d0>]}
[0m09:44:55.877239 [debug] [MainThread]: Flushing usage events
[0m09:46:55.292805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153a1f8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153a5bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153a81b50>]}


============================== 09:46:55.295419 | fe975a40-2d96-4a03-92ce-57b7d2b8db2e ==============================
[0m09:46:55.295419 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:46:55.295695 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select intermediate', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:46:56.005372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fe975a40-2d96-4a03-92ce-57b7d2b8db2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152c32b50>]}
[0m09:46:56.025858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fe975a40-2d96-4a03-92ce-57b7d2b8db2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153300c10>]}
[0m09:46:56.026542 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:46:56.044058 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:46:56.089612 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m09:46:56.091908 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m09:46:56.092160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fe975a40-2d96-4a03-92ce-57b7d2b8db2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15232ee10>]}
[0m09:46:56.781926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fe975a40-2d96-4a03-92ce-57b7d2b8db2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16891c9d0>]}
[0m09:46:56.826960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fe975a40-2d96-4a03-92ce-57b7d2b8db2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168e276d0>]}
[0m09:46:56.827265 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m09:46:56.827423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe975a40-2d96-4a03-92ce-57b7d2b8db2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168a20ed0>]}
[0m09:46:56.828141 [info ] [MainThread]: 
[0m09:46:56.828416 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:46:56.828833 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m09:46:56.834710 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m09:46:56.834940 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m09:46:56.835075 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:46:57.344778 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.510 seconds
[0m09:46:57.347251 [debug] [ThreadPool]: On list_LB: Close
[0m09:46:57.470244 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now create_LB_STAGE_dwh_mart)
[0m09:46:57.470965 [debug] [ThreadPool]: Creating schema "database: "LB"
schema: "STAGE_dwh_mart"
"
[0m09:46:57.479885 [debug] [ThreadPool]: Using snowflake connection "create_LB_STAGE_dwh_mart"
[0m09:46:57.480521 [debug] [ThreadPool]: On create_LB_STAGE_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "create_LB_STAGE_dwh_mart"} */
create schema if not exists LB.STAGE_dwh_mart
[0m09:46:57.480848 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:46:57.917747 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.437 seconds
[0m09:46:57.918840 [debug] [ThreadPool]: On create_LB_STAGE_dwh_mart: Close
[0m09:46:58.016887 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_LB_STAGE_dwh_mart, now list_LB_STAGE_dwh_mart)
[0m09:46:58.022379 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE_dwh_mart"
[0m09:46:58.022597 [debug] [ThreadPool]: On list_LB_STAGE_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE_dwh_mart"} */
show objects in LB.STAGE_dwh_mart limit 10000
[0m09:46:58.022760 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:46:58.441608 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.419 seconds
[0m09:46:58.442466 [debug] [ThreadPool]: On list_LB_STAGE_dwh_mart: Close
[0m09:46:58.557097 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE_dwh_mart, now list_LB_STAGE_stage)
[0m09:46:58.558932 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE_stage"
[0m09:46:58.559168 [debug] [ThreadPool]: On list_LB_STAGE_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE_stage"} */
show objects in LB.STAGE_stage limit 10000
[0m09:46:58.559346 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:46:59.149992 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59212-0202-cf6c-0000-0002d44688b5
[0m09:46:59.150788 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m09:46:59.151288 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m09:46:59.151673 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m09:46:59.152140 [debug] [ThreadPool]: On list_LB_STAGE_stage: Close
[0m09:46:59.265941 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE_stage, now list_LB_STAGE)
[0m09:46:59.273312 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m09:46:59.273827 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m09:46:59.274109 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:46:59.701889 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.428 seconds
[0m09:46:59.703950 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m09:46:59.815121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fe975a40-2d96-4a03-92ce-57b7d2b8db2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c910d10>]}
[0m09:46:59.815520 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:46:59.815680 [info ] [MainThread]: 
[0m09:46:59.817110 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m09:46:59.817385 [info ] [Thread-1 (]: 1 of 1 START sql view model STAGE_dwh_mart.int_view_contract ................... [RUN]
[0m09:46:59.817607 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.int_view_contract)
[0m09:46:59.817755 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m09:46:59.821987 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m09:46:59.822455 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m09:46:59.837629 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m09:46:59.838998 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m09:46:59.839251 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.STAGE_dwh_mart.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.STAGE_stage.stg_contract c
    JOIN
        LB.STAGE_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.STAGE_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.STAGE_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
db
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m09:46:59.839452 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:47:00.191875 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59213-0202-cf6b-0000-0002d446c781
[0m09:47:00.192193 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 43 at position 0 unexpected 'db'.
[0m09:47:00.192448 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m09:47:00.299838 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  001003 (42000): SQL compilation error:
  syntax error line 43 at position 0 unexpected 'db'.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m09:47:00.300659 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe975a40-2d96-4a03-92ce-57b7d2b8db2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168bd0e10>]}
[0m09:47:00.300982 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model STAGE_dwh_mart.int_view_contract .......... [[31mERROR[0m in 0.48s]
[0m09:47:00.301245 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m09:47:00.302284 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:47:00.302433 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m09:47:00.302565 [info ] [MainThread]: 
[0m09:47:00.302703 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.47 seconds (3.47s).
[0m09:47:00.302977 [debug] [MainThread]: Command end result
[0m09:47:00.318207 [info ] [MainThread]: 
[0m09:47:00.318423 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:47:00.318541 [info ] [MainThread]: 
[0m09:47:00.318698 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  001003 (42000): SQL compilation error:
  syntax error line 43 at position 0 unexpected 'db'.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m09:47:00.318818 [info ] [MainThread]: 
[0m09:47:00.318948 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m09:47:00.320568 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.0579653, "process_user_time": 2.700806, "process_kernel_time": 2.225796, "process_mem_max_rss": "196935680", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:47:00.320848 [debug] [MainThread]: Command `dbt run` failed at 09:47:00.320809 after 5.06 seconds
[0m09:47:00.321060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100202cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153a60450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153a60d50>]}
[0m09:47:00.321216 [debug] [MainThread]: Flushing usage events
[0m09:49:36.222660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ee95c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eebd150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ee96cd0>]}


============================== 09:49:36.225011 | 55cad16c-ccd4-4836-9af7-72f3af010896 ==============================
[0m09:49:36.225011 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:49:36.225290 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select intermediate', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:49:36.903314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55cad16c-ccd4-4836-9af7-72f3af010896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138d28d10>]}
[0m09:49:36.924386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '55cad16c-ccd4-4836-9af7-72f3af010896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e800ad0>]}
[0m09:49:36.925013 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:49:36.937932 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:49:37.001544 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:49:37.001884 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m09:49:37.128387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '55cad16c-ccd4-4836-9af7-72f3af010896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148fa5310>]}
[0m09:49:37.179486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '55cad16c-ccd4-4836-9af7-72f3af010896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149207990>]}
[0m09:49:37.179815 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m09:49:37.179977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55cad16c-ccd4-4836-9af7-72f3af010896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149270210>]}
[0m09:49:37.180686 [info ] [MainThread]: 
[0m09:49:37.180937 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:49:37.181340 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m09:49:37.187807 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m09:49:37.188775 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m09:49:37.189009 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:49:37.631239 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.442 seconds
[0m09:49:37.633873 [debug] [ThreadPool]: On list_LB: Close
[0m09:49:37.777735 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE_stage)
[0m09:49:37.786756 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE_stage"
[0m09:49:37.787081 [debug] [ThreadPool]: On list_LB_STAGE_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE_stage"} */
show objects in LB.STAGE_stage limit 10000
[0m09:49:37.787310 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:38.230543 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59215-0202-cf68-0000-0002d44697c5
[0m09:49:38.231386 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m09:49:38.231966 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m09:49:38.232334 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m09:49:38.232883 [debug] [ThreadPool]: On list_LB_STAGE_stage: Close
[0m09:49:38.347914 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE_stage, now list_LB_STAGE_dwh_mart)
[0m09:49:38.352989 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE_dwh_mart"
[0m09:49:38.353549 [debug] [ThreadPool]: On list_LB_STAGE_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE_dwh_mart"} */
show objects in LB.STAGE_dwh_mart limit 10000
[0m09:49:38.353883 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:38.690299 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.336 seconds
[0m09:49:38.691982 [debug] [ThreadPool]: On list_LB_STAGE_dwh_mart: Close
[0m09:49:38.810696 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE_dwh_mart, now list_LB_STAGE)
[0m09:49:38.812707 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m09:49:38.812988 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m09:49:38.813188 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:49:39.265356 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.452 seconds
[0m09:49:39.269302 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m09:49:39.406645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55cad16c-ccd4-4836-9af7-72f3af010896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118324250>]}
[0m09:49:39.407172 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:49:39.407417 [info ] [MainThread]: 
[0m09:49:39.409271 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m09:49:39.409706 [info ] [Thread-1 (]: 1 of 1 START sql view model STAGE_dwh_mart.int_view_contract ................... [RUN]
[0m09:49:39.410026 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE, now model.snowflake_airflow_dbt.int_view_contract)
[0m09:49:39.410270 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m09:49:39.416510 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m09:49:39.417033 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m09:49:39.432859 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m09:49:39.434082 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m09:49:39.434349 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.STAGE_dwh_mart.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.STAGE_stage.stg_contract c
    JOIN
        LB.STAGE_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.STAGE_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.STAGE_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m09:49:39.434577 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:49:39.845340 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59215-0202-cf69-0000-0002d446a7b1
[0m09:49:39.846173 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.STAGE_STAGE' does not exist or not authorized.
[0m09:49:39.846934 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m09:49:39.995030 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m09:49:39.997466 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55cad16c-ccd4-4836-9af7-72f3af010896', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a9cc4d0>]}
[0m09:49:39.998210 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model STAGE_dwh_mart.int_view_contract .......... [[31mERROR[0m in 0.59s]
[0m09:49:39.998795 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m09:49:40.000468 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:49:40.000780 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m09:49:40.001089 [info ] [MainThread]: 
[0m09:49:40.001430 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.82 seconds (2.82s).
[0m09:49:40.001921 [debug] [MainThread]: Command end result
[0m09:49:40.025185 [info ] [MainThread]: 
[0m09:49:40.025489 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:49:40.025621 [info ] [MainThread]: 
[0m09:49:40.025781 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m09:49:40.025909 [info ] [MainThread]: 
[0m09:49:40.026043 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m09:49:40.027746 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.8325486, "process_user_time": 2.290536, "process_kernel_time": 2.048324, "process_mem_max_rss": "194887680", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:49:40.028094 [debug] [MainThread]: Command `dbt run` failed at 09:49:40.028051 after 3.83 seconds
[0m09:49:40.028338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eed9290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101042cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ee9c550>]}
[0m09:49:40.028506 [debug] [MainThread]: Flushing usage events
[0m09:55:36.263415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14de5d2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e2a9510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e2a9b50>]}


============================== 09:55:36.265843 | fab38aaa-a990-413f-888e-9537df0e2795 ==============================
[0m09:55:36.265843 [info ] [MainThread]: Running with dbt=1.8.0
[0m09:55:36.266104 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select intermediate', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:55:36.927483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fab38aaa-a990-413f-888e-9537df0e2795', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2a6610>]}
[0m09:55:36.949053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fab38aaa-a990-413f-888e-9537df0e2795', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dd00bd0>]}
[0m09:55:36.949852 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m09:55:36.977062 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m09:55:37.062795 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:55:37.063045 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:55:37.080444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fab38aaa-a990-413f-888e-9537df0e2795', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a1c9ad0>]}
[0m09:55:37.125191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fab38aaa-a990-413f-888e-9537df0e2795', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2fa510>]}
[0m09:55:37.125468 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m09:55:37.125625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fab38aaa-a990-413f-888e-9537df0e2795', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2570d0>]}
[0m09:55:37.126354 [info ] [MainThread]: 
[0m09:55:37.126611 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:55:37.127035 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m09:55:37.178052 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m09:55:37.178287 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m09:55:37.178408 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:55:37.838501 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.660 seconds
[0m09:55:37.839371 [debug] [ThreadPool]: On list_LB: Close
[0m09:55:38.045225 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_STAGE_dwh_mart)
[0m09:55:38.054982 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE_dwh_mart"
[0m09:55:38.055319 [debug] [ThreadPool]: On list_LB_STAGE_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE_dwh_mart"} */
show objects in LB.STAGE_dwh_mart limit 10000
[0m09:55:38.055459 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:55:38.650322 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.595 seconds
[0m09:55:38.652468 [debug] [ThreadPool]: On list_LB_STAGE_dwh_mart: Close
[0m09:55:38.773023 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE_dwh_mart, now list_LB_STAGE)
[0m09:55:38.776651 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE"
[0m09:55:38.777073 [debug] [ThreadPool]: On list_LB_STAGE: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE"} */
show objects in LB.STAGE limit 10000
[0m09:55:38.777511 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:55:39.267498 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.490 seconds
[0m09:55:39.271073 [debug] [ThreadPool]: On list_LB_STAGE: Close
[0m09:55:39.394949 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_STAGE, now list_LB_STAGE_stage)
[0m09:55:39.401322 [debug] [ThreadPool]: Using snowflake connection "list_LB_STAGE_stage"
[0m09:55:39.401885 [debug] [ThreadPool]: On list_LB_STAGE_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_STAGE_stage"} */
show objects in LB.STAGE_stage limit 10000
[0m09:55:39.402207 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:55:39.844359 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b5921b-0202-cf68-0000-0002d44697d5
[0m09:55:39.844632 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m09:55:39.844812 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m09:55:39.844926 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m09:55:39.845094 [debug] [ThreadPool]: On list_LB_STAGE_stage: Close
[0m09:55:39.950949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fab38aaa-a990-413f-888e-9537df0e2795', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14eacb4d0>]}
[0m09:55:39.951982 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:55:39.952182 [info ] [MainThread]: 
[0m09:55:39.954581 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m09:55:39.955047 [info ] [Thread-1 (]: 1 of 1 START sql view model STAGE_dwh_mart.int_view_contract ................... [RUN]
[0m09:55:39.955557 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_STAGE_stage, now model.snowflake_airflow_dbt.int_view_contract)
[0m09:55:39.955750 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m09:55:39.967104 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m09:55:39.967587 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m09:55:39.982511 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m09:55:39.983789 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m09:55:39.984057 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.STAGE_dwh_mart.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.STAGE_stage.stg_contract c
    JOIN
        LB.STAGE_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.STAGE_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.STAGE_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m09:55:39.984289 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:55:40.384895 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5921b-0202-cf6b-0000-0002d446c7bd
[0m09:55:40.385793 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.STAGE_STAGE' does not exist or not authorized.
[0m09:55:40.386422 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m09:55:40.511011 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m09:55:40.513422 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fab38aaa-a990-413f-888e-9537df0e2795', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b1e8ed0>]}
[0m09:55:40.514475 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model STAGE_dwh_mart.int_view_contract .......... [[31mERROR[0m in 0.56s]
[0m09:55:40.515261 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m09:55:40.517416 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:55:40.517833 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m09:55:40.518183 [info ] [MainThread]: 
[0m09:55:40.518523 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.39 seconds (3.39s).
[0m09:55:40.519176 [debug] [MainThread]: Command end result
[0m09:55:40.542485 [info ] [MainThread]: 
[0m09:55:40.542807 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:55:40.542990 [info ] [MainThread]: 
[0m09:55:40.543222 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m09:55:40.543401 [info ] [MainThread]: 
[0m09:55:40.543570 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m09:55:40.544953 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.310922, "process_user_time": 1.975863, "process_kernel_time": 2.383128, "process_mem_max_rss": "193511424", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:55:40.545267 [debug] [MainThread]: Command `dbt run` failed at 09:55:40.545210 after 4.31 seconds
[0m09:55:40.545522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e2ab210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e2aba10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c27f10>]}
[0m09:55:40.545732 [debug] [MainThread]: Flushing usage events
[0m10:19:10.761693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13345b710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1334bd2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1334bd910>]}


============================== 10:19:10.765501 | d4cba773-bbde-47a3-9664-d6149156983a ==============================
[0m10:19:10.765501 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:19:10.765818 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select intermediate', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:19:11.486165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd4cba773-bbde-47a3-9664-d6149156983a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140d9e7d0>]}
[0m10:19:11.505537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd4cba773-bbde-47a3-9664-d6149156983a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132f00b50>]}
[0m10:19:11.506079 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:19:11.520753 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:19:11.560594 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m10:19:11.560886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd4cba773-bbde-47a3-9664-d6149156983a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127e2ec90>]}
[0m10:19:12.173937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd4cba773-bbde-47a3-9664-d6149156983a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140da58d0>]}
[0m10:19:12.223867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd4cba773-bbde-47a3-9664-d6149156983a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1416f8f50>]}
[0m10:19:12.224140 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:19:12.224300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4cba773-bbde-47a3-9664-d6149156983a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140e7b890>]}
[0m10:19:12.224949 [info ] [MainThread]: 
[0m10:19:12.225185 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:19:12.225552 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:19:12.230930 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:19:12.231118 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:19:12.231244 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:19:12.773011 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.542 seconds
[0m10:19:12.775954 [debug] [ThreadPool]: On list_LB: Close
[0m10:19:12.884847 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now create_LB_dDWH_MART_dwh_mart)
[0m10:19:12.885593 [debug] [ThreadPool]: Creating schema "database: "LB"
schema: "dDWH_MART_dwh_mart"
"
[0m10:19:12.891575 [debug] [ThreadPool]: Using snowflake connection "create_LB_dDWH_MART_dwh_mart"
[0m10:19:12.892053 [debug] [ThreadPool]: On create_LB_dDWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "create_LB_dDWH_MART_dwh_mart"} */
create schema if not exists LB.dDWH_MART_dwh_mart
[0m10:19:12.892368 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:19:13.490070 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.598 seconds
[0m10:19:13.491514 [debug] [ThreadPool]: On create_LB_dDWH_MART_dwh_mart: Close
[0m10:19:13.616201 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_LB_dDWH_MART_dwh_mart, now list_LB_dDWH_MART_stage)
[0m10:19:13.625255 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART_stage"
[0m10:19:13.625551 [debug] [ThreadPool]: On list_LB_dDWH_MART_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART_stage"} */
show objects in LB.dDWH_MART_stage limit 10000
[0m10:19:13.625698 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:19:14.233857 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59233-0202-cf6c-0000-0002d4468929
[0m10:19:14.234208 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:19:14.234435 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:19:14.234558 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:19:14.234778 [debug] [ThreadPool]: On list_LB_dDWH_MART_stage: Close
[0m10:19:14.364102 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART_stage, now list_LB_dDWH_MART)
[0m10:19:14.367266 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART"
[0m10:19:14.367700 [debug] [ThreadPool]: On list_LB_dDWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART"} */
show objects in LB.dDWH_MART limit 10000
[0m10:19:14.367938 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:19:14.711240 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59233-0202-cf54-0000-0002d446d735
[0m10:19:14.711524 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:19:14.711716 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:19:14.711839 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:19:14.712012 [debug] [ThreadPool]: On list_LB_dDWH_MART: Close
[0m10:19:14.846957 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART, now list_LB_dDWH_MART_dwh_mart)
[0m10:19:14.848286 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART_dwh_mart"
[0m10:19:14.848453 [debug] [ThreadPool]: On list_LB_dDWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART_dwh_mart"} */
show objects in LB.dDWH_MART_dwh_mart limit 10000
[0m10:19:14.848574 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:19:15.203226 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.354 seconds
[0m10:19:15.209849 [debug] [ThreadPool]: On list_LB_dDWH_MART_dwh_mart: Close
[0m10:19:15.332796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4cba773-bbde-47a3-9664-d6149156983a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140e93d10>]}
[0m10:19:15.334181 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:19:15.334700 [info ] [MainThread]: 
[0m10:19:15.338662 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:19:15.339055 [info ] [Thread-1 (]: 1 of 1 START sql view model dDWH_MART_dwh_mart.int_view_contract ............... [RUN]
[0m10:19:15.339368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART_dwh_mart, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:19:15.339763 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:19:15.346214 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:19:15.346658 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:19:15.368834 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:19:15.370195 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:19:15.370446 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.dDWH_MART_dwh_mart.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.dDWH_MART_stage.stg_contract c
    JOIN
        LB.dDWH_MART_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.dDWH_MART_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.dDWH_MART_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:19:15.370732 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:19:15.782477 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59233-0202-cf6c-0000-0002d446892d
[0m10:19:15.783110 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.DDWH_MART_STAGE' does not exist or not authorized.
[0m10:19:15.783627 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:19:15.907667 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DDWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:19:15.910913 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4cba773-bbde-47a3-9664-d6149156983a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1413694d0>]}
[0m10:19:15.911993 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model dDWH_MART_dwh_mart.int_view_contract ...... [[31mERROR[0m in 0.57s]
[0m10:19:15.912733 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:19:15.915382 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:19:15.915952 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:19:15.916706 [info ] [MainThread]: 
[0m10:19:15.917211 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.69 seconds (3.69s).
[0m10:19:15.919596 [debug] [MainThread]: Command end result
[0m10:19:15.945438 [info ] [MainThread]: 
[0m10:19:15.945975 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:19:15.946133 [info ] [MainThread]: 
[0m10:19:15.946506 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DDWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:19:15.946639 [info ] [MainThread]: 
[0m10:19:15.947099 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:19:15.950948 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.2216263, "process_user_time": 2.625229, "process_kernel_time": 2.165032, "process_mem_max_rss": "200376320", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:19:15.952074 [debug] [MainThread]: Command `dbt run` failed at 10:19:15.952030 after 5.22 seconds
[0m10:19:15.953304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1334bd590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102316cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1334969d0>]}
[0m10:19:15.953514 [debug] [MainThread]: Flushing usage events
[0m10:20:03.044666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df5bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dbf0650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dfadf10>]}


============================== 10:20:03.047571 | e1ef6486-9d0a-4d38-b15f-5c23bbf46f55 ==============================
[0m10:20:03.047571 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:20:03.047864 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select intermediate', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:20:03.780724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e1ef6486-9d0a-4d38-b15f-5c23bbf46f55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125c2d490>]}
[0m10:20:03.803472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e1ef6486-9d0a-4d38-b15f-5c23bbf46f55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125cea590>]}
[0m10:20:03.804088 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:20:03.816696 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:20:03.856927 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:20:03.857288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e1ef6486-9d0a-4d38-b15f-5c23bbf46f55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c92eb50>]}
[0m10:20:04.490066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1ef6486-9d0a-4d38-b15f-5c23bbf46f55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1261c43d0>]}
[0m10:20:04.533390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1ef6486-9d0a-4d38-b15f-5c23bbf46f55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12644c210>]}
[0m10:20:04.533661 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:20:04.533816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1ef6486-9d0a-4d38-b15f-5c23bbf46f55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125ece490>]}
[0m10:20:04.534454 [info ] [MainThread]: 
[0m10:20:04.534695 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:20:04.535061 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:20:04.540414 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:20:04.540649 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:20:04.540780 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:05.009385 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.468 seconds
[0m10:20:05.012240 [debug] [ThreadPool]: On list_LB: Close
[0m10:20:05.131205 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now create_LB_dDWH_MART)
[0m10:20:05.132048 [debug] [ThreadPool]: Creating schema "database: "LB"
schema: "dDWH_MART"
"
[0m10:20:05.138160 [debug] [ThreadPool]: Using snowflake connection "create_LB_dDWH_MART"
[0m10:20:05.138768 [debug] [ThreadPool]: On create_LB_dDWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "create_LB_dDWH_MART"} */
create schema if not exists LB.dDWH_MART
[0m10:20:05.139200 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:05.578009 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.439 seconds
[0m10:20:05.579520 [debug] [ThreadPool]: On create_LB_dDWH_MART: Close
[0m10:20:05.700337 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_LB_dDWH_MART, now list_LB_dDWH_MART_stage)
[0m10:20:05.708857 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART_stage"
[0m10:20:05.709532 [debug] [ThreadPool]: On list_LB_dDWH_MART_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART_stage"} */
show objects in LB.dDWH_MART_stage limit 10000
[0m10:20:05.710121 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:06.204125 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59234-0202-d459-0000-0002d446e005
[0m10:20:06.204977 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:20:06.205495 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:20:06.205783 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:20:06.206319 [debug] [ThreadPool]: On list_LB_dDWH_MART_stage: Close
[0m10:20:06.376866 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART_stage, now list_LB_dDWH_MART_dwh_mart)
[0m10:20:06.381999 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART_dwh_mart"
[0m10:20:06.382526 [debug] [ThreadPool]: On list_LB_dDWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART_dwh_mart"} */
show objects in LB.dDWH_MART_dwh_mart limit 10000
[0m10:20:06.382866 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:06.795842 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.413 seconds
[0m10:20:06.799145 [debug] [ThreadPool]: On list_LB_dDWH_MART_dwh_mart: Close
[0m10:20:06.910886 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART_dwh_mart, now list_LB_dDWH_MART)
[0m10:20:06.914135 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART"
[0m10:20:06.914617 [debug] [ThreadPool]: On list_LB_dDWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART"} */
show objects in LB.dDWH_MART limit 10000
[0m10:20:06.914895 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:07.389397 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.474 seconds
[0m10:20:07.390865 [debug] [ThreadPool]: On list_LB_dDWH_MART: Close
[0m10:20:07.503225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1ef6486-9d0a-4d38-b15f-5c23bbf46f55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126189950>]}
[0m10:20:07.505099 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:20:07.505735 [info ] [MainThread]: 
[0m10:20:07.511015 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:20:07.511872 [info ] [Thread-1 (]: 1 of 1 START sql view model dDWH_MART.int_view_contract ........................ [RUN]
[0m10:20:07.512420 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:20:07.512812 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:20:07.528938 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:20:07.530787 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:20:07.549097 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:20:07.550560 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:20:07.550863 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.dDWH_MART.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.dDWH_MART_stage.stg_contract c
    JOIN
        LB.dDWH_MART_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.dDWH_MART_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.dDWH_MART_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:20:07.551107 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:07.949086 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59234-0202-cf6b-0000-0002d446c809
[0m10:20:07.950163 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.DDWH_MART_STAGE' does not exist or not authorized.
[0m10:20:07.951087 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:20:08.098755 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DDWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:20:08.108035 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1ef6486-9d0a-4d38-b15f-5c23bbf46f55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126ab3390>]}
[0m10:20:08.110530 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model dDWH_MART.int_view_contract ............... [[31mERROR[0m in 0.59s]
[0m10:20:08.110933 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:20:08.113914 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:20:08.114110 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:20:08.114274 [info ] [MainThread]: 
[0m10:20:08.114449 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.58 seconds (3.58s).
[0m10:20:08.114827 [debug] [MainThread]: Command end result
[0m10:20:08.137501 [info ] [MainThread]: 
[0m10:20:08.138476 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:20:08.138797 [info ] [MainThread]: 
[0m10:20:08.139000 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DDWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:20:08.139130 [info ] [MainThread]: 
[0m10:20:08.139291 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:20:08.141037 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.1310954, "process_user_time": 2.908345, "process_kernel_time": 1.965506, "process_mem_max_rss": "197951488", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:20:08.141433 [debug] [MainThread]: Command `dbt run` failed at 10:20:08.141384 after 5.13 seconds
[0m10:20:08.141700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100d52cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dfad110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dfafa90>]}
[0m10:20:08.141882 [debug] [MainThread]: Flushing usage events
[0m10:20:30.046808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c45b950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c4bd250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c4bd8d0>]}


============================== 10:20:30.049568 | e0b5cfc7-7e10-4517-ad30-01104cf80a93 ==============================
[0m10:20:30.049568 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:20:30.049885 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate', 'send_anonymous_usage_stats': 'True'}
[0m10:20:30.644012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e0b5cfc7-7e10-4517-ad30-01104cf80a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163d85650>]}
[0m10:20:30.663086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e0b5cfc7-7e10-4517-ad30-01104cf80a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15bd00bd0>]}
[0m10:20:30.663589 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:20:30.676397 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:20:30.719171 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:20:30.719501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e0b5cfc7-7e10-4517-ad30-01104cf80a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ac2ed90>]}
[0m10:20:31.416398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0b5cfc7-7e10-4517-ad30-01104cf80a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16441edd0>]}
[0m10:20:31.471174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0b5cfc7-7e10-4517-ad30-01104cf80a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1645ffdd0>]}
[0m10:20:31.472085 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:20:31.472454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0b5cfc7-7e10-4517-ad30-01104cf80a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16443ab10>]}
[0m10:20:31.474145 [info ] [MainThread]: 
[0m10:20:31.476368 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:20:31.477400 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:20:31.496319 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:20:31.496597 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:20:31.496746 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:20:32.132028 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.635 seconds
[0m10:20:32.133625 [debug] [ThreadPool]: On list_LB: Close
[0m10:20:32.233815 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dDWH_MART)
[0m10:20:32.239408 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART"
[0m10:20:32.239703 [debug] [ThreadPool]: On list_LB_dDWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART"} */
show objects in LB.dDWH_MART limit 10000
[0m10:20:32.239847 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:32.731895 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.492 seconds
[0m10:20:32.733474 [debug] [ThreadPool]: On list_LB_dDWH_MART: Close
[0m10:20:32.849706 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART, now list_LB_dDWH_MART_dwh_mart)
[0m10:20:32.850991 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART_dwh_mart"
[0m10:20:32.851310 [debug] [ThreadPool]: On list_LB_dDWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART_dwh_mart"} */
show objects in LB.dDWH_MART_dwh_mart limit 10000
[0m10:20:32.851569 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:20:33.441499 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.590 seconds
[0m10:20:33.444162 [debug] [ThreadPool]: On list_LB_dDWH_MART_dwh_mart: Close
[0m10:20:33.552980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0b5cfc7-7e10-4517-ad30-01104cf80a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a310750>]}
[0m10:20:33.553916 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:20:33.554213 [info ] [MainThread]: 
[0m10:20:33.557620 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:20:33.558019 [info ] [Thread-1 (]: 1 of 1 START sql view model dDWH_MART.int_view_contract ........................ [RUN]
[0m10:20:33.558336 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART_dwh_mart, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:20:33.558526 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:20:33.566085 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:20:33.567311 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:20:33.625507 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:20:33.627944 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:20:33.628362 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.dDWH_MART.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.dDWH_MART.stg_contract c
    JOIN
        LB.dDWH_MART.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.dDWH_MART.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.dDWH_MART.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:20:33.628581 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:20:34.015584 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59234-0202-d452-0000-0002d446f00d
[0m10:20:34.015918 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DDWH_MART.STG_CONTRACT' does not exist or not authorized.
[0m10:20:34.016204 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:20:34.127187 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DDWH_MART.STG_CONTRACT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:20:34.128431 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0b5cfc7-7e10-4517-ad30-01104cf80a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a082790>]}
[0m10:20:34.128788 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model dDWH_MART.int_view_contract ............... [[31mERROR[0m in 0.57s]
[0m10:20:34.129074 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:20:34.130166 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:20:34.130332 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:20:34.130486 [info ] [MainThread]: 
[0m10:20:34.130650 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.66 seconds (2.66s).
[0m10:20:34.130954 [debug] [MainThread]: Command end result
[0m10:20:34.155836 [info ] [MainThread]: 
[0m10:20:34.156216 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:20:34.156354 [info ] [MainThread]: 
[0m10:20:34.156531 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DDWH_MART.STG_CONTRACT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:20:34.156658 [info ] [MainThread]: 
[0m10:20:34.156860 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:20:34.161004 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.1503725, "process_user_time": 2.740696, "process_kernel_time": 1.882953, "process_mem_max_rss": "188596224", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:20:34.161757 [debug] [MainThread]: Command `dbt run` failed at 10:20:34.161685 after 4.15 seconds
[0m10:20:34.162399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c4bd510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100fbecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c488650>]}
[0m10:20:34.162624 [debug] [MainThread]: Flushing usage events
[0m10:22:27.322670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e65b990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e67d310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e65acd0>]}


============================== 10:22:27.325423 | 29be79c7-9cb0-46aa-939f-df965ee90097 ==============================
[0m10:22:27.325423 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:22:27.325740 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select intermediate', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:22:28.109774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '29be79c7-9cb0-46aa-939f-df965ee90097', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e67dc50>]}
[0m10:22:28.131427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '29be79c7-9cb0-46aa-939f-df965ee90097', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13de00b10>]}
[0m10:22:28.132085 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:22:28.148708 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:22:28.191500 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:22:28.191847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '29be79c7-9cb0-46aa-939f-df965ee90097', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b379d50>]}
[0m10:22:28.998463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '29be79c7-9cb0-46aa-939f-df965ee90097', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b81fe90>]}
[0m10:22:29.066216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '29be79c7-9cb0-46aa-939f-df965ee90097', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bbebd50>]}
[0m10:22:29.066952 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:22:29.067191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '29be79c7-9cb0-46aa-939f-df965ee90097', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9b1850>]}
[0m10:22:29.069512 [info ] [MainThread]: 
[0m10:22:29.070077 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:22:29.070844 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:22:29.077308 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:22:29.077561 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:22:29.077711 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:22:29.582160 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.504 seconds
[0m10:22:29.583307 [debug] [ThreadPool]: On list_LB: Close
[0m10:22:29.711621 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_dDWH_MART)
[0m10:22:29.717229 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART"
[0m10:22:29.717475 [debug] [ThreadPool]: On list_LB_dDWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART"} */
show objects in LB.dDWH_MART limit 10000
[0m10:22:29.717607 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:30.125725 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.408 seconds
[0m10:22:30.129256 [debug] [ThreadPool]: On list_LB_dDWH_MART: Close
[0m10:22:30.238997 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART, now list_LB_dDWH_MART_dwh_mart)
[0m10:22:30.241807 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART_dwh_mart"
[0m10:22:30.242153 [debug] [ThreadPool]: On list_LB_dDWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART_dwh_mart"} */
show objects in LB.dDWH_MART_dwh_mart limit 10000
[0m10:22:30.242422 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:30.603474 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.361 seconds
[0m10:22:30.604315 [debug] [ThreadPool]: On list_LB_dDWH_MART_dwh_mart: Close
[0m10:22:30.721803 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART_dwh_mart, now list_LB_dDWH_MART_stage)
[0m10:22:30.723951 [debug] [ThreadPool]: Using snowflake connection "list_LB_dDWH_MART_stage"
[0m10:22:30.724114 [debug] [ThreadPool]: On list_LB_dDWH_MART_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_dDWH_MART_stage"} */
show objects in LB.dDWH_MART_stage limit 10000
[0m10:22:30.724234 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:31.059748 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59236-0202-cf54-0000-0002d446d749
[0m10:22:31.060521 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:22:31.061046 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:22:31.061369 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:22:31.061878 [debug] [ThreadPool]: On list_LB_dDWH_MART_stage: Close
[0m10:22:31.224163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '29be79c7-9cb0-46aa-939f-df965ee90097', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b40c390>]}
[0m10:22:31.225368 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:22:31.225835 [info ] [MainThread]: 
[0m10:22:31.229459 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:22:31.230175 [info ] [Thread-1 (]: 1 of 1 START sql view model dDWH_MART.int_view_contract ........................ [RUN]
[0m10:22:31.230703 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_dDWH_MART_stage, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:22:31.231083 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:22:31.240792 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:22:31.241751 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:22:31.270589 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:22:31.271863 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:22:31.272085 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.dDWH_MART.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.dDWH_MART_stage.stg_contract c
    JOIN
        LB.dDWH_MART_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.dDWH_MART_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.dDWH_MART_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:22:31.272280 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:22:31.824258 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59236-0202-cf54-0000-0002d446d74d
[0m10:22:31.824809 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.DDWH_MART_STAGE' does not exist or not authorized.
[0m10:22:31.825321 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:22:31.946936 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DDWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:22:31.950383 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '29be79c7-9cb0-46aa-939f-df965ee90097', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16be4b910>]}
[0m10:22:31.950795 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model dDWH_MART.int_view_contract ............... [[31mERROR[0m in 0.72s]
[0m10:22:31.951302 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:22:31.955049 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:22:31.955215 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:22:31.955356 [info ] [MainThread]: 
[0m10:22:31.955507 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.89 seconds (2.89s).
[0m10:22:31.955956 [debug] [MainThread]: Command end result
[0m10:22:32.009961 [info ] [MainThread]: 
[0m10:22:32.011039 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:22:32.011232 [info ] [MainThread]: 
[0m10:22:32.011407 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DDWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:22:32.011534 [info ] [MainThread]: 
[0m10:22:32.011678 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:22:32.017453 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.7257824, "process_user_time": 2.495531, "process_kernel_time": 2.544641, "process_mem_max_rss": "185499648", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:22:32.018082 [debug] [MainThread]: Command `dbt run` failed at 10:22:32.017967 after 4.73 seconds
[0m10:22:32.018559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d7e3290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e65b210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e059410>]}
[0m10:22:32.018756 [debug] [MainThread]: Flushing usage events
[0m10:23:11.750677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f132dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f16f1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f196190>]}


============================== 10:23:11.753107 | fa87d46f-3217-4e38-a6f6-0b931667fe93 ==============================
[0m10:23:11.753107 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:23:11.753431 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select intermediate', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:23:12.428729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fa87d46f-3217-4e38-a6f6-0b931667fe93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b1e9fd0>]}
[0m10:23:12.447836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fa87d46f-3217-4e38-a6f6-0b931667fe93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ba00ad0>]}
[0m10:23:12.448411 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:23:12.460895 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:23:12.500442 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m10:23:12.500839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fa87d46f-3217-4e38-a6f6-0b931667fe93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a92ebd0>]}
[0m10:23:13.236499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fa87d46f-3217-4e38-a6f6-0b931667fe93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b7affd0>]}
[0m10:23:13.286879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fa87d46f-3217-4e38-a6f6-0b931667fe93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ba50090>]}
[0m10:23:13.287253 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:23:13.287431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa87d46f-3217-4e38-a6f6-0b931667fe93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a1f4e90>]}
[0m10:23:13.288251 [info ] [MainThread]: 
[0m10:23:13.288559 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:23:13.289060 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:23:13.296006 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:23:13.296348 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:23:13.296524 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:23:13.733541 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.437 seconds
[0m10:23:13.735660 [debug] [ThreadPool]: On list_LB: Close
[0m10:23:13.854642 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_DWH_MART)
[0m10:23:13.862408 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART"
[0m10:23:13.862647 [debug] [ThreadPool]: On list_LB_DWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART"} */
show objects in LB.DWH_MART limit 10000
[0m10:23:13.862770 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:14.322569 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.460 seconds
[0m10:23:14.325085 [debug] [ThreadPool]: On list_LB_DWH_MART: Close
[0m10:23:14.441261 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART, now list_LB_DWH_MART_dwh_mart)
[0m10:23:14.446639 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_dwh_mart"
[0m10:23:14.447435 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_dwh_mart"} */
show objects in LB.DWH_MART_dwh_mart limit 10000
[0m10:23:14.447762 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:15.078882 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59237-0202-cf69-0000-0002d446a7f5
[0m10:23:15.079587 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:23:15.080622 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:23:15.081450 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:23:15.082714 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: Close
[0m10:23:15.200092 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_dwh_mart, now list_LB_DWH_MART_stage)
[0m10:23:15.201345 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_stage"
[0m10:23:15.201504 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_stage"} */
show objects in LB.DWH_MART_stage limit 10000
[0m10:23:15.201631 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:15.649105 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59237-0202-cf6b-0000-0002d446c819
[0m10:23:15.649396 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:23:15.649592 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:23:15.649719 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:23:15.649938 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: Close
[0m10:23:15.758677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa87d46f-3217-4e38-a6f6-0b931667fe93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b8a2590>]}
[0m10:23:15.759374 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:23:15.759661 [info ] [MainThread]: 
[0m10:23:15.761840 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:23:15.762742 [info ] [Thread-1 (]: 1 of 1 START sql view model DWH_MART.int_view_contract ......................... [RUN]
[0m10:23:15.763606 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_stage, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:23:15.764269 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:23:15.795784 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:23:15.798513 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:23:15.827901 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:23:15.829349 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:23:15.829618 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.DWH_MART.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.DWH_MART_stage.stg_contract c
    JOIN
        LB.DWH_MART_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.DWH_MART_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.DWH_MART_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:23:15.829886 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:16.270589 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59237-0202-cf69-0000-0002d446a7f9
[0m10:23:16.270952 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
[0m10:23:16.271265 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:23:16.380226 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:23:16.382718 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa87d46f-3217-4e38-a6f6-0b931667fe93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bac1390>]}
[0m10:23:16.383705 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model DWH_MART.int_view_contract ................ [[31mERROR[0m in 0.62s]
[0m10:23:16.384406 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:23:16.386762 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:23:16.387103 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:23:16.387389 [info ] [MainThread]: 
[0m10:23:16.387702 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.10 seconds (3.10s).
[0m10:23:16.388273 [debug] [MainThread]: Command end result
[0m10:23:16.430748 [info ] [MainThread]: 
[0m10:23:16.431123 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:23:16.431644 [info ] [MainThread]: 
[0m10:23:16.432239 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:23:16.432475 [info ] [MainThread]: 
[0m10:23:16.432646 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:23:16.437377 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.715698, "process_user_time": 2.348921, "process_kernel_time": 2.550288, "process_mem_max_rss": "195739648", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:23:16.437927 [debug] [MainThread]: Command `dbt run` failed at 10:23:16.437875 after 4.72 seconds
[0m10:23:16.438234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12bbf0250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10254acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fdfafd0>]}
[0m10:23:16.438430 [debug] [MainThread]: Flushing usage events
[0m10:25:07.398047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12362f950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123695190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123695810>]}


============================== 10:25:07.400910 | a49f04a4-1760-4e2a-b306-be827d8c2167 ==============================
[0m10:25:07.400910 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:25:07.401208 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select intermediate', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:25:08.134391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a49f04a4-1760-4e2a-b306-be827d8c2167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130c86850>]}
[0m10:25:08.154271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a49f04a4-1760-4e2a-b306-be827d8c2167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121200b10>]}
[0m10:25:08.154833 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:25:08.167804 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:25:08.211857 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:25:08.212187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a49f04a4-1760-4e2a-b306-be827d8c2167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ff2ed50>]}
[0m10:25:08.851367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a49f04a4-1760-4e2a-b306-be827d8c2167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132f25310>]}
[0m10:25:08.893094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a49f04a4-1760-4e2a-b306-be827d8c2167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1334640d0>]}
[0m10:25:08.893371 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:25:08.893566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a49f04a4-1760-4e2a-b306-be827d8c2167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13300e510>]}
[0m10:25:08.894251 [info ] [MainThread]: 
[0m10:25:08.894479 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:25:08.894989 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:25:08.900153 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:25:08.900320 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:25:08.900450 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:25:09.388735 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.488 seconds
[0m10:25:09.391106 [debug] [ThreadPool]: On list_LB: Close
[0m10:25:09.565511 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_DWH_MART_dwh_mart)
[0m10:25:09.574416 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_dwh_mart"
[0m10:25:09.574728 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_dwh_mart"} */
show objects in LB.DWH_MART_dwh_mart limit 10000
[0m10:25:09.574941 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:10.490429 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59239-0202-cf69-0000-0002d446a805
[0m10:25:10.491152 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:25:10.491750 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:25:10.492267 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:25:10.492757 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: Close
[0m10:25:10.734596 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_dwh_mart, now list_LB_DWH_MART)
[0m10:25:10.740451 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART"
[0m10:25:10.740958 [debug] [ThreadPool]: On list_LB_DWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART"} */
show objects in LB.DWH_MART limit 10000
[0m10:25:10.741271 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:11.202619 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.461 seconds
[0m10:25:11.206727 [debug] [ThreadPool]: On list_LB_DWH_MART: Close
[0m10:25:11.332985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a49f04a4-1760-4e2a-b306-be827d8c2167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13300ef50>]}
[0m10:25:11.334227 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:25:11.334676 [info ] [MainThread]: 
[0m10:25:11.338839 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:25:11.339470 [info ] [Thread-1 (]: 1 of 1 START sql view model DWH_MART.int_view_contract ......................... [RUN]
[0m10:25:11.339999 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_DWH_MART, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:25:11.340435 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:25:11.350907 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:25:11.352006 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:25:11.373976 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:25:11.375484 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:25:11.375775 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.DWH_MART.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.DWH_MART.stg_contract c
    JOIN
        LB.DWH_MART.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.DWH_MART.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.DWH_MART.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:25:11.376033 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:11.903356 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59239-0202-cf54-0000-0002d446d755
[0m10:25:11.903742 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART.STG_CONTRACT' does not exist or not authorized.
[0m10:25:11.904374 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:25:12.080007 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.STG_CONTRACT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:25:12.083140 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a49f04a4-1760-4e2a-b306-be827d8c2167', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134059f10>]}
[0m10:25:12.084304 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model DWH_MART.int_view_contract ................ [[31mERROR[0m in 0.74s]
[0m10:25:12.085051 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:25:12.089672 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:25:12.090103 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:25:12.090538 [info ] [MainThread]: 
[0m10:25:12.091006 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.20 seconds (3.20s).
[0m10:25:12.093611 [debug] [MainThread]: Command end result
[0m10:25:12.116411 [info ] [MainThread]: 
[0m10:25:12.116716 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:25:12.116848 [info ] [MainThread]: 
[0m10:25:12.117137 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART.STG_CONTRACT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:25:12.117300 [info ] [MainThread]: 
[0m10:25:12.117550 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:25:12.120567 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.758057, "process_user_time": 2.64757, "process_kernel_time": 1.720663, "process_mem_max_rss": "201457664", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:25:12.121235 [debug] [MainThread]: Command `dbt run` failed at 10:25:12.121189 after 4.76 seconds
[0m10:25:12.121666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10430acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1236955d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123697710>]}
[0m10:25:12.122125 [debug] [MainThread]: Flushing usage events
[0m10:26:04.833941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122697990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1226bd490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1226bdb10>]}


============================== 10:26:04.836204 | efb7201f-0743-46d5-b5de-908d196324b1 ==============================
[0m10:26:04.836204 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:26:04.836461 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select intermediate', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:26:05.497073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'efb7201f-0743-46d5-b5de-908d196324b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f98e50>]}
[0m10:26:05.516154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'efb7201f-0743-46d5-b5de-908d196324b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1304ea410>]}
[0m10:26:05.516722 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:26:05.532106 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:26:05.574391 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:26:05.574867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'efb7201f-0743-46d5-b5de-908d196324b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120e2eb90>]}
[0m10:26:06.223580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'efb7201f-0743-46d5-b5de-908d196324b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1309e54d0>]}
[0m10:26:06.267479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'efb7201f-0743-46d5-b5de-908d196324b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130cfc8d0>]}
[0m10:26:06.267767 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:26:06.267926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'efb7201f-0743-46d5-b5de-908d196324b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130968410>]}
[0m10:26:06.268584 [info ] [MainThread]: 
[0m10:26:06.268827 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:26:06.269242 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:26:06.275039 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:26:06.275296 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:26:06.275431 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:26:06.783017 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.507 seconds
[0m10:26:06.787322 [debug] [ThreadPool]: On list_LB: Close
[0m10:26:06.915214 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_DWH_MART_stage)
[0m10:26:06.920781 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_stage"
[0m10:26:06.921077 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_stage"} */
show objects in LB.DWH_MART_stage limit 10000
[0m10:26:06.921202 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:26:07.413578 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b5923a-0202-cf6c-0000-0002d4468945
[0m10:26:07.414353 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:26:07.414876 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:26:07.415200 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:26:07.415746 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: Close
[0m10:26:07.619615 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_stage, now list_LB_DWH_MART)
[0m10:26:07.624776 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART"
[0m10:26:07.625429 [debug] [ThreadPool]: On list_LB_DWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART"} */
show objects in LB.DWH_MART limit 10000
[0m10:26:07.625705 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:26:08.095600 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.470 seconds
[0m10:26:08.099863 [debug] [ThreadPool]: On list_LB_DWH_MART: Close
[0m10:26:08.216966 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART, now list_LB_DWH_MART_dwh_mart)
[0m10:26:08.223212 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_dwh_mart"
[0m10:26:08.223735 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_dwh_mart"} */
show objects in LB.DWH_MART_dwh_mart limit 10000
[0m10:26:08.224133 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:26:08.559631 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b5923a-0202-cf6c-0000-0002d4468949
[0m10:26:08.559918 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:26:08.560113 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:26:08.560240 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:26:08.560412 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: Close
[0m10:26:08.674054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'efb7201f-0743-46d5-b5de-908d196324b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1220010d0>]}
[0m10:26:08.675325 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:26:08.675870 [info ] [MainThread]: 
[0m10:26:08.679858 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:26:08.680735 [info ] [Thread-1 (]: 1 of 1 START sql view model DWH_MART.int_view_contract ......................... [RUN]
[0m10:26:08.681369 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_dwh_mart, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:26:08.681883 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:26:08.690786 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:26:08.691659 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:26:08.709248 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:26:08.711220 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:26:08.711497 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.DWH_MART.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.DWH_MART_stage.stg_contract c
    JOIN
        LB.DWH_MART_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.DWH_MART_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.DWH_MART_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:26:08.711713 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:26:09.118303 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5923a-0202-cf69-0000-0002d446a80d
[0m10:26:09.119274 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
[0m10:26:09.120081 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:26:09.237795 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:26:09.239344 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'efb7201f-0743-46d5-b5de-908d196324b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130f61290>]}
[0m10:26:09.239844 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model DWH_MART.int_view_contract ................ [[31mERROR[0m in 0.56s]
[0m10:26:09.240251 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:26:09.241812 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:26:09.242070 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:26:09.242281 [info ] [MainThread]: 
[0m10:26:09.242497 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.97 seconds (2.97s).
[0m10:26:09.242886 [debug] [MainThread]: Command end result
[0m10:26:09.266591 [info ] [MainThread]: 
[0m10:26:09.267027 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:26:09.267216 [info ] [MainThread]: 
[0m10:26:09.267709 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:26:09.267917 [info ] [MainThread]: 
[0m10:26:09.268102 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:26:09.270645 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.4755087, "process_user_time": 2.65798, "process_kernel_time": 2.404292, "process_mem_max_rss": "202883072", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:26:09.271356 [debug] [MainThread]: Command `dbt run` failed at 10:26:09.271308 after 4.48 seconds
[0m10:26:09.271720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104932fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1226bd350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1226bd990>]}
[0m10:26:09.271898 [debug] [MainThread]: Flushing usage events
[0m10:27:42.451298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc1b610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc5be50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc81e10>]}


============================== 10:27:42.454082 | 7f1d0ed4-8911-47a1-ab5b-7cfb006ef1bf ==============================
[0m10:27:42.454082 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:27:42.454360 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select intermediate', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:27:43.137535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f1d0ed4-8911-47a1-ab5b-7cfb006ef1bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158448890>]}
[0m10:27:43.157163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f1d0ed4-8911-47a1-ab5b-7cfb006ef1bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f400b50>]}
[0m10:27:43.157796 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:27:43.170676 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:27:43.209655 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:27:43.209962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '7f1d0ed4-8911-47a1-ab5b-7cfb006ef1bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129032990>]}
[0m10:27:43.819470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f1d0ed4-8911-47a1-ab5b-7cfb006ef1bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e03d790>]}
[0m10:27:43.860348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f1d0ed4-8911-47a1-ab5b-7cfb006ef1bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e1fc390>]}
[0m10:27:43.860572 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:27:43.860717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f1d0ed4-8911-47a1-ab5b-7cfb006ef1bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ab3ee10>]}
[0m10:27:43.861299 [info ] [MainThread]: 
[0m10:27:43.861508 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:27:43.861844 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:27:43.866812 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:27:43.866947 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:27:43.867067 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:27:44.429057 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.562 seconds
[0m10:27:44.432482 [debug] [ThreadPool]: On list_LB: Close
[0m10:27:44.557115 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_DWH_MART_stage)
[0m10:27:44.563315 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_stage"
[0m10:27:44.563592 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_stage"} */
show objects in LB.DWH_MART_stage limit 10000
[0m10:27:44.563792 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:27:45.108425 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b5923b-0202-cf54-0000-0002d446d765
[0m10:27:45.109039 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:27:45.109509 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:27:45.109819 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:27:45.110262 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: Close
[0m10:27:45.225349 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_stage, now list_LB_DWH_MART)
[0m10:27:45.229877 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART"
[0m10:27:45.230363 [debug] [ThreadPool]: On list_LB_DWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART"} */
show objects in LB.DWH_MART limit 10000
[0m10:27:45.230664 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:27:45.596539 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.366 seconds
[0m10:27:45.599156 [debug] [ThreadPool]: On list_LB_DWH_MART: Close
[0m10:27:45.717212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f1d0ed4-8911-47a1-ab5b-7cfb006ef1bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1287241d0>]}
[0m10:27:45.718569 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:27:45.719176 [info ] [MainThread]: 
[0m10:27:45.722843 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:27:45.723624 [info ] [Thread-1 (]: 1 of 1 START sql view model DWH_MART.int_view_contract ......................... [RUN]
[0m10:27:45.724131 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_DWH_MART, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:27:45.724538 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:27:45.733341 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:27:45.734683 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:27:45.758384 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:27:45.760771 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:27:45.761082 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.DWH_MART.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.DWH_MART_stage.stg_contract c
    JOIN
        LB.DWH_MART_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.DWH_MART_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.DWH_MART_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:27:45.762333 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:27:46.131339 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5923b-0202-cf69-0000-0002d446a815
[0m10:27:46.132473 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
[0m10:27:46.134723 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:27:46.281844 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:27:46.283214 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f1d0ed4-8911-47a1-ab5b-7cfb006ef1bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e034190>]}
[0m10:27:46.283632 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model DWH_MART.int_view_contract ................ [[31mERROR[0m in 0.56s]
[0m10:27:46.283933 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:27:46.285072 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:27:46.285208 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:27:46.285343 [info ] [MainThread]: 
[0m10:27:46.285485 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.42 seconds (2.42s).
[0m10:27:46.285763 [debug] [MainThread]: Command end result
[0m10:27:46.302816 [info ] [MainThread]: 
[0m10:27:46.303128 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:27:46.303259 [info ] [MainThread]: 
[0m10:27:46.303425 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:27:46.303553 [info ] [MainThread]: 
[0m10:27:46.303701 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:27:46.305508 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.8821566, "process_user_time": 2.380049, "process_kernel_time": 2.257337, "process_mem_max_rss": "202276864", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:27:46.305832 [debug] [MainThread]: Command `dbt run` failed at 10:27:46.305795 after 3.88 seconds
[0m10:27:46.306076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc5a3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102432cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc60b10>]}
[0m10:27:46.306232 [debug] [MainThread]: Flushing usage events
[0m10:32:22.548338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b21b090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13adf4110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b2819d0>]}


============================== 10:32:22.550795 | 62e00e8c-4d6b-4b5d-b614-01eab05712f0 ==============================
[0m10:32:22.550795 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:32:22.551066 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate', 'send_anonymous_usage_stats': 'True'}
[0m10:32:23.187621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '62e00e8c-4d6b-4b5d-b614-01eab05712f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aca1350>]}
[0m10:32:23.217147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '62e00e8c-4d6b-4b5d-b614-01eab05712f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ab00b10>]}
[0m10:32:23.217838 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:32:23.231786 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:32:23.269624 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:32:23.269924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '62e00e8c-4d6b-4b5d-b614-01eab05712f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fa32bd0>]}
[0m10:32:23.878444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '62e00e8c-4d6b-4b5d-b614-01eab05712f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b7e6a50>]}
[0m10:32:23.924053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '62e00e8c-4d6b-4b5d-b614-01eab05712f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b757650>]}
[0m10:32:23.924398 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:32:23.924563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62e00e8c-4d6b-4b5d-b614-01eab05712f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b7563d0>]}
[0m10:32:23.925269 [info ] [MainThread]: 
[0m10:32:23.925527 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:32:23.925930 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:32:23.932545 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:32:23.932824 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:32:23.933026 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:32:24.478767 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.546 seconds
[0m10:32:24.481196 [debug] [ThreadPool]: On list_LB: Close
[0m10:32:24.592471 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now create_LB_DWH_MART_intermediate)
[0m10:32:24.593510 [debug] [ThreadPool]: Creating schema "database: "LB"
schema: "DWH_MART_intermediate"
"
[0m10:32:24.601083 [debug] [ThreadPool]: Using snowflake connection "create_LB_DWH_MART_intermediate"
[0m10:32:24.601561 [debug] [ThreadPool]: On create_LB_DWH_MART_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "create_LB_DWH_MART_intermediate"} */
create schema if not exists LB.DWH_MART_intermediate
[0m10:32:24.601841 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:25.114059 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.512 seconds
[0m10:32:25.115552 [debug] [ThreadPool]: On create_LB_DWH_MART_intermediate: Close
[0m10:32:25.242307 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_LB_DWH_MART_intermediate, now list_LB_DWH_MART_intermediate)
[0m10:32:25.253469 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_intermediate"
[0m10:32:25.253995 [debug] [ThreadPool]: On list_LB_DWH_MART_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_intermediate"} */
show objects in LB.DWH_MART_intermediate limit 10000
[0m10:32:25.254279 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:25.612412 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.358 seconds
[0m10:32:25.615669 [debug] [ThreadPool]: On list_LB_DWH_MART_intermediate: Close
[0m10:32:25.726621 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_intermediate, now list_LB_DWH_MART_stage)
[0m10:32:25.730876 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_stage"
[0m10:32:25.731291 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_stage"} */
show objects in LB.DWH_MART_stage limit 10000
[0m10:32:25.731551 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:26.184620 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59240-0202-cf54-0000-0002d446d791
[0m10:32:26.185159 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:32:26.185586 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:32:26.185820 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:32:26.186380 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: Close
[0m10:32:26.310807 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_stage, now list_LB_DWH_MART)
[0m10:32:26.316596 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART"
[0m10:32:26.317218 [debug] [ThreadPool]: On list_LB_DWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART"} */
show objects in LB.DWH_MART limit 10000
[0m10:32:26.317883 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:26.698290 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.380 seconds
[0m10:32:26.701184 [debug] [ThreadPool]: On list_LB_DWH_MART: Close
[0m10:32:26.808075 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART, now list_LB_DWH_MART_dwh_mart)
[0m10:32:26.812277 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_dwh_mart"
[0m10:32:26.812655 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_dwh_mart"} */
show objects in LB.DWH_MART_dwh_mart limit 10000
[0m10:32:26.812945 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:32:27.225361 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59240-0202-cf54-0000-0002d446d795
[0m10:32:27.226490 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:32:27.227364 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:32:27.227923 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:32:27.228648 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: Close
[0m10:32:27.337050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62e00e8c-4d6b-4b5d-b614-01eab05712f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16baee490>]}
[0m10:32:27.338282 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:32:27.338883 [info ] [MainThread]: 
[0m10:32:27.341762 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:32:27.342733 [info ] [Thread-1 (]: 1 of 1 START sql view model DWH_MART_intermediate.int_view_contract ............ [RUN]
[0m10:32:27.343376 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_dwh_mart, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:32:27.343750 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:32:27.354497 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:32:27.355520 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:32:27.372919 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:32:27.374277 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:32:27.374555 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.DWH_MART_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.DWH_MART_stage.stg_contract c
    JOIN
        LB.DWH_MART_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.DWH_MART_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.DWH_MART_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:32:27.374881 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:32:27.948224 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59240-0202-cf6c-0000-0002d446898d
[0m10:32:27.948850 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
[0m10:32:27.949414 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:32:28.052581 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:32:28.053831 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '62e00e8c-4d6b-4b5d-b614-01eab05712f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c0f0590>]}
[0m10:32:28.054189 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model DWH_MART_intermediate.int_view_contract ... [[31mERROR[0m in 0.71s]
[0m10:32:28.054483 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:32:28.055628 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:32:28.055801 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:32:28.055942 [info ] [MainThread]: 
[0m10:32:28.056094 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 4.13 seconds (4.13s).
[0m10:32:28.056386 [debug] [MainThread]: Command end result
[0m10:32:28.073600 [info ] [MainThread]: 
[0m10:32:28.073899 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:32:28.074038 [info ] [MainThread]: 
[0m10:32:28.074207 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.DWH_MART_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:32:28.074347 [info ] [MainThread]: 
[0m10:32:28.074488 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:32:28.076309 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.567322, "process_user_time": 2.744298, "process_kernel_time": 2.211643, "process_mem_max_rss": "203341824", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:32:28.076738 [debug] [MainThread]: Command `dbt run` failed at 10:32:28.076689 after 5.57 seconds
[0m10:32:28.076988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d96cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b283a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b281610>]}
[0m10:32:28.077163 [debug] [MainThread]: Flushing usage events
[0m10:33:02.788794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13331ba90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132e20150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1333819d0>]}


============================== 10:33:02.791740 | 3537f0a4-9c3b-408e-97f0-02552a1214f2 ==============================
[0m10:33:02.791740 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:33:02.792030 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate', 'send_anonymous_usage_stats': 'True'}
[0m10:33:03.546630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3537f0a4-9c3b-408e-97f0-02552a1214f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137476250>]}
[0m10:33:03.566006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3537f0a4-9c3b-408e-97f0-02552a1214f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131a730d0>]}
[0m10:33:03.566572 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:33:03.579067 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:33:03.642343 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:33:03.642587 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:33:03.659699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3537f0a4-9c3b-408e-97f0-02552a1214f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1418bcd90>]}
[0m10:33:03.710255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3537f0a4-9c3b-408e-97f0-02552a1214f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141c91610>]}
[0m10:33:03.710648 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:33:03.710817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3537f0a4-9c3b-408e-97f0-02552a1214f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141a22dd0>]}
[0m10:33:03.711770 [info ] [MainThread]: 
[0m10:33:03.712075 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:33:03.712554 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:33:03.756519 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:33:03.756750 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:33:03.756872 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:33:04.237765 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.481 seconds
[0m10:33:04.240057 [debug] [ThreadPool]: On list_LB: Close
[0m10:33:04.520464 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_DWH_MART_stage)
[0m10:33:04.526841 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_stage"
[0m10:33:04.527091 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_stage"} */
show objects in LB.DWH_MART_stage limit 10000
[0m10:33:04.527235 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:04.956975 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.430 seconds
[0m10:33:04.960063 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: Close
[0m10:33:05.062100 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_stage, now list_LB_DWH_MART)
[0m10:33:05.066056 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART"
[0m10:33:05.066657 [debug] [ThreadPool]: On list_LB_DWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART"} */
show objects in LB.DWH_MART limit 10000
[0m10:33:05.067030 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:05.512467 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.445 seconds
[0m10:33:05.514603 [debug] [ThreadPool]: On list_LB_DWH_MART: Close
[0m10:33:05.624869 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART, now list_LB_DWH_MART_intermediate)
[0m10:33:05.627429 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_intermediate"
[0m10:33:05.627604 [debug] [ThreadPool]: On list_LB_DWH_MART_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_intermediate"} */
show objects in LB.DWH_MART_intermediate limit 10000
[0m10:33:05.627768 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:05.989006 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.360 seconds
[0m10:33:05.993003 [debug] [ThreadPool]: On list_LB_DWH_MART_intermediate: Close
[0m10:33:06.142257 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_intermediate, now list_LB_DWH_MART_dwh_mart)
[0m10:33:06.144324 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_dwh_mart"
[0m10:33:06.144532 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_dwh_mart"} */
show objects in LB.DWH_MART_dwh_mart limit 10000
[0m10:33:06.144688 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:33:06.544563 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59241-0202-cf6c-0000-0002d4468991
[0m10:33:06.545253 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:33:06.545789 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:33:06.546148 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:33:06.546620 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: Close
[0m10:33:06.648944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3537f0a4-9c3b-408e-97f0-02552a1214f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131224250>]}
[0m10:33:06.650301 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:33:06.650829 [info ] [MainThread]: 
[0m10:33:06.654024 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:33:06.654684 [info ] [Thread-1 (]: 1 of 1 START sql view model DWH_MART_intermediate.int_view_contract ............ [RUN]
[0m10:33:06.655126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_dwh_mart, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:33:06.655469 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:33:06.667027 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:33:06.667851 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:33:06.690233 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:33:06.691828 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:33:06.692108 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.DWH_MART_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.DWH_MART_stage.stg_contract c
    JOIN
        LB.DWH_MART_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.DWH_MART_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.DWH_MART_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:33:06.692327 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:33:07.083344 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59241-0202-d459-0000-0002d446e03d
[0m10:33:07.084700 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART_STAGE.STG_CONTRACT' does not exist or not authorized.
[0m10:33:07.087444 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:33:07.230748 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART_STAGE.STG_CONTRACT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:33:07.234076 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3537f0a4-9c3b-408e-97f0-02552a1214f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141abd5d0>]}
[0m10:33:07.235301 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model DWH_MART_intermediate.int_view_contract ... [[31mERROR[0m in 0.58s]
[0m10:33:07.236281 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:33:07.239886 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:33:07.240533 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:33:07.241016 [info ] [MainThread]: 
[0m10:33:07.241419 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.53 seconds (3.53s).
[0m10:33:07.242244 [debug] [MainThread]: Command end result
[0m10:33:07.275996 [info ] [MainThread]: 
[0m10:33:07.276371 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:33:07.276559 [info ] [MainThread]: 
[0m10:33:07.276763 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART_STAGE.STG_CONTRACT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:33:07.276934 [info ] [MainThread]: 
[0m10:33:07.277111 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:33:07.279660 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.5231223, "process_user_time": 2.324375, "process_kernel_time": 1.771485, "process_mem_max_rss": "195837952", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:33:07.281000 [debug] [MainThread]: Command `dbt run` failed at 10:33:07.280764 after 4.52 seconds
[0m10:33:07.281472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1333818d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103136cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141f03b90>]}
[0m10:33:07.281734 [debug] [MainThread]: Flushing usage events
[0m10:36:06.236521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14041b450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14047d050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14047d690>]}


============================== 10:36:06.239975 | e6332db0-5fa1-4435-b8e4-c15bf7ece070 ==============================
[0m10:36:06.239975 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:36:06.240325 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select intermediate', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:36:08.126494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e6332db0-5fa1-4435-b8e4-c15bf7ece070', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147d2dbd0>]}
[0m10:36:08.150112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e6332db0-5fa1-4435-b8e4-c15bf7ece070', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c00c10>]}
[0m10:36:08.150820 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:36:08.166288 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:36:08.242462 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:36:08.242745 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:36:08.260809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e6332db0-5fa1-4435-b8e4-c15bf7ece070', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17daeb390>]}
[0m10:36:08.309800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e6332db0-5fa1-4435-b8e4-c15bf7ece070', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17de425d0>]}
[0m10:36:08.310159 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:36:08.310363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e6332db0-5fa1-4435-b8e4-c15bf7ece070', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17dcdc390>]}
[0m10:36:08.311262 [info ] [MainThread]: 
[0m10:36:08.311592 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:36:08.312189 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:36:08.374119 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:36:08.374454 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:36:08.374621 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:36:08.853074 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.478 seconds
[0m10:36:08.854247 [debug] [ThreadPool]: On list_LB: Close
[0m10:36:08.973661 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_DWH_MART_dwh_mart)
[0m10:36:08.981035 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_dwh_mart"
[0m10:36:08.981338 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_dwh_mart"} */
show objects in LB.DWH_MART_dwh_mart limit 10000
[0m10:36:08.981475 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:36:09.401789 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59244-0202-cf6c-0000-0002d44689b5
[0m10:36:09.402281 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:36:09.402646 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:36:09.402935 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:36:09.403344 [debug] [ThreadPool]: On list_LB_DWH_MART_dwh_mart: Close
[0m10:36:09.555391 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_dwh_mart, now list_LB_DWH_MART_intermediate)
[0m10:36:09.557464 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_intermediate"
[0m10:36:09.557722 [debug] [ThreadPool]: On list_LB_DWH_MART_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_intermediate"} */
show objects in LB.DWH_MART_intermediate limit 10000
[0m10:36:09.557897 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:36:09.949649 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.392 seconds
[0m10:36:09.952274 [debug] [ThreadPool]: On list_LB_DWH_MART_intermediate: Close
[0m10:36:10.057372 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_intermediate, now list_LB_DWH_MART_stage)
[0m10:36:10.062079 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART_stage"
[0m10:36:10.062695 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART_stage"} */
show objects in LB.DWH_MART_stage limit 10000
[0m10:36:10.063071 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:36:10.466893 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.404 seconds
[0m10:36:10.467929 [debug] [ThreadPool]: On list_LB_DWH_MART_stage: Close
[0m10:36:10.577181 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_DWH_MART_stage, now list_LB_DWH_MART)
[0m10:36:10.578729 [debug] [ThreadPool]: Using snowflake connection "list_LB_DWH_MART"
[0m10:36:10.578910 [debug] [ThreadPool]: On list_LB_DWH_MART: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_DWH_MART"} */
show objects in LB.DWH_MART limit 10000
[0m10:36:10.579047 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:36:10.915520 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.336 seconds
[0m10:36:10.918756 [debug] [ThreadPool]: On list_LB_DWH_MART: Close
[0m10:36:11.038949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e6332db0-5fa1-4435-b8e4-c15bf7ece070', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17dc4bf50>]}
[0m10:36:11.041115 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:36:11.042042 [info ] [MainThread]: 
[0m10:36:11.048853 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:36:11.050257 [info ] [Thread-1 (]: 1 of 1 START sql view model DWH_MART_intermediate.int_view_contract ............ [RUN]
[0m10:36:11.050925 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_DWH_MART, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:36:11.051396 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:36:11.063297 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:36:11.064246 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:36:11.089241 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:36:11.091710 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:36:11.092163 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.DWH_MART_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.DWH_MART_stage.stg_contract c
    JOIN
        LB.DWH_MART_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.DWH_MART_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.DWH_MART_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:36:11.092790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:36:11.448675 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59244-0202-cf6c-0000-0002d44689b9
[0m10:36:11.449355 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.DWH_MART_STAGE.STG_CONTRACT' does not exist or not authorized.
[0m10:36:11.450112 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:36:11.563663 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART_STAGE.STG_CONTRACT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:36:11.566422 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e6332db0-5fa1-4435-b8e4-c15bf7ece070', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17dd0b110>]}
[0m10:36:11.567197 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model DWH_MART_intermediate.int_view_contract ... [[31mERROR[0m in 0.51s]
[0m10:36:11.567822 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:36:11.570558 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:36:11.570831 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:36:11.571000 [info ] [MainThread]: 
[0m10:36:11.571282 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.26 seconds (3.26s).
[0m10:36:11.571892 [debug] [MainThread]: Command end result
[0m10:36:11.595090 [info ] [MainThread]: 
[0m10:36:11.595369 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:36:11.595498 [info ] [MainThread]: 
[0m10:36:11.595669 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.DWH_MART_STAGE.STG_CONTRACT' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:36:11.595800 [info ] [MainThread]: 
[0m10:36:11.595937 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:36:11.597585 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.4137216, "process_user_time": 2.854476, "process_kernel_time": 1.63089, "process_mem_max_rss": "190251008", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:36:11.597915 [debug] [MainThread]: Command `dbt run` failed at 10:36:11.597878 after 5.41 seconds
[0m10:36:11.598168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049aecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14047f750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140420090>]}
[0m10:36:11.598331 [debug] [MainThread]: Flushing usage events
[0m10:37:58.525822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16451d750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x164238110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16457d990>]}


============================== 10:37:58.528629 | 55c495a2-e553-4c3c-994c-57873e3086c3 ==============================
[0m10:37:58.528629 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:37:58.528985 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select intermediate', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:37:59.193537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55c495a2-e553-4c3c-994c-57873e3086c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16454c950>]}
[0m10:37:59.212668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '55c495a2-e553-4c3c-994c-57873e3086c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163d00b10>]}
[0m10:37:59.213198 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:37:59.231825 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:37:59.270608 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m10:37:59.270906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '55c495a2-e553-4c3c-994c-57873e3086c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x162d2ed10>]}
[0m10:37:59.914704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '55c495a2-e553-4c3c-994c-57873e3086c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bfe59d0>]}
[0m10:37:59.961588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '55c495a2-e553-4c3c-994c-57873e3086c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c4fff10>]}
[0m10:37:59.961849 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:37:59.962005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55c495a2-e553-4c3c-994c-57873e3086c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c3e2c50>]}
[0m10:37:59.962625 [info ] [MainThread]: 
[0m10:37:59.962851 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:37:59.963203 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:37:59.968419 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:37:59.968562 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:37:59.968679 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:38:00.450762 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.482 seconds
[0m10:38:00.453642 [debug] [ThreadPool]: On list_LB: Close
[0m10:38:00.569727 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now create_LB_stage_intermediate)
[0m10:38:00.570907 [debug] [ThreadPool]: Creating schema "database: "LB"
schema: "stage_intermediate"
"
[0m10:38:00.579763 [debug] [ThreadPool]: Using snowflake connection "create_LB_stage_intermediate"
[0m10:38:00.580705 [debug] [ThreadPool]: On create_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "create_LB_stage_intermediate"} */
create schema if not exists LB.stage_intermediate
[0m10:38:00.581235 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:38:01.026730 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.445 seconds
[0m10:38:01.029915 [debug] [ThreadPool]: On create_LB_stage_intermediate: Close
[0m10:38:01.162245 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_LB_stage_intermediate, now list_LB_stage_dwh_mart)
[0m10:38:01.175903 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m10:38:01.176461 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m10:38:01.176755 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:38:01.788439 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.612 seconds
[0m10:38:01.791230 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m10:38:01.911974 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now list_LB_stage_intermediate)
[0m10:38:01.915766 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m10:38:01.916315 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m10:38:01.916615 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:38:02.587496 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.671 seconds
[0m10:38:02.589452 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m10:38:02.698965 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage_stage)
[0m10:38:02.703909 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_stage"
[0m10:38:02.704391 [debug] [ThreadPool]: On list_LB_stage_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_stage"} */
show objects in LB.stage_stage limit 10000
[0m10:38:02.704716 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:38:03.093519 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59246-0202-d452-0000-0002d446f095
[0m10:38:03.094039 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:38:03.094376 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:38:03.094577 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:38:03.095686 [debug] [ThreadPool]: On list_LB_stage_stage: Close
[0m10:38:03.331174 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_stage, now list_LB_stage)
[0m10:38:03.336673 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m10:38:03.337253 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m10:38:03.337963 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:38:03.694319 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.356 seconds
[0m10:38:03.698266 [debug] [ThreadPool]: On list_LB_stage: Close
[0m10:38:03.811096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55c495a2-e553-4c3c-994c-57873e3086c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c151190>]}
[0m10:38:03.812858 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:38:03.813533 [info ] [MainThread]: 
[0m10:38:03.818701 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:38:03.826422 [info ] [Thread-1 (]: 1 of 1 START sql view model stage_intermediate.int_view_contract ............... [RUN]
[0m10:38:03.827941 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:38:03.829011 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:38:03.849823 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:38:03.850620 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:38:03.867469 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:38:03.868860 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:38:03.869187 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.stage_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.stage_stage.stg_contract c
    JOIN
        LB.stage_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.stage_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.stage_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:38:03.869443 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:38:04.160043 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59246-0202-cf54-0000-0002d446d7c1
[0m10:38:04.160655 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.STAGE_STAGE' does not exist or not authorized.
[0m10:38:04.161159 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:38:04.265757 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:38:04.267655 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55c495a2-e553-4c3c-994c-57873e3086c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16be52a50>]}
[0m10:38:04.268284 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model stage_intermediate.int_view_contract ...... [[31mERROR[0m in 0.44s]
[0m10:38:04.268843 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:38:04.270759 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:38:04.271106 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:38:04.271361 [info ] [MainThread]: 
[0m10:38:04.271626 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 4.31 seconds (4.31s).
[0m10:38:04.272128 [debug] [MainThread]: Command end result
[0m10:38:04.296153 [info ] [MainThread]: 
[0m10:38:04.296496 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:38:04.296675 [info ] [MainThread]: 
[0m10:38:04.296892 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:38:04.297058 [info ] [MainThread]: 
[0m10:38:04.297228 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:38:04.299170 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.8029594, "process_user_time": 2.481278, "process_kernel_time": 2.519541, "process_mem_max_rss": "199213056", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:38:04.299484 [debug] [MainThread]: Command `dbt run` failed at 10:38:04.299448 after 5.80 seconds
[0m10:38:04.299733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1635e32d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100ceacd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x162b93f50>]}
[0m10:38:04.299872 [debug] [MainThread]: Flushing usage events
[0m10:39:22.536008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14681b3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1463f0110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146871b50>]}


============================== 10:39:22.538572 | e91c4436-f3c4-49ea-b647-4c1bab791315 ==============================
[0m10:39:22.538572 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:39:22.538842 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate', 'send_anonymous_usage_stats': 'True'}
[0m10:39:23.453898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e91c4436-f3c4-49ea-b647-4c1bab791315', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a678290>]}
[0m10:39:23.480881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e91c4436-f3c4-49ea-b647-4c1bab791315', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146100b50>]}
[0m10:39:23.481851 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:39:23.500500 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:39:23.561360 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:39:23.561941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e91c4436-f3c4-49ea-b647-4c1bab791315', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14502ebd0>]}
[0m10:39:24.536984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e91c4436-f3c4-49ea-b647-4c1bab791315', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b6b7f10>]}
[0m10:39:24.580279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e91c4436-f3c4-49ea-b647-4c1bab791315', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bcf8190>]}
[0m10:39:24.580563 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:39:24.580724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e91c4436-f3c4-49ea-b647-4c1bab791315', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b6dd850>]}
[0m10:39:24.581402 [info ] [MainThread]: 
[0m10:39:24.581645 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:39:24.581995 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:39:24.587258 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:39:24.587417 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:39:24.587555 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:39:25.201938 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.614 seconds
[0m10:39:25.205641 [debug] [ThreadPool]: On list_LB: Close
[0m10:39:25.330730 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m10:39:25.339139 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m10:39:25.339368 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m10:39:25.339495 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:39:25.764965 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.425 seconds
[0m10:39:25.767828 [debug] [ThreadPool]: On list_LB_stage: Close
[0m10:39:25.869175 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_stage_stage)
[0m10:39:25.874707 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_stage"
[0m10:39:25.875279 [debug] [ThreadPool]: On list_LB_stage_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_stage"} */
show objects in LB.stage_stage limit 10000
[0m10:39:25.875706 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:39:26.286343 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59247-0202-cf6b-0000-0002d446c88d
[0m10:39:26.286627 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:39:26.286823 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:39:26.286962 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:39:26.287176 [debug] [ThreadPool]: On list_LB_stage_stage: Close
[0m10:39:26.394522 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_stage, now list_LB_stage_dwh_mart)
[0m10:39:26.396232 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m10:39:26.396418 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m10:39:26.396551 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:39:26.704456 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.308 seconds
[0m10:39:26.708576 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m10:39:26.829444 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now list_LB_stage_intermediate)
[0m10:39:26.833127 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m10:39:26.833621 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m10:39:26.834035 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:39:27.319499 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.485 seconds
[0m10:39:27.322043 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m10:39:27.421492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e91c4436-f3c4-49ea-b647-4c1bab791315', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bcdce50>]}
[0m10:39:27.422240 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:39:27.422442 [info ] [MainThread]: 
[0m10:39:27.428023 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:39:27.428942 [info ] [Thread-1 (]: 1 of 1 START sql view model stage_intermediate.int_view_contract ............... [RUN]
[0m10:39:27.430207 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:39:27.430818 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:39:27.442450 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:39:27.443391 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:39:27.464648 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:39:27.466531 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:39:27.466902 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.stage_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.stage_stage.stg_contract c
    JOIN
        LB.stage_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.stage_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.stage_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:39:27.467142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:39:27.760710 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59247-0202-cf6b-0000-0002d446c895
[0m10:39:27.761526 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.STAGE_STAGE' does not exist or not authorized.
[0m10:39:27.762321 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:39:27.894477 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:39:27.901696 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e91c4436-f3c4-49ea-b647-4c1bab791315', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bcbd450>]}
[0m10:39:27.903062 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model stage_intermediate.int_view_contract ...... [[31mERROR[0m in 0.47s]
[0m10:39:27.903867 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:39:27.908666 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:39:27.910183 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:39:27.910417 [info ] [MainThread]: 
[0m10:39:27.910606 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.33 seconds (3.33s).
[0m10:39:27.910965 [debug] [MainThread]: Command end result
[0m10:39:27.936831 [info ] [MainThread]: 
[0m10:39:27.937123 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:39:27.937264 [info ] [MainThread]: 
[0m10:39:27.937449 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:39:27.937582 [info ] [MainThread]: 
[0m10:39:27.937738 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:39:27.940553 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.440728, "process_user_time": 2.685323, "process_kernel_time": 2.583313, "process_mem_max_rss": "182632448", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:39:27.941906 [debug] [MainThread]: Command `dbt run` failed at 10:39:27.941847 after 5.44 seconds
[0m10:39:27.942683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032becd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1468717d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146870b50>]}
[0m10:39:27.942904 [debug] [MainThread]: Flushing usage events
[0m10:40:18.238136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f35ac10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f3bd410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f3bda90>]}


============================== 10:40:18.241052 | 7b52d868-81c3-407c-a447-1ec6a2212e8e ==============================
[0m10:40:18.241052 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:40:18.241414 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select staging', 'send_anonymous_usage_stats': 'True'}
[0m10:40:20.348662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7b52d868-81c3-407c-a447-1ec6a2212e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d2ce390>]}
[0m10:40:20.369622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7b52d868-81c3-407c-a447-1ec6a2212e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d3ea590>]}
[0m10:40:20.370248 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:40:20.404033 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:40:20.459395 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:40:20.460160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '7b52d868-81c3-407c-a447-1ec6a2212e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dd2e850>]}
[0m10:40:21.120767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7b52d868-81c3-407c-a447-1ec6a2212e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16891c6d0>]}
[0m10:40:21.161063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7b52d868-81c3-407c-a447-1ec6a2212e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168def6d0>]}
[0m10:40:21.161303 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:40:21.161459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7b52d868-81c3-407c-a447-1ec6a2212e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168bcac50>]}
[0m10:40:21.162093 [info ] [MainThread]: 
[0m10:40:21.162324 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:40:21.163944 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:40:21.169062 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:40:21.169224 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:40:21.169342 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:40:21.899896 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.730 seconds
[0m10:40:21.904698 [debug] [ThreadPool]: On list_LB: Close
[0m10:40:22.023086 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now create_LB_stage_stage)
[0m10:40:22.023725 [debug] [ThreadPool]: Creating schema "database: "LB"
schema: "stage_stage"
"
[0m10:40:22.028042 [debug] [ThreadPool]: Using snowflake connection "create_LB_stage_stage"
[0m10:40:22.028327 [debug] [ThreadPool]: On create_LB_stage_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "create_LB_stage_stage"} */
create schema if not exists LB.stage_stage
[0m10:40:22.028480 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:40:22.671932 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.643 seconds
[0m10:40:22.674875 [debug] [ThreadPool]: On create_LB_stage_stage: Close
[0m10:40:22.793062 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_LB_stage_stage, now list_LB_stage)
[0m10:40:22.804151 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m10:40:22.804613 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m10:40:22.804842 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:40:23.422479 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.617 seconds
[0m10:40:23.430055 [debug] [ThreadPool]: On list_LB_stage: Close
[0m10:40:23.536190 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_stage_stage)
[0m10:40:23.541967 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_stage"
[0m10:40:23.542424 [debug] [ThreadPool]: On list_LB_stage_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_stage"} */
show objects in LB.stage_stage limit 10000
[0m10:40:23.542738 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:40:23.997780 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.455 seconds
[0m10:40:24.000428 [debug] [ThreadPool]: On list_LB_stage_stage: Close
[0m10:40:24.125202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7b52d868-81c3-407c-a447-1ec6a2212e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168d00d90>]}
[0m10:40:24.126478 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:40:24.127073 [info ] [MainThread]: 
[0m10:40:24.130854 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m10:40:24.131628 [info ] [Thread-1 (]: 1 of 3 START sql table model stage_stage.stg_contract .......................... [RUN]
[0m10:40:24.132188 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m10:40:24.132637 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m10:40:24.140180 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m10:40:24.140716 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m10:40:24.153330 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m10:40:24.154217 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m10:40:24.154486 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage_stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m10:40:24.154650 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:40:25.951087 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.795 seconds
[0m10:40:25.981190 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m10:40:26.096823 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b52d868-81c3-407c-a447-1ec6a2212e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16913af10>]}
[0m10:40:26.098117 [info ] [Thread-1 (]: 1 of 3 OK created sql table model stage_stage.stg_contract ..................... [[32mSUCCESS 1[0m in 1.96s]
[0m10:40:26.098890 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m10:40:26.099452 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m10:40:26.100404 [info ] [Thread-1 (]: 2 of 3 START sql table model stage_stage.stg_prices ............................ [RUN]
[0m10:40:26.101123 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m10:40:26.101551 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m10:40:26.105883 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m10:40:26.109406 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m10:40:26.112021 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m10:40:26.112947 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m10:40:26.113241 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage_stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m10:40:26.113525 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:40:27.588692 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.475 seconds
[0m10:40:27.590093 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m10:40:27.697670 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b52d868-81c3-407c-a447-1ec6a2212e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169113d50>]}
[0m10:40:27.698388 [info ] [Thread-1 (]: 2 of 3 OK created sql table model stage_stage.stg_prices ....................... [[32mSUCCESS 1[0m in 1.60s]
[0m10:40:27.699206 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m10:40:27.699680 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m10:40:27.700562 [info ] [Thread-1 (]: 3 of 3 START sql table model stage_stage.stg_products .......................... [RUN]
[0m10:40:27.701357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m10:40:27.701771 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m10:40:27.706388 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m10:40:27.707021 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m10:40:27.709445 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m10:40:27.710227 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m10:40:27.710427 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage_stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m10:40:27.710609 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:40:28.994486 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.281 seconds
[0m10:40:29.009153 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m10:40:29.104015 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b52d868-81c3-407c-a447-1ec6a2212e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16921ea90>]}
[0m10:40:29.104937 [info ] [Thread-1 (]: 3 of 3 OK created sql table model stage_stage.stg_products ..................... [[32mSUCCESS 1[0m in 1.40s]
[0m10:40:29.105426 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m10:40:29.107073 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:40:29.107312 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m10:40:29.107646 [info ] [MainThread]: 
[0m10:40:29.107937 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 7.95 seconds (7.95s).
[0m10:40:29.108852 [debug] [MainThread]: Command end result
[0m10:40:29.146264 [info ] [MainThread]: 
[0m10:40:29.146638 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:40:29.146791 [info ] [MainThread]: 
[0m10:40:29.146985 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:40:29.156762 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.94885, "process_user_time": 3.217149, "process_kernel_time": 1.673513, "process_mem_max_rss": "197083136", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:40:29.157829 [debug] [MainThread]: Command `dbt run` succeeded at 10:40:29.157742 after 10.95 seconds
[0m10:40:29.158686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f11190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104eb2cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ec1810>]}
[0m10:40:29.159165 [debug] [MainThread]: Flushing usage events
[0m10:44:55.941546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132255790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1322bd3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1322bda50>]}


============================== 10:44:55.944104 | 0194c1a4-e1aa-42bb-a41f-09eae2c958f3 ==============================
[0m10:44:55.944104 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:44:55.944378 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate', 'send_anonymous_usage_stats': 'True'}
[0m10:44:56.649265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0194c1a4-e1aa-42bb-a41f-09eae2c958f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151a9e390>]}
[0m10:44:56.668251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0194c1a4-e1aa-42bb-a41f-09eae2c958f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131d00bd0>]}
[0m10:44:56.668726 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:44:56.685128 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:44:56.727862 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:44:56.728165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0194c1a4-e1aa-42bb-a41f-09eae2c958f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151b7db10>]}
[0m10:44:57.362814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0194c1a4-e1aa-42bb-a41f-09eae2c958f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152102310>]}
[0m10:44:57.408146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0194c1a4-e1aa-42bb-a41f-09eae2c958f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15244c190>]}
[0m10:44:57.408484 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:44:57.408659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0194c1a4-e1aa-42bb-a41f-09eae2c958f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152230050>]}
[0m10:44:57.409424 [info ] [MainThread]: 
[0m10:44:57.409709 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:44:57.410159 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:44:57.416169 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:44:57.416608 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:44:57.416753 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:44:57.988987 [debug] [ThreadPool]: SQL status: SUCCESS 13 in 0.572 seconds
[0m10:44:57.992055 [debug] [ThreadPool]: On list_LB: Close
[0m10:44:58.099270 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage_stage)
[0m10:44:58.104068 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_stage"
[0m10:44:58.104346 [debug] [ThreadPool]: On list_LB_stage_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_stage"} */
show objects in LB.stage_stage limit 10000
[0m10:44:58.104484 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:44:58.493858 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.389 seconds
[0m10:44:58.497041 [debug] [ThreadPool]: On list_LB_stage_stage: Close
[0m10:44:58.616120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_stage, now list_LB_stage_intermediate)
[0m10:44:58.620896 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m10:44:58.621409 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m10:44:58.621748 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:44:59.043660 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.422 seconds
[0m10:44:59.046498 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m10:44:59.148298 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage)
[0m10:44:59.150502 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m10:44:59.150775 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m10:44:59.150979 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:44:59.668938 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.518 seconds
[0m10:44:59.671343 [debug] [ThreadPool]: On list_LB_stage: Close
[0m10:44:59.778610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0194c1a4-e1aa-42bb-a41f-09eae2c958f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15228d650>]}
[0m10:44:59.780129 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:44:59.780815 [info ] [MainThread]: 
[0m10:44:59.784466 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:44:59.785226 [info ] [Thread-1 (]: 1 of 1 START sql view model stage_intermediate.int_view_contract ............... [RUN]
[0m10:44:59.785746 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:44:59.786238 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:44:59.795861 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:44:59.799400 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:44:59.813875 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:44:59.815391 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:44:59.815675 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.stage_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.stage_stage.stg_contract c
    JOIN
        LB.stage_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.stage_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.stage_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:44:59.815879 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:45:00.413349 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.597 seconds
[0m10:45:00.436354 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:45:00.669658 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0194c1a4-e1aa-42bb-a41f-09eae2c958f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152867e10>]}
[0m10:45:00.671079 [info ] [Thread-1 (]: 1 of 1 OK created sql view model stage_intermediate.int_view_contract .......... [[32mSUCCESS 1[0m in 0.88s]
[0m10:45:00.671990 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:45:00.673955 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:45:00.674451 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:45:00.674835 [info ] [MainThread]: 
[0m10:45:00.675227 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.27 seconds (3.27s).
[0m10:45:00.676016 [debug] [MainThread]: Command end result
[0m10:45:00.704871 [info ] [MainThread]: 
[0m10:45:00.705574 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:45:00.705722 [info ] [MainThread]: 
[0m10:45:00.705915 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:45:00.707814 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.7960715, "process_user_time": 2.456024, "process_kernel_time": 2.467558, "process_mem_max_rss": "197820416", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:45:00.708340 [debug] [MainThread]: Command `dbt run` succeeded at 10:45:00.708273 after 4.80 seconds
[0m10:45:00.708735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1315e3250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132295a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b72e50>]}
[0m10:45:00.708965 [debug] [MainThread]: Flushing usage events
[0m10:49:23.850157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a01ba10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a081410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a081a90>]}


============================== 10:49:23.854275 | 75649a49-34e6-430b-9b26-b49684bb5f7a ==============================
[0m10:49:23.854275 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:49:23.854653 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select intermediate', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:49:24.764475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '75649a49-34e6-430b-9b26-b49684bb5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b608cd0>]}
[0m10:49:24.786740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '75649a49-34e6-430b-9b26-b49684bb5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1297fca90>]}
[0m10:49:24.787343 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:49:24.806375 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:49:24.866528 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:49:24.866898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '75649a49-34e6-430b-9b26-b49684bb5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12872ea50>]}
[0m10:49:25.677529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '75649a49-34e6-430b-9b26-b49684bb5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b8e7f50>]}
[0m10:49:25.727607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '75649a49-34e6-430b-9b26-b49684bb5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13be7c0d0>]}
[0m10:49:25.727976 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:49:25.728319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75649a49-34e6-430b-9b26-b49684bb5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bcec5d0>]}
[0m10:49:25.729423 [info ] [MainThread]: 
[0m10:49:25.729903 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:49:25.730814 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:49:25.744333 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:49:25.744737 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:49:25.745138 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:49:26.378394 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.631 seconds
[0m10:49:26.384314 [debug] [ThreadPool]: On list_LB: Close
[0m10:49:26.534011 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now create_LB_stage_intermediate)
[0m10:49:26.537382 [debug] [ThreadPool]: Creating schema "database: "LB"
schema: "stage_intermediate"
"
[0m10:49:26.554561 [debug] [ThreadPool]: Using snowflake connection "create_LB_stage_intermediate"
[0m10:49:26.555110 [debug] [ThreadPool]: On create_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "create_LB_stage_intermediate"} */
create schema if not exists LB.stage_intermediate
[0m10:49:26.555338 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:49:27.059638 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.504 seconds
[0m10:49:27.066341 [debug] [ThreadPool]: On create_LB_stage_intermediate: Close
[0m10:49:27.216741 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_LB_stage_intermediate, now list_LB_stage_stage)
[0m10:49:27.227760 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_stage"
[0m10:49:27.228052 [debug] [ThreadPool]: On list_LB_stage_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_stage"} */
show objects in LB.stage_stage limit 10000
[0m10:49:27.228223 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:49:27.690068 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59251-0202-cf6c-0000-0002d4468a6d
[0m10:49:27.690560 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:49:27.691009 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:49:27.691327 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:49:27.691764 [debug] [ThreadPool]: On list_LB_stage_stage: Close
[0m10:49:27.810304 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_stage, now list_LB_stage_intermediate)
[0m10:49:27.814900 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m10:49:27.815442 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m10:49:27.815797 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:49:28.261848 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.446 seconds
[0m10:49:28.265515 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m10:49:28.388373 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage)
[0m10:49:28.393316 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m10:49:28.393837 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m10:49:28.394162 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:49:28.869646 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.475 seconds
[0m10:49:28.872326 [debug] [ThreadPool]: On list_LB_stage: Close
[0m10:49:29.011913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75649a49-34e6-430b-9b26-b49684bb5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13be7c450>]}
[0m10:49:29.013463 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:49:29.014113 [info ] [MainThread]: 
[0m10:49:29.017417 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:49:29.018060 [info ] [Thread-1 (]: 1 of 1 START sql view model stage_intermediate.int_view_contract ............... [RUN]
[0m10:49:29.018553 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:49:29.018942 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:49:29.026118 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:49:29.026811 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:49:29.042165 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:49:29.043302 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:49:29.043529 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.stage_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.stage_stage.stg_contract c
    JOIN
        LB.stage_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.stage_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.stage_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:49:29.043733 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:49:29.476934 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59251-0202-cf6c-0000-0002d4468a71
[0m10:49:29.478108 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.STAGE_STAGE' does not exist or not authorized.
[0m10:49:29.479111 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:49:29.610374 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:49:29.613875 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75649a49-34e6-430b-9b26-b49684bb5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cd1c910>]}
[0m10:49:29.614733 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model stage_intermediate.int_view_contract ...... [[31mERROR[0m in 0.59s]
[0m10:49:29.615339 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:49:29.618069 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:49:29.618500 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:49:29.618848 [info ] [MainThread]: 
[0m10:49:29.619214 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.89 seconds (3.89s).
[0m10:49:29.619940 [debug] [MainThread]: Command end result
[0m10:49:29.645782 [info ] [MainThread]: 
[0m10:49:29.646134 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:49:29.646330 [info ] [MainThread]: 
[0m10:49:29.646549 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:49:29.646719 [info ] [MainThread]: 
[0m10:49:29.646950 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:49:29.649352 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.8475137, "process_user_time": 2.845649, "process_kernel_time": 2.497877, "process_mem_max_rss": "181731328", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:49:29.649961 [debug] [MainThread]: Command `dbt run` failed at 10:49:29.649907 after 5.85 seconds
[0m10:49:29.650398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1299b0450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c9ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d98890>]}
[0m10:49:29.650591 [debug] [MainThread]: Flushing usage events
[0m10:52:21.324356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d56c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137dbd210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137dbd850>]}


============================== 10:52:21.326615 | 2019c804-5811-4169-9e10-31e69b8c9088 ==============================
[0m10:52:21.326615 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:52:21.326887 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select intermediate', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:52:21.937584 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "default", target "dev" invalid: 'schema' is a required property
[0m10:52:21.938843 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.6413101, "process_user_time": 1.382068, "process_kernel_time": 2.163316, "process_mem_max_rss": "177602560", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:52:21.939101 [debug] [MainThread]: Command `dbt run` failed at 10:52:21.939056 after 0.64 seconds
[0m10:52:21.939267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137dbd810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1026becd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156473090>]}
[0m10:52:21.939434 [debug] [MainThread]: Flushing usage events
[0m10:55:34.004926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160457850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1604bd390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1604bd990>]}


============================== 10:55:34.007434 | 5c931b30-cccf-4c6a-a70c-bca440cad64a ==============================
[0m10:55:34.007434 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:55:34.007697 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select intermediate', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:55:34.860749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c931b30-cccf-4c6a-a70c-bca440cad64a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167f17690>]}
[0m10:55:34.880026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c931b30-cccf-4c6a-a70c-bca440cad64a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff00b50>]}
[0m10:55:34.880596 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:55:34.897394 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:55:34.961723 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m10:55:34.962088 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_metrics.sql
[0m10:55:34.962256 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m10:55:35.118797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c931b30-cccf-4c6a-a70c-bca440cad64a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16819c0d0>]}
[0m10:55:35.176863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c931b30-cccf-4c6a-a70c-bca440cad64a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167e3ed10>]}
[0m10:55:35.177183 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:55:35.177352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c931b30-cccf-4c6a-a70c-bca440cad64a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167fa1a50>]}
[0m10:55:35.178109 [info ] [MainThread]: 
[0m10:55:35.178367 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:55:35.178790 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:55:35.185360 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:55:35.185820 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:55:35.186069 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:55:35.740255 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.554 seconds
[0m10:55:35.742986 [debug] [ThreadPool]: On list_LB: Close
[0m10:55:35.860624 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage_stage)
[0m10:55:35.871903 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_stage"
[0m10:55:35.872432 [debug] [ThreadPool]: On list_LB_stage_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_stage"} */
show objects in LB.stage_stage limit 10000
[0m10:55:35.872904 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:55:36.353469 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59257-0202-cf6b-0000-0002d446c911
[0m10:55:36.354053 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:55:36.354508 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:55:36.354800 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:55:36.355180 [debug] [ThreadPool]: On list_LB_stage_stage: Close
[0m10:55:36.452230 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_stage, now list_LB_stage_intermediate)
[0m10:55:36.453653 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m10:55:36.453834 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m10:55:36.453973 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:55:37.099202 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.645 seconds
[0m10:55:37.102586 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m10:55:37.225846 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage_dwh_mart)
[0m10:55:37.229943 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m10:55:37.230397 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m10:55:37.230648 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:55:37.607581 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59257-0202-cf54-0000-0002d446d879
[0m10:55:37.608613 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:55:37.609560 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:55:37.610252 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:55:37.611040 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m10:55:37.734195 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now list_LB_stage)
[0m10:55:37.738997 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m10:55:37.739605 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m10:55:37.740038 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:55:38.186824 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.447 seconds
[0m10:55:38.190684 [debug] [ThreadPool]: On list_LB_stage: Close
[0m10:55:38.304181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c931b30-cccf-4c6a-a70c-bca440cad64a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168417090>]}
[0m10:55:38.305633 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:55:38.306262 [info ] [MainThread]: 
[0m10:55:38.310843 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:55:38.311585 [info ] [Thread-1 (]: 1 of 1 START sql view model stage_intermediate.int_view_contract ............... [RUN]
[0m10:55:38.312129 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:55:38.312550 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:55:38.326612 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:55:38.327594 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:55:38.357846 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:55:38.359464 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:55:38.359757 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.stage_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.stage_stage.stg_contract c
    JOIN
        LB.stage_stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.stage_stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.stage_stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:55:38.359989 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:55:38.676213 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59257-0202-cf6b-0000-0002d446c915
[0m10:55:38.677157 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (02000): SQL compilation error:
Schema 'LB.STAGE_STAGE' does not exist or not authorized.
[0m10:55:38.678053 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:55:38.794549 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:55:38.797932 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c931b30-cccf-4c6a-a70c-bca440cad64a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f8fb010>]}
[0m10:55:38.799122 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model stage_intermediate.int_view_contract ...... [[31mERROR[0m in 0.48s]
[0m10:55:38.799930 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:55:38.802375 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:55:38.802701 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:55:38.803000 [info ] [MainThread]: 
[0m10:55:38.803301 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.62 seconds (3.62s).
[0m10:55:38.803908 [debug] [MainThread]: Command end result
[0m10:55:38.830948 [info ] [MainThread]: 
[0m10:55:38.831295 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:55:38.831483 [info ] [MainThread]: 
[0m10:55:38.831713 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  002003 (02000): SQL compilation error:
  Schema 'LB.STAGE_STAGE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m10:55:38.831887 [info ] [MainThread]: 
[0m10:55:38.832066 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:55:38.834005 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.8553557, "process_user_time": 2.303412, "process_kernel_time": 2.06624, "process_mem_max_rss": "195788800", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:55:38.834450 [debug] [MainThread]: Command `dbt run` failed at 10:55:38.834393 after 4.86 seconds
[0m10:55:38.834751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105286cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160455310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053000d0>]}
[0m10:55:38.834954 [debug] [MainThread]: Flushing usage events
[0m10:56:55.644672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12201ab50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12207ce10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12205acd0>]}


============================== 10:56:55.647355 | 4b08084c-b80f-4f76-b960-7ddfee579ede ==============================
[0m10:56:55.647355 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:56:55.647669 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate', 'send_anonymous_usage_stats': 'True'}
[0m10:56:56.377291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4b08084c-b80f-4f76-b960-7ddfee579ede', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131c78110>]}
[0m10:56:56.398366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4b08084c-b80f-4f76-b960-7ddfee579ede', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120772fd0>]}
[0m10:56:56.399090 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:56:56.419092 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:56:56.477430 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:56:56.477924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4b08084c-b80f-4f76-b960-7ddfee579ede', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12072ec50>]}
[0m10:56:57.168461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4b08084c-b80f-4f76-b960-7ddfee579ede', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132efce10>]}
[0m10:56:57.209818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4b08084c-b80f-4f76-b960-7ddfee579ede', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1366ac310>]}
[0m10:56:57.210071 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:56:57.210229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4b08084c-b80f-4f76-b960-7ddfee579ede', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1364a7290>]}
[0m10:56:57.210857 [info ] [MainThread]: 
[0m10:56:57.211090 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:56:57.211438 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:56:57.216439 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:56:57.216582 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:56:57.216700 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:56:58.037984 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.821 seconds
[0m10:56:58.040849 [debug] [ThreadPool]: On list_LB: Close
[0m10:56:58.271185 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage_intermediate)
[0m10:56:58.279620 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m10:56:58.280023 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m10:56:58.280307 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:56:58.747317 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.467 seconds
[0m10:56:58.750804 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m10:56:58.866865 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage)
[0m10:56:58.871128 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m10:56:58.871657 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m10:56:58.871969 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:56:59.429774 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.558 seconds
[0m10:56:59.432259 [debug] [ThreadPool]: On list_LB_stage: Close
[0m10:56:59.533600 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_stage_dwh_mart)
[0m10:56:59.536031 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m10:56:59.536263 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m10:56:59.536450 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:56:59.872386 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b59258-0202-d459-0000-0002d446e10d
[0m10:56:59.872946 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:56:59.873397 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:56:59.873658 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:56:59.874017 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m10:57:00.147427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4b08084c-b80f-4f76-b960-7ddfee579ede', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121f32790>]}
[0m10:57:00.148114 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:57:00.148405 [info ] [MainThread]: 
[0m10:57:00.150772 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:57:00.151119 [info ] [Thread-1 (]: 1 of 1 START sql view model stage_intermediate.int_view_contract ............... [RUN]
[0m10:57:00.151380 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:57:00.151569 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:57:00.157038 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:57:00.157698 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:57:00.173557 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:57:00.175268 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:57:00.175531 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.stage_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.stage.stg_contract c
    JOIN
        LB.stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:57:00.175725 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:57:00.809041 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.633 seconds
[0m10:57:00.826608 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:57:01.049015 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b08084c-b80f-4f76-b960-7ddfee579ede', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13713df10>]}
[0m10:57:01.050735 [info ] [Thread-1 (]: 1 of 1 OK created sql view model stage_intermediate.int_view_contract .......... [[32mSUCCESS 1[0m in 0.90s]
[0m10:57:01.051716 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:57:01.055936 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:57:01.056616 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:57:01.057170 [info ] [MainThread]: 
[0m10:57:01.057647 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.85 seconds (3.85s).
[0m10:57:01.059258 [debug] [MainThread]: Command end result
[0m10:57:01.096231 [info ] [MainThread]: 
[0m10:57:01.096696 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:57:01.096846 [info ] [MainThread]: 
[0m10:57:01.096999 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:57:01.099122 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.4866624, "process_user_time": 2.882142, "process_kernel_time": 2.027843, "process_mem_max_rss": "195772416", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:57:01.099788 [debug] [MainThread]: Command `dbt run` succeeded at 10:57:01.099736 after 5.49 seconds
[0m10:57:01.100078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c60750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b66cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bc5190>]}
[0m10:57:01.100242 [debug] [MainThread]: Flushing usage events
[0m10:59:12.954902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135019790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135080c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135081290>]}


============================== 10:59:12.957786 | 3d69d92d-1054-4c38-94e5-2efe20dd817d ==============================
[0m10:59:12.957786 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:59:12.958070 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select intermediate', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:59:13.655786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3d69d92d-1054-4c38-94e5-2efe20dd817d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13504c350>]}
[0m10:59:13.675185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3d69d92d-1054-4c38-94e5-2efe20dd817d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134800c10>]}
[0m10:59:13.675700 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:59:13.688247 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:59:13.726796 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:59:13.727100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3d69d92d-1054-4c38-94e5-2efe20dd817d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12542ee50>]}
[0m10:59:14.403044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3d69d92d-1054-4c38-94e5-2efe20dd817d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169539490>]}
[0m10:59:14.444861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3d69d92d-1054-4c38-94e5-2efe20dd817d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1697fb710>]}
[0m10:59:14.445114 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:59:14.445263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d69d92d-1054-4c38-94e5-2efe20dd817d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1693bab10>]}
[0m10:59:14.445870 [info ] [MainThread]: 
[0m10:59:14.446089 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:59:14.446436 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:59:14.451472 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:59:14.451616 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:59:14.451733 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:59:15.016663 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.565 seconds
[0m10:59:15.020013 [debug] [ThreadPool]: On list_LB: Close
[0m10:59:15.143402 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m10:59:15.148470 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m10:59:15.148726 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m10:59:15.148868 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:59:15.495193 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.346 seconds
[0m10:59:15.496572 [debug] [ThreadPool]: On list_LB_stage: Close
[0m10:59:15.596501 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_stage_intermediate)
[0m10:59:15.602063 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m10:59:15.602562 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m10:59:15.602939 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:59:16.077589 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.475 seconds
[0m10:59:16.080345 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m10:59:16.191913 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage_dwh_mart)
[0m10:59:16.196409 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m10:59:16.196968 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m10:59:16.197361 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:59:16.588402 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01b5925b-0202-cf6c-0000-0002d4468aad
[0m10:59:16.588783 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m10:59:16.589054 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m10:59:16.589228 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m10:59:16.589471 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m10:59:16.699278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d69d92d-1054-4c38-94e5-2efe20dd817d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169ab3c50>]}
[0m10:59:16.700413 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:59:16.700947 [info ] [MainThread]: 
[0m10:59:16.707541 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m10:59:16.708303 [info ] [Thread-1 (]: 1 of 1 START sql view model stage_intermediate.int_view_contract ............... [RUN]
[0m10:59:16.708804 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now model.snowflake_airflow_dbt.int_view_contract)
[0m10:59:16.709133 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m10:59:16.720286 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:59:16.721016 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m10:59:16.750844 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m10:59:16.752481 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m10:59:16.752738 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.stage_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.CREATEDAT AS anlagedatum,
        p.PRODUCTNAME AS produkt,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price
    FROM
        LB.stage.stg_contract c
    JOIN
        LB.stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        current_date AS load_date,
        md5(cast(coalesce(cast(anlagedatum as TEXT), '') || '-' || coalesce(cast(produkt as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)
SELECT
    anlagedatum,
    produkt,
    verbrauch,
    umsatz,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date,
    TRUE AS is_current
FROM
    new_data
  );
[0m10:59:16.752931 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:59:17.405199 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.652 seconds
[0m10:59:17.425898 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m10:59:17.537065 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d69d92d-1054-4c38-94e5-2efe20dd817d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1695bc5d0>]}
[0m10:59:17.537604 [info ] [Thread-1 (]: 1 of 1 OK created sql view model stage_intermediate.int_view_contract .......... [[32mSUCCESS 1[0m in 0.83s]
[0m10:59:17.537948 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m10:59:17.540237 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:59:17.540432 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m10:59:17.540608 [info ] [MainThread]: 
[0m10:59:17.540771 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.09 seconds (3.09s).
[0m10:59:17.541265 [debug] [MainThread]: Command end result
[0m10:59:17.560731 [info ] [MainThread]: 
[0m10:59:17.561024 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:59:17.561165 [info ] [MainThread]: 
[0m10:59:17.561322 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:59:17.564157 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.641582, "process_user_time": 2.472691, "process_kernel_time": 2.522507, "process_mem_max_rss": "199557120", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:59:17.564675 [debug] [MainThread]: Command `dbt run` succeeded at 10:59:17.564631 after 4.64 seconds
[0m10:59:17.565332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135064b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1009aecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1698676d0>]}
[0m10:59:17.565535 [debug] [MainThread]: Flushing usage events
[0m10:59:50.451386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d243e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d280fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d281650>]}


============================== 10:59:50.453569 | a3ceaaa1-4b5f-4f3a-931a-b384ce19efa2 ==============================
[0m10:59:50.453569 [info ] [MainThread]: Running with dbt=1.8.0
[0m10:59:50.453835 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select mart', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:59:51.146152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3ceaaa1-4b5f-4f3a-931a-b384ce19efa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a8eae50>]}
[0m10:59:51.166046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a3ceaaa1-4b5f-4f3a-931a-b384ce19efa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138272590>]}
[0m10:59:51.166699 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m10:59:51.180593 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m10:59:51.244235 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:59:51.244437 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:59:51.261142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a3ceaaa1-4b5f-4f3a-931a-b384ce19efa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ac35690>]}
[0m10:59:51.303552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a3ceaaa1-4b5f-4f3a-931a-b384ce19efa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13aad2010>]}
[0m10:59:51.303834 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m10:59:51.303997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3ceaaa1-4b5f-4f3a-931a-b384ce19efa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d2415d0>]}
[0m10:59:51.304660 [info ] [MainThread]: 
[0m10:59:51.304911 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:59:51.305354 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m10:59:51.350640 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m10:59:51.350845 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m10:59:51.350959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:59:51.892016 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.541 seconds
[0m10:59:51.893861 [debug] [ThreadPool]: On list_LB: Close
[0m10:59:51.994014 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now create_LB_stage_dwh_mart)
[0m10:59:51.995115 [debug] [ThreadPool]: Creating schema "database: "LB"
schema: "stage_dwh_mart"
"
[0m10:59:52.002491 [debug] [ThreadPool]: Using snowflake connection "create_LB_stage_dwh_mart"
[0m10:59:52.002965 [debug] [ThreadPool]: On create_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "create_LB_stage_dwh_mart"} */
create schema if not exists LB.stage_dwh_mart
[0m10:59:52.003258 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:59:52.556088 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.553 seconds
[0m10:59:52.557836 [debug] [ThreadPool]: On create_LB_stage_dwh_mart: Close
[0m10:59:52.667973 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_LB_stage_dwh_mart, now list_LB_stage_intermediate)
[0m10:59:52.679451 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m10:59:52.680041 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m10:59:52.680334 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:59:53.056341 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.376 seconds
[0m10:59:53.059570 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m10:59:53.179778 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage)
[0m10:59:53.184700 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m10:59:53.185239 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m10:59:53.185539 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:59:53.569857 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.384 seconds
[0m10:59:53.573417 [debug] [ThreadPool]: On list_LB_stage: Close
[0m10:59:53.680554 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_stage_dwh_mart)
[0m10:59:53.685390 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m10:59:53.685935 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m10:59:53.686238 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:59:54.111584 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.425 seconds
[0m10:59:54.113761 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m10:59:54.263273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3ceaaa1-4b5f-4f3a-931a-b384ce19efa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fb5e510>]}
[0m10:59:54.264176 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:59:54.264577 [info ] [MainThread]: 
[0m10:59:54.266942 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_metrics
[0m10:59:54.267467 [info ] [Thread-1 (]: 1 of 1 START sql table model stage_dwh_mart.fact_metrics ....................... [RUN]
[0m10:59:54.267900 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now model.snowflake_airflow_dbt.fact_metrics)
[0m10:59:54.268160 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_metrics
[0m10:59:54.271989 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_metrics"
[0m10:59:54.272409 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_metrics
[0m10:59:54.284211 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_metrics"
[0m10:59:54.285162 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_metrics"
[0m10:59:54.285377 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_metrics"} */
create or replace transient table LB.stage_dwh_mart.fact_metrics
         as
        (

WITH latest_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        umsatz,
        id,
        effective_date,
        expiry_date,
        is_current
    FROM LB.stage_intermediate.int_view_contract
),

current_data AS (
    SELECT
        ID,
        ANLAGEDATUM,
        PRODUKT,
        VERBRAUCH,
        UMSATZ,
        EFFECTIVE_DATE,
        EXPIRY_DATE,
        IS_CURRENT
    FROM LB.stage_dwh_mart.fact_metrics
    WHERE IS_CURRENT = TRUE
),

expired_data AS (
    SELECT
        c.ID,
        c.ANLAGEDATUM,
        c.PRODUKT,
        c.VERBRAUCH,
        c.UMSATZ,
        c.EFFECTIVE_DATE,
        current_date AS EXPIRY_DATE,
        FALSE AS IS_CURRENT
    FROM current_data c
    JOIN latest_data n
    ON c.ID = n.ID
    WHERE c.VERBRAUCH <> n.VERBRAUCH OR c.UMSATZ <> n.UMSATZ
)

-- Combine latest data and mark existing data as expired
SELECT * FROM latest_data

UNION ALL

SELECT * FROM expired_data
        );
[0m10:59:54.285562 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:59:54.791537 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5925b-0202-d36c-0002-d44600014006
[0m10:59:54.792370 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.STAGE_DWH_MART.FACT_METRICS' does not exist or not authorized.
[0m10:59:54.792949 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: Close
[0m10:59:54.897059 [debug] [Thread-1 (]: Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.STAGE_DWH_MART.FACT_METRICS' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m10:59:54.899758 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3ceaaa1-4b5f-4f3a-931a-b384ce19efa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ab05c50>]}
[0m10:59:54.900643 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model stage_dwh_mart.fact_metrics .............. [[31mERROR[0m in 0.63s]
[0m10:59:54.901400 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_metrics
[0m10:59:54.903497 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:59:54.903860 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_metrics' was properly closed.
[0m10:59:54.904166 [info ] [MainThread]: 
[0m10:59:54.904512 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.60 seconds (3.60s).
[0m10:59:54.905139 [debug] [MainThread]: Command end result
[0m10:59:54.926123 [info ] [MainThread]: 
[0m10:59:54.926468 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:59:54.926605 [info ] [MainThread]: 
[0m10:59:54.926766 [error] [MainThread]:   Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.STAGE_DWH_MART.FACT_METRICS' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m10:59:54.926890 [info ] [MainThread]: 
[0m10:59:54.927046 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m10:59:54.928608 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.505205, "process_user_time": 1.906504, "process_kernel_time": 2.571262, "process_mem_max_rss": "201113600", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:59:54.928901 [debug] [MainThread]: Command `dbt run` failed at 10:59:54.928865 after 4.51 seconds
[0m10:59:54.929149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d281290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102542cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ac93f50>]}
[0m10:59:54.929313 [debug] [MainThread]: Flushing usage events
[0m11:02:21.440572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e242150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e281150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e2817d0>]}


============================== 11:02:21.443028 | b454c23c-db3a-4ea1-8439-96023aa31eb5 ==============================
[0m11:02:21.443028 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:02:21.443286 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select mart', 'send_anonymous_usage_stats': 'True'}
[0m11:02:22.122996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b454c23c-db3a-4ea1-8439-96023aa31eb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e29de90>]}
[0m11:02:22.142315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b454c23c-db3a-4ea1-8439-96023aa31eb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11db00950>]}
[0m11:02:22.142910 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:02:22.157336 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:02:22.219696 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:02:22.219908 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:02:22.236300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b454c23c-db3a-4ea1-8439-96023aa31eb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ebc8b10>]}
[0m11:02:22.281651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b454c23c-db3a-4ea1-8439-96023aa31eb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e958ad0>]}
[0m11:02:22.281912 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m11:02:22.282067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b454c23c-db3a-4ea1-8439-96023aa31eb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ca79e10>]}
[0m11:02:22.282708 [info ] [MainThread]: 
[0m11:02:22.282955 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:02:22.283381 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:02:22.332540 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:02:22.332763 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:02:22.332891 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:02:22.911363 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.578 seconds
[0m11:02:22.912769 [debug] [ThreadPool]: On list_LB: Close
[0m11:02:23.034192 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage_dwh_mart)
[0m11:02:23.038819 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m11:02:23.039043 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m11:02:23.039174 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:02:23.455678 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.416 seconds
[0m11:02:23.458987 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m11:02:23.574558 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now list_LB_stage_intermediate)
[0m11:02:23.579512 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m11:02:23.580001 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m11:02:23.580290 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:02:24.028593 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.448 seconds
[0m11:02:24.031526 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m11:02:24.158385 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage)
[0m11:02:24.161613 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:02:24.161903 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:02:24.162047 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:02:24.496258 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.334 seconds
[0m11:02:24.497628 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:02:24.612767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b454c23c-db3a-4ea1-8439-96023aa31eb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dcf02d0>]}
[0m11:02:24.614412 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:02:24.615066 [info ] [MainThread]: 
[0m11:02:24.619027 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_metrics
[0m11:02:24.619945 [info ] [Thread-1 (]: 1 of 1 START sql table model stage_dwh_mart.fact_metrics ....................... [RUN]
[0m11:02:24.620577 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.fact_metrics)
[0m11:02:24.621076 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_metrics
[0m11:02:24.632312 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_metrics"
[0m11:02:24.633464 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_metrics
[0m11:02:24.663710 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_metrics"
[0m11:02:24.666337 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_metrics"
[0m11:02:24.666876 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_metrics"} */
create or replace transient table LB.stage_dwh_mart.fact_metrics
         as
        (

WITH latest_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        umsatz,
        id,
        effective_date,
        expiry_date,
        is_current
    FROM LB.stage_intermediate.int_view_contract
),

current_data AS (
    SELECT
        ID,
        ANLAGEDATUM,
        PRODUKT,
        VERBRAUCH,
        UMSATZ,
        EFFECTIVE_DATE,
        EXPIRY_DATE,
        IS_CURRENT
    FROM LB.stage_dwh_mart.fact_metrics
    WHERE IS_CURRENT = TRUE
),

expired_data AS (
    SELECT
        c.ID,
        c.ANLAGEDATUM,
        c.PRODUKT,
        c.VERBRAUCH,
        c.UMSATZ,
        c.EFFECTIVE_DATE,
        current_date AS EXPIRY_DATE,
        FALSE AS IS_CURRENT
    FROM current_data c
    JOIN latest_data n
    ON c.ID = n.ID
    WHERE c.VERBRAUCH <> n.VERBRAUCH OR c.UMSATZ <> n.UMSATZ
)

-- Combine latest data and mark existing data as expired
SELECT * FROM latest_data

UNION ALL

SELECT * FROM expired_data
        );
[0m11:02:24.667243 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:02:25.181152 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5925e-0202-d36e-0002-d44600012032
[0m11:02:25.182048 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.STAGE_DWH_MART.FACT_METRICS' does not exist or not authorized.
[0m11:02:25.182707 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: Close
[0m11:02:25.294438 [debug] [Thread-1 (]: Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.STAGE_DWH_MART.FACT_METRICS' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m11:02:25.295733 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b454c23c-db3a-4ea1-8439-96023aa31eb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e9b5cd0>]}
[0m11:02:25.296173 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model stage_dwh_mart.fact_metrics .............. [[31mERROR[0m in 0.67s]
[0m11:02:25.296477 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_metrics
[0m11:02:25.297665 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:02:25.297835 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_metrics' was properly closed.
[0m11:02:25.297985 [info ] [MainThread]: 
[0m11:02:25.298137 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.02 seconds (3.02s).
[0m11:02:25.298471 [debug] [MainThread]: Command end result
[0m11:02:25.323335 [info ] [MainThread]: 
[0m11:02:25.324126 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:02:25.324273 [info ] [MainThread]: 
[0m11:02:25.324446 [error] [MainThread]:   Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.STAGE_DWH_MART.FACT_METRICS' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m11:02:25.324577 [info ] [MainThread]: 
[0m11:02:25.324725 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:02:25.327688 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.91672, "process_user_time": 2.005748, "process_kernel_time": 2.067232, "process_mem_max_rss": "189530112", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:02:25.328160 [debug] [MainThread]: Command `dbt run` failed at 11:02:25.328112 after 3.92 seconds
[0m11:02:25.328456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10054efd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1005c81d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e935790>]}
[0m11:02:25.328623 [debug] [MainThread]: Flushing usage events
[0m11:03:05.241689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142c595d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142c79090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142c796d0>]}


============================== 11:03:05.244653 | 8ea808e6-0c49-4003-9f19-38966a50e62a ==============================
[0m11:03:05.244653 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:03:05.245025 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:03:06.368687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8ea808e6-0c49-4003-9f19-38966a50e62a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14763cad0>]}
[0m11:03:06.391587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8ea808e6-0c49-4003-9f19-38966a50e62a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1693ea590>]}
[0m11:03:06.392278 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:03:06.410898 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:03:06.578182 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:03:06.578573 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:03:06.598402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8ea808e6-0c49-4003-9f19-38966a50e62a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169690050>]}
[0m11:03:06.657554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8ea808e6-0c49-4003-9f19-38966a50e62a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169663b10>]}
[0m11:03:06.657987 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m11:03:06.658219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ea808e6-0c49-4003-9f19-38966a50e62a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16954ead0>]}
[0m11:03:06.659647 [info ] [MainThread]: 
[0m11:03:06.660017 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:03:06.660606 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:03:06.779284 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:03:06.780549 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:03:06.781098 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:03:07.470120 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.688 seconds
[0m11:03:07.477674 [debug] [ThreadPool]: On list_LB: Close
[0m11:03:07.593990 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage_intermediate)
[0m11:03:07.612690 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m11:03:07.613263 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m11:03:07.613843 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:03:08.060503 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.446 seconds
[0m11:03:08.066805 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m11:03:08.206418 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage)
[0m11:03:08.218106 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:03:08.218444 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:03:08.219182 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:03:08.712912 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.494 seconds
[0m11:03:08.715892 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:03:08.838324 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_stage_dwh_mart)
[0m11:03:08.842972 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m11:03:08.843469 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m11:03:08.843809 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:03:09.256595 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.413 seconds
[0m11:03:09.260315 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m11:03:09.369098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ea808e6-0c49-4003-9f19-38966a50e62a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1682ac290>]}
[0m11:03:09.369786 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:03:09.370073 [info ] [MainThread]: 
[0m11:03:09.372474 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_metrics
[0m11:03:09.372933 [info ] [Thread-1 (]: 1 of 1 START sql table model stage_dwh_mart.fact_metrics ....................... [RUN]
[0m11:03:09.373225 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now model.snowflake_airflow_dbt.fact_metrics)
[0m11:03:09.373431 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_metrics
[0m11:03:09.380058 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_metrics"
[0m11:03:09.380758 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_metrics
[0m11:03:09.395127 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_metrics"
[0m11:03:09.396383 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_metrics"
[0m11:03:09.396585 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_metrics"} */
create or replace transient table LB.stage_dwh_mart.fact_metrics
         as
        (

WITH latest_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        umsatz,
        id,
        effective_date,
        expiry_date,
        is_current
    FROM LB.stage_intermediate.int_view_contract
),

current_data AS (
    SELECT
        ID,
        ANLAGEDATUM,
        PRODUKT,
        VERBRAUCH,
        UMSATZ,
        EFFECTIVE_DATE,
        EXPIRY_DATE,
        IS_CURRENT
    FROM LB.stage_dwh_mart.fact_metrics
    WHERE IS_CURRENT = TRUE
),

expired_data AS (
    SELECT
        c.ID,
        c.ANLAGEDATUM,
        c.PRODUKT,
        c.VERBRAUCH,
        c.UMSATZ,
        c.EFFECTIVE_DATE,
        current_date AS EXPIRY_DATE,
        FALSE AS IS_CURRENT
    FROM current_data c
    JOIN latest_data n
    ON c.ID = n.ID
    WHERE c.VERBRAUCH <> n.VERBRAUCH OR c.UMSATZ <> n.UMSATZ
)

-- Combine latest data and mark existing data as expired
SELECT * FROM latest_data

UNION ALL

SELECT * FROM expired_data
        );
[0m11:03:09.396765 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:03:09.963895 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5925f-0202-d36d-0002-d4460001104e
[0m11:03:09.964146 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 20 at position 8
invalid identifier 'ID'
[0m11:03:09.964361 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: Close
[0m11:03:10.062642 [debug] [Thread-1 (]: Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  000904 (42000): SQL compilation error: error line 20 at position 8
  invalid identifier 'ID'
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m11:03:10.064143 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ea808e6-0c49-4003-9f19-38966a50e62a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169b9bed0>]}
[0m11:03:10.064533 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model stage_dwh_mart.fact_metrics .............. [[31mERROR[0m in 0.69s]
[0m11:03:10.064814 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_metrics
[0m11:03:10.066403 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:03:10.066583 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_metrics' was properly closed.
[0m11:03:10.066731 [info ] [MainThread]: 
[0m11:03:10.066913 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.41 seconds (3.41s).
[0m11:03:10.067328 [debug] [MainThread]: Command end result
[0m11:03:10.090701 [info ] [MainThread]: 
[0m11:03:10.090961 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:03:10.091086 [info ] [MainThread]: 
[0m11:03:10.091252 [error] [MainThread]:   Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  000904 (42000): SQL compilation error: error line 20 at position 8
  invalid identifier 'ID'
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m11:03:10.091372 [info ] [MainThread]: 
[0m11:03:10.091532 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:03:10.093134 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.884326, "process_user_time": 2.808437, "process_kernel_time": 1.837219, "process_mem_max_rss": "180682752", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:03:10.093475 [debug] [MainThread]: Command `dbt run` failed at 11:03:10.093434 after 4.88 seconds
[0m11:03:10.093735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137ce39d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100faacd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137244310>]}
[0m11:03:10.093900 [debug] [MainThread]: Flushing usage events
[0m11:06:21.352932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168457450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1681f4110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1684bde50>]}


============================== 11:06:21.356683 | 4eabef89-dd03-413c-acd8-06412ba227d6 ==============================
[0m11:06:21.356683 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:06:21.357132 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select intermediate', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:06:22.067479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4eabef89-dd03-413c-acd8-06412ba227d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16845fad0>]}
[0m11:06:22.086671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4eabef89-dd03-413c-acd8-06412ba227d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147dfca50>]}
[0m11:06:22.087264 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:06:22.100377 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:06:22.168062 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:06:22.168427 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m11:06:22.285831 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.int_view_contract' (models/intermediate/int_view_contract.sql) depends on a node named 'stg_contracts' which was not found
[0m11:06:22.288078 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.9648647, "process_user_time": 1.749516, "process_kernel_time": 2.226642, "process_mem_max_rss": "188678144", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:06:22.288434 [debug] [MainThread]: Command `dbt run` failed at 11:06:22.288356 after 0.97 seconds
[0m11:06:22.288646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168488110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105266cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1680f0250>]}
[0m11:06:22.288837 [debug] [MainThread]: Flushing usage events
[0m11:06:40.773396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c01f3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c080f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c05b290>]}


============================== 11:06:40.776177 | 8023723d-84bb-4d8e-97b6-ac31dee35b51 ==============================
[0m11:06:40.776177 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:06:40.776453 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select intermediate', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:06:41.362141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8023723d-84bb-4d8e-97b6-ac31dee35b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c01ddd0>]}
[0m11:06:41.381078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8023723d-84bb-4d8e-97b6-ac31dee35b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168dea410>]}
[0m11:06:41.381671 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:06:41.407767 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:06:41.465953 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:06:41.466314 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m11:06:41.591960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8023723d-84bb-4d8e-97b6-ac31dee35b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168ebc510>]}
[0m11:06:41.633436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8023723d-84bb-4d8e-97b6-ac31dee35b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1690e87d0>]}
[0m11:06:41.633685 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m11:06:41.633833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8023723d-84bb-4d8e-97b6-ac31dee35b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168e6a550>]}
[0m11:06:41.634425 [info ] [MainThread]: 
[0m11:06:41.634641 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:06:41.634994 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:06:41.640283 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:06:41.640459 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:06:41.640576 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:06:42.169034 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.528 seconds
[0m11:06:42.171956 [debug] [ThreadPool]: On list_LB: Close
[0m11:06:42.290523 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage_dwh_mart)
[0m11:06:42.301562 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m11:06:42.302006 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m11:06:42.302281 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:06:42.720384 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.418 seconds
[0m11:06:42.722906 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m11:06:42.828996 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now list_LB_stage)
[0m11:06:42.833317 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:06:42.833882 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:06:42.834390 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:06:43.275946 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.442 seconds
[0m11:06:43.277285 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:06:43.437577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8023723d-84bb-4d8e-97b6-ac31dee35b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168e9e4d0>]}
[0m11:06:43.439160 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:06:43.439810 [info ] [MainThread]: 
[0m11:06:43.444205 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m11:06:43.444867 [info ] [Thread-1 (]: 1 of 1 START sql table model stage_dwh_mart.int_view_contract .................. [RUN]
[0m11:06:43.445384 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.int_view_contract)
[0m11:06:43.445766 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m11:06:43.455777 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m11:06:43.456561 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m11:06:43.475589 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m11:06:43.477273 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m11:06:43.477593 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace transient table LB.stage_dwh_mart.int_view_contract
         as
        (

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.PRODUCTID AS product_id,
        c.CREATEDAT AS anlagedatum,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price,
        c.MODIFICATIONDATE AS contract_modificationdate,
        p.PRODUCTCODE,
        p.PRODUCTNAME,
        p_base.VALID_FROM,
        p_base.VALID_UNTIL
    FROM
        LB.stage.stg_contract c
    JOIN
        LB.stage.stg_products p
        ON c.PRODUCTID = p.ID
    JOIN
        LB.stage.stg_prices p_base
        ON c.PRODUCTID = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.stage.stg_prices p_working
        ON c.PRODUCTID = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        contract_id,
        product_id,
        anlagedatum,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        PRODUCTCODE,
        PRODUCTNAME,
        contract_modificationdate,
        VALID_FROM,
        VALID_UNTIL,
        TRUE AS is_current,
        current_date AS load_date,
        md5(cast(coalesce(cast(contract_id as TEXT), '') || '-' || coalesce(cast(product_id as TEXT), '') || '-' || coalesce(cast(anlagedatum as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)

SELECT
    contract_id,
    product_id,
    anlagedatum,
    verbrauch,
    umsatz,
    PRODUCTCODE,
    PRODUCTNAME,
    contract_modificationdate,
    VALID_FROM,
    VALID_UNTIL,
    is_current,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date
FROM
    new_data
        );
[0m11:06:43.477875 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:06:45.517200 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.038 seconds
[0m11:06:45.539796 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m11:06:45.654429 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8023723d-84bb-4d8e-97b6-ac31dee35b51', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169151390>]}
[0m11:06:45.657826 [info ] [Thread-1 (]: 1 of 1 OK created sql table model stage_dwh_mart.int_view_contract ............. [[32mSUCCESS 1[0m in 2.21s]
[0m11:06:45.658688 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m11:06:45.661073 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:06:45.661488 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m11:06:45.661899 [info ] [MainThread]: 
[0m11:06:45.662297 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.03 seconds (4.03s).
[0m11:06:45.663161 [debug] [MainThread]: Command end result
[0m11:06:45.707762 [info ] [MainThread]: 
[0m11:06:45.709003 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:06:45.709278 [info ] [MainThread]: 
[0m11:06:45.709723 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:06:45.713874 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.970447, "process_user_time": 1.908427, "process_kernel_time": 2.320101, "process_mem_max_rss": "201588736", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:06:45.714718 [debug] [MainThread]: Command `dbt run` succeeded at 11:06:45.714650 after 4.97 seconds
[0m11:06:45.715555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c0818d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1008cc7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1007d2e50>]}
[0m11:06:45.715820 [debug] [MainThread]: Flushing usage events
[0m11:08:27.044176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140957b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1409b9250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1409b98d0>]}


============================== 11:08:27.048610 | a297c0aa-933b-4857-a785-3574554a1327 ==============================
[0m11:08:27.048610 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:08:27.048965 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select mart', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:08:28.003947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a297c0aa-933b-4857-a785-3574554a1327', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14086ded0>]}
[0m11:08:28.026210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a297c0aa-933b-4857-a785-3574554a1327', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140400d10>]}
[0m11:08:28.026932 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:08:28.051834 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:08:28.146368 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:08:28.146709 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:08:28.167085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a297c0aa-933b-4857-a785-3574554a1327', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151d0fd90>]}
[0m11:08:28.220725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a297c0aa-933b-4857-a785-3574554a1327', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151be05d0>]}
[0m11:08:28.221020 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m11:08:28.221187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a297c0aa-933b-4857-a785-3574554a1327', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1513a6490>]}
[0m11:08:28.221979 [info ] [MainThread]: 
[0m11:08:28.222279 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:08:28.222783 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:08:28.290883 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:08:28.291167 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:08:28.291306 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:08:28.819666 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.528 seconds
[0m11:08:28.822590 [debug] [ThreadPool]: On list_LB: Close
[0m11:08:28.940020 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m11:08:28.949485 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:08:28.949738 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:08:28.949857 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:08:29.352968 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.403 seconds
[0m11:08:29.356686 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:08:29.461131 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_stage_dwh_mart)
[0m11:08:29.467013 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m11:08:29.467539 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m11:08:29.467857 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:08:29.872501 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.404 seconds
[0m11:08:29.875772 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m11:08:29.986307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a297c0aa-933b-4857-a785-3574554a1327', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15096a010>]}
[0m11:08:29.987068 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:08:29.987287 [info ] [MainThread]: 
[0m11:08:29.989640 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_metrics
[0m11:08:29.990042 [info ] [Thread-1 (]: 1 of 1 START sql table model stage_dwh_mart.fact_metrics ....................... [RUN]
[0m11:08:29.990295 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now model.snowflake_airflow_dbt.fact_metrics)
[0m11:08:29.990451 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_metrics
[0m11:08:29.995687 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_metrics"
[0m11:08:30.003713 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_metrics
[0m11:08:30.029528 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_metrics"
[0m11:08:30.030865 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_metrics"
[0m11:08:30.031239 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_metrics"} */
create or replace transient table LB.stage_dwh_mart.fact_metrics
         as
        (

WITH latest_data AS (
    SELECT
        anlagedatum,
        produkt,
        verbrauch,
        umsatz,
        id,
        effective_date,
        expiry_date,
        is_current
    FROM LB.stage_dwh_mart.int_view_contract
),

current_data AS (
    SELECT
        ID,
        ANLAGEDATUM,
        PRODUKT,
        VERBRAUCH,
        UMSATZ,
        EFFECTIVE_DATE,
        EXPIRY_DATE,
        IS_CURRENT
    FROM LB.stage_dwh_mart.fact_metrics
    WHERE IS_CURRENT = TRUE
),

expired_data AS (
    SELECT
        c.ID,
        c.ANLAGEDATUM,
        c.PRODUKT,
        c.VERBRAUCH,
        c.UMSATZ,
        c.EFFECTIVE_DATE,
        current_date AS EXPIRY_DATE,
        FALSE AS IS_CURRENT
    FROM current_data c
    JOIN latest_data n
    ON c.ID = n.ID
    WHERE c.VERBRAUCH <> n.VERBRAUCH OR c.UMSATZ <> n.UMSATZ
)

-- Combine latest data and mark existing data as expired
SELECT * FROM latest_data

UNION ALL

SELECT * FROM expired_data
        );
[0m11:08:30.031454 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:08:30.486935 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59264-0202-d35b-0002-d4460001005e
[0m11:08:30.487658 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 8 at position 8
invalid identifier 'PRODUKT'
[0m11:08:30.488214 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: Close
[0m11:08:30.605310 [debug] [Thread-1 (]: Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  000904 (42000): SQL compilation error: error line 8 at position 8
  invalid identifier 'PRODUKT'
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m11:08:30.608356 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a297c0aa-933b-4857-a785-3574554a1327', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152df10d0>]}
[0m11:08:30.609962 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model stage_dwh_mart.fact_metrics .............. [[31mERROR[0m in 0.62s]
[0m11:08:30.610901 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_metrics
[0m11:08:30.620863 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:08:30.621376 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_metrics' was properly closed.
[0m11:08:30.621832 [info ] [MainThread]: 
[0m11:08:30.622326 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.40 seconds (2.40s).
[0m11:08:30.623348 [debug] [MainThread]: Command end result
[0m11:08:30.661821 [info ] [MainThread]: 
[0m11:08:30.663064 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:08:30.663270 [info ] [MainThread]: 
[0m11:08:30.663466 [error] [MainThread]:   Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  000904 (42000): SQL compilation error: error line 8 at position 8
  invalid identifier 'PRODUKT'
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m11:08:30.663598 [info ] [MainThread]: 
[0m11:08:30.663848 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:08:30.666876 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.6568704, "process_user_time": 2.546727, "process_kernel_time": 1.345834, "process_mem_max_rss": "190889984", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:08:30.667803 [debug] [MainThread]: Command `dbt run` failed at 11:08:30.667741 after 3.66 seconds
[0m11:08:30.668495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c2ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1409bb6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140943d10>]}
[0m11:08:30.668678 [debug] [MainThread]: Flushing usage events
[0m11:08:59.780579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143d57750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143af4110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143d56f10>]}


============================== 11:08:59.782957 | 16c8d1df-46c1-4e31-96d9-81ac377cb9ae ==============================
[0m11:08:59.782957 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:08:59.783221 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:09:00.361778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '16c8d1df-46c1-4e31-96d9-81ac377cb9ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143dda690>]}
[0m11:09:00.384097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '16c8d1df-46c1-4e31-96d9-81ac377cb9ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1436fca90>]}
[0m11:09:00.384814 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:09:00.399831 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:09:00.457008 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:09:00.457328 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_metrics.sql
[0m11:09:00.522401 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_metrics' (models/mart/fact_metrics.sql) depends on a node named 'stg_contracts' which was not found
[0m11:09:00.524050 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.7708438, "process_user_time": 1.490717, "process_kernel_time": 2.416394, "process_mem_max_rss": "195674112", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:09:00.524336 [debug] [MainThread]: Command `dbt run` failed at 11:09:00.524295 after 0.77 seconds
[0m11:09:00.524533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13707a790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10115ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169dcfd50>]}
[0m11:09:00.524709 [debug] [MainThread]: Flushing usage events
[0m11:21:24.471122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c11b790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c181750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c181dd0>]}


============================== 11:21:24.474003 | f091c6d0-15c6-40c5-9960-d39887e0f2f7 ==============================
[0m11:21:24.474003 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:21:24.474303 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:21:25.134470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f091c6d0-15c6-40c5-9960-d39887e0f2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c19ec50>]}
[0m11:21:25.153580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f091c6d0-15c6-40c5-9960-d39887e0f2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168dea590>]}
[0m11:21:25.154157 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:21:25.167867 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:21:25.246261 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m11:21:25.246670 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_metrics.sql
[0m11:21:25.246860 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m11:21:25.422384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f091c6d0-15c6-40c5-9960-d39887e0f2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169086150>]}
[0m11:21:25.478380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f091c6d0-15c6-40c5-9960-d39887e0f2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168f0a390>]}
[0m11:21:25.478707 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m11:21:25.478872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f091c6d0-15c6-40c5-9960-d39887e0f2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15bce0390>]}
[0m11:21:25.479591 [info ] [MainThread]: 
[0m11:21:25.479860 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:21:25.480292 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:21:25.486462 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:21:25.486768 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:21:25.486913 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:21:25.983457 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.496 seconds
[0m11:21:25.985309 [debug] [ThreadPool]: On list_LB: Close
[0m11:21:26.094181 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m11:21:26.102297 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:21:26.102519 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:21:26.102637 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:21:26.518489 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.416 seconds
[0m11:21:26.521504 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:21:26.625941 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_stage_intermediate)
[0m11:21:26.631418 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m11:21:26.632082 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m11:21:26.632548 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:21:27.070483 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.438 seconds
[0m11:21:27.073326 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m11:21:27.193078 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage_dwh_mart)
[0m11:21:27.201207 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m11:21:27.201457 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m11:21:27.201588 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:21:27.605171 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.403 seconds
[0m11:21:27.607394 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m11:21:27.721057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f091c6d0-15c6-40c5-9960-d39887e0f2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168dc0610>]}
[0m11:21:27.722334 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:21:27.722626 [info ] [MainThread]: 
[0m11:21:27.725399 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_metrics
[0m11:21:27.726104 [info ] [Thread-1 (]: 1 of 1 START sql table model stage_dwh_mart.fact_metrics ....................... [RUN]
[0m11:21:27.726451 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now model.snowflake_airflow_dbt.fact_metrics)
[0m11:21:27.726630 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_metrics
[0m11:21:27.743133 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_metrics"
[0m11:21:27.744241 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_metrics
[0m11:21:27.771358 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_metrics"
[0m11:21:27.773125 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_metrics"
[0m11:21:27.773452 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_metrics"} */
create or replace transient table LB.stage_dwh_mart.fact_metrics
         as
        (

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.PRODUCTID AS product_id,
        c.CREATEDAT AS anlagedatum,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price,
        c.MODIFICATIONDATE AS contract_modificationdate,
        p.PRODUCTCODE,
        p.PRODUCTNAME,
        p_base.VALID_FROM AS base_valid_from,
        p_base.VALID_UNTIL AS base_valid_until,
        c.STARTDATE AS startdate,
        c.ENDDATE AS enddate
    FROM
        LB.stage_intermediate.int_view_contract c
    JOIN
        LB.stage.stg_products p
        ON c.product_id = p.ID
    JOIN
        LB.stage.stg_prices p_base
        ON c.product_id = p_base.PRODUCTID
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.startdate
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.startdate)
    JOIN
        LB.stage.stg_prices p_working
        ON c.product_id = p_working.PRODUCTID
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.startdate
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.startdate)
),

new_data AS (
    SELECT
        contract_id,
        product_id,
        anlagedatum,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        PRODUCTCODE,
        PRODUCTNAME,
        contract_modificationdate,
        base_valid_from AS valid_from,
        base_valid_until AS valid_to,
        TRUE AS is_current,
        current_date AS load_date,
        md5(cast(coalesce(cast(contract_id as TEXT), '') || '-' || coalesce(cast(product_id as TEXT), '') || '-' || coalesce(cast(anlagedatum as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)

SELECT
    contract_id AS CONTRACT_ID,
    product_id AS PRODUCT_ID,
    anlagedatum AS ANLAGEDATUM,
    verbrauch AS VERBRAUCH,
    umsatz AS UMSATZ,
    PRODUCTCODE AS PRODUCTCODE,
    PRODUCTNAME AS PRODUCTNAME,
    contract_modificationdate AS CONTRACT_MODIFICATIONDATE,
    valid_from AS VALID_FROM,
    valid_to AS VALID_TO,
    is_current AS IS_CURRENT,
    load_date AS LOAD_DATE,
    id AS ID,
    current_date AS EFFECTIVE_DATE,
    NULL AS EXPIRY_DATE
FROM
    new_data
        );
[0m11:21:27.773692 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:21:28.340217 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59271-0202-d370-0002-d44600015066
[0m11:21:28.340552 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 8 at position 8
invalid identifier 'C.PRODUCTID'
[0m11:21:28.340842 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: Close
[0m11:21:28.447752 [debug] [Thread-1 (]: Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  000904 (42000): SQL compilation error: error line 8 at position 8
  invalid identifier 'C.PRODUCTID'
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m11:21:28.449678 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f091c6d0-15c6-40c5-9960-d39887e0f2f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168da9350>]}
[0m11:21:28.450446 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model stage_dwh_mart.fact_metrics .............. [[31mERROR[0m in 0.72s]
[0m11:21:28.451660 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_metrics
[0m11:21:28.454271 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:21:28.454506 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_metrics' was properly closed.
[0m11:21:28.454675 [info ] [MainThread]: 
[0m11:21:28.454847 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.97 seconds (2.97s).
[0m11:21:28.455160 [debug] [MainThread]: Command end result
[0m11:21:28.496046 [info ] [MainThread]: 
[0m11:21:28.496368 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:21:28.496508 [info ] [MainThread]: 
[0m11:21:28.496666 [error] [MainThread]:   Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  000904 (42000): SQL compilation error: error line 8 at position 8
  invalid identifier 'C.PRODUCTID'
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m11:21:28.496788 [info ] [MainThread]: 
[0m11:21:28.496925 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:21:28.499972 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.0621905, "process_user_time": 2.072698, "process_kernel_time": 2.276915, "process_mem_max_rss": "192708608", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:21:28.500849 [debug] [MainThread]: Command `dbt run` failed at 11:21:28.500602 after 4.06 seconds
[0m11:21:28.501219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c181590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1008b2fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c15a3d0>]}
[0m11:21:28.501414 [debug] [MainThread]: Flushing usage events
[0m11:22:43.404706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db57a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dbb98d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dbb9f50>]}


============================== 11:22:43.407723 | 8379e0b8-349e-49b2-b79e-8c88eea76b61 ==============================
[0m11:22:43.407723 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:22:43.408013 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select mart', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:22:44.112395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8379e0b8-349e-49b2-b79e-8c88eea76b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa577d0>]}
[0m11:22:44.132657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8379e0b8-349e-49b2-b79e-8c88eea76b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d500c10>]}
[0m11:22:44.133284 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:22:44.146221 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:22:44.213617 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:22:44.213967 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/mart/fact_metrics.sql
[0m11:22:44.350676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8379e0b8-349e-49b2-b79e-8c88eea76b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abbcb90>]}
[0m11:22:44.420049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8379e0b8-349e-49b2-b79e-8c88eea76b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ac20a10>]}
[0m11:22:44.420374 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m11:22:44.420541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8379e0b8-349e-49b2-b79e-8c88eea76b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa7f850>]}
[0m11:22:44.421229 [info ] [MainThread]: 
[0m11:22:44.421472 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:22:44.421853 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:22:44.427631 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:22:44.427905 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:22:44.428044 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:22:44.922664 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.494 seconds
[0m11:22:44.926333 [debug] [ThreadPool]: On list_LB: Close
[0m11:22:45.046336 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage_dwh_mart)
[0m11:22:45.055541 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m11:22:45.055922 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m11:22:45.056201 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:22:45.475132 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.419 seconds
[0m11:22:45.477267 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m11:22:45.606267 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now list_LB_stage)
[0m11:22:45.611463 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:22:45.611972 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:22:45.612299 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:22:45.996484 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.384 seconds
[0m11:22:46.000161 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:22:46.116846 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage, now list_LB_stage_intermediate)
[0m11:22:46.122759 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m11:22:46.123300 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m11:22:46.123629 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:22:46.586659 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.463 seconds
[0m11:22:46.590028 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m11:22:46.724846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8379e0b8-349e-49b2-b79e-8c88eea76b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d6f0a10>]}
[0m11:22:46.725910 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:22:46.726484 [info ] [MainThread]: 
[0m11:22:46.729977 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_metrics
[0m11:22:46.730880 [info ] [Thread-1 (]: 1 of 1 START sql table model stage_dwh_mart.fact_metrics ....................... [RUN]
[0m11:22:46.731418 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now model.snowflake_airflow_dbt.fact_metrics)
[0m11:22:46.731852 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_metrics
[0m11:22:46.742277 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_metrics"
[0m11:22:46.743243 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_metrics
[0m11:22:46.760569 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_metrics"
[0m11:22:46.762578 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_metrics"
[0m11:22:46.763144 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_metrics"} */
create or replace transient table LB.stage_dwh_mart.fact_metrics
         as
        (

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.PRODUCT_ID AS product_id,  -- Fixed column name to match source data
        c.CREATEDAT AS anlagedatum,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price,
        c.MODIFICATIONDATE AS contract_modificationdate,
        p.PRODUCTCODE,
        p.PRODUCTNAME,
        p_base.VALID_FROM AS base_valid_from,
        p_base.VALID_UNTIL AS base_valid_until,
        c.STARTDATE AS startdate,
        c.ENDDATE AS enddate
    FROM
        LB.stage_intermediate.int_view_contract c
    JOIN
        LB.stage.stg_products p
        ON c.product_id = p.ID  -- Fixed column name to match source data
    JOIN
        LB.stage.stg_prices p_base
        ON c.product_id = p_base.PRODUCTID  -- Fixed column name to match source data
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.startdate
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.startdate)
    JOIN
        LB.stage.stg_prices p_working
        ON c.product_id = p_working.PRODUCTID  -- Fixed column name to match source data
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.startdate
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.startdate)
),

new_data AS (
    SELECT
        contract_id,
        product_id,
        anlagedatum,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        PRODUCTCODE,
        PRODUCTNAME,
        contract_modificationdate,
        base_valid_from AS valid_from,
        base_valid_until AS valid_to,
        TRUE AS is_current,
        current_date AS load_date,
        md5(cast(coalesce(cast(contract_id as TEXT), '') || '-' || coalesce(cast(product_id as TEXT), '') || '-' || coalesce(cast(anlagedatum as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)

SELECT
    contract_id AS CONTRACT_ID,
    product_id AS PRODUCT_ID,
    anlagedatum AS ANLAGEDATUM,
    verbrauch AS VERBRAUCH,
    umsatz AS UMSATZ,
    PRODUCTCODE AS PRODUCTCODE,
    PRODUCTNAME AS PRODUCTNAME,
    contract_modificationdate AS CONTRACT_MODIFICATIONDATE,
    valid_from AS VALID_FROM,
    valid_to AS VALID_TO,
    is_current AS IS_CURRENT,
    load_date AS LOAD_DATE,
    id AS ID,
    current_date AS EFFECTIVE_DATE,
    NULL AS EXPIRY_DATE
FROM
    new_data
        );
[0m11:22:46.763390 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:22:47.249456 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59272-0202-d35b-0002-d44600010086
[0m11:22:47.249721 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 8 at position 8
invalid identifier 'C.PRODUCT_ID'
[0m11:22:47.249925 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_metrics: Close
[0m11:22:47.395952 [debug] [Thread-1 (]: Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  000904 (42000): SQL compilation error: error line 8 at position 8
  invalid identifier 'C.PRODUCT_ID'
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m11:22:47.397728 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8379e0b8-349e-49b2-b79e-8c88eea76b61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14da1ced0>]}
[0m11:22:47.398388 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model stage_dwh_mart.fact_metrics .............. [[31mERROR[0m in 0.67s]
[0m11:22:47.398942 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_metrics
[0m11:22:47.401226 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:22:47.401554 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_metrics' was properly closed.
[0m11:22:47.401829 [info ] [MainThread]: 
[0m11:22:47.402089 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.98 seconds (2.98s).
[0m11:22:47.402596 [debug] [MainThread]: Command end result
[0m11:22:47.426749 [info ] [MainThread]: 
[0m11:22:47.427118 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:22:47.427285 [info ] [MainThread]: 
[0m11:22:47.427488 [error] [MainThread]:   Database Error in model fact_metrics (models/mart/fact_metrics.sql)
  000904 (42000): SQL compilation error: error line 8 at position 8
  invalid identifier 'C.PRODUCT_ID'
  compiled Code at target/run/snowflake_airflow_dbt/models/mart/fact_metrics.sql
[0m11:22:47.427649 [info ] [MainThread]: 
[0m11:22:47.427815 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:22:47.429687 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.0562506, "process_user_time": 2.419045, "process_kernel_time": 2.164189, "process_mem_max_rss": "195903488", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:22:47.430084 [debug] [MainThread]: Command `dbt run` failed at 11:22:47.430037 after 4.06 seconds
[0m11:22:47.430350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cde32d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10251ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db969d0>]}
[0m11:22:47.430533 [debug] [MainThread]: Flushing usage events
[0m11:23:35.527304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c7ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120cbd390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120cbda10>]}


============================== 11:23:35.530534 | 7f6e00de-f2a0-436b-a30c-2294a92730c9 ==============================
[0m11:23:35.530534 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:23:35.530868 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select intermediate', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:23:36.386464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f6e00de-f2a0-436b-a30c-2294a92730c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c97d10>]}
[0m11:23:36.406840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f6e00de-f2a0-436b-a30c-2294a92730c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1259455d0>]}
[0m11:23:36.407440 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:23:36.420586 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:23:36.483964 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:23:36.484288 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m11:23:36.559921 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.int_view_contract' (models/intermediate/int_view_contract.sql) depends on a node named 'stg_contracts' which was not found
[0m11:23:36.562511 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0675418, "process_user_time": 1.803608, "process_kernel_time": 2.023549, "process_mem_max_rss": "189661184", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:23:36.562955 [debug] [MainThread]: Command `dbt run` failed at 11:23:36.562900 after 1.07 seconds
[0m11:23:36.563192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120cbd650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102872cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c88050>]}
[0m11:23:36.563395 [debug] [MainThread]: Flushing usage events
[0m11:23:50.548003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126796850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1267bcbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1267bd250>]}


============================== 11:23:50.550225 | 31f56fa0-d60e-4455-a68f-b9f4313db7ff ==============================
[0m11:23:50.550225 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:23:50.550490 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select intermediate', 'send_anonymous_usage_stats': 'True'}
[0m11:23:51.173753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '31f56fa0-d60e-4455-a68f-b9f4313db7ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133e08710>]}
[0m11:23:51.193468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '31f56fa0-d60e-4455-a68f-b9f4313db7ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125073090>]}
[0m11:23:51.194047 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:23:51.206312 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:23:51.269934 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:23:51.270300 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m11:23:51.413773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31f56fa0-d60e-4455-a68f-b9f4313db7ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134008890>]}
[0m11:23:51.462431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31f56fa0-d60e-4455-a68f-b9f4313db7ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1342bcd50>]}
[0m11:23:51.462718 [info ] [MainThread]: Found 5 models, 3 seeds, 3 sources, 563 macros
[0m11:23:51.462879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '31f56fa0-d60e-4455-a68f-b9f4313db7ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134310bd0>]}
[0m11:23:51.463528 [info ] [MainThread]: 
[0m11:23:51.463789 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:23:51.464166 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:23:51.469901 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:23:51.470118 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:23:51.470247 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:23:51.913449 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.443 seconds
[0m11:23:51.915269 [debug] [ThreadPool]: On list_LB: Close
[0m11:23:52.024470 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage_intermediate)
[0m11:23:52.028912 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_intermediate"
[0m11:23:52.029139 [debug] [ThreadPool]: On list_LB_stage_intermediate: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_intermediate"} */
show objects in LB.stage_intermediate limit 10000
[0m11:23:52.029268 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:23:52.457089 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.428 seconds
[0m11:23:52.459456 [debug] [ThreadPool]: On list_LB_stage_intermediate: Close
[0m11:23:52.573610 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_intermediate, now list_LB_stage_dwh_mart)
[0m11:23:52.578341 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage_dwh_mart"
[0m11:23:52.578841 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage_dwh_mart"} */
show objects in LB.stage_dwh_mart limit 10000
[0m11:23:52.579161 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:23:52.985047 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.406 seconds
[0m11:23:52.987678 [debug] [ThreadPool]: On list_LB_stage_dwh_mart: Close
[0m11:23:53.165413 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB_stage_dwh_mart, now list_LB_stage)
[0m11:23:53.168788 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:23:53.169156 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:23:53.169398 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:23:53.545518 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.376 seconds
[0m11:23:53.548875 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:23:53.734775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '31f56fa0-d60e-4455-a68f-b9f4313db7ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134302a50>]}
[0m11:23:53.736227 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:23:53.736842 [info ] [MainThread]: 
[0m11:23:53.740685 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.int_view_contract
[0m11:23:53.741351 [info ] [Thread-1 (]: 1 of 1 START sql view model stage_intermediate.int_view_contract ............... [RUN]
[0m11:23:53.741839 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.int_view_contract)
[0m11:23:53.742172 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.int_view_contract
[0m11:23:53.751384 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.int_view_contract"
[0m11:23:53.752327 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.int_view_contract
[0m11:23:53.778567 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.int_view_contract"
[0m11:23:53.780347 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.int_view_contract"
[0m11:23:53.780673 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.int_view_contract"} */
create or replace   view LB.stage_intermediate.int_view_contract
  
   as (
    

WITH contract_prices AS (
    SELECT
        c.ID AS contract_id,
        c.PRODUCT_ID AS product_id,  -- Fixed column name to match source data
        c.CREATEDAT AS anlagedatum,
        c.USAGE AS verbrauch,
        p_base.PRICE AS base_price,
        p_working.PRICE AS working_price,
        c.MODIFICATIONDATE AS contract_modificationdate,
        p.PRODUCTCODE,
        p.PRODUCTNAME,
        p_base.VALID_FROM,
        p_base.VALID_UNTIL
    FROM
        LB.stage.stg_contract c
    JOIN
        LB.stage.stg_products p
        ON c.PRODUCT_ID = p.ID  -- Fixed column name to match source data
    JOIN
        LB.stage.stg_prices p_base
        ON c.PRODUCT_ID = p_base.PRODUCTID  -- Fixed column name to match source data
        AND p_base.PRODUCTCOMPONENT = 'baseprice'
        AND p_base.VALID_FROM <= c.STARTDATE
        AND (p_base.VALID_UNTIL IS NULL OR p_base.VALID_UNTIL >= c.STARTDATE)
    JOIN
        LB.stage.stg_prices p_working
        ON c.PRODUCT_ID = p_working.PRODUCTID  -- Fixed column name to match source data
        AND p_working.PRODUCTCOMPONENT = 'workingprice'
        AND p_working.VALID_FROM <= c.STARTDATE
        AND (p_working.VALID_UNTIL IS NULL OR p_working.VALID_UNTIL >= c.STARTDATE)
),
new_data AS (
    SELECT
        contract_id,
        product_id,
        anlagedatum,
        verbrauch,
        base_price + (verbrauch * working_price / 100) AS umsatz,
        PRODUCTCODE,
        PRODUCTNAME,
        contract_modificationdate,
        VALID_FROM,
        VALID_UNTIL,
        TRUE AS is_current,
        current_date AS load_date,
        md5(cast(coalesce(cast(contract_id as TEXT), '') || '-' || coalesce(cast(product_id as TEXT), '') || '-' || coalesce(cast(anlagedatum as TEXT), '') as TEXT)) AS id
    FROM
        contract_prices
)

SELECT
    contract_id,
    product_id,
    anlagedatum,
    verbrauch,
    umsatz,
    PRODUCTCODE,
    PRODUCTNAME,
    contract_modificationdate,
    VALID_FROM,
    VALID_UNTIL,
    is_current,
    load_date,
    id,
    current_date AS effective_date,
    NULL AS expiry_date
FROM
    new_data
  );
[0m11:23:53.780954 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:23:54.185320 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59273-0202-d36e-0002-d44600012092
[0m11:23:54.186064 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 9 at position 8
invalid identifier 'C.PRODUCT_ID'
[0m11:23:54.186736 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.int_view_contract: Close
[0m11:23:54.302918 [debug] [Thread-1 (]: Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  000904 (42000): SQL compilation error: error line 9 at position 8
  invalid identifier 'C.PRODUCT_ID'
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m11:23:54.305262 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31f56fa0-d60e-4455-a68f-b9f4313db7ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1346c0790>]}
[0m11:23:54.306016 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model stage_intermediate.int_view_contract ...... [[31mERROR[0m in 0.56s]
[0m11:23:54.306672 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.int_view_contract
[0m11:23:54.308539 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:23:54.308896 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.int_view_contract' was properly closed.
[0m11:23:54.309204 [info ] [MainThread]: 
[0m11:23:54.309508 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.85 seconds (2.85s).
[0m11:23:54.310090 [debug] [MainThread]: Command end result
[0m11:23:54.337409 [info ] [MainThread]: 
[0m11:23:54.337647 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:23:54.337766 [info ] [MainThread]: 
[0m11:23:54.337927 [error] [MainThread]:   Database Error in model int_view_contract (models/intermediate/int_view_contract.sql)
  000904 (42000): SQL compilation error: error line 9 at position 8
  invalid identifier 'C.PRODUCT_ID'
  compiled Code at target/run/snowflake_airflow_dbt/models/intermediate/int_view_contract.sql
[0m11:23:54.338046 [info ] [MainThread]: 
[0m11:23:54.338177 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:23:54.339759 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.818621, "process_user_time": 1.876092, "process_kernel_time": 2.475287, "process_mem_max_rss": "196296704", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:23:54.340058 [debug] [MainThread]: Command `dbt run` failed at 11:23:54.340026 after 3.82 seconds
[0m11:23:54.340320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b2ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126797e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126747490>]}
[0m11:23:54.340484 [debug] [MainThread]: Flushing usage events
[0m11:52:36.155625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11785b150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117881590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117881bd0>]}


============================== 11:52:36.158716 | 83f56430-6038-4524-8cac-9040eb649c6a ==============================
[0m11:52:36.158716 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:52:36.159064 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:52:36.873664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83f56430-6038-4524-8cac-9040eb649c6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11789e490>]}
[0m11:52:36.892515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83f56430-6038-4524-8cac-9040eb649c6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116f28c90>]}
[0m11:52:36.893051 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:52:36.906280 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:52:36.999608 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 0 files added, 0 files changed.
[0m11:52:37.000124 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://seeds/bookings_2.csv
[0m11:52:37.000386 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/intermediate/int_view_contract.sql
[0m11:52:37.000525 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://seeds/customers.csv
[0m11:52:37.000739 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/mart/fact_metrics.sql
[0m11:52:37.045397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83f56430-6038-4524-8cac-9040eb649c6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1651e3350>]}
[0m11:52:37.130539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83f56430-6038-4524-8cac-9040eb649c6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1652c4610>]}
[0m11:52:37.130837 [info ] [MainThread]: Found 3 models, 1 seed, 3 sources, 563 macros
[0m11:52:37.130996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83f56430-6038-4524-8cac-9040eb649c6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16510a190>]}
[0m11:52:37.131682 [info ] [MainThread]: 
[0m11:52:37.131935 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:52:37.133739 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:52:37.139881 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:52:37.140074 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:52:37.140195 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:52:37.662013 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.522 seconds
[0m11:52:37.663434 [debug] [ThreadPool]: On list_LB: Close
[0m11:52:37.763974 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m11:52:37.767836 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:52:37.767983 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:52:37.768095 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:52:38.320653 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.552 seconds
[0m11:52:38.322722 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:52:38.424938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83f56430-6038-4524-8cac-9040eb649c6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165156410>]}
[0m11:52:38.425438 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:52:38.425639 [info ] [MainThread]: 
[0m11:52:38.428035 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m11:52:38.428632 [info ] [Thread-1 (]: 1 of 3 START sql table model stage.stg_contract ................................ [RUN]
[0m11:52:38.428890 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m11:52:38.429049 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m11:52:38.435917 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m11:52:38.437147 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m11:52:38.452774 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m11:52:38.453489 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m11:52:38.453674 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m11:52:38.453834 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:52:40.076065 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.624 seconds
[0m11:52:40.103967 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m11:52:40.218563 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83f56430-6038-4524-8cac-9040eb649c6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1656e8410>]}
[0m11:52:40.219741 [info ] [Thread-1 (]: 1 of 3 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.79s]
[0m11:52:40.220604 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m11:52:40.221205 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m11:52:40.222104 [info ] [Thread-1 (]: 2 of 3 START sql table model stage.stg_prices .................................. [RUN]
[0m11:52:40.222832 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m11:52:40.223291 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m11:52:40.228296 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m11:52:40.229256 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m11:52:40.231006 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m11:52:40.231693 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m11:52:40.231883 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m11:52:40.232042 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:52:42.076151 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.846 seconds
[0m11:52:42.080031 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m11:52:42.205899 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83f56430-6038-4524-8cac-9040eb649c6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1657b9010>]}
[0m11:52:42.207651 [info ] [Thread-1 (]: 2 of 3 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.98s]
[0m11:52:42.208757 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m11:52:42.209367 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m11:52:42.210057 [info ] [Thread-1 (]: 3 of 3 START sql table model stage.stg_products ................................ [RUN]
[0m11:52:42.210680 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m11:52:42.211084 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m11:52:42.216891 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m11:52:42.217662 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m11:52:42.221426 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m11:52:42.222283 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m11:52:42.222628 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m11:52:42.222926 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:52:43.405114 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.183 seconds
[0m11:52:43.408810 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m11:52:43.523257 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83f56430-6038-4524-8cac-9040eb649c6a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1658f2ed0>]}
[0m11:52:43.524782 [info ] [Thread-1 (]: 3 of 3 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.31s]
[0m11:52:43.525897 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m11:52:43.528731 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:52:43.529226 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m11:52:43.529967 [info ] [MainThread]: 
[0m11:52:43.530553 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.40 seconds (6.40s).
[0m11:52:43.531855 [debug] [MainThread]: Command end result
[0m11:52:43.561505 [info ] [MainThread]: 
[0m11:52:43.561759 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:52:43.561891 [info ] [MainThread]: 
[0m11:52:43.562033 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m11:52:43.563422 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.4470406, "process_user_time": 2.03401, "process_kernel_time": 2.471846, "process_mem_max_rss": "195084288", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:52:43.563762 [debug] [MainThread]: Command `dbt run` succeeded at 11:52:43.563723 after 7.45 seconds
[0m11:52:43.564014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117883a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117881e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104caae50>]}
[0m11:52:43.564163 [debug] [MainThread]: Flushing usage events
[0m12:07:00.551352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168655790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1682f0650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168696cd0>]}


============================== 12:07:00.554692 | dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76 ==============================
[0m12:07:00.554692 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:07:00.554984 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:07:01.247316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16d364b10>]}
[0m12:07:01.267600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168100b50>]}
[0m12:07:01.268199 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:07:01.284466 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:07:01.356035 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:07:01.356364 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m12:07:01.488375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e909010>]}
[0m12:07:01.533456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e6a24d0>]}
[0m12:07:01.533739 [info ] [MainThread]: Found 4 models, 1 seed, 3 sources, 563 macros
[0m12:07:01.533894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e6cb350>]}
[0m12:07:01.534588 [info ] [MainThread]: 
[0m12:07:01.534839 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:07:01.536687 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m12:07:01.542553 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m12:07:01.542783 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m12:07:01.542917 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:07:02.086641 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.544 seconds
[0m12:07:02.089720 [debug] [ThreadPool]: On list_LB: Close
[0m12:07:02.211241 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m12:07:02.224474 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m12:07:02.224996 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m12:07:02.225320 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:07:02.679282 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.454 seconds
[0m12:07:02.682229 [debug] [ThreadPool]: On list_LB_stage: Close
[0m12:07:02.798518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1313d3390>]}
[0m12:07:02.799960 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:07:02.800661 [info ] [MainThread]: 
[0m12:07:02.805499 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m12:07:02.806250 [info ] [Thread-1 (]: 1 of 4 START sql table model stage.stg_contract ................................ [RUN]
[0m12:07:02.806965 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m12:07:02.807381 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m12:07:02.816064 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:07:02.817048 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m12:07:02.836642 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:07:02.837575 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m12:07:02.837820 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m12:07:02.838026 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:07:04.056710 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.216 seconds
[0m12:07:04.083467 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m12:07:04.210377 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17c0398d0>]}
[0m12:07:04.212429 [info ] [Thread-1 (]: 1 of 4 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.40s]
[0m12:07:04.213675 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m12:07:04.214462 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m12:07:04.215367 [info ] [Thread-1 (]: 2 of 4 START sql table model stage.stg_prices .................................. [RUN]
[0m12:07:04.216092 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m12:07:04.216526 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m12:07:04.221038 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:07:04.222178 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m12:07:04.224892 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:07:04.225825 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m12:07:04.226184 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m12:07:04.226511 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:07:05.715918 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.489 seconds
[0m12:07:05.722379 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m12:07:05.835691 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e5a0a90>]}
[0m12:07:05.837051 [info ] [Thread-1 (]: 2 of 4 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.62s]
[0m12:07:05.838152 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m12:07:05.838967 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m12:07:05.839897 [info ] [Thread-1 (]: 3 of 4 START sql table model stage.stg_products ................................ [RUN]
[0m12:07:05.840559 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m12:07:05.841042 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m12:07:05.848160 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m12:07:05.848788 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m12:07:05.850148 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m12:07:05.850637 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m12:07:05.850806 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m12:07:05.850951 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:07:06.836395 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.985 seconds
[0m12:07:06.847332 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m12:07:06.972994 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1686577d0>]}
[0m12:07:06.976226 [info ] [Thread-1 (]: 3 of 4 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.13s]
[0m12:07:06.977376 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m12:07:06.982296 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m12:07:06.983298 [info ] [Thread-1 (]: 4 of 4 START sql table model stage.dim_product ................................. [RUN]
[0m12:07:06.983972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_product)
[0m12:07:06.984880 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m12:07:06.993321 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m12:07:06.994777 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m12:07:06.996839 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m12:07:06.997869 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m12:07:06.998034 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.stage.dim_product
         as
        (-- models/dimensions/dim_product.sql



select
    id as product_id,
    productcode,
    productname,
    energy,
    consumptiontype
from LB.stage.stg_products
        );
[0m12:07:06.998185 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:07:08.020008 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.021 seconds
[0m12:07:08.027372 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m12:07:08.139784 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcd15f5f-efd5-4fbe-bbf2-5032ba23ff76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17be63290>]}
[0m12:07:08.140492 [info ] [Thread-1 (]: 4 of 4 OK created sql table model stage.dim_product ............................ [[32mSUCCESS 1[0m in 1.16s]
[0m12:07:08.140888 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m12:07:08.142493 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:07:08.142706 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m12:07:08.142950 [info ] [MainThread]: 
[0m12:07:08.143098 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 6.61 seconds (6.61s).
[0m12:07:08.143646 [debug] [MainThread]: Command end result
[0m12:07:08.164089 [info ] [MainThread]: 
[0m12:07:08.164370 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:07:08.164501 [info ] [MainThread]: 
[0m12:07:08.164651 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m12:07:08.168599 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.6473627, "process_user_time": 2.018126, "process_kernel_time": 2.552804, "process_mem_max_rss": "197787648", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:07:08.170217 [debug] [MainThread]: Command `dbt run` succeeded at 12:07:08.170158 after 7.65 seconds
[0m12:07:08.171573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ff1190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f92cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fa1810>]}
[0m12:07:08.171896 [debug] [MainThread]: Flushing usage events
[0m12:16:51.180154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139b42750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139b81210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139b81890>]}


============================== 12:16:51.183100 | 6d4fe643-710f-448d-979e-d08ad874ee68 ==============================
[0m12:16:51.183100 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:16:51.183419 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select staging dim_products', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:16:51.940802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6d4fe643-710f-448d-979e-d08ad874ee68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f143010>]}
[0m12:16:51.965570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6d4fe643-710f-448d-979e-d08ad874ee68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139300c90>]}
[0m12:16:51.966169 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:16:51.988150 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:16:52.052278 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:16:52.052646 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m12:16:52.179709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6d4fe643-710f-448d-979e-d08ad874ee68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f6847d0>]}
[0m12:16:52.224561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6d4fe643-710f-448d-979e-d08ad874ee68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f4419d0>]}
[0m12:16:52.224819 [info ] [MainThread]: Found 4 models, 1 seed, 3 sources, 563 macros
[0m12:16:52.224978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d4fe643-710f-448d-979e-d08ad874ee68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f61c150>]}
[0m12:16:52.225270 [warn ] [MainThread]: The selection criterion 'dim_products' does not match any enabled nodes
[0m12:16:52.225878 [info ] [MainThread]: 
[0m12:16:52.226119 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:16:52.227826 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m12:16:52.233188 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m12:16:52.233351 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m12:16:52.233472 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:16:52.711857 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.478 seconds
[0m12:16:52.715372 [debug] [ThreadPool]: On list_LB: Close
[0m12:16:52.836931 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m12:16:52.847685 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m12:16:52.848267 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m12:16:52.848578 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:16:53.283435 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.435 seconds
[0m12:16:53.286335 [debug] [ThreadPool]: On list_LB_stage: Close
[0m12:16:53.397465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d4fe643-710f-448d-979e-d08ad874ee68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f690b50>]}
[0m12:16:53.398180 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:16:53.398551 [info ] [MainThread]: 
[0m12:16:53.400904 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m12:16:53.401386 [info ] [Thread-1 (]: 1 of 4 START sql table model stage.stg_contract ................................ [RUN]
[0m12:16:53.401776 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m12:16:53.402082 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m12:16:53.408963 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:16:53.409552 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m12:16:53.424577 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:16:53.425182 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m12:16:53.425346 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m12:16:53.425492 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:16:54.510918 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.085 seconds
[0m12:16:54.537807 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m12:16:54.654926 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d4fe643-710f-448d-979e-d08ad874ee68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cb10a50>]}
[0m12:16:54.656018 [info ] [Thread-1 (]: 1 of 4 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.25s]
[0m12:16:54.657062 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m12:16:54.657856 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m12:16:54.658870 [info ] [Thread-1 (]: 2 of 4 START sql table model stage.stg_prices .................................. [RUN]
[0m12:16:54.659570 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m12:16:54.660019 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m12:16:54.664769 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:16:54.666052 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m12:16:54.668092 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:16:54.668877 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m12:16:54.669108 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m12:16:54.669319 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:16:55.760444 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.091 seconds
[0m12:16:55.763301 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m12:16:55.876430 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d4fe643-710f-448d-979e-d08ad874ee68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fb75d50>]}
[0m12:16:55.877855 [info ] [Thread-1 (]: 2 of 4 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.22s]
[0m12:16:55.878793 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m12:16:55.879471 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m12:16:55.880322 [info ] [Thread-1 (]: 3 of 4 START sql table model stage.stg_products ................................ [RUN]
[0m12:16:55.881078 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m12:16:55.881589 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m12:16:55.886512 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m12:16:55.887434 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m12:16:55.890168 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m12:16:55.891293 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m12:16:55.891468 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m12:16:55.891618 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:16:56.727029 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.835 seconds
[0m12:16:56.728907 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m12:16:56.835074 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d4fe643-710f-448d-979e-d08ad874ee68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f86f310>]}
[0m12:16:56.836052 [info ] [Thread-1 (]: 3 of 4 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 0.95s]
[0m12:16:56.836467 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m12:16:56.837170 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m12:16:56.837480 [info ] [Thread-1 (]: 4 of 4 START sql table model stage.dim_product ................................. [RUN]
[0m12:16:56.837708 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_product)
[0m12:16:56.837861 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m12:16:56.839880 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m12:16:56.840341 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m12:16:56.841577 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m12:16:56.842886 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m12:16:56.843173 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.stage.dim_product
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_product d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_product d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and b.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m12:16:56.843391 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:16:57.191192 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b592a8-0202-d36e-0002-d44600012216
[0m12:16:57.191645 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 34 at position 12
invalid identifier 'D.EFFECTIVE_TO'
[0m12:16:57.191906 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m12:16:57.303421 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 34 at position 12
  invalid identifier 'D.EFFECTIVE_TO'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_product.sql
[0m12:16:57.304116 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d4fe643-710f-448d-979e-d08ad874ee68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fa9be10>]}
[0m12:16:57.304745 [error] [Thread-1 (]: 4 of 4 ERROR creating sql table model stage.dim_product ........................ [[31mERROR[0m in 0.47s]
[0m12:16:57.305312 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m12:16:57.307427 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:16:57.307770 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m12:16:57.308144 [info ] [MainThread]: 
[0m12:16:57.308420 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 5.08 seconds (5.08s).
[0m12:16:57.309250 [debug] [MainThread]: Command end result
[0m12:16:57.333387 [info ] [MainThread]: 
[0m12:16:57.333731 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:16:57.333896 [info ] [MainThread]: 
[0m12:16:57.334106 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 34 at position 12
  invalid identifier 'D.EFFECTIVE_TO'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_product.sql
[0m12:16:57.334266 [info ] [MainThread]: 
[0m12:16:57.334434 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m12:16:57.336368 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.1901712, "process_user_time": 2.558441, "process_kernel_time": 1.928508, "process_mem_max_rss": "193413120", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:16:57.336791 [debug] [MainThread]: Command `dbt run` failed at 12:16:57.336746 after 6.19 seconds
[0m12:16:57.337087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100696cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c8fad50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139b0b8d0>]}
[0m12:16:57.337287 [debug] [MainThread]: Flushing usage events
[0m12:21:31.639818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1681f0110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1685bd490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1685bdb10>]}


============================== 12:21:31.642764 | 28e35a27-5359-4185-8fa3-4c160d57a454 ==============================
[0m12:21:31.642764 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:21:31.643119 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging dim_products', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:21:32.430759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '28e35a27-5359-4185-8fa3-4c160d57a454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e5a0610>]}
[0m12:21:32.450349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '28e35a27-5359-4185-8fa3-4c160d57a454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fffca10>]}
[0m12:21:32.451028 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:21:32.464637 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:21:32.532026 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m12:21:32.532362 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m12:21:32.532503 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m12:21:32.664833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '28e35a27-5359-4185-8fa3-4c160d57a454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e7c4690>]}
[0m12:21:32.707448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '28e35a27-5359-4185-8fa3-4c160d57a454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e94ab10>]}
[0m12:21:32.707720 [info ] [MainThread]: Found 4 models, 1 seed, 3 sources, 563 macros
[0m12:21:32.707872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28e35a27-5359-4185-8fa3-4c160d57a454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e75a050>]}
[0m12:21:32.708638 [info ] [MainThread]: 
[0m12:21:32.708889 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:21:32.710627 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m12:21:32.715994 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m12:21:32.716163 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m12:21:32.716290 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:21:33.261187 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.544 seconds
[0m12:21:33.262708 [debug] [ThreadPool]: On list_LB: Close
[0m12:21:33.390836 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m12:21:33.395358 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m12:21:33.395531 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m12:21:33.395660 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:21:33.829588 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.434 seconds
[0m12:21:33.832049 [debug] [ThreadPool]: On list_LB_stage: Close
[0m12:21:33.937937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28e35a27-5359-4185-8fa3-4c160d57a454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e73b910>]}
[0m12:21:33.938610 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:21:33.938760 [info ] [MainThread]: 
[0m12:21:33.940378 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m12:21:33.940641 [info ] [Thread-1 (]: 1 of 4 START sql table model stage.stg_contract ................................ [RUN]
[0m12:21:33.940836 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m12:21:33.940977 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m12:21:33.946606 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:21:33.946959 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m12:21:33.960567 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:21:33.962241 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m12:21:33.962511 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m12:21:33.962685 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:21:35.218358 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.255 seconds
[0m12:21:35.245217 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m12:21:35.354231 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e35a27-5359-4185-8fa3-4c160d57a454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e7c4050>]}
[0m12:21:35.355988 [info ] [Thread-1 (]: 1 of 4 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.41s]
[0m12:21:35.357073 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m12:21:35.357796 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m12:21:35.358704 [info ] [Thread-1 (]: 2 of 4 START sql table model stage.stg_prices .................................. [RUN]
[0m12:21:35.359437 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m12:21:35.359942 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m12:21:35.365262 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:21:35.366197 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m12:21:35.369136 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:21:35.370069 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m12:21:35.370417 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m12:21:35.370727 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:21:36.342122 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.970 seconds
[0m12:21:36.347356 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m12:21:36.480447 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e35a27-5359-4185-8fa3-4c160d57a454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x282a2bb10>]}
[0m12:21:36.481886 [info ] [Thread-1 (]: 2 of 4 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.12s]
[0m12:21:36.482637 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m12:21:36.483203 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m12:21:36.483953 [info ] [Thread-1 (]: 3 of 4 START sql table model stage.stg_products ................................ [RUN]
[0m12:21:36.484659 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m12:21:36.485115 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m12:21:36.489684 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m12:21:36.490471 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m12:21:36.493002 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m12:21:36.493810 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m12:21:36.494094 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m12:21:36.494365 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:21:37.600428 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.106 seconds
[0m12:21:37.603216 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m12:21:37.714018 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e35a27-5359-4185-8fa3-4c160d57a454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x2829f9550>]}
[0m12:21:37.715308 [info ] [Thread-1 (]: 3 of 4 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.23s]
[0m12:21:37.716117 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m12:21:37.717376 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m12:21:37.718096 [info ] [Thread-1 (]: 4 of 4 START sql table model stage.dim_products ................................ [RUN]
[0m12:21:37.718618 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m12:21:37.718927 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m12:21:37.722420 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m12:21:37.723080 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m12:21:37.724751 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m12:21:37.725870 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m12:21:37.726241 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and b.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m12:21:37.726656 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:21:38.081109 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b592ad-0202-d36c-0002-d4460001426e
[0m12:21:38.081518 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 51 at position 34
invalid identifier 'D.MODIFICATIONDATE'
[0m12:21:38.081980 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m12:21:38.228388 [debug] [Thread-1 (]: Database Error in model dim_products (models/staging/dim_products.sql)
  000904 (42000): SQL compilation error: error line 51 at position 34
  invalid identifier 'D.MODIFICATIONDATE'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_products.sql
[0m12:21:38.228961 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28e35a27-5359-4185-8fa3-4c160d57a454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ff670d0>]}
[0m12:21:38.229401 [error] [Thread-1 (]: 4 of 4 ERROR creating sql table model stage.dim_products ....................... [[31mERROR[0m in 0.51s]
[0m12:21:38.229655 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m12:21:38.231372 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:21:38.231603 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_products' was properly closed.
[0m12:21:38.231928 [info ] [MainThread]: 
[0m12:21:38.232178 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 5.52 seconds (5.52s).
[0m12:21:38.232843 [debug] [MainThread]: Command end result
[0m12:21:38.253216 [info ] [MainThread]: 
[0m12:21:38.253499 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:21:38.253624 [info ] [MainThread]: 
[0m12:21:38.253840 [error] [MainThread]:   Database Error in model dim_products (models/staging/dim_products.sql)
  000904 (42000): SQL compilation error: error line 51 at position 34
  invalid identifier 'D.MODIFICATIONDATE'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_products.sql
[0m12:21:38.253975 [info ] [MainThread]: 
[0m12:21:38.254112 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m12:21:38.256012 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.6598186, "process_user_time": 2.711823, "process_kernel_time": 1.842259, "process_mem_max_rss": "194428928", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:21:38.256389 [debug] [MainThread]: Command `dbt run` failed at 12:21:38.256347 after 6.66 seconds
[0m12:21:38.256690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9e32d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105002cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10507c0d0>]}
[0m12:21:38.256867 [debug] [MainThread]: Flushing usage events
[0m12:26:04.249510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ca5a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ca812d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ca5acd0>]}


============================== 12:26:04.252479 | cc040431-2793-4380-ad0f-dbaf5aa61cc1 ==============================
[0m12:26:04.252479 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:26:04.252792 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select staging dim_products', 'send_anonymous_usage_stats': 'True'}
[0m12:26:04.895287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc040431-2793-4380-ad0f-dbaf5aa61cc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169643250>]}
[0m12:26:04.914135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc040431-2793-4380-ad0f-dbaf5aa61cc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c300b90>]}
[0m12:26:04.915782 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:26:04.929049 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:26:04.990261 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:26:04.990554 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m12:26:05.119104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc040431-2793-4380-ad0f-dbaf5aa61cc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169a78250>]}
[0m12:26:05.163358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc040431-2793-4380-ad0f-dbaf5aa61cc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169b4c510>]}
[0m12:26:05.163594 [info ] [MainThread]: Found 4 models, 1 seed, 3 sources, 563 macros
[0m12:26:05.163743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc040431-2793-4380-ad0f-dbaf5aa61cc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1698a3f10>]}
[0m12:26:05.164487 [info ] [MainThread]: 
[0m12:26:05.164717 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:26:05.166367 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m12:26:05.171677 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m12:26:05.171872 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m12:26:05.171996 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:26:05.639463 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.467 seconds
[0m12:26:05.640651 [debug] [ThreadPool]: On list_LB: Close
[0m12:26:05.751240 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m12:26:05.763006 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m12:26:05.763328 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m12:26:05.763651 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:26:06.136983 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.373 seconds
[0m12:26:06.139297 [debug] [ThreadPool]: On list_LB_stage: Close
[0m12:26:06.250580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc040431-2793-4380-ad0f-dbaf5aa61cc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169a4b810>]}
[0m12:26:06.251345 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:26:06.251732 [info ] [MainThread]: 
[0m12:26:06.254219 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m12:26:06.254571 [info ] [Thread-1 (]: 1 of 4 START sql table model stage.stg_contract ................................ [RUN]
[0m12:26:06.254814 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m12:26:06.254968 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m12:26:06.258821 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:26:06.259943 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m12:26:06.276149 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:26:06.276843 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m12:26:06.277036 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m12:26:06.277195 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:26:07.438465 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.161 seconds
[0m12:26:07.463036 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m12:26:07.573175 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc040431-2793-4380-ad0f-dbaf5aa61cc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15bd32d90>]}
[0m12:26:07.573884 [info ] [Thread-1 (]: 1 of 4 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.32s]
[0m12:26:07.574270 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m12:26:07.574535 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m12:26:07.574922 [info ] [Thread-1 (]: 2 of 4 START sql table model stage.stg_prices .................................. [RUN]
[0m12:26:07.575226 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m12:26:07.575390 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m12:26:07.577687 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:26:07.578472 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m12:26:07.579830 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:26:07.580678 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m12:26:07.580848 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m12:26:07.581003 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:26:08.625324 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.044 seconds
[0m12:26:08.626742 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m12:26:08.735389 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc040431-2793-4380-ad0f-dbaf5aa61cc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1698673d0>]}
[0m12:26:08.735855 [info ] [Thread-1 (]: 2 of 4 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.16s]
[0m12:26:08.736131 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m12:26:08.736305 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m12:26:08.736532 [info ] [Thread-1 (]: 3 of 4 START sql table model stage.stg_products ................................ [RUN]
[0m12:26:08.736769 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m12:26:08.736923 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m12:26:08.740655 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m12:26:08.741187 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m12:26:08.742558 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m12:26:08.743185 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m12:26:08.743369 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m12:26:08.743513 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:26:09.754854 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.011 seconds
[0m12:26:09.758247 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m12:26:09.869074 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc040431-2793-4380-ad0f-dbaf5aa61cc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169a4a550>]}
[0m12:26:09.870321 [info ] [Thread-1 (]: 3 of 4 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.13s]
[0m12:26:09.871318 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m12:26:09.872942 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m12:26:09.873781 [info ] [Thread-1 (]: 4 of 4 START sql table model stage.dim_products ................................ [RUN]
[0m12:26:09.874407 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m12:26:09.874862 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m12:26:09.880041 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m12:26:09.880917 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m12:26:09.882420 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m12:26:09.883509 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m12:26:09.883732 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and b.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m12:26:09.883924 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:26:10.298777 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b592b2-0202-d36c-0002-d44600014286
[0m12:26:10.299305 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 51 at position 101
invalid identifier 'B.RECORD_STATUS'
[0m12:26:10.299792 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m12:26:10.409326 [debug] [Thread-1 (]: Database Error in model dim_products (models/staging/dim_products.sql)
  000904 (42000): SQL compilation error: error line 51 at position 101
  invalid identifier 'B.RECORD_STATUS'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_products.sql
[0m12:26:10.409895 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc040431-2793-4380-ad0f-dbaf5aa61cc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169e69d10>]}
[0m12:26:10.410876 [error] [Thread-1 (]: 4 of 4 ERROR creating sql table model stage.dim_products ....................... [[31mERROR[0m in 0.54s]
[0m12:26:10.411412 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m12:26:10.413247 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:26:10.413653 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_products' was properly closed.
[0m12:26:10.414129 [info ] [MainThread]: 
[0m12:26:10.414472 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 5.25 seconds (5.25s).
[0m12:26:10.415405 [debug] [MainThread]: Command end result
[0m12:26:10.436468 [info ] [MainThread]: 
[0m12:26:10.436736 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:26:10.436874 [info ] [MainThread]: 
[0m12:26:10.437039 [error] [MainThread]:   Database Error in model dim_products (models/staging/dim_products.sql)
  000904 (42000): SQL compilation error: error line 51 at position 101
  invalid identifier 'B.RECORD_STATUS'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_products.sql
[0m12:26:10.437169 [info ] [MainThread]: 
[0m12:26:10.437313 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m12:26:10.439442 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.221836, "process_user_time": 2.42273, "process_kernel_time": 2.080252, "process_mem_max_rss": "201424896", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:26:10.439959 [debug] [MainThread]: Command `dbt run` failed at 12:26:10.439913 after 6.22 seconds
[0m12:26:10.440312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ca4c550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10114ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ca81890>]}
[0m12:26:10.440479 [debug] [MainThread]: Flushing usage events
[0m12:27:02.069925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e34c4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e37d510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e37db90>]}


============================== 12:27:02.072320 | edc4fa78-b476-4895-888f-7571b6dc5e60 ==============================
[0m12:27:02.072320 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:27:02.072593 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select staging dim_products', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:27:02.750199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'edc4fa78-b476-4895-888f-7571b6dc5e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d4d0610>]}
[0m12:27:02.769566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'edc4fa78-b476-4895-888f-7571b6dc5e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dc00bd0>]}
[0m12:27:02.770205 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:27:02.783469 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:27:02.848882 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:27:02.849231 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m12:27:02.971670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'edc4fa78-b476-4895-888f-7571b6dc5e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b59c290>]}
[0m12:27:03.013611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'edc4fa78-b476-4895-888f-7571b6dc5e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b471410>]}
[0m12:27:03.013908 [info ] [MainThread]: Found 4 models, 1 seed, 3 sources, 563 macros
[0m12:27:03.014065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'edc4fa78-b476-4895-888f-7571b6dc5e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2a1ed0>]}
[0m12:27:03.014805 [info ] [MainThread]: 
[0m12:27:03.015043 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:27:03.016759 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m12:27:03.022043 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m12:27:03.022240 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m12:27:03.022382 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:27:03.521205 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.499 seconds
[0m12:27:03.523872 [debug] [ThreadPool]: On list_LB: Close
[0m12:27:03.631724 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m12:27:03.644884 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m12:27:03.645410 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m12:27:03.645731 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:27:04.100958 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.455 seconds
[0m12:27:04.104994 [debug] [ThreadPool]: On list_LB_stage: Close
[0m12:27:04.221863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'edc4fa78-b476-4895-888f-7571b6dc5e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b63b8d0>]}
[0m12:27:04.222849 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:27:04.223371 [info ] [MainThread]: 
[0m12:27:04.227436 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m12:27:04.228045 [info ] [Thread-1 (]: 1 of 4 START sql table model stage.stg_contract ................................ [RUN]
[0m12:27:04.228547 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m12:27:04.228920 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m12:27:04.236777 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:27:04.237538 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m12:27:04.255990 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:27:04.256654 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m12:27:04.256810 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m12:27:04.256958 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:27:05.357335 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.100 seconds
[0m12:27:05.375937 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m12:27:05.478247 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'edc4fa78-b476-4895-888f-7571b6dc5e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b267050>]}
[0m12:27:05.479311 [info ] [Thread-1 (]: 1 of 4 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.25s]
[0m12:27:05.479601 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m12:27:05.479804 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m12:27:05.479989 [info ] [Thread-1 (]: 2 of 4 START sql table model stage.stg_prices .................................. [RUN]
[0m12:27:05.480307 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m12:27:05.480510 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m12:27:05.481889 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:27:05.482438 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m12:27:05.483477 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:27:05.483878 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m12:27:05.484019 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m12:27:05.484155 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:27:06.385360 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.901 seconds
[0m12:27:06.386896 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m12:27:06.496121 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'edc4fa78-b476-4895-888f-7571b6dc5e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b109490>]}
[0m12:27:06.497850 [info ] [Thread-1 (]: 2 of 4 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.02s]
[0m12:27:06.498870 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m12:27:06.499376 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m12:27:06.500180 [info ] [Thread-1 (]: 3 of 4 START sql table model stage.stg_products ................................ [RUN]
[0m12:27:06.500808 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m12:27:06.501209 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m12:27:06.507796 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m12:27:06.509879 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m12:27:06.512065 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m12:27:06.512998 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m12:27:06.513283 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m12:27:06.513543 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:27:07.513684 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.000 seconds
[0m12:27:07.519747 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m12:27:07.635315 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'edc4fa78-b476-4895-888f-7571b6dc5e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9605d0>]}
[0m12:27:07.636029 [info ] [Thread-1 (]: 3 of 4 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.13s]
[0m12:27:07.636380 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m12:27:07.637265 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m12:27:07.637576 [info ] [Thread-1 (]: 4 of 4 START sql table model stage.dim_products ................................ [RUN]
[0m12:27:07.637814 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m12:27:07.637971 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m12:27:07.640774 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m12:27:07.641414 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m12:27:07.642743 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m12:27:07.643880 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m12:27:07.644153 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and d.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m12:27:07.644373 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:27:08.507971 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.864 seconds
[0m12:27:08.509008 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m12:27:08.604888 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'edc4fa78-b476-4895-888f-7571b6dc5e60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ba53810>]}
[0m12:27:08.605354 [info ] [Thread-1 (]: 4 of 4 OK created sql table model stage.dim_products ........................... [[32mSUCCESS 1[0m in 0.97s]
[0m12:27:08.605605 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m12:27:08.606488 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:27:08.606770 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_products' was properly closed.
[0m12:27:08.607094 [info ] [MainThread]: 
[0m12:27:08.607349 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 5.59 seconds (5.59s).
[0m12:27:08.608113 [debug] [MainThread]: Command end result
[0m12:27:08.632671 [info ] [MainThread]: 
[0m12:27:08.633259 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:27:08.633390 [info ] [MainThread]: 
[0m12:27:08.633667 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m12:27:08.635803 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.593525, "process_user_time": 2.083502, "process_kernel_time": 2.40935, "process_mem_max_rss": "200949760", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:27:08.636167 [debug] [MainThread]: Command `dbt run` succeeded at 12:27:08.636123 after 6.59 seconds
[0m12:27:08.636432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e360d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c7acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c7ae50>]}
[0m12:27:08.636621 [debug] [MainThread]: Flushing usage events
[0m12:28:49.925981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d07ea90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d0bd450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d0bda90>]}


============================== 12:28:49.928290 | 15734ad4-9cb9-4738-a479-cac3d0715dda ==============================
[0m12:28:49.928290 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:28:49.928552 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging dim_products', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:28:50.572140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ad88e10>]}
[0m12:28:50.597510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ca00c10>]}
[0m12:28:50.598254 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:28:50.613916 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:28:50.674154 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:28:50.674442 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m12:28:50.790926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e125310>]}
[0m12:28:50.832547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e0f00d0>]}
[0m12:28:50.832795 [info ] [MainThread]: Found 5 models, 1 seed, 3 sources, 563 macros
[0m12:28:50.832944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b695f50>]}
[0m12:28:50.833667 [info ] [MainThread]: 
[0m12:28:50.833900 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:28:50.835632 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m12:28:50.840966 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m12:28:50.841138 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m12:28:50.841256 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:28:51.343285 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.502 seconds
[0m12:28:51.346036 [debug] [ThreadPool]: On list_LB: Close
[0m12:28:51.466315 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m12:28:51.478506 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m12:28:51.478747 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m12:28:51.478902 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:28:51.900619 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.422 seconds
[0m12:28:51.901876 [debug] [ThreadPool]: On list_LB_stage: Close
[0m12:28:52.009207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f724590>]}
[0m12:28:52.010017 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:28:52.010437 [info ] [MainThread]: 
[0m12:28:52.013050 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m12:28:52.013633 [info ] [Thread-1 (]: 1 of 5 START sql table model stage.dim_date .................................... [RUN]
[0m12:28:52.014120 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m12:28:52.014464 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m12:28:52.022935 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m12:28:52.023901 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m12:28:52.037989 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m12:28:52.039045 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m12:28:52.039245 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- models/dimensions/dim_date.sql



with date_range as (
    select
        dateadd(day, seq4(), '2000-01-01') as date
    from table(generator(rowcount => 10000))  -- Adjust the row count as necessary
    where dateadd(day, seq4(), '2000-01-01') <= current_date()
)

select
    date as date,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    week(date) as week,
    weekday(date) as weekday,
    case when weekday(date) in (1, 7) then 'Weekend' else 'Weekday' end as day_type
from date_range
        );
[0m12:28:52.039409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:28:52.455889 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b592b4-0202-d36c-0002-d44600014292
[0m12:28:52.457100 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002140 (42601): SQL compilation error:
Unknown functions WEEKDAY, WEEKDAY
[0m12:28:52.457965 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m12:28:52.570712 [debug] [Thread-1 (]: Database Error in model dim_date (models/staging/dim_date.sql)
  002140 (42601): SQL compilation error:
  Unknown functions WEEKDAY, WEEKDAY
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_date.sql
[0m12:28:52.571649 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e496210>]}
[0m12:28:52.572015 [error] [Thread-1 (]: 1 of 5 ERROR creating sql table model stage.dim_date ........................... [[31mERROR[0m in 0.56s]
[0m12:28:52.572289 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m12:28:52.572479 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m12:28:52.573022 [info ] [Thread-1 (]: 2 of 5 START sql table model stage.stg_contract ................................ [RUN]
[0m12:28:52.573209 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m12:28:52.573352 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m12:28:52.574993 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:28:52.575297 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m12:28:52.576393 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:28:52.576819 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m12:28:52.576973 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m12:28:52.577124 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:28:53.672478 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.095 seconds
[0m12:28:53.698345 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m12:28:53.819809 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b832c90>]}
[0m12:28:53.820593 [info ] [Thread-1 (]: 2 of 5 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.25s]
[0m12:28:53.821228 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m12:28:53.821704 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m12:28:53.822345 [info ] [Thread-1 (]: 3 of 5 START sql table model stage.stg_prices .................................. [RUN]
[0m12:28:53.822898 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m12:28:53.823291 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m12:28:53.826588 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:28:53.827773 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m12:28:53.831667 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:28:53.832556 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m12:28:53.832890 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m12:28:53.833156 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:28:54.825634 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.992 seconds
[0m12:28:54.829171 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m12:28:54.943260 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e0e7a50>]}
[0m12:28:54.944081 [info ] [Thread-1 (]: 3 of 5 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.12s]
[0m12:28:54.944633 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m12:28:54.944981 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m12:28:54.945435 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.stg_products ................................ [RUN]
[0m12:28:54.945879 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m12:28:54.946161 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m12:28:54.948869 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m12:28:54.949458 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m12:28:54.951348 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m12:28:54.952022 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m12:28:54.952269 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m12:28:54.952494 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:28:56.052942 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.100 seconds
[0m12:28:56.055241 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m12:28:56.168895 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dec6710>]}
[0m12:28:56.170104 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.22s]
[0m12:28:56.170989 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m12:28:56.172579 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m12:28:56.173533 [info ] [Thread-1 (]: 5 of 5 START sql table model stage.dim_products ................................ [RUN]
[0m12:28:56.174155 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m12:28:56.174476 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m12:28:56.179243 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m12:28:56.180446 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m12:28:56.183076 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m12:28:56.184479 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m12:28:56.184715 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and d.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m12:28:56.184903 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:28:57.112531 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.926 seconds
[0m12:28:57.118086 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m12:28:57.223695 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15734ad4-9cb9-4738-a479-cac3d0715dda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e777cd0>]}
[0m12:28:57.224744 [info ] [Thread-1 (]: 5 of 5 OK created sql table model stage.dim_products ........................... [[32mSUCCESS 1[0m in 1.05s]
[0m12:28:57.225431 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m12:28:57.227035 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:28:57.227414 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_products' was properly closed.
[0m12:28:57.227845 [info ] [MainThread]: 
[0m12:28:57.228167 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 6.39 seconds (6.39s).
[0m12:28:57.229133 [debug] [MainThread]: Command end result
[0m12:28:57.253550 [info ] [MainThread]: 
[0m12:28:57.253838 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:28:57.253971 [info ] [MainThread]: 
[0m12:28:57.254138 [error] [MainThread]:   Database Error in model dim_date (models/staging/dim_date.sql)
  002140 (42601): SQL compilation error:
  Unknown functions WEEKDAY, WEEKDAY
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_date.sql
[0m12:28:57.254272 [info ] [MainThread]: 
[0m12:28:57.254416 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m12:28:57.256417 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.3571267, "process_user_time": 1.905191, "process_kernel_time": 2.530287, "process_mem_max_rss": "201211904", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:28:57.256867 [debug] [MainThread]: Command `dbt run` failed at 12:28:57.256816 after 7.36 seconds
[0m12:28:57.257149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c232010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104636cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d047390>]}
[0m12:28:57.257329 [debug] [MainThread]: Flushing usage events
[0m12:30:28.853952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e232f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e2897d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e289e10>]}


============================== 12:30:28.857823 | c1eb2906-83ea-4423-931f-4c89d9a0426c ==============================
[0m12:30:28.857823 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:30:28.858185 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging dim_products', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:30:29.582218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16959e650>]}
[0m12:30:29.601116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16af42250>]}
[0m12:30:29.601700 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:30:29.618163 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:30:29.682442 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:30:29.682772 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m12:30:29.813364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b440c50>]}
[0m12:30:29.862729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2f0810>]}
[0m12:30:29.863094 [info ] [MainThread]: Found 5 models, 1 seed, 3 sources, 563 macros
[0m12:30:29.863248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2a9890>]}
[0m12:30:29.864020 [info ] [MainThread]: 
[0m12:30:29.864488 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:30:29.867508 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m12:30:29.873936 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m12:30:29.874160 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m12:30:29.874297 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:30:30.390427 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.516 seconds
[0m12:30:30.392930 [debug] [ThreadPool]: On list_LB: Close
[0m12:30:30.500113 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m12:30:30.505568 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m12:30:30.505822 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m12:30:30.505957 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:30:30.884056 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.378 seconds
[0m12:30:30.889474 [debug] [ThreadPool]: On list_LB_stage: Close
[0m12:30:30.997581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b138310>]}
[0m12:30:30.998112 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:30:30.998312 [info ] [MainThread]: 
[0m12:30:31.000313 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m12:30:31.000721 [info ] [Thread-1 (]: 1 of 5 START sql table model stage.dim_date .................................... [RUN]
[0m12:30:31.001000 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m12:30:31.001165 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m12:30:31.006059 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m12:30:31.006615 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m12:30:31.024115 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m12:30:31.025193 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m12:30:31.025425 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- models/dimensions/dim_date.sql



with date_range as (
    select
        dateadd(day, seq4(), '2000-01-01') as date
    from table(generator(rowcount => 10000))  -- Adjust the row count as necessary
    where dateadd(day, seq4(), '2000-01-01') <= current_date()
)

select
    date as date,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    week(date) as week,
    to_char(date, 'Day') as weekday,
    case when to_char(date, 'D') in ('1', '7') then 'Weekend' else 'Weekday' end as day_type
from date_range
        );
[0m12:30:31.025606 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:33.032975 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.006 seconds
[0m12:30:33.079661 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m12:30:33.240129 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e2b24d0>]}
[0m12:30:33.241662 [info ] [Thread-1 (]: 1 of 5 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 2.24s]
[0m12:30:33.242616 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m12:30:33.243265 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m12:30:33.244068 [info ] [Thread-1 (]: 2 of 5 START sql table model stage.stg_contract ................................ [RUN]
[0m12:30:33.244623 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m12:30:33.244974 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m12:30:33.249043 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:30:33.249612 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m12:30:33.250971 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:30:33.251563 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m12:30:33.251725 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m12:30:33.251884 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:34.564496 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.312 seconds
[0m12:30:34.567141 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m12:30:34.701880 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e2b24d0>]}
[0m12:30:34.703146 [info ] [Thread-1 (]: 2 of 5 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.46s]
[0m12:30:34.703694 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m12:30:34.704169 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m12:30:34.705035 [info ] [Thread-1 (]: 3 of 5 START sql table model stage.stg_prices .................................. [RUN]
[0m12:30:34.705781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m12:30:34.706103 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m12:30:34.710619 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:30:34.711914 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m12:30:34.717192 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:30:34.718401 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m12:30:34.718662 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m12:30:34.718828 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:35.692846 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.973 seconds
[0m12:30:35.697232 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m12:30:35.816373 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124711050>]}
[0m12:30:35.817957 [info ] [Thread-1 (]: 3 of 5 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.11s]
[0m12:30:35.818919 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m12:30:35.819710 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m12:30:35.820635 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.stg_products ................................ [RUN]
[0m12:30:35.821254 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m12:30:35.821667 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m12:30:35.826766 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m12:30:35.828099 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m12:30:35.829942 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m12:30:35.830651 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m12:30:35.830847 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m12:30:35.831021 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:36.716274 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.885 seconds
[0m12:30:36.719379 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m12:30:36.829811 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16afe8e90>]}
[0m12:30:36.830396 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.01s]
[0m12:30:36.830786 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m12:30:36.831564 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m12:30:36.831930 [info ] [Thread-1 (]: 5 of 5 START sql table model stage.dim_products ................................ [RUN]
[0m12:30:36.832204 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m12:30:36.832421 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m12:30:36.834894 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m12:30:36.835538 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m12:30:36.837079 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m12:30:36.838300 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m12:30:36.838560 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and d.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m12:30:36.838804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:37.810770 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.972 seconds
[0m12:30:37.815021 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m12:30:37.926594 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1eb2906-83ea-4423-931f-4c89d9a0426c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b138310>]}
[0m12:30:37.928145 [info ] [Thread-1 (]: 5 of 5 OK created sql table model stage.dim_products ........................... [[32mSUCCESS 1[0m in 1.09s]
[0m12:30:37.929142 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m12:30:37.931956 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:30:37.932449 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_products' was properly closed.
[0m12:30:37.933135 [info ] [MainThread]: 
[0m12:30:37.933844 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 8.07 seconds (8.07s).
[0m12:30:37.935512 [debug] [MainThread]: Command end result
[0m12:30:37.978580 [info ] [MainThread]: 
[0m12:30:37.978924 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:30:37.979114 [info ] [MainThread]: 
[0m12:30:37.979318 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m12:30:37.981343 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.23222, "process_user_time": 2.584247, "process_kernel_time": 2.059036, "process_mem_max_rss": "189693952", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:30:37.981713 [debug] [MainThread]: Command `dbt run` succeeded at 12:30:37.981665 after 9.23 seconds
[0m12:30:37.982017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e26fa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c5c790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b62e50>]}
[0m12:30:37.982218 [debug] [MainThread]: Flushing usage events
[0m12:54:04.728965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e31b690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e381790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e381dd0>]}


============================== 12:54:04.732599 | 648f60ae-e92d-45bf-b9aa-9c0abb0f6794 ==============================
[0m12:54:04.732599 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:54:04.732988 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging dim_products', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:54:05.571009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '648f60ae-e92d-45bf-b9aa-9c0abb0f6794', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b0cfb90>]}
[0m12:54:05.593318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '648f60ae-e92d-45bf-b9aa-9c0abb0f6794', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db00c90>]}
[0m12:54:05.594731 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:54:05.630524 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:54:05.699706 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:54:05.700037 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m12:54:05.781900 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_revenue_metrics' (models/staging/fact_revenue_metrics.sql) depends on a node named 'dim_product' which was not found
[0m12:54:05.787606 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0964524, "process_user_time": 1.815347, "process_kernel_time": 2.25615, "process_mem_max_rss": "185286656", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:54:05.788145 [debug] [MainThread]: Command `dbt run` failed at 12:54:05.788063 after 1.10 seconds
[0m12:54:05.788408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e381590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e360d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b52fb50>]}
[0m12:54:05.788619 [debug] [MainThread]: Flushing usage events
[0m12:54:25.872571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e59790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e97350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137eb5510>]}


============================== 12:54:25.875663 | a3e239a0-f9d8-499b-bbcf-f0b24f9210ce ==============================
[0m12:54:25.875663 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:54:25.876011 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging dim_products', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:54:26.600289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3e239a0-f9d8-499b-bbcf-f0b24f9210ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145410f10>]}
[0m12:54:26.621218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a3e239a0-f9d8-499b-bbcf-f0b24f9210ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130f00ad0>]}
[0m12:54:26.621834 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:54:26.634779 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:54:26.697698 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:54:26.698049 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m12:54:26.760625 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_revenue_metrics' (models/staging/fact_revenue_metrics.sql) depends on a node named 'stg_contracts' which was not found
[0m12:54:26.761939 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.92281365, "process_user_time": 1.998447, "process_kernel_time": 1.373669, "process_mem_max_rss": "183304192", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:54:26.762203 [debug] [MainThread]: Command `dbt run` failed at 12:54:26.762161 after 0.92 seconds
[0m12:54:26.762388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e95290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1004becd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137eb7010>]}
[0m12:54:26.762550 [debug] [MainThread]: Flushing usage events
[0m13:11:16.947441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1460432d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146080ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146081550>]}


============================== 13:11:16.953432 | 067b9e31-b39f-4f85-bc3f-01ef5ed3391e ==============================
[0m13:11:16.953432 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:11:16.953864 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select staging dim_products', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:11:17.723461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '067b9e31-b39f-4f85-bc3f-01ef5ed3391e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16993c150>]}
[0m13:11:17.742295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '067b9e31-b39f-4f85-bc3f-01ef5ed3391e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145900b50>]}
[0m13:11:17.742760 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:11:17.755070 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:11:17.824470 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m13:11:17.824818 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m13:11:17.895023 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_revenue_metrics' (models/staging/fact_revenue_metrics.sql) depends on a node named 'stg_contracts' which was not found
[0m13:11:17.897797 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0061436, "process_user_time": 1.555701, "process_kernel_time": 2.444704, "process_mem_max_rss": "184582144", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:11:17.898116 [debug] [MainThread]: Command `dbt run` failed at 13:11:17.898067 after 1.01 seconds
[0m13:11:17.898326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146081450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102856cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146060e90>]}
[0m13:11:17.898498 [debug] [MainThread]: Flushing usage events
[0m13:11:34.225377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a45ae10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a4bd5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a4bdc50>]}


============================== 13:11:34.228649 | 003890af-3112-41a9-98e4-62c5b3e4f91b ==============================
[0m13:11:34.228649 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:11:34.228975 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging dim_products', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:11:34.916332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f1eacd0>]}
[0m13:11:34.935272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128473050>]}
[0m13:11:34.935800 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:11:34.948267 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:11:35.008648 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m13:11:35.008929 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m13:11:35.127819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d17ee90>]}
[0m13:11:35.171112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f4655d0>]}
[0m13:11:35.171361 [info ] [MainThread]: Found 6 models, 1 seed, 3 sources, 563 macros
[0m13:11:35.171514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f76b790>]}
[0m13:11:35.172208 [info ] [MainThread]: 
[0m13:11:35.172434 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:11:35.174185 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m13:11:35.179773 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m13:11:35.180012 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m13:11:35.180136 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:11:35.724743 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.545 seconds
[0m13:11:35.726185 [debug] [ThreadPool]: On list_LB: Close
[0m13:11:35.833390 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m13:11:35.840842 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m13:11:35.841138 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m13:11:35.841359 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:11:36.259269 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.418 seconds
[0m13:11:36.263471 [debug] [ThreadPool]: On list_LB_stage: Close
[0m13:11:36.375779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9c1b90>]}
[0m13:11:36.376998 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:11:36.377648 [info ] [MainThread]: 
[0m13:11:36.380588 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m13:11:36.381356 [info ] [Thread-1 (]: 1 of 6 START sql table model stage.dim_date .................................... [RUN]
[0m13:11:36.381905 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m13:11:36.382299 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m13:11:36.391047 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m13:11:36.391940 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m13:11:36.412324 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m13:11:36.413115 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m13:11:36.413325 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- models/dimensions/dim_date.sql



with date_range as (
    select
        dateadd(day, seq4(), '2000-01-01') as date
    from table(generator(rowcount => 10000))  -- Adjust the row count as necessary
    where dateadd(day, seq4(), '2000-01-01') <= current_date()
)

select
    date as date,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    week(date) as week,
    to_char(date, 'Day') as weekday,
    case when to_char(date, 'D') in ('1', '7') then 'Weekend' else 'Weekday' end as day_type
from date_range
        );
[0m13:11:36.413498 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:11:38.158543 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.744 seconds
[0m13:11:38.183108 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m13:11:38.634633 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fa49d10>]}
[0m13:11:38.636960 [info ] [Thread-1 (]: 1 of 6 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 2.25s]
[0m13:11:38.638016 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m13:11:38.638759 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m13:11:38.640432 [info ] [Thread-1 (]: 2 of 6 START sql table model stage.stg_contract ................................ [RUN]
[0m13:11:38.640994 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m13:11:38.641422 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m13:11:38.645679 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:11:38.648006 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m13:11:38.650442 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:11:38.651406 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m13:11:38.651753 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m13:11:38.652082 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:11:40.199527 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.547 seconds
[0m13:11:40.205025 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m13:11:40.314115 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fb39190>]}
[0m13:11:40.318051 [info ] [Thread-1 (]: 2 of 6 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.67s]
[0m13:11:40.319943 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m13:11:40.320770 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m13:11:40.323521 [info ] [Thread-1 (]: 3 of 6 START sql table model stage.stg_prices .................................. [RUN]
[0m13:11:40.324158 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m13:11:40.324877 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m13:11:40.336833 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:11:40.337882 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m13:11:40.340115 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:11:40.340903 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m13:11:40.341136 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m13:11:40.341359 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:11:41.607338 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.265 seconds
[0m13:11:41.616346 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m13:11:41.725323 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f587550>]}
[0m13:11:41.726243 [info ] [Thread-1 (]: 3 of 6 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.40s]
[0m13:11:41.726986 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m13:11:41.727550 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m13:11:41.728187 [info ] [Thread-1 (]: 4 of 6 START sql table model stage.stg_products ................................ [RUN]
[0m13:11:41.728707 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m13:11:41.729105 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m13:11:41.733245 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m13:11:41.734085 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m13:11:41.737472 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m13:11:41.738620 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m13:11:41.738994 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m13:11:41.739302 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:11:43.033931 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.293 seconds
[0m13:11:43.039505 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m13:11:43.168933 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f752e10>]}
[0m13:11:43.171001 [info ] [Thread-1 (]: 4 of 6 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.44s]
[0m13:11:43.171910 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m13:11:43.175278 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m13:11:43.176323 [info ] [Thread-1 (]: 5 of 6 START sql table model stage.dim_products ................................ [RUN]
[0m13:11:43.177042 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m13:11:43.177460 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m13:11:43.183631 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m13:11:43.185074 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m13:11:43.187749 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m13:11:43.189036 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m13:11:43.189278 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and d.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m13:11:43.189485 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:11:44.111667 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.922 seconds
[0m13:11:44.114223 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m13:11:44.254414 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fb83650>]}
[0m13:11:44.255369 [info ] [Thread-1 (]: 5 of 6 OK created sql table model stage.dim_products ........................... [[32mSUCCESS 1[0m in 1.08s]
[0m13:11:44.255987 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m13:11:44.257095 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:11:44.257788 [info ] [Thread-1 (]: 6 of 6 START sql incremental model stage.fact_revenue_metrics .................. [RUN]
[0m13:11:44.258316 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_products, now model.snowflake_airflow_dbt.fact_revenue_metrics)
[0m13:11:44.258712 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:11:44.266989 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:11:44.268062 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:11:44.299571 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:11:44.299922 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_revenue_metrics"} */
create or replace  temporary view LB.stage.fact_revenue_metrics__dbt_tmp
  
   as (
    -- models/fact_revenue_metrics.sql



WITH valid_prices AS (
    SELECT
        p.productcode,
        p.productname,
        p.energy,
        p.consumptiontype,
        p.deleted,
        p.modificationdate,
        pr.productid,
        pr.pricecomponentid,
        pr.productcomponent,
        pr.price,
        pr.unit,
        pr.valid_from,
        pr.valid_until,
        pr.modificationdate AS price_modificationdate
    FROM LB.stage.stg_prices pr
    JOIN LB.stage.dim_products p
        ON pr.productid = p.product_id
    WHERE pr.valid_from <= CURRENT_DATE()
    AND (pr.valid_until IS NULL OR pr.valid_until >= CURRENT_DATE())
),

revenue_calculation AS (
    SELECT
        c.id AS contract_id,
        c.creation_date,
        c.startdate,
        c.enddate,
        c.status,
        c.city,
        c.total_consumption,  -- Directly using total_consumption from stg_contracts
        c.total_consumption * (p.total_working_revenue / 100) AS total_working_revenue,
        p.total_base_revenue,
        p.total_base_revenue + c.total_consumption * (p.total_working_revenue / 100) AS total_revenue
    FROM LB.stage.stg_contract c
    LEFT JOIN valid_prices p
        ON c.product_id = p.productid
    WHERE c.creation_date BETWEEN c.startdate AND COALESCE(c.enddate, c.creation_date)
)

SELECT
    rc.contract_id,
    rc.creation_date,
    rc.startdate,
    rc.enddate,
    rc.status,
    rc.city,
    rc.total_consumption,
    rc.total_working_revenue,
    rc.total_base_revenue,
    rc.total_revenue
FROM revenue_calculation rc


    WHERE rc.creation_date > (SELECT MAX(creation_date) FROM LB.stage.fact_revenue_metrics)

  );
[0m13:11:44.300142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:11:44.720642 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b592df-0202-d370-0002-d446000152ea
[0m13:11:44.721358 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 14 at position 8
invalid identifier 'P.DELETED'
[0m13:11:44.721945 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: Close
[0m13:11:44.840788 [debug] [Thread-1 (]: Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  000904 (42000): SQL compilation error: error line 14 at position 8
  invalid identifier 'P.DELETED'
[0m13:11:44.841884 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '003890af-3112-41a9-98e4-62c5b3e4f91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f788950>]}
[0m13:11:44.842965 [error] [Thread-1 (]: 6 of 6 ERROR creating sql incremental model stage.fact_revenue_metrics ......... [[31mERROR[0m in 0.58s]
[0m13:11:44.843839 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:11:44.846919 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:11:44.847486 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_revenue_metrics' was properly closed.
[0m13:11:44.848495 [info ] [MainThread]: 
[0m13:11:44.849217 [info ] [MainThread]: Finished running 5 table models, 1 incremental model in 0 hours 0 minutes and 9.68 seconds (9.68s).
[0m13:11:44.851398 [debug] [MainThread]: Command end result
[0m13:11:44.876479 [info ] [MainThread]: 
[0m13:11:44.876772 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:11:44.876908 [info ] [MainThread]: 
[0m13:11:44.877074 [error] [MainThread]:   Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  000904 (42000): SQL compilation error: error line 14 at position 8
  invalid identifier 'P.DELETED'
[0m13:11:44.877202 [info ] [MainThread]: 
[0m13:11:44.877352 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m13:11:44.880309 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 10.700497, "process_user_time": 2.025624, "process_kernel_time": 2.527366, "process_mem_max_rss": "196296704", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:11:44.880933 [debug] [MainThread]: Command `dbt run` failed at 13:11:44.880893 after 10.70 seconds
[0m13:11:44.881603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a496a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1010f2cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10116c250>]}
[0m13:11:44.881934 [debug] [MainThread]: Flushing usage events
[0m13:12:45.530985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e1184d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e1811d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e181850>]}


============================== 13:12:45.534351 | b4f7db5a-db3a-4f21-a437-4b7c5c27ea47 ==============================
[0m13:12:45.534351 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:12:45.534838 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select staging dim_products', 'send_anonymous_usage_stats': 'True'}
[0m13:12:46.310244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169bc7a10>]}
[0m13:12:46.329090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e14e250>]}
[0m13:12:46.329597 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:12:46.342479 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:12:46.407030 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:12:46.407378 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m13:12:46.531847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169bc79d0>]}
[0m13:12:46.581373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b11df10>]}
[0m13:12:46.581621 [info ] [MainThread]: Found 6 models, 1 seed, 3 sources, 563 macros
[0m13:12:46.581776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b22dc10>]}
[0m13:12:46.582465 [info ] [MainThread]: 
[0m13:12:46.582696 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:12:46.584460 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m13:12:46.589704 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m13:12:46.589872 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m13:12:46.589988 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:12:47.093205 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.503 seconds
[0m13:12:47.095259 [debug] [ThreadPool]: On list_LB: Close
[0m13:12:47.249117 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m13:12:47.260371 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m13:12:47.260637 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m13:12:47.260868 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:12:47.802141 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.541 seconds
[0m13:12:47.810875 [debug] [ThreadPool]: On list_LB_stage: Close
[0m13:12:47.925317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16af45250>]}
[0m13:12:47.926337 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:12:47.926804 [info ] [MainThread]: 
[0m13:12:47.929960 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m13:12:47.930695 [info ] [Thread-1 (]: 1 of 6 START sql table model stage.dim_date .................................... [RUN]
[0m13:12:47.931253 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m13:12:47.931628 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m13:12:47.938446 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m13:12:47.939164 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m13:12:47.957137 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m13:12:47.957917 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m13:12:47.958112 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- models/dimensions/dim_date.sql



with date_range as (
    select
        dateadd(day, seq4(), '2000-01-01') as date
    from table(generator(rowcount => 10000))  -- Adjust the row count as necessary
    where dateadd(day, seq4(), '2000-01-01') <= current_date()
)

select
    date as date,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    week(date) as week,
    to_char(date, 'Day') as weekday,
    case when to_char(date, 'D') in ('1', '7') then 'Weekend' else 'Weekday' end as day_type
from date_range
        );
[0m13:12:47.958281 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:12:49.077355 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.119 seconds
[0m13:12:49.099590 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m13:12:49.215822 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b748150>]}
[0m13:12:49.217213 [info ] [Thread-1 (]: 1 of 6 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 1.28s]
[0m13:12:49.218108 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m13:12:49.218636 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m13:12:49.219314 [info ] [Thread-1 (]: 2 of 6 START sql table model stage.stg_contract ................................ [RUN]
[0m13:12:49.219842 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m13:12:49.220256 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m13:12:49.225096 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:12:49.226170 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m13:12:49.228358 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:12:49.229199 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m13:12:49.229441 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m13:12:49.229675 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:12:50.410440 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.181 seconds
[0m13:12:50.412397 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m13:12:50.521464 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b858a90>]}
[0m13:12:50.522175 [info ] [Thread-1 (]: 2 of 6 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.30s]
[0m13:12:50.522622 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m13:12:50.522918 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m13:12:50.523170 [info ] [Thread-1 (]: 3 of 6 START sql table model stage.stg_prices .................................. [RUN]
[0m13:12:50.523576 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m13:12:50.523812 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m13:12:50.526303 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:12:50.526931 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m13:12:50.528442 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:12:50.528975 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m13:12:50.529166 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m13:12:50.529345 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:12:51.434904 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.905 seconds
[0m13:12:51.439707 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m13:12:51.549146 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b792dd0>]}
[0m13:12:51.550415 [info ] [Thread-1 (]: 3 of 6 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.03s]
[0m13:12:51.551625 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m13:12:51.552221 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m13:12:51.553831 [info ] [Thread-1 (]: 4 of 6 START sql table model stage.stg_products ................................ [RUN]
[0m13:12:51.554899 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m13:12:51.555411 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m13:12:51.560961 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m13:12:51.561637 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m13:12:51.563973 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m13:12:51.564772 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m13:12:51.565068 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m13:12:51.565365 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:12:52.438990 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.873 seconds
[0m13:12:52.444152 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m13:12:52.553667 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e140e10>]}
[0m13:12:52.554282 [info ] [Thread-1 (]: 4 of 6 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.00s]
[0m13:12:52.554656 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m13:12:52.555785 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m13:12:52.556101 [info ] [Thread-1 (]: 5 of 6 START sql table model stage.dim_products ................................ [RUN]
[0m13:12:52.556314 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m13:12:52.556458 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m13:12:52.560342 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m13:12:52.560988 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m13:12:52.562696 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m13:12:52.563811 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m13:12:52.564056 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and d.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m13:12:52.564263 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:12:53.686633 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.122 seconds
[0m13:12:53.689013 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m13:12:53.791596 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b776510>]}
[0m13:12:53.793009 [info ] [Thread-1 (]: 5 of 6 OK created sql table model stage.dim_products ........................... [[32mSUCCESS 1[0m in 1.23s]
[0m13:12:53.793956 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m13:12:53.795487 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:12:53.796305 [info ] [Thread-1 (]: 6 of 6 START sql incremental model stage.fact_revenue_metrics .................. [RUN]
[0m13:12:53.796896 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_products, now model.snowflake_airflow_dbt.fact_revenue_metrics)
[0m13:12:53.797292 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:12:53.804235 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:12:53.804747 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:12:53.821606 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:12:53.821896 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_revenue_metrics"} */
create or replace  temporary view LB.stage.fact_revenue_metrics__dbt_tmp
  
   as (
    -- models/fact_revenue_metrics.sql



WITH valid_prices AS (
    SELECT
        p.productcode,
        p.productname,
        p.energy,
        p.consumptiontype,
        p.modificationdate,
        pr.productid,
        pr.pricecomponentid,
        pr.productcomponent,
        pr.price,
        pr.unit,
        pr.valid_from,
        pr.valid_until,
        pr.modificationdate AS price_modificationdate
    FROM LB.stage.stg_prices pr
    JOIN LB.stage.dim_products p
        ON pr.productid = p.product_id
    WHERE pr.valid_from <= CURRENT_DATE()
    AND (pr.valid_until IS NULL OR pr.valid_until >= CURRENT_DATE())
),

revenue_calculation AS (
    SELECT
        c.id AS contract_id,
        c.creation_date,
        c.startdate,
        c.enddate,
        c.status,
        c.city,
        c.total_consumption,  -- Directly using total_consumption from stg_contracts
        c.total_consumption * (p.total_working_revenue / 100) AS total_working_revenue,
        p.total_base_revenue,
        p.total_base_revenue + c.total_consumption * (p.total_working_revenue / 100) AS total_revenue
    FROM LB.stage.stg_contract c
    LEFT JOIN valid_prices p
        ON c.product_id = p.productid
    WHERE c.creation_date BETWEEN c.startdate AND COALESCE(c.enddate, c.creation_date)
)

SELECT
    rc.contract_id,
    rc.creation_date,
    rc.startdate,
    rc.enddate,
    rc.status,
    rc.city,
    rc.total_consumption,
    rc.total_working_revenue,
    rc.total_base_revenue,
    rc.total_revenue
FROM revenue_calculation rc


    WHERE rc.creation_date > (SELECT MAX(creation_date) FROM LB.stage.fact_revenue_metrics)

  );
[0m13:12:53.822108 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:12:54.330174 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b592e0-0202-d36d-0002-d44600011302
[0m13:12:54.331008 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 33 at position 8
invalid identifier 'C.CREATION_DATE'
[0m13:12:54.331681 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: Close
[0m13:12:54.445425 [debug] [Thread-1 (]: Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  000904 (42000): SQL compilation error: error line 33 at position 8
  invalid identifier 'C.CREATION_DATE'
[0m13:12:54.446419 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4f7db5a-db3a-4f21-a437-4b7c5c27ea47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b06f050>]}
[0m13:12:54.447347 [error] [Thread-1 (]: 6 of 6 ERROR creating sql incremental model stage.fact_revenue_metrics ......... [[31mERROR[0m in 0.65s]
[0m13:12:54.448123 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:12:54.450974 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:12:54.451418 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_revenue_metrics' was properly closed.
[0m13:12:54.451873 [info ] [MainThread]: 
[0m13:12:54.452255 [info ] [MainThread]: Finished running 5 table models, 1 incremental model in 0 hours 0 minutes and 7.87 seconds (7.87s).
[0m13:12:54.453623 [debug] [MainThread]: Command end result
[0m13:12:54.488984 [info ] [MainThread]: 
[0m13:12:54.489324 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:12:54.489467 [info ] [MainThread]: 
[0m13:12:54.490128 [error] [MainThread]:   Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  000904 (42000): SQL compilation error: error line 33 at position 8
  invalid identifier 'C.CREATION_DATE'
[0m13:12:54.490763 [info ] [MainThread]: 
[0m13:12:54.491269 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m13:12:54.495369 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.996785, "process_user_time": 2.257628, "process_kernel_time": 2.378204, "process_mem_max_rss": "191807488", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:12:54.497662 [debug] [MainThread]: Command `dbt run` failed at 13:12:54.497393 after 9.00 seconds
[0m13:12:54.499541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e181850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10295ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fbf0350>]}
[0m13:12:54.499801 [debug] [MainThread]: Flushing usage events
[0m13:14:11.308096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145f96a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145fbd190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145fbd7d0>]}


============================== 13:14:11.310884 | 49ef95c5-26a2-42ff-80aa-d344882b9c17 ==============================
[0m13:14:11.310884 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:14:11.311170 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select staging dim_products', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:14:12.052244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abacd90>]}
[0m13:14:12.071255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145a00b10>]}
[0m13:14:12.071762 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:14:12.084019 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:14:12.148999 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:14:12.149339 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m13:14:12.294587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127b4d750>]}
[0m13:14:12.339118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae36fd0>]}
[0m13:14:12.339423 [info ] [MainThread]: Found 6 models, 1 seed, 3 sources, 563 macros
[0m13:14:12.339579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ace9ed0>]}
[0m13:14:12.340341 [info ] [MainThread]: 
[0m13:14:12.340589 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:14:12.342507 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m13:14:12.348303 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m13:14:12.348539 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m13:14:12.348671 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:14:12.876285 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.528 seconds
[0m13:14:12.877240 [debug] [ThreadPool]: On list_LB: Close
[0m13:14:12.977415 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m13:14:12.987249 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m13:14:12.987493 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m13:14:12.987624 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:14:13.393324 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.405 seconds
[0m13:14:13.397923 [debug] [ThreadPool]: On list_LB_stage: Close
[0m13:14:13.601324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ace8cd0>]}
[0m13:14:13.602376 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:14:13.602692 [info ] [MainThread]: 
[0m13:14:13.605423 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m13:14:13.606145 [info ] [Thread-1 (]: 1 of 6 START sql table model stage.dim_date .................................... [RUN]
[0m13:14:13.606646 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m13:14:13.606980 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m13:14:13.616372 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m13:14:13.617324 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m13:14:13.637511 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m13:14:13.639091 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m13:14:13.639764 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- models/dimensions/dim_date.sql



with date_range as (
    select
        dateadd(day, seq4(), '2000-01-01') as date
    from table(generator(rowcount => 10000))  -- Adjust the row count as necessary
    where dateadd(day, seq4(), '2000-01-01') <= current_date()
)

select
    date as date,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    week(date) as week,
    to_char(date, 'Day') as weekday,
    case when to_char(date, 'D') in ('1', '7') then 'Weekend' else 'Weekday' end as day_type
from date_range
        );
[0m13:14:13.640028 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:14:14.892380 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.252 seconds
[0m13:14:14.918075 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m13:14:15.036882 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1458d7b10>]}
[0m13:14:15.038304 [info ] [Thread-1 (]: 1 of 6 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 1.43s]
[0m13:14:15.039157 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m13:14:15.039833 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m13:14:15.040720 [info ] [Thread-1 (]: 2 of 6 START sql table model stage.stg_contract ................................ [RUN]
[0m13:14:15.041385 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m13:14:15.041822 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m13:14:15.046854 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:14:15.047905 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m13:14:15.050717 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:14:15.051763 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m13:14:15.052131 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m13:14:15.052477 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:14:16.221606 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.169 seconds
[0m13:14:16.226163 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m13:14:16.330747 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b457e50>]}
[0m13:14:16.332708 [info ] [Thread-1 (]: 2 of 6 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.29s]
[0m13:14:16.333491 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m13:14:16.334427 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m13:14:16.335974 [info ] [Thread-1 (]: 3 of 6 START sql table model stage.stg_prices .................................. [RUN]
[0m13:14:16.336526 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m13:14:16.336901 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m13:14:16.342515 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:14:16.343788 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m13:14:16.345996 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:14:16.346775 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m13:14:16.347039 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m13:14:16.347289 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:14:17.224011 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.876 seconds
[0m13:14:17.228077 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m13:14:17.352315 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16afc9150>]}
[0m13:14:17.354010 [info ] [Thread-1 (]: 3 of 6 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.02s]
[0m13:14:17.355401 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m13:14:17.356488 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m13:14:17.357804 [info ] [Thread-1 (]: 4 of 6 START sql table model stage.stg_products ................................ [RUN]
[0m13:14:17.358769 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m13:14:17.359344 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m13:14:17.365829 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m13:14:17.366998 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m13:14:17.370304 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m13:14:17.371374 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m13:14:17.371731 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m13:14:17.372059 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:14:18.315574 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.943 seconds
[0m13:14:18.319952 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m13:14:18.438908 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16afc9810>]}
[0m13:14:18.440509 [info ] [Thread-1 (]: 4 of 6 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.08s]
[0m13:14:18.441479 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m13:14:18.443526 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m13:14:18.444371 [info ] [Thread-1 (]: 5 of 6 START sql table model stage.dim_products ................................ [RUN]
[0m13:14:18.445116 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m13:14:18.445608 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m13:14:18.452427 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m13:14:18.453515 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m13:14:18.456057 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m13:14:18.458029 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m13:14:18.458400 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and d.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m13:14:18.458731 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:14:19.499014 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.040 seconds
[0m13:14:19.502505 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m13:14:19.613941 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b457e50>]}
[0m13:14:19.619117 [info ] [Thread-1 (]: 5 of 6 OK created sql table model stage.dim_products ........................... [[32mSUCCESS 1[0m in 1.17s]
[0m13:14:19.620451 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m13:14:19.622146 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:14:19.623240 [info ] [Thread-1 (]: 6 of 6 START sql incremental model stage.fact_revenue_metrics .................. [RUN]
[0m13:14:19.623958 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_products, now model.snowflake_airflow_dbt.fact_revenue_metrics)
[0m13:14:19.624361 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:14:19.638797 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:14:19.646731 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:14:19.690213 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:14:19.690572 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_revenue_metrics"} */
create or replace  temporary view LB.stage.fact_revenue_metrics__dbt_tmp
  
   as (
    -- models/fact_revenue_metrics.sql



WITH valid_prices AS (
    SELECT
        p.productcode,
        p.productname,
        p.energy,
        p.consumptiontype,
        p.modificationdate,
        pr.productid,
        pr.pricecomponentid,
        pr.productcomponent,
        pr.price,
        pr.unit,
        pr.valid_from,
        pr.valid_until,
        pr.modificationdate AS price_modificationdate
    FROM LB.stage.stg_prices pr
    JOIN LB.stage.dim_products p
        ON pr.productid = p.product_id
    WHERE pr.valid_from <= CURRENT_DATE()
    AND (pr.valid_until IS NULL OR pr.valid_until >= CURRENT_DATE())
),

revenue_calculation AS (
    SELECT
        c.id AS contract_id,
        c.CREATEDAT,
        c.startdate,
        c.enddate,
        c.status,
        c.city,
        c.total_consumption,  -- Directly using total_consumption from stg_contracts
        c.total_consumption * (p.total_working_revenue / 100) AS total_working_revenue,
        p.total_base_revenue,
        p.total_base_revenue + c.total_consumption * (p.total_working_revenue / 100) AS total_revenue
    FROM LB.stage.stg_contract c
    LEFT JOIN valid_prices p
        ON c.product_id = p.productid
    WHERE c.creation_date BETWEEN c.startdate AND COALESCE(c.enddate, c.creation_date)
)

SELECT
    rc.contract_id,
    rc.creation_date,
    rc.startdate,
    rc.enddate,
    rc.status,
    rc.city,
    rc.total_consumption,
    rc.total_working_revenue,
    rc.total_base_revenue,
    rc.total_revenue
FROM revenue_calculation rc


    WHERE rc.creation_date > (SELECT MAX(creation_date) FROM LB.stage.fact_revenue_metrics)

  );
[0m13:14:19.690804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:14:20.171921 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b592e2-0202-d36d-0002-d44600011312
[0m13:14:20.174790 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 38 at position 8
invalid identifier 'C.TOTAL_CONSUMPTION'
[0m13:14:20.177508 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: Close
[0m13:14:20.303168 [debug] [Thread-1 (]: Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  000904 (42000): SQL compilation error: error line 38 at position 8
  invalid identifier 'C.TOTAL_CONSUMPTION'
[0m13:14:20.304181 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49ef95c5-26a2-42ff-80aa-d344882b9c17', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b356d50>]}
[0m13:14:20.305212 [error] [Thread-1 (]: 6 of 6 ERROR creating sql incremental model stage.fact_revenue_metrics ......... [[31mERROR[0m in 0.68s]
[0m13:14:20.305956 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:14:20.308745 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:14:20.309209 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_revenue_metrics' was properly closed.
[0m13:14:20.309747 [info ] [MainThread]: 
[0m13:14:20.310136 [info ] [MainThread]: Finished running 5 table models, 1 incremental model in 0 hours 0 minutes and 7.97 seconds (7.97s).
[0m13:14:20.311551 [debug] [MainThread]: Command end result
[0m13:14:20.345839 [info ] [MainThread]: 
[0m13:14:20.346172 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:14:20.346312 [info ] [MainThread]: 
[0m13:14:20.346492 [error] [MainThread]:   Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  000904 (42000): SQL compilation error: error line 38 at position 8
  invalid identifier 'C.TOTAL_CONSUMPTION'
[0m13:14:20.346627 [info ] [MainThread]: 
[0m13:14:20.346772 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m13:14:20.348523 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 9.06949, "process_user_time": 2.743508, "process_kernel_time": 2.051159, "process_mem_max_rss": "193380352", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:14:20.348865 [debug] [MainThread]: Command `dbt run` failed at 13:14:20.348829 after 9.07 seconds
[0m13:14:20.349145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1027d6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b4cadd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127d39cd0>]}
[0m13:14:20.349345 [debug] [MainThread]: Flushing usage events
[0m13:16:21.292324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bd1ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bd812d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bd81910>]}


============================== 13:16:21.295151 | 4ad3e470-36be-4d02-b002-201e1d38d86f ==============================
[0m13:16:21.295151 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:16:21.295455 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging dim_products', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:16:22.008644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4ad3e470-36be-4d02-b002-201e1d38d86f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bd1dc50>]}
[0m13:16:22.034845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4ad3e470-36be-4d02-b002-201e1d38d86f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b500c90>]}
[0m13:16:22.035870 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:16:22.052477 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:16:22.123265 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:16:22.123646 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m13:16:22.187980 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_revenue_metrics' (models/staging/fact_revenue_metrics.sql) depends on a node named 'stg_contracts' which was not found
[0m13:16:22.189666 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.92738, "process_user_time": 1.780005, "process_kernel_time": 2.097097, "process_mem_max_rss": "180764672", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:16:22.189995 [debug] [MainThread]: Command `dbt run` failed at 13:16:22.189944 after 0.93 seconds
[0m13:16:22.190193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bd60210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a22cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bd1f090>]}
[0m13:16:22.190371 [debug] [MainThread]: Flushing usage events
[0m13:16:38.588873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143d97290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143db5890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143db5f10>]}


============================== 13:16:38.591476 | cbe267b6-d149-446a-aee8-e99c2e1a4100 ==============================
[0m13:16:38.591476 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:16:38.591787 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select staging dim_products', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:16:39.224528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168c4bd50>]}
[0m13:16:39.244532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134e73150>]}
[0m13:16:39.245274 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:16:39.257852 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:16:39.318998 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:16:39.319386 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m13:16:39.451357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168fa14d0>]}
[0m13:16:39.497929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168cf2290>]}
[0m13:16:39.498194 [info ] [MainThread]: Found 6 models, 1 seed, 3 sources, 563 macros
[0m13:16:39.498351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168d6b510>]}
[0m13:16:39.499083 [info ] [MainThread]: 
[0m13:16:39.499333 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:16:39.501391 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m13:16:39.506953 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m13:16:39.507165 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m13:16:39.507286 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:16:40.006444 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.499 seconds
[0m13:16:40.007613 [debug] [ThreadPool]: On list_LB: Close
[0m13:16:40.111965 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m13:16:40.119883 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m13:16:40.120273 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m13:16:40.120545 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:16:40.483504 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.363 seconds
[0m13:16:40.486473 [debug] [ThreadPool]: On list_LB_stage: Close
[0m13:16:40.594890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168e62f90>]}
[0m13:16:40.595907 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:16:40.596508 [info ] [MainThread]: 
[0m13:16:40.598837 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m13:16:40.599232 [info ] [Thread-1 (]: 1 of 6 START sql table model stage.dim_date .................................... [RUN]
[0m13:16:40.599489 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m13:16:40.599665 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m13:16:40.604993 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m13:16:40.605575 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m13:16:40.622321 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m13:16:40.623116 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m13:16:40.623315 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- models/dimensions/dim_date.sql



with date_range as (
    select
        dateadd(day, seq4(), '2000-01-01') as date
    from table(generator(rowcount => 10000))  -- Adjust the row count as necessary
    where dateadd(day, seq4(), '2000-01-01') <= current_date()
)

select
    date as date,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    week(date) as week,
    to_char(date, 'Day') as weekday,
    case when to_char(date, 'D') in ('1', '7') then 'Weekend' else 'Weekday' end as day_type
from date_range
        );
[0m13:16:40.623492 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:41.636436 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.013 seconds
[0m13:16:41.658427 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m13:16:41.777826 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169328f10>]}
[0m13:16:41.779107 [info ] [Thread-1 (]: 1 of 6 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 1.18s]
[0m13:16:41.780052 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m13:16:41.780609 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m13:16:41.781312 [info ] [Thread-1 (]: 2 of 6 START sql table model stage.stg_contract ................................ [RUN]
[0m13:16:41.781819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m13:16:41.782212 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m13:16:41.786668 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:16:41.787739 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m13:16:41.790155 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:16:41.792344 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m13:16:41.792600 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m13:16:41.792782 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:42.962045 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.169 seconds
[0m13:16:42.964467 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m13:16:43.070492 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169372c90>]}
[0m13:16:43.071116 [info ] [Thread-1 (]: 2 of 6 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.29s]
[0m13:16:43.071426 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m13:16:43.071655 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m13:16:43.071972 [info ] [Thread-1 (]: 3 of 6 START sql table model stage.stg_prices .................................. [RUN]
[0m13:16:43.072163 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m13:16:43.072304 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m13:16:43.075775 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:16:43.076379 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m13:16:43.077596 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:16:43.078164 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m13:16:43.078382 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m13:16:43.078563 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:44.082196 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.003 seconds
[0m13:16:44.085370 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m13:16:44.192447 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169458ed0>]}
[0m13:16:44.193490 [info ] [Thread-1 (]: 3 of 6 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.12s]
[0m13:16:44.194151 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m13:16:44.194611 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m13:16:44.195276 [info ] [Thread-1 (]: 4 of 6 START sql table model stage.stg_products ................................ [RUN]
[0m13:16:44.195802 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m13:16:44.196129 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m13:16:44.199626 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m13:16:44.200418 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m13:16:44.202686 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m13:16:44.203533 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m13:16:44.203825 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m13:16:44.204083 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:45.215293 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.011 seconds
[0m13:16:45.218782 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m13:16:45.329700 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16945a7d0>]}
[0m13:16:45.330856 [info ] [Thread-1 (]: 4 of 6 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.13s]
[0m13:16:45.331751 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m13:16:45.333235 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m13:16:45.334093 [info ] [Thread-1 (]: 5 of 6 START sql table model stage.dim_products ................................ [RUN]
[0m13:16:45.334771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m13:16:45.335338 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m13:16:45.340331 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m13:16:45.341522 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m13:16:45.344032 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m13:16:45.345356 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m13:16:45.345593 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and d.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m13:16:45.345782 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:46.444628 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.099 seconds
[0m13:16:46.451041 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m13:16:46.565315 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1691173d0>]}
[0m13:16:46.566725 [info ] [Thread-1 (]: 5 of 6 OK created sql table model stage.dim_products ........................... [[32mSUCCESS 1[0m in 1.23s]
[0m13:16:46.567713 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m13:16:46.568439 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:16:46.569236 [info ] [Thread-1 (]: 6 of 6 START sql view model stage.fact_revenue_metrics ......................... [RUN]
[0m13:16:46.569821 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_products, now model.snowflake_airflow_dbt.fact_revenue_metrics)
[0m13:16:46.570226 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:16:46.578310 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:16:46.579201 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:16:46.589582 [debug] [Thread-1 (]: Dropping relation "LB"."STAGE"."FACT_REVENUE_METRICS" because it is of type table
[0m13:16:46.598662 [debug] [Thread-1 (]: Applying DROP to: "LB"."STAGE"."FACT_REVENUE_METRICS"
[0m13:16:46.603479 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:16:46.603813 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_revenue_metrics"} */
drop table if exists "LB"."STAGE"."FACT_REVENUE_METRICS" cascade
[0m13:16:46.603979 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:47.011625 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.404 seconds
[0m13:16:47.031895 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:16:47.033042 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:16:47.033260 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_revenue_metrics"} */
create or replace   view LB.stage.fact_revenue_metrics
  
   as (
    WITH contract_data AS (
    SELECT
        c.id AS contract_id,
        c.productid AS product_id,
        c.createdat AS creation_date,
        c.startdate,
        c.enddate,
        c.status,
        c.city,
        c.usage AS total_consumption
    FROM LB.stage.stg_contract c
),

product_prices AS (
    SELECT
        p.productid AS product_id,
        MAX(CASE WHEN pc.productcomponent = 'baseprice' THEN pc.price ELSE NULL END) AS base_price,
        MAX(CASE WHEN pc.productcomponent = 'workingprice' THEN pc.price ELSE NULL END) AS working_price
    FROM LB.stage.stg_products p
    JOIN LB.stage.stg_prices pc
    ON p.id = pc.productid
    GROUP BY p.productid
),

revenue_data AS (
    SELECT
        cd.contract_id,
        cd.product_id,
        cd.creation_date,
        cd.startdate,
        cd.enddate,
        cd.status,
        cd.city,
        cd.total_consumption,
        pp.base_price,
        pp.working_price,
        pp.base_price + (cd.total_consumption * pp.working_price) AS total_revenue
    FROM contract_data cd
    JOIN product_prices pp
    ON cd.product_id = pp.product_id
)

SELECT
    contract_id,
    product_id,
    creation_date,
    startdate,
    enddate,
    status,
    city,
    total_consumption,
    working_price * total_consumption AS total_working_revenue,
    base_price AS total_base_revenue,
    total_revenue
FROM revenue_data;
[0m13:16:47.254447 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b592e4-0202-d36c-0002-d446000143c2
[0m13:16:47.254694 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 58 at position 17 unexpected ';'.
[0m13:16:47.254919 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: Close
[0m13:16:47.385960 [debug] [Thread-1 (]: Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  001003 (42000): SQL compilation error:
  syntax error line 58 at position 17 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/fact_revenue_metrics.sql
[0m13:16:47.386813 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cbe267b6-d149-446a-aee8-e99c2e1a4100', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168cf2c10>]}
[0m13:16:47.387622 [error] [Thread-1 (]: 6 of 6 ERROR creating sql view model stage.fact_revenue_metrics ................ [[31mERROR[0m in 0.82s]
[0m13:16:47.388295 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:16:47.390590 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:16:47.390902 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_revenue_metrics' was properly closed.
[0m13:16:47.391311 [info ] [MainThread]: 
[0m13:16:47.391629 [info ] [MainThread]: Finished running 5 table models, 1 view model in 0 hours 0 minutes and 7.89 seconds (7.89s).
[0m13:16:47.392508 [debug] [MainThread]: Command end result
[0m13:16:47.410521 [info ] [MainThread]: 
[0m13:16:47.410783 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:16:47.410914 [info ] [MainThread]: 
[0m13:16:47.411088 [error] [MainThread]:   Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  001003 (42000): SQL compilation error:
  syntax error line 58 at position 17 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/fact_revenue_metrics.sql
[0m13:16:47.411214 [info ] [MainThread]: 
[0m13:16:47.411354 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m13:16:47.413114 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.851353, "process_user_time": 2.090613, "process_kernel_time": 2.537444, "process_mem_max_rss": "195624960", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:16:47.413415 [debug] [MainThread]: Command `dbt run` failed at 13:16:47.413381 after 8.85 seconds
[0m13:16:47.414504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143d97990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1006b6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143d9d110>]}
[0m13:16:47.414716 [debug] [MainThread]: Flushing usage events
[0m13:17:43.129838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16871abd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1687811d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168781850>]}


============================== 13:17:43.132149 | da253a3f-369c-44b9-a7f8-77d5c7cd8d45 ==============================
[0m13:17:43.132149 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:17:43.132411 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select staging dim_products', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:17:43.810354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168dfc190>]}
[0m13:17:43.830529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e1e15d0>]}
[0m13:17:43.831332 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:17:43.843970 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:17:43.907241 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:17:43.907553 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m13:17:44.031846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e5a6d90>]}
[0m13:17:44.077223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e490850>]}
[0m13:17:44.077478 [info ] [MainThread]: Found 6 models, 1 seed, 3 sources, 563 macros
[0m13:17:44.077630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e5de410>]}
[0m13:17:44.078332 [info ] [MainThread]: 
[0m13:17:44.078567 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:17:44.080291 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m13:17:44.086064 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m13:17:44.086426 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m13:17:44.086578 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:17:44.549624 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.463 seconds
[0m13:17:44.550598 [debug] [ThreadPool]: On list_LB: Close
[0m13:17:44.661133 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m13:17:44.666704 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m13:17:44.666913 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m13:17:44.667077 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:17:45.057715 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.391 seconds
[0m13:17:45.061555 [debug] [ThreadPool]: On list_LB_stage: Close
[0m13:17:45.182021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e70e150>]}
[0m13:17:45.183070 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:17:45.183617 [info ] [MainThread]: 
[0m13:17:45.187061 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m13:17:45.187764 [info ] [Thread-1 (]: 1 of 6 START sql table model stage.dim_date .................................... [RUN]
[0m13:17:45.188282 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m13:17:45.188665 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m13:17:45.194955 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m13:17:45.195872 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m13:17:45.213206 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m13:17:45.214328 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m13:17:45.214536 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- models/dimensions/dim_date.sql



with date_range as (
    select
        dateadd(day, seq4(), '2000-01-01') as date
    from table(generator(rowcount => 10000))  -- Adjust the row count as necessary
    where dateadd(day, seq4(), '2000-01-01') <= current_date()
)

select
    date as date,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    week(date) as week,
    to_char(date, 'Day') as weekday,
    case when to_char(date, 'D') in ('1', '7') then 'Weekend' else 'Weekday' end as day_type
from date_range
        );
[0m13:17:45.214706 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:46.109801 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.895 seconds
[0m13:17:46.139336 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m13:17:46.256780 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17bd49610>]}
[0m13:17:46.257914 [info ] [Thread-1 (]: 1 of 6 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 1.07s]
[0m13:17:46.258818 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m13:17:46.259412 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m13:17:46.260216 [info ] [Thread-1 (]: 2 of 6 START sql table model stage.stg_contract ................................ [RUN]
[0m13:17:46.260939 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m13:17:46.261443 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m13:17:46.266341 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:17:46.267237 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m13:17:46.269166 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:17:46.270165 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m13:17:46.270366 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m13:17:46.270582 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:47.301708 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.027 seconds
[0m13:17:47.329600 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m13:17:47.447464 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168740690>]}
[0m13:17:47.451191 [info ] [Thread-1 (]: 2 of 6 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.18s]
[0m13:17:47.452782 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m13:17:47.453352 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m13:17:47.454524 [info ] [Thread-1 (]: 3 of 6 START sql table model stage.stg_prices .................................. [RUN]
[0m13:17:47.454847 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m13:17:47.455054 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m13:17:47.466318 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:17:47.467122 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m13:17:47.469350 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:17:47.470413 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m13:17:47.470872 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m13:17:47.471079 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:48.511576 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.040 seconds
[0m13:17:48.515366 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m13:17:48.623745 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16879e450>]}
[0m13:17:48.624440 [info ] [Thread-1 (]: 3 of 6 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.17s]
[0m13:17:48.624808 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m13:17:48.625031 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m13:17:48.625307 [info ] [Thread-1 (]: 4 of 6 START sql table model stage.stg_products ................................ [RUN]
[0m13:17:48.625512 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m13:17:48.625654 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m13:17:48.627655 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m13:17:48.628255 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m13:17:48.629617 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m13:17:48.630103 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m13:17:48.630259 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m13:17:48.630404 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:49.625684 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.995 seconds
[0m13:17:49.627866 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m13:17:49.742086 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e5a86d0>]}
[0m13:17:49.743347 [info ] [Thread-1 (]: 4 of 6 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.12s]
[0m13:17:49.744075 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m13:17:49.747081 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m13:17:49.747732 [info ] [Thread-1 (]: 5 of 6 START sql table model stage.dim_products ................................ [RUN]
[0m13:17:49.748078 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m13:17:49.748249 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m13:17:49.751172 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m13:17:49.753018 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m13:17:49.755019 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m13:17:49.756385 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m13:17:49.756677 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and d.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m13:17:49.756879 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:50.956981 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.200 seconds
[0m13:17:50.958497 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m13:17:51.067961 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e726990>]}
[0m13:17:51.069343 [info ] [Thread-1 (]: 5 of 6 OK created sql table model stage.dim_products ........................... [[32mSUCCESS 1[0m in 1.32s]
[0m13:17:51.070097 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m13:17:51.070587 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:17:51.071020 [info ] [Thread-1 (]: 6 of 6 START sql view model stage.fact_revenue_metrics ......................... [RUN]
[0m13:17:51.071309 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_products, now model.snowflake_airflow_dbt.fact_revenue_metrics)
[0m13:17:51.071479 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:17:51.074321 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:17:51.074961 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:17:51.086666 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:17:51.088629 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:17:51.088933 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_revenue_metrics"} */
create or replace   view LB.stage.fact_revenue_metrics
  
   as (
    WITH contract_data AS (
    SELECT
        c.id AS contract_id,
        c.productid AS product_id,
        c.createdat AS creation_date,
        c.startdate,
        c.enddate,
        c.status,
        c.city,
        c.usage AS total_consumption
    FROM LB.stage.stg_contract c
),

product_prices AS (
    SELECT
        p.productid AS product_id,
        MAX(CASE WHEN pc.productcomponent = 'baseprice' THEN pc.price ELSE NULL END) AS base_price,
        MAX(CASE WHEN pc.productcomponent = 'workingprice' THEN pc.price ELSE NULL END) AS working_price
    FROM LB.stage.stg_products p
    JOIN LB.stage.stg_prices pc
    ON p.id = pc.productid
    GROUP BY p.productid
),

revenue_data AS (
    SELECT
        cd.contract_id,
        cd.product_id,
        cd.creation_date,
        cd.startdate,
        cd.enddate,
        cd.status,
        cd.city,
        cd.total_consumption,
        pp.base_price,
        pp.working_price,
        pp.base_price + (cd.total_consumption * pp.working_price) AS total_revenue
    FROM contract_data cd
    JOIN product_prices pp
    ON cd.product_id = pp.product_id
)
SELECT
    contract_id,
    product_id,
    creation_date,
    startdate,
    enddate,
    status,
    city,
    total_consumption,
    working_price * total_consumption AS total_working_revenue,
    base_price AS total_base_revenue,
    total_revenue
FROM revenue_data;
[0m13:17:51.089143 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:51.520231 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b592e5-0202-d36d-0002-d44600011316
[0m13:17:51.521251 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 57 at position 17 unexpected ';'.
[0m13:17:51.522062 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: Close
[0m13:17:51.680409 [debug] [Thread-1 (]: Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  001003 (42000): SQL compilation error:
  syntax error line 57 at position 17 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/fact_revenue_metrics.sql
[0m13:17:51.681131 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da253a3f-369c-44b9-a7f8-77d5c7cd8d45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17bea7b50>]}
[0m13:17:51.681733 [error] [Thread-1 (]: 6 of 6 ERROR creating sql view model stage.fact_revenue_metrics ................ [[31mERROR[0m in 0.61s]
[0m13:17:51.682286 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:17:51.684521 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:17:51.684916 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_revenue_metrics' was properly closed.
[0m13:17:51.685336 [info ] [MainThread]: 
[0m13:17:51.685666 [info ] [MainThread]: Finished running 5 table models, 1 view model in 0 hours 0 minutes and 7.61 seconds (7.61s).
[0m13:17:51.686864 [debug] [MainThread]: Command end result
[0m13:17:51.712694 [info ] [MainThread]: 
[0m13:17:51.712965 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:17:51.713100 [info ] [MainThread]: 
[0m13:17:51.713281 [error] [MainThread]:   Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  001003 (42000): SQL compilation error:
  syntax error line 57 at position 17 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/fact_revenue_metrics.sql
[0m13:17:51.713414 [info ] [MainThread]: 
[0m13:17:51.713560 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m13:17:51.715139 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.613453, "process_user_time": 2.070338, "process_kernel_time": 2.600149, "process_mem_max_rss": "195510272", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:17:51.715773 [debug] [MainThread]: Command `dbt run` failed at 13:17:51.715730 after 8.61 seconds
[0m13:17:51.716029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168760650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e16fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17bd36f90>]}
[0m13:17:51.716189 [debug] [MainThread]: Flushing usage events
[0m13:18:46.773694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127b96f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127bb9150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127bb9790>]}


============================== 13:18:46.777500 | 77dd0b91-3030-4903-9871-65619320e0b2 ==============================
[0m13:18:46.777500 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:18:46.777774 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select staging dim_products', 'send_anonymous_usage_stats': 'True'}
[0m13:18:47.542000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '77dd0b91-3030-4903-9871-65619320e0b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127be3110>]}
[0m13:18:47.562293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '77dd0b91-3030-4903-9871-65619320e0b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121b00dd0>]}
[0m13:18:47.563002 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:18:47.577051 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:18:47.641198 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:18:47.641516 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m13:18:47.699085 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_revenue_metrics' (models/staging/fact_revenue_metrics.sql) depends on a node named 'stg_contracts' which was not found
[0m13:18:47.700690 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.9933092, "process_user_time": 1.939108, "process_kernel_time": 1.599586, "process_mem_max_rss": "185335808", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:18:47.700984 [debug] [MainThread]: Command `dbt run` failed at 13:18:47.700939 after 0.99 seconds
[0m13:18:47.701164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121df0810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10037acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1688af5d0>]}
[0m13:18:47.701323 [debug] [MainThread]: Flushing usage events
[0m13:19:06.183247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1401b1610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143d80e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143d814d0>]}


============================== 13:19:06.185883 | fb33822a-f8b1-47d1-a9bc-67695b84d357 ==============================
[0m13:19:06.185883 [info ] [MainThread]: Running with dbt=1.8.0
[0m13:19:06.186186 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select staging dim_products', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:19:06.813108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168888610>]}
[0m13:19:06.833022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140073350>]}
[0m13:19:06.833646 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m13:19:06.846134 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m13:19:06.955463 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:19:06.955883 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m13:19:07.242405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168cfee10>]}
[0m13:19:07.430167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168b5bb50>]}
[0m13:19:07.430586 [info ] [MainThread]: Found 6 models, 1 seed, 3 sources, 563 macros
[0m13:19:07.430979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168b6ea50>]}
[0m13:19:07.432427 [info ] [MainThread]: 
[0m13:19:07.432832 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:19:07.435308 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m13:19:07.444816 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m13:19:07.445121 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m13:19:07.445269 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:19:08.058284 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.613 seconds
[0m13:19:08.062529 [debug] [ThreadPool]: On list_LB: Close
[0m13:19:08.187076 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m13:19:08.199912 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m13:19:08.200491 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m13:19:08.200839 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:19:08.651857 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.451 seconds
[0m13:19:08.654999 [debug] [ThreadPool]: On list_LB_stage: Close
[0m13:19:08.780689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1432eb150>]}
[0m13:19:08.782060 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m13:19:08.782739 [info ] [MainThread]: 
[0m13:19:08.786408 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m13:19:08.787214 [info ] [Thread-1 (]: 1 of 6 START sql table model stage.dim_date .................................... [RUN]
[0m13:19:08.787948 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m13:19:08.788421 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m13:19:08.794654 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m13:19:08.795507 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m13:19:08.812405 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m13:19:08.813323 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m13:19:08.813545 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- models/dimensions/dim_date.sql



with date_range as (
    select
        dateadd(day, seq4(), '2000-01-01') as date
    from table(generator(rowcount => 10000))  -- Adjust the row count as necessary
    where dateadd(day, seq4(), '2000-01-01') <= current_date()
)

select
    date as date,
    year(date) as year,
    month(date) as month,
    day(date) as day,
    week(date) as week,
    to_char(date, 'Day') as weekday,
    case when to_char(date, 'D') in ('1', '7') then 'Weekend' else 'Weekday' end as day_type
from date_range
        );
[0m13:19:08.813733 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:19:09.747032 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.933 seconds
[0m13:19:09.759094 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m13:19:09.927215 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16916ff90>]}
[0m13:19:09.928068 [info ] [Thread-1 (]: 1 of 6 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 1.14s]
[0m13:19:09.928677 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m13:19:09.929123 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m13:19:09.930697 [info ] [Thread-1 (]: 2 of 6 START sql table model stage.stg_contract ................................ [RUN]
[0m13:19:09.931258 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m13:19:09.931692 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m13:19:09.938725 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:19:09.939881 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m13:19:09.943177 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m13:19:09.945778 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m13:19:09.946628 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace transient table LB.stage.stg_contract
         as
        (

SELECT
    ID,
    TYPE,
    ENERGY,
    USAGE,
    USAGENET,
    CREATEDAT,
    STARTDATE,
    ENDDATE,
    FILLINGDATECANCELLATION,
    CANCELLATIONREASON,
    CITY,
    STATUS,
    PRODUCTID,
    MODIFICATIONDATE
FROM lb.raw.contract
        );
[0m13:19:09.947364 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:19:11.061947 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.114 seconds
[0m13:19:11.067328 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m13:19:11.183581 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169151250>]}
[0m13:19:11.186535 [info ] [Thread-1 (]: 2 of 6 OK created sql table model stage.stg_contract ........................... [[32mSUCCESS 1[0m in 1.25s]
[0m13:19:11.187455 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m13:19:11.187919 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m13:19:11.188914 [info ] [Thread-1 (]: 3 of 6 START sql table model stage.stg_prices .................................. [RUN]
[0m13:19:11.189320 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m13:19:11.189531 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m13:19:11.200916 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:19:11.201821 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m13:19:11.204013 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m13:19:11.205208 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m13:19:11.205579 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace transient table LB.stage.stg_prices
         as
        (

SELECT
    ID,
    PRODUCTID,
    PRICECOMPONENTID,
    PRODUCTCOMPONENT,
    PRICE,
    UNIT,
    VALID_FROM,
    VALID_UNTIL,
    MODIFICATIONDATE
FROM lb.raw.prices
        );
[0m13:19:11.205852 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:19:12.108456 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.902 seconds
[0m13:19:12.112121 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m13:19:12.223822 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169140310>]}
[0m13:19:12.224799 [info ] [Thread-1 (]: 3 of 6 OK created sql table model stage.stg_prices ............................. [[32mSUCCESS 1[0m in 1.03s]
[0m13:19:12.225396 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m13:19:12.225981 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m13:19:12.226726 [info ] [Thread-1 (]: 4 of 6 START sql table model stage.stg_products ................................ [RUN]
[0m13:19:12.227301 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m13:19:12.227662 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m13:19:12.232239 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m13:19:12.233271 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m13:19:12.236766 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m13:19:12.238362 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m13:19:12.238701 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace transient table LB.stage.stg_products
         as
        (


SELECT
    ID,
    PRODUCTCODE,
    PRODUCTNAME,
    ENERGY,
    CONSUMPTIONTYPE,
    DELETED,
    MODIFICATIONDATE
FROM lb.raw.products
        );
[0m13:19:12.238890 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:19:13.144485 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.905 seconds
[0m13:19:13.150033 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m13:19:13.313615 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169239b50>]}
[0m13:19:13.315125 [info ] [Thread-1 (]: 4 of 6 OK created sql table model stage.stg_products ........................... [[32mSUCCESS 1[0m in 1.09s]
[0m13:19:13.316173 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m13:19:13.318001 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_products
[0m13:19:13.318677 [info ] [Thread-1 (]: 5 of 6 START sql table model stage.dim_products ................................ [RUN]
[0m13:19:13.319196 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_products)
[0m13:19:13.319571 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_products
[0m13:19:13.323833 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_products"
[0m13:19:13.324720 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_products
[0m13:19:13.326168 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_products"
[0m13:19:13.327190 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_products"
[0m13:19:13.327416 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_products"} */
create or replace transient table LB.stage.dim_products
         as
        (-- models/dimensions/dim_product_scd2.sql



with base as (
    select
        id as product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate
    from LB.stage.stg_products
),

historized as (
    select
        product_id,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        current_date() as effective_from,
        null as effective_to,
        'Active' as record_status
    from base
    where not exists (
        select 1
        from LB.stage.dim_products d
        where d.product_id = base.product_id
        and d.effective_to is null
    )
    union all
    select
        b.product_id,
        b.productcode,
        b.productname,
        b.energy,
        b.consumptiontype,
        b.modificationdate,
        d.effective_from,
        current_date() as effective_to,
        'Inactive' as record_status
    from base b
    join LB.stage.dim_products d
        on b.product_id = d.product_id
        and d.effective_to is null
        and (b.modificationdate > d.modificationdate or (b.modificationdate = d.modificationdate and d.record_status = 'Inactive'))
)

select
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    effective_from,
    effective_to,
    record_status
from historized
        );
[0m13:19:13.327625 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:19:14.468877 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.141 seconds
[0m13:19:14.471782 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_products: Close
[0m13:19:14.579123 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16912a5d0>]}
[0m13:19:14.580050 [info ] [Thread-1 (]: 5 of 6 OK created sql table model stage.dim_products ........................... [[32mSUCCESS 1[0m in 1.26s]
[0m13:19:14.580761 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_products
[0m13:19:14.581188 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:19:14.581738 [info ] [Thread-1 (]: 6 of 6 START sql view model stage.fact_revenue_metrics ......................... [RUN]
[0m13:19:14.582239 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_products, now model.snowflake_airflow_dbt.fact_revenue_metrics)
[0m13:19:14.582627 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:19:14.587853 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:19:14.589113 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:19:14.604288 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:19:14.605679 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_revenue_metrics"
[0m13:19:14.605926 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_revenue_metrics"} */
create or replace   view LB.stage.fact_revenue_metrics
  
   as (
    WITH contract_data AS (
    SELECT
        c.id AS contract_id,
        c.productid AS product_id,
        c.createdat AS creation_date,
        c.startdate,
        c.enddate,
        c.status,
        c.city,
        c.usage AS total_consumption
    FROM LB.stage.stg_contract c
),

product_prices AS (
    SELECT
        p.id AS product_id,
        MAX(CASE WHEN pc.productcomponent = 'baseprice' THEN pc.price ELSE NULL END) AS base_price,
        MAX(CASE WHEN pc.productcomponent = 'workingprice' THEN pc.price ELSE NULL END) AS working_price
    FROM LB.stage.stg_products p
    JOIN LB.stage.stg_prices pc
    ON p.id = pc.productid
    GROUP BY p.id
),

revenue_data AS (
    SELECT
        cd.contract_id,
        cd.product_id,
        cd.creation_date,
        cd.startdate,
        cd.enddate,
        cd.status,
        cd.city,
        cd.total_consumption,
        pp.base_price,
        pp.working_price,
        pp.base_price + (cd.total_consumption * pp.working_price) AS total_revenue
    FROM contract_data cd
    JOIN product_prices pp
    ON cd.product_id = pp.product_id
)

SELECT
    contract_id,
    product_id,
    creation_date,
    startdate,
    enddate,
    status,
    city,
    total_consumption,
    working_price * total_consumption AS total_working_revenue,
    base_price AS total_base_revenue,
    total_revenue
FROM revenue_data;
[0m13:19:14.606116 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:19:14.971845 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b592e7-0202-d35b-0002-d4460001037a
[0m13:19:14.972113 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 58 at position 17 unexpected ';'.
[0m13:19:14.972608 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_revenue_metrics: Close
[0m13:19:15.087231 [debug] [Thread-1 (]: Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  001003 (42000): SQL compilation error:
  syntax error line 58 at position 17 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/fact_revenue_metrics.sql
[0m13:19:15.088247 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb33822a-f8b1-47d1-a9bc-67695b84d357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141cdd210>]}
[0m13:19:15.089266 [error] [Thread-1 (]: 6 of 6 ERROR creating sql view model stage.fact_revenue_metrics ................ [[31mERROR[0m in 0.51s]
[0m13:19:15.090147 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_revenue_metrics
[0m13:19:15.092779 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:19:15.093157 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_revenue_metrics' was properly closed.
[0m13:19:15.093597 [info ] [MainThread]: 
[0m13:19:15.093935 [info ] [MainThread]: Finished running 5 table models, 1 view model in 0 hours 0 minutes and 7.66 seconds (7.66s).
[0m13:19:15.095117 [debug] [MainThread]: Command end result
[0m13:19:15.126213 [info ] [MainThread]: 
[0m13:19:15.126579 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:19:15.126800 [info ] [MainThread]: 
[0m13:19:15.127018 [error] [MainThread]:   Database Error in model fact_revenue_metrics (models/staging/fact_revenue_metrics.sql)
  001003 (42000): SQL compilation error:
  syntax error line 58 at position 17 unexpected ';'.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/fact_revenue_metrics.sql
[0m13:19:15.127176 [info ] [MainThread]: 
[0m13:19:15.127336 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m13:19:15.129382 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.984441, "process_user_time": 2.180795, "process_kernel_time": 2.438118, "process_mem_max_rss": "186974208", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:19:15.129812 [debug] [MainThread]: Command `dbt run` failed at 13:19:15.129765 after 8.98 seconds
[0m13:19:15.130133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10051ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143d3f190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143d81150>]}
[0m13:19:15.130363 [debug] [MainThread]: Flushing usage events
[0m14:42:59.658965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153b59790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153bbd010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153bbd690>]}


============================== 14:42:59.661945 | 7a41e1e7-3ccd-4f7f-a53c-7168937cb90c ==============================
[0m14:42:59.661945 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:42:59.662283 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:43:00.455998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7a41e1e7-3ccd-4f7f-a53c-7168937cb90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168a5e790>]}
[0m14:43:00.475947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7a41e1e7-3ccd-4f7f-a53c-7168937cb90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152373290>]}
[0m14:43:00.476574 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:43:00.489658 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:43:00.556268 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 1 files added, 2 files changed.
[0m14:43:00.556665 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/stg_contracts.sql
[0m14:43:00.556822 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m14:43:00.556975 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:43:00.557095 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m14:43:00.557212 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m14:43:00.557393 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m14:43:00.557560 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m14:43:00.741552 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'stg_contract' in the 'models' section of file 'models/staging/_stg_models.yml'
[0m14:43:00.742636 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contracts' (models/staging/stg_contracts.sql) depends on a source named 'source.contracts' which was not found
[0m14:43:00.752965 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1285374, "process_user_time": 2.176603, "process_kernel_time": 1.396473, "process_mem_max_rss": "189677568", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:43:00.758277 [debug] [MainThread]: Command `dbt run` failed at 14:43:00.757558 after 1.13 seconds
[0m14:43:00.760657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1004fecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100578210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168e2e310>]}
[0m14:43:00.761286 [debug] [MainThread]: Flushing usage events
[0m14:43:27.223672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b5b590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b80e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b81490>]}


============================== 14:43:27.226557 | af8fb274-53fd-47b5-9428-e97f28bb55d0 ==============================
[0m14:43:27.226557 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:43:27.226868 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select staging', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:43:27.881202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'af8fb274-53fd-47b5-9428-e97f28bb55d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1400d5e90>]}
[0m14:43:27.904006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'af8fb274-53fd-47b5-9428-e97f28bb55d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1401e95d0>]}
[0m14:43:27.904687 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:43:27.918923 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:43:27.984621 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 1 files added, 3 files changed.
[0m14:43:27.984959 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/stg_contracts.sql
[0m14:43:27.985242 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/_stg_sources.yml
[0m14:43:27.985378 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m14:43:27.985570 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:43:27.985744 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m14:43:27.985870 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m14:43:27.986013 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m14:43:27.986142 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m14:43:28.128705 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'stg_contract' in the 'models' section of file 'models/staging/_stg_models.yml'
[0m14:43:28.164196 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_prices' (models/staging/stg_prices.sql) depends on a source named 'raw.prices' which was not found
[0m14:43:28.165978 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.9723247, "process_user_time": 1.671953, "process_kernel_time": 2.412228, "process_mem_max_rss": "188186624", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:43:28.166332 [debug] [MainThread]: Command `dbt run` failed at 14:43:28.166284 after 0.97 seconds
[0m14:43:28.166532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b60e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100db6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b81010>]}
[0m14:43:28.166735 [debug] [MainThread]: Flushing usage events
[0m14:44:27.041017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b357250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b3bd690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b3bdd10>]}


============================== 14:44:27.043746 | d73271c2-4acb-4f9d-9570-fa418a1ac1a9 ==============================
[0m14:44:27.043746 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:44:27.044044 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select staging', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:44:27.749859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd73271c2-4acb-4f9d-9570-fa418a1ac1a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ff47590>]}
[0m14:44:27.769722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd73271c2-4acb-4f9d-9570-fa418a1ac1a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139c72f90>]}
[0m14:44:27.770349 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:44:27.783704 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:44:27.848023 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 1 files added, 3 files changed.
[0m14:44:27.848328 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/stg_contracts.sql
[0m14:44:27.848606 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/_stg_sources.yml
[0m14:44:27.848744 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:44:27.848860 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m14:44:27.848971 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m14:44:27.849077 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m14:44:27.849207 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m14:44:27.849330 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m14:44:27.984050 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'stg_contract' in the 'models' section of file 'models/staging/_stg_models.yml'
[0m14:44:28.014313 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contracts' (models/staging/stg_contracts.sql) depends on a source named 'raw.contracts' which was not found
[0m14:44:28.015966 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0052406, "process_user_time": 1.651903, "process_kernel_time": 2.486174, "process_mem_max_rss": "190660608", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:44:28.016223 [debug] [MainThread]: Command `dbt run` failed at 14:44:28.016178 after 1.01 seconds
[0m14:44:28.016388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100eb6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b3bd090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b3bdc10>]}
[0m14:44:28.016544 [debug] [MainThread]: Flushing usage events
[0m14:45:16.160633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e957090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e99c6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e9bde10>]}


============================== 14:45:16.163146 | 44f9b679-7475-406a-8770-007f7669c127 ==============================
[0m14:45:16.163146 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:45:16.163424 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select staging', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:45:16.825191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44f9b679-7475-406a-8770-007f7669c127', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e988810>]}
[0m14:45:16.844070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '44f9b679-7475-406a-8770-007f7669c127', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e300990>]}
[0m14:45:16.844578 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:45:16.857674 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:45:16.916820 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 1 files added, 2 files changed.
[0m14:45:16.917133 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/stg_contracts.sql
[0m14:45:16.917269 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m14:45:16.917389 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m14:45:16.917498 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m14:45:16.917621 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:45:16.917783 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m14:45:16.917934 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m14:45:17.047659 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'stg_contract' in the 'models' section of file 'models/staging/_stg_models.yml'
[0m14:45:17.049621 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contracts' (models/staging/stg_contracts.sql) depends on a source named 'raw.contract' which was not found
[0m14:45:17.055292 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.92463124, "process_user_time": 1.970403, "process_kernel_time": 1.678877, "process_mem_max_rss": "193249280", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:45:17.055669 [debug] [MainThread]: Command `dbt run` failed at 14:45:17.055579 after 0.93 seconds
[0m14:45:17.056295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1004b6fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100530110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1005301d0>]}
[0m14:45:17.056617 [debug] [MainThread]: Flushing usage events
[0m14:46:16.972138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e357510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e3bd790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e3bde10>]}


============================== 14:46:16.974564 | 60472ba0-51cd-4c06-a4c8-40fc6da69431 ==============================
[0m14:46:16.974564 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:46:16.974829 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select staging', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:46:17.677627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '60472ba0-51cd-4c06-a4c8-40fc6da69431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b1a19d0>]}
[0m14:46:17.696280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '60472ba0-51cd-4c06-a4c8-40fc6da69431', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dd00cd0>]}
[0m14:46:17.696762 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:46:17.708699 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:46:17.767952 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 1 files added, 2 files changed.
[0m14:46:17.768226 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/stg_contracts.sql
[0m14:46:17.768364 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:46:17.768477 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m14:46:17.768580 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m14:46:17.768683 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m14:46:17.768838 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m14:46:17.768981 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m14:46:17.893979 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'stg_contract' in the 'models' section of file 'models/staging/_stg_models.yml'
[0m14:46:17.894895 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contracts' (models/staging/stg_contracts.sql) depends on a source named 'raw.contract' which was not found
[0m14:46:17.896864 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.95257735, "process_user_time": 2.062225, "process_kernel_time": 2.165127, "process_mem_max_rss": "190627840", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:46:17.897154 [debug] [MainThread]: Command `dbt run` failed at 14:46:17.897108 after 0.95 seconds
[0m14:46:17.897331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104846cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e347650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e347810>]}
[0m14:46:17.897489 [debug] [MainThread]: Flushing usage events
[0m14:46:44.539224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e8971d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e8bd4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e8bdb10>]}


============================== 14:46:44.541744 | 203cbd82-6dbd-44f3-a0c2-f58b8f1f1e38 ==============================
[0m14:46:44.541744 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:46:44.542029 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select staging', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:46:45.102717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '203cbd82-6dbd-44f3-a0c2-f58b8f1f1e38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b5ad090>]}
[0m14:46:45.121389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '203cbd82-6dbd-44f3-a0c2-f58b8f1f1e38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d0732d0>]}
[0m14:46:45.121883 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:46:45.134635 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:46:45.197448 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 0 files added, 3 files changed.
[0m14:46:45.197748 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m14:46:45.197883 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m14:46:45.197999 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m14:46:45.198187 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:46:45.198352 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m14:46:45.198503 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m14:46:45.309567 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/staging/stg_contract.sql) depends on a source named 'raw.contract' which was not found
[0m14:46:45.311174 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8009151, "process_user_time": 1.907145, "process_kernel_time": 1.796539, "process_mem_max_rss": "194772992", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:46:45.311435 [debug] [MainThread]: Command `dbt run` failed at 14:46:45.311394 after 0.80 seconds
[0m14:46:45.311603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030f6cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b7dcb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16badce50>]}
[0m14:46:45.311755 [debug] [MainThread]: Flushing usage events
[0m14:47:30.376609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c5bc90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c812d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c81950>]}


============================== 14:47:30.378950 | 98d92206-982c-456c-a743-b26bdb2f2875 ==============================
[0m14:47:30.378950 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:47:30.379215 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select staging', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:47:31.079270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '98d92206-982c-456c-a743-b26bdb2f2875', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c838d0>]}
[0m14:47:31.099602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '98d92206-982c-456c-a743-b26bdb2f2875', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c4fa590>]}
[0m14:47:31.100211 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:47:31.113346 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:47:31.183540 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 0 files added, 3 files changed.
[0m14:47:31.184012 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m14:47:31.184174 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m14:47:31.184428 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m14:47:31.184734 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:47:31.184933 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m14:47:31.185111 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m14:47:31.347629 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/staging/stg_contract.sql) depends on a source named 'raw.contract' which was not found
[0m14:47:31.349207 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0012217, "process_user_time": 1.665233, "process_kernel_time": 2.370954, "process_mem_max_rss": "184827904", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:47:31.349558 [debug] [MainThread]: Command `dbt run` failed at 14:47:31.349511 after 1.00 seconds
[0m14:47:31.349764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104252cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c605d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042cc1d0>]}
[0m14:47:31.349950 [debug] [MainThread]: Flushing usage events
[0m14:47:53.470649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c94c490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c200650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c97dad0>]}


============================== 14:47:53.472931 | 6080e70f-eeb8-4041-b903-0b315d28a1b1 ==============================
[0m14:47:53.472931 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:47:53.473201 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:47:54.025975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6080e70f-eeb8-4041-b903-0b315d28a1b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f0c9150>]}
[0m14:47:54.046263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6080e70f-eeb8-4041-b903-0b315d28a1b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c100cd0>]}
[0m14:47:54.047009 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:47:54.059988 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:47:54.127096 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 0 files added, 3 files changed.
[0m14:47:54.127399 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m14:47:54.127532 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m14:47:54.127649 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m14:47:54.127848 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:47:54.128011 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m14:47:54.128163 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m14:47:54.254263 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/staging/stg_contract.sql) depends on a source named 'raw.contract' which was not found
[0m14:47:54.256007 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8116866, "process_user_time": 1.756864, "process_kernel_time": 2.097995, "process_mem_max_rss": "193822720", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:47:54.256346 [debug] [MainThread]: Command `dbt run` failed at 14:47:54.256299 after 0.81 seconds
[0m14:47:54.256550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10222ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149e7f610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1022a4090>]}
[0m14:47:54.256835 [debug] [MainThread]: Flushing usage events
[0m14:49:10.189579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127e5b010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127ebd1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127ebd850>]}


============================== 14:49:10.192708 | 47e81f46-d337-4dad-9be1-26ae85f3b4f2 ==============================
[0m14:49:10.192708 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:49:10.193017 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:49:10.855763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47e81f46-d337-4dad-9be1-26ae85f3b4f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133bee810>]}
[0m14:49:10.874959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '47e81f46-d337-4dad-9be1-26ae85f3b4f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127800b50>]}
[0m14:49:10.875524 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:49:10.888837 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:49:10.983410 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m14:49:10.984227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '47e81f46-d337-4dad-9be1-26ae85f3b4f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117c2e850>]}
[0m14:49:11.722339 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/staging/stg_contract.sql) depends on a source named 'raw.contract' which was not found
[0m14:49:11.724186 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.566676, "process_user_time": 2.181484, "process_kernel_time": 2.372292, "process_mem_max_rss": "179945472", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:49:11.724497 [debug] [MainThread]: Command `dbt run` failed at 14:49:11.724430 after 1.57 seconds
[0m14:49:11.724826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1225e33d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1023cad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127e95890>]}
[0m14:49:11.725014 [debug] [MainThread]: Flushing usage events
[0m14:49:44.955612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e15b2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e15a8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e1bd890>]}


============================== 14:49:44.957872 | 53dc600a-2c9c-4ac6-b272-585d88b371d9 ==============================
[0m14:49:44.957872 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:49:44.958137 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:49:44.966396 [info ] [MainThread]: dbt version: 1.8.0
[0m14:49:44.966679 [info ] [MainThread]: python version: 3.11.9
[0m14:49:44.966825 [info ] [MainThread]: python path: /opt/homebrew/opt/python@3.11/bin/python3.11
[0m14:49:44.966947 [info ] [MainThread]: os info: macOS-14.1-arm64-arm-64bit
[0m14:49:45.521900 [info ] [MainThread]: Using profiles dir at /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt
[0m14:49:45.522181 [info ] [MainThread]: Using profiles.yml file at /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/profiles.yml
[0m14:49:45.522315 [info ] [MainThread]: Using dbt_project.yml file at /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/dbt_project.yml
[0m14:49:45.522701 [info ] [MainThread]: adapter type: snowflake
[0m14:49:45.522873 [info ] [MainThread]: adapter version: 1.8.3
[0m14:49:45.555499 [info ] [MainThread]: Configuration:
[0m14:49:45.555770 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m14:49:45.555909 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m14:49:45.556026 [info ] [MainThread]: Required dependencies:
[0m14:49:45.556183 [debug] [MainThread]: Executing "git --help"
[0m14:49:45.564823 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--config-env=<name>=<envvar>] <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m14:49:45.565469 [debug] [MainThread]: STDERR: "b''"
[0m14:49:45.565670 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m14:49:45.565839 [info ] [MainThread]: Connection:
[0m14:49:45.566114 [info ] [MainThread]:   account: oh95089.eu-central-1
[0m14:49:45.566235 [info ] [MainThread]:   user: SCHALLADBT
[0m14:49:45.566358 [info ] [MainThread]:   database: LB
[0m14:49:45.566474 [info ] [MainThread]:   warehouse: COMPUTE_WH
[0m14:49:45.566581 [info ] [MainThread]:   role: ACCOUNTADMIN
[0m14:49:45.566706 [info ] [MainThread]:   schema: stage
[0m14:49:45.566822 [info ] [MainThread]:   authenticator: None
[0m14:49:45.566929 [info ] [MainThread]:   oauth_client_id: None
[0m14:49:45.567045 [info ] [MainThread]:   query_tag: None
[0m14:49:45.567153 [info ] [MainThread]:   client_session_keep_alive: False
[0m14:49:45.567264 [info ] [MainThread]:   host: None
[0m14:49:45.567366 [info ] [MainThread]:   port: None
[0m14:49:45.567466 [info ] [MainThread]:   proxy_host: None
[0m14:49:45.567569 [info ] [MainThread]:   proxy_port: None
[0m14:49:45.567671 [info ] [MainThread]:   protocol: None
[0m14:49:45.567771 [info ] [MainThread]:   connect_retries: 1
[0m14:49:45.567890 [info ] [MainThread]:   connect_timeout: None
[0m14:49:45.567996 [info ] [MainThread]:   retry_on_database_errors: False
[0m14:49:45.568101 [info ] [MainThread]:   retry_all: False
[0m14:49:45.568210 [info ] [MainThread]:   insecure_mode: False
[0m14:49:45.568317 [info ] [MainThread]:   reuse_connections: None
[0m14:49:45.568715 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:49:45.575147 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m14:49:45.576705 [debug] [MainThread]: Using snowflake connection "debug"
[0m14:49:45.577084 [debug] [MainThread]: On debug: select 1 as id
[0m14:49:45.577239 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:49:46.078751 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.501 seconds
[0m14:49:46.080421 [debug] [MainThread]: On debug: Close
[0m14:49:46.192805 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m14:49:46.193879 [info ] [MainThread]: [32mAll checks passed![0m
[0m14:49:46.197722 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.2717873, "process_user_time": 1.459322, "process_kernel_time": 2.173821, "process_mem_max_rss": "185614336", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:49:46.198675 [debug] [MainThread]: Command `dbt debug` succeeded at 14:49:46.198527 after 1.27 seconds
[0m14:49:46.199159 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m14:49:46.199784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e1bd350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e197c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102be8690>]}
[0m14:49:46.200434 [debug] [MainThread]: Flushing usage events
[0m14:50:22.913945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b641ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b0f0650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b67dd50>]}


============================== 14:50:22.916276 | ef541f03-d9ee-43d4-a14c-ce2314d5f5ae ==============================
[0m14:50:22.916276 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:50:22.916540 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:50:23.573608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ef541f03-d9ee-43d4-a14c-ce2314d5f5ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12be91950>]}
[0m14:50:23.593177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ef541f03-d9ee-43d4-a14c-ce2314d5f5ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129c6f090>]}
[0m14:50:23.593769 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:50:23.605940 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:50:23.666807 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 0 files added, 3 files changed.
[0m14:50:23.667086 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_products.sql
[0m14:50:23.667217 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_revenue_metrics.sql
[0m14:50:23.667336 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m14:50:23.667530 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m14:50:23.667687 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m14:50:23.667848 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m14:50:23.794967 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/staging/stg_contract.sql) depends on a source named 'raw.contract' which was not found
[0m14:50:23.796699 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.9098659, "process_user_time": 1.906491, "process_kernel_time": 1.649982, "process_mem_max_rss": "194805760", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:50:23.796965 [debug] [MainThread]: Command `dbt run` failed at 14:50:23.796927 after 0.91 seconds
[0m14:50:23.797121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101152d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101161650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138923a90>]}
[0m14:50:23.797264 [debug] [MainThread]: Flushing usage events
[0m14:54:25.546220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e17fb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e1bcf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e1bd610>]}


============================== 14:54:25.549374 | a61749cf-7122-4cdb-aaff-17e3c3925bed ==============================
[0m14:54:25.549374 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:54:25.550215 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:54:26.306056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a61749cf-7122-4cdb-aaff-17e3c3925bed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16af42590>]}
[0m14:54:26.325804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a61749cf-7122-4cdb-aaff-17e3c3925bed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db00e10>]}
[0m14:54:26.326459 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:54:26.342167 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:54:26.382421 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m14:54:26.382722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a61749cf-7122-4cdb-aaff-17e3c3925bed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cb32d50>]}
[0m14:54:27.000159 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/staging/stg_contract.sql) depends on a source named 'raw.contract' which was not found
[0m14:54:27.002386 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4858438, "process_user_time": 2.333096, "process_kernel_time": 2.266655, "process_mem_max_rss": "193232896", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:54:27.003184 [debug] [MainThread]: Command `dbt run` failed at 14:54:27.002774 after 1.49 seconds
[0m14:54:27.003907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c6a2f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d34990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e197210>]}
[0m14:54:27.004165 [debug] [MainThread]: Flushing usage events
[0m14:54:50.822676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128556710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1285ad390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1285ada10>]}


============================== 14:54:50.825163 | d336b2c8-b39e-479d-b640-fc0c8a606edb ==============================
[0m14:54:50.825163 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:54:50.825442 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:54:50.826970 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'default'
[0m14:54:50.828008 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.03477771, "process_user_time": 1.239717, "process_kernel_time": 2.148011, "process_mem_max_rss": "110084096", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:54:50.828320 [debug] [MainThread]: Command `dbt run` failed at 14:54:50.828272 after 0.04 seconds
[0m14:54:50.828496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128597b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1285472d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12859ccd0>]}
[0m14:54:50.828660 [debug] [MainThread]: Flushing usage events
[0m14:55:04.425980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c860e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c8bc290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c8bd890>]}


============================== 14:55:04.428794 | 91b3458e-f27b-4971-b55e-6dbf24bfbc2e ==============================
[0m14:55:04.428794 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:55:04.429116 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:55:04.430733 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'default'
[0m14:55:04.431914 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.03875579, "process_user_time": 1.64007, "process_kernel_time": 1.273691, "process_mem_max_rss": "113426432", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:55:04.432221 [debug] [MainThread]: Command `dbt run` failed at 14:55:04.432175 after 0.04 seconds
[0m14:55:04.432410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1012b87d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c8bf890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1011cd650>]}
[0m14:55:04.432592 [debug] [MainThread]: Flushing usage events
[0m14:55:09.157915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122a43d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122a80f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122a815d0>]}


============================== 14:55:09.159817 | 551cf8f8-e32b-4f15-9bde-71334a09c027 ==============================
[0m14:55:09.159817 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:55:09.160090 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:55:09.883116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '551cf8f8-e32b-4f15-9bde-71334a09c027', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126f3be50>]}
[0m14:55:09.904498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '551cf8f8-e32b-4f15-9bde-71334a09c027', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120800bd0>]}
[0m14:55:09.905180 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:55:09.920418 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:55:09.960630 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m14:55:09.960929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '551cf8f8-e32b-4f15-9bde-71334a09c027', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f72e9d0>]}
[0m14:55:10.548930 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.stg_contract' (models/staging/stg_contract.sql) depends on a source named 'raw.contract' which was not found
[0m14:55:10.550235 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.416334, "process_user_time": 2.562939, "process_kernel_time": 1.408752, "process_mem_max_rss": "187727872", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:55:10.550485 [debug] [MainThread]: Command `dbt run` failed at 14:55:10.550441 after 1.42 seconds
[0m14:55:10.550673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100de6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122a82f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122a81290>]}
[0m14:55:10.550818 [debug] [MainThread]: Flushing usage events
[0m14:56:20.129230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe5a210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe80e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe81490>]}


============================== 14:56:20.132260 | 492b378e-9ec3-490f-abc2-ca2d9fa22a31 ==============================
[0m14:56:20.132260 [info ] [MainThread]: Running with dbt=1.8.0
[0m14:56:20.132595 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:56:21.003203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '492b378e-9ec3-490f-abc2-ca2d9fa22a31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe59410>]}
[0m14:56:21.024694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '492b378e-9ec3-490f-abc2-ca2d9fa22a31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f5fca10>]}
[0m14:56:21.025393 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m14:56:21.038529 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m14:56:21.084022 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m14:56:21.084364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '492b378e-9ec3-490f-abc2-ca2d9fa22a31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e72ea50>]}
[0m14:56:21.779601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '492b378e-9ec3-490f-abc2-ca2d9fa22a31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ddf7510>]}
[0m14:56:21.849252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '492b378e-9ec3-490f-abc2-ca2d9fa22a31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1480ff550>]}
[0m14:56:21.849522 [info ] [MainThread]: Found 3 models, 1 seed, 3 sources, 563 macros
[0m14:56:21.849674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '492b378e-9ec3-490f-abc2-ca2d9fa22a31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe7cfd0>]}
[0m14:56:21.850532 [info ] [MainThread]: 
[0m14:56:21.850771 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:56:21.852512 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m14:56:21.857993 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m14:56:21.858236 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m14:56:21.858397 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:56:22.387884 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.529 seconds
[0m14:56:22.391089 [debug] [ThreadPool]: On list_LB: Close
[0m14:56:22.504673 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m14:56:22.512124 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m14:56:22.512530 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m14:56:22.512765 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:56:22.998891 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.486 seconds
[0m14:56:23.005785 [debug] [ThreadPool]: On list_LB_stage: Close
[0m14:56:23.116835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '492b378e-9ec3-490f-abc2-ca2d9fa22a31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe4ffd0>]}
[0m14:56:23.117697 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m14:56:23.117961 [info ] [MainThread]: 
[0m14:56:23.125306 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m14:56:23.126279 [info ] [Thread-1 (]: 1 of 3 START sql view model stage.stg_contract ................................. [RUN]
[0m14:56:23.126633 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m14:56:23.126821 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m14:56:23.137566 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m14:56:23.138197 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m14:56:23.151818 [debug] [Thread-1 (]: Dropping relation "LB"."STAGE"."STG_CONTRACT" because it is of type table
[0m14:56:23.156540 [debug] [Thread-1 (]: Applying DROP to: "LB"."STAGE"."STG_CONTRACT"
[0m14:56:23.159760 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m14:56:23.160030 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
drop table if exists "LB"."STAGE"."STG_CONTRACT" cascade
[0m14:56:23.160231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:56:23.671296 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.511 seconds
[0m14:56:23.687820 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m14:56:23.689495 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m14:56:23.689961 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.contract
  );
[0m14:56:23.919384 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.229 seconds
[0m14:56:23.945093 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m14:56:24.057581 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '492b378e-9ec3-490f-abc2-ca2d9fa22a31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14855c3d0>]}
[0m14:56:24.058853 [info ] [Thread-1 (]: 1 of 3 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.93s]
[0m14:56:24.059739 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m14:56:24.060291 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m14:56:24.061055 [info ] [Thread-1 (]: 2 of 3 START sql view model stage.stg_prices ................................... [RUN]
[0m14:56:24.061939 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m14:56:24.062605 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m14:56:24.065604 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m14:56:24.066459 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m14:56:24.070673 [debug] [Thread-1 (]: Dropping relation "LB"."STAGE"."STG_PRICES" because it is of type table
[0m14:56:24.072425 [debug] [Thread-1 (]: Applying DROP to: "LB"."STAGE"."STG_PRICES"
[0m14:56:24.072931 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m14:56:24.073111 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
drop table if exists "LB"."STAGE"."STG_PRICES" cascade
[0m14:56:24.073270 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:56:24.606168 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.533 seconds
[0m14:56:24.608861 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m14:56:24.611067 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m14:56:24.611716 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS price_id,
    productid::INTEGER AS product_id,
    pricecomponentid::INTEGER AS price_component_id,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.prices
  );
[0m14:56:24.834516 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.222 seconds
[0m14:56:24.836303 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m14:56:24.934052 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '492b378e-9ec3-490f-abc2-ca2d9fa22a31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1480ce610>]}
[0m14:56:24.934539 [info ] [Thread-1 (]: 2 of 3 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.87s]
[0m14:56:24.934840 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m14:56:24.935055 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m14:56:24.935360 [info ] [Thread-1 (]: 3 of 3 START sql view model stage.stg_products ................................. [RUN]
[0m14:56:24.935632 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m14:56:24.935788 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m14:56:24.937801 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m14:56:24.938189 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m14:56:24.939325 [debug] [Thread-1 (]: Dropping relation "LB"."STAGE"."STG_PRODUCTS" because it is of type table
[0m14:56:24.940294 [debug] [Thread-1 (]: Applying DROP to: "LB"."STAGE"."STG_PRODUCTS"
[0m14:56:24.940609 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m14:56:24.940758 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
drop table if exists "LB"."STAGE"."STG_PRODUCTS" cascade
[0m14:56:24.940891 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:56:25.437875 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.497 seconds
[0m14:56:25.438765 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m14:56:25.439447 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m14:56:25.439645 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.products
  );
[0m14:56:25.683823 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.244 seconds
[0m14:56:25.687691 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m14:56:25.793136 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '492b378e-9ec3-490f-abc2-ca2d9fa22a31', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1480ecb90>]}
[0m14:56:25.794665 [info ] [Thread-1 (]: 3 of 3 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.86s]
[0m14:56:25.795822 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m14:56:25.798686 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:56:25.799266 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m14:56:25.799882 [info ] [MainThread]: 
[0m14:56:25.800453 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 3.95 seconds (3.95s).
[0m14:56:25.802222 [debug] [MainThread]: Command end result
[0m14:56:25.831614 [info ] [MainThread]: 
[0m14:56:25.832088 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:56:25.832227 [info ] [MainThread]: 
[0m14:56:25.832385 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m14:56:25.834197 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.7396555, "process_user_time": 2.655881, "process_kernel_time": 2.314092, "process_mem_max_rss": "197918720", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:56:25.834689 [debug] [MainThread]: Command `dbt run` succeeded at 14:56:25.834631 after 5.74 seconds
[0m14:56:25.835086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe813d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102350710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102256cd0>]}
[0m14:56:25.835278 [debug] [MainThread]: Flushing usage events
[0m15:01:19.038965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c757b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c7bd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c7bd950>]}


============================== 15:01:19.041317 | e14616b4-2322-419a-90d1-2e45efc432f0 ==============================
[0m15:01:19.041317 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:01:19.041579 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m15:01:19.720365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e14616b4-2322-419a-90d1-2e45efc432f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a11d150>]}
[0m15:01:19.740096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e14616b4-2322-419a-90d1-2e45efc432f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f16ee10>]}
[0m15:01:19.740644 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:01:19.754978 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:01:19.816232 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:01:19.816535 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_contract.sql
[0m15:01:19.876586 [error] [MainThread]: Encountered an error:
Compilation Error in model dim_contract (models/staging/dim_contract.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The snowflake_airflow_dbt.dim_contract model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model dim_contract (models/staging/dim_contract.sql)
[0m15:01:19.878146 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8673303, "process_user_time": 1.581998, "process_kernel_time": 2.336768, "process_mem_max_rss": "196395008", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:01:19.878407 [debug] [MainThread]: Command `dbt run` failed at 15:01:19.878366 after 0.87 seconds
[0m15:01:19.878577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c2f0490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f5ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fd8090>]}
[0m15:01:19.878750 [debug] [MainThread]: Flushing usage events
[0m15:01:25.303431 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m15:06:17.691897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1241141d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126b81090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126b81710>]}


============================== 15:06:17.695374 | 128558a8-b0f4-44b3-b6b1-2c60352512b7 ==============================
[0m15:06:17.695374 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:06:17.695900 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt deps', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:06:17.821174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '128558a8-b0f4-44b3-b6b1-2c60352512b7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126c43190>]}
[0m15:06:17.852760 [debug] [MainThread]: Set downloads directory='/var/folders/q9/8ffkdmwj2r740qgh_yjbjs8c0000gn/T/dbt-downloads-baq2xih7'
[0m15:06:17.853172 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m15:06:18.028602 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m15:06:18.029118 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m15:06:18.149566 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m15:06:18.153056 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m15:06:18.521568 [info ] [MainThread]: Installed from version 1.2.0
[0m15:06:18.521890 [info ] [MainThread]: Up to date!
[0m15:06:18.522109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '128558a8-b0f4-44b3-b6b1-2c60352512b7', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126b9eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147d3390>]}
[0m15:06:18.524362 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.87529963, "process_user_time": 1.472467, "process_kernel_time": 2.223608, "process_mem_max_rss": "110510080", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:06:18.524896 [debug] [MainThread]: Command `dbt deps` succeeded at 15:06:18.524815 after 0.88 seconds
[0m15:06:18.525121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c46d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c46cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102cc0090>]}
[0m15:06:18.525324 [debug] [MainThread]: Flushing usage events
[0m15:06:22.089791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e1ec810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e781390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e781a10>]}


============================== 15:06:22.092069 | 4c442d01-611f-4128-a6d4-ce3f58a2d11f ==============================
[0m15:06:22.092069 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:06:22.092357 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:06:22.786325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4c442d01-611f-4128-a6d4-ce3f58a2d11f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168e69dd0>]}
[0m15:06:22.805134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4c442d01-611f-4128-a6d4-ce3f58a2d11f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b2a6250>]}
[0m15:06:22.805726 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:06:22.817365 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:06:22.873556 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:06:22.873839 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_contract.sql
[0m15:06:22.930549 [error] [MainThread]: Encountered an error:
Compilation Error in model dim_contract (models/staging/dim_contract.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The snowflake_airflow_dbt.dim_contract model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model dim_contract (models/staging/dim_contract.sql)
[0m15:06:22.931530 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8825334, "process_user_time": 1.335601, "process_kernel_time": 2.361776, "process_mem_max_rss": "190742528", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:06:22.931782 [debug] [MainThread]: Command `dbt run` failed at 15:06:22.931742 after 0.88 seconds
[0m15:06:22.931952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f6eb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e759c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102fe8050>]}
[0m15:06:22.932102 [debug] [MainThread]: Flushing usage events
[0m15:07:16.755484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134295910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1342bd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1342bd990>]}


============================== 15:07:16.758174 | 0788d571-da29-40a6-855a-d286eb017d9e ==============================
[0m15:07:16.758174 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:07:16.758476 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:07:17.514503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0788d571-da29-40a6-855a-d286eb017d9e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14063ae10>]}
[0m15:07:17.534558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0788d571-da29-40a6-855a-d286eb017d9e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133c00b50>]}
[0m15:07:17.535184 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:07:17.551164 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:07:17.613598 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m15:07:17.613938 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_contract.sql
[0m15:07:17.614078 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://macros/new_id.sql
[0m15:07:17.679172 [error] [MainThread]: Encountered an error:
Compilation Error in model dim_contract (models/staging/dim_contract.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The snowflake_airflow_dbt.dim_contract model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model dim_contract (models/staging/dim_contract.sql)
[0m15:07:17.680836 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.9600345, "process_user_time": 2.244795, "process_kernel_time": 1.512545, "process_mem_max_rss": "182009856", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:07:17.681129 [debug] [MainThread]: Command `dbt run` failed at 15:07:17.681083 after 0.96 seconds
[0m15:07:17.681327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030bad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1342bdc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030c9650>]}
[0m15:07:17.681498 [debug] [MainThread]: Flushing usage events
[0m15:08:50.925790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fa4c090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fa81110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fa81790>]}


============================== 15:08:50.929362 | 80d1a95a-7c5d-477a-b17d-937474712d69 ==============================
[0m15:08:50.929362 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:08:50.929865 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:08:51.816264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '80d1a95a-7c5d-477a-b17d-937474712d69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1686d67d0>]}
[0m15:08:51.849847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '80d1a95a-7c5d-477a-b17d-937474712d69', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f300ad0>]}
[0m15:08:51.850693 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:08:51.878462 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:08:52.007443 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m15:08:52.007925 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_contract.sql
[0m15:08:52.008102 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://macros/new_id.sql
[0m15:08:52.141057 [error] [MainThread]: Encountered an error:
Compilation Error in model dim_contract (models/staging/dim_contract.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The snowflake_airflow_dbt.dim_contract model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model dim_contract (models/staging/dim_contract.sql)
[0m15:08:52.143991 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.2529902, "process_user_time": 1.91652, "process_kernel_time": 2.395726, "process_mem_max_rss": "180469760", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:08:52.144925 [debug] [MainThread]: Command `dbt run` failed at 15:08:52.144821 after 1.25 seconds
[0m15:08:52.145233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1002e6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fa81610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100360090>]}
[0m15:08:52.145457 [debug] [MainThread]: Flushing usage events
[0m15:09:10.936083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13197fe10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1319bcfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1319bd650>]}


============================== 15:09:10.939677 | d367820f-2483-4598-b8d7-99b0e6658e4c ==============================
[0m15:09:10.939677 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:09:10.940023 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m15:09:11.726305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd367820f-2483-4598-b8d7-99b0e6658e4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1376cc1d0>]}
[0m15:09:11.751974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd367820f-2483-4598-b8d7-99b0e6658e4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131400c50>]}
[0m15:09:11.752704 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:09:11.773611 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:09:11.832781 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:09:11.833146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd367820f-2483-4598-b8d7-99b0e6658e4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13032eb10>]}
[0m15:09:12.497863 [error] [MainThread]: Encountered an error:
Compilation Error in model dim_contract (models/staging/dim_contract.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The snowflake_airflow_dbt.dim_contract model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model dim_contract (models/staging/dim_contract.sql)
[0m15:09:12.499971 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6435344, "process_user_time": 2.660408, "process_kernel_time": 0.944851, "process_mem_max_rss": "176340992", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:09:12.500275 [debug] [MainThread]: Command `dbt run` failed at 15:09:12.500220 after 1.64 seconds
[0m15:09:12.500452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1304af150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100fe2d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1010dc710>]}
[0m15:09:12.500619 [debug] [MainThread]: Flushing usage events
[0m15:10:53.882778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13115add0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1311bd050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1311bd690>]}


============================== 15:10:53.885133 | 770bd905-5575-4d1c-a042-3645adefb3e9 ==============================
[0m15:10:53.885133 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:10:53.885405 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m15:10:54.584781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '770bd905-5575-4d1c-a042-3645adefb3e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135eeb650>]}
[0m15:10:54.611144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '770bd905-5575-4d1c-a042-3645adefb3e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130afcad0>]}
[0m15:10:54.611847 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:10:54.627156 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:10:54.673129 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:10:54.673478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '770bd905-5575-4d1c-a042-3645adefb3e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f92e8d0>]}
[0m15:10:55.185434 [error] [MainThread]: Encountered an error:
Compilation Error in model dim_contract (models/staging/dim_contract.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The snowflake_airflow_dbt.dim_contract model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model dim_contract (models/staging/dim_contract.sql)
[0m15:10:55.187106 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3366684, "process_user_time": 1.854572, "process_kernel_time": 2.499207, "process_mem_max_rss": "187252736", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:10:55.187367 [debug] [MainThread]: Command `dbt run` failed at 15:10:55.187324 after 1.34 seconds
[0m15:10:55.187535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1007eeb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1361f6a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131196310>]}
[0m15:10:55.187690 [debug] [MainThread]: Flushing usage events
[0m15:11:34.214169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bb61550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c0bd5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c0bdc50>]}


============================== 15:11:34.216485 | 8913c881-d2c9-4051-b55c-cdc2150da497 ==============================
[0m15:11:34.216485 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:11:34.216751 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:11:34.890396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8913c881-d2c9-4051-b55c-cdc2150da497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16d469090>]}
[0m15:11:34.910040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8913c881-d2c9-4051-b55c-cdc2150da497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ba00d10>]}
[0m15:11:34.910656 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:11:34.923240 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:11:34.961728 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:11:34.962030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8913c881-d2c9-4051-b55c-cdc2150da497', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a936950>]}
[0m15:11:35.562357 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.dim_contract' (models/staging/dim_contract.sql) depends on a node named 'stg_contracts' which was not found
[0m15:11:35.564193 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.3772086, "process_user_time": 2.094493, "process_kernel_time": 2.350891, "process_mem_max_rss": "189218816", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:11:35.564527 [debug] [MainThread]: Command `dbt run` failed at 15:11:35.564482 after 1.38 seconds
[0m15:11:35.564734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a944f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1008dad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17eca4cd0>]}
[0m15:11:35.564914 [debug] [MainThread]: Flushing usage events
[0m15:11:51.102046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16805a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168081190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168081810>]}


============================== 15:11:51.104566 | 3b01b73a-5e32-4544-8138-8c953306977b ==============================
[0m15:11:51.104566 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:11:51.104864 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m15:11:51.657174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3b01b73a-5e32-4544-8138-8c953306977b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168060e10>]}
[0m15:11:51.676485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3b01b73a-5e32-4544-8138-8c953306977b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f8fca50>]}
[0m15:11:51.677128 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:11:51.689186 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:11:51.726095 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:11:51.726398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3b01b73a-5e32-4544-8138-8c953306977b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e832c10>]}
[0m15:11:52.323092 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.dim_contract' (models/staging/dim_contract.sql) depends on a node named 'stg_contracts' which was not found
[0m15:11:52.324844 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.2515068, "process_user_time": 2.090902, "process_kernel_time": 2.329803, "process_mem_max_rss": "189022208", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:11:52.325123 [debug] [MainThread]: Command `dbt run` failed at 15:11:52.325076 after 1.25 seconds
[0m15:11:52.325288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10475ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16dcadd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047d8090>]}
[0m15:11:52.325450 [debug] [MainThread]: Flushing usage events
[0m15:12:09.095774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ab1a910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ab80bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ab81250>]}


============================== 15:12:09.102241 | 9fabd468-b22c-4e52-8350-10921102ea36 ==============================
[0m15:12:09.102241 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:12:09.102678 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:12:09.796843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16d189450>]}
[0m15:12:09.816498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a3fca50>]}
[0m15:12:09.817159 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:12:09.829597 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:12:09.868781 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m15:12:09.869109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a332950>]}
[0m15:12:10.475575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16df13090>]}
[0m15:12:10.519163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16faf3150>]}
[0m15:12:10.519451 [info ] [MainThread]: Found 4 models, 1 seed, 3 sources, 563 macros
[0m15:12:10.519609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f862450>]}
[0m15:12:10.520503 [info ] [MainThread]: 
[0m15:12:10.520767 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:12:10.522614 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:12:10.528210 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:12:10.528410 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:12:10.528529 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:12:11.092308 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.563 seconds
[0m15:12:11.095331 [debug] [ThreadPool]: On list_LB: Close
[0m15:12:11.211007 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:12:11.223932 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:12:11.224405 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:12:11.224700 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:12:11.731955 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.507 seconds
[0m15:12:11.736604 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:12:11.849045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fa90090>]}
[0m15:12:11.850186 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:12:11.850819 [info ] [MainThread]: 
[0m15:12:11.854445 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:12:11.855126 [info ] [Thread-1 (]: 1 of 4 START sql view model stage.stg_contract ................................. [RUN]
[0m15:12:11.855636 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:12:11.856214 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:12:11.864174 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:12:11.865330 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:12:11.889590 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:12:11.891116 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:12:11.891391 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.contract
  );
[0m15:12:11.891616 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:12.625705 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.727 seconds
[0m15:12:12.702879 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:12:12.816112 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fefaa50>]}
[0m15:12:12.817050 [info ] [Thread-1 (]: 1 of 4 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.96s]
[0m15:12:12.818981 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:12:12.820022 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:12:12.823930 [info ] [Thread-1 (]: 2 of 4 START sql view model stage.stg_prices ................................... [RUN]
[0m15:12:12.824616 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:12:12.825886 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:12:12.834223 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:12:12.835347 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:12:12.840993 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:12:12.842970 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:12:12.843211 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS price_id,
    productid::INTEGER AS product_id,
    pricecomponentid::INTEGER AS price_component_id,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.prices
  );
[0m15:12:12.843439 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:13.431775 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.588 seconds
[0m15:12:13.435858 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:12:13.557808 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14aa32990>]}
[0m15:12:13.558823 [info ] [Thread-1 (]: 2 of 4 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.73s]
[0m15:12:13.559439 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:12:13.559973 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:12:13.560518 [info ] [Thread-1 (]: 3 of 4 START sql view model stage.stg_products ................................. [RUN]
[0m15:12:13.561016 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:12:13.561372 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:12:13.566044 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:12:13.567269 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:12:13.571104 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:12:13.572497 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:12:13.572793 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.products
  );
[0m15:12:13.572987 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:14.135555 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.562 seconds
[0m15:12:14.138216 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:12:14.254477 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fadf750>]}
[0m15:12:14.255898 [info ] [Thread-1 (]: 3 of 4 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.69s]
[0m15:12:14.256875 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:12:14.257508 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:12:14.258385 [info ] [Thread-1 (]: 4 of 4 START sql table model stage.dim_contract ................................ [RUN]
[0m15:12:14.259124 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:12:14.259618 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:12:14.266124 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:12:14.267217 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:12:14.286289 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:12:14.287143 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:12:14.287412 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (-- dbt model


SELECT
    
    
    
        
    
    
    MD5(COALESCE(CAST(contract_id AS VARCHAR), ''))
 AS contract_key,
    *
FROM LB.stage.stg_contract
        );
[0m15:12:14.287656 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:12:15.997187 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.709 seconds
[0m15:12:16.001374 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:12:16.116741 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9fabd468-b22c-4e52-8350-10921102ea36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fac1510>]}
[0m15:12:16.118334 [info ] [Thread-1 (]: 4 of 4 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.86s]
[0m15:12:16.119307 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:12:16.121957 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:12:16.122387 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_contract' was properly closed.
[0m15:12:16.122987 [info ] [MainThread]: 
[0m15:12:16.123478 [info ] [MainThread]: Finished running 3 view models, 1 table model in 0 hours 0 minutes and 5.60 seconds (5.60s).
[0m15:12:16.124639 [debug] [MainThread]: Command end result
[0m15:12:16.161282 [info ] [MainThread]: 
[0m15:12:16.161674 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:12:16.161952 [info ] [MainThread]: 
[0m15:12:16.162332 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m15:12:16.166598 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.1260777, "process_user_time": 3.317796, "process_kernel_time": 1.144576, "process_mem_max_rss": "192626688", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:12:16.168237 [debug] [MainThread]: Command `dbt run` succeeded at 15:12:16.168165 after 7.13 seconds
[0m15:12:16.168902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ab43f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104700690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104606cd0>]}
[0m15:12:16.169114 [debug] [MainThread]: Flushing usage events
[0m15:15:15.214250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15623e350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15627d490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15627db10>]}


============================== 15:15:15.216635 | 47f3e57b-e981-4e90-9f13-76ea0df8afc6 ==============================
[0m15:15:15.216635 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:15:15.216900 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:15:15.986521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47f3e57b-e981-4e90-9f13-76ea0df8afc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168a19250>]}
[0m15:15:16.005880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '47f3e57b-e981-4e90-9f13-76ea0df8afc6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12bbfca90>]}
[0m15:15:16.006396 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:15:16.019570 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:15:16.086872 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:15:16.087168 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:15:16.157059 [error] [MainThread]: Encountered an error:
Compilation Error in model dim_product (models/staging/dim_product.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The snowflake_airflow_dbt.dim_product model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model dim_product (models/staging/dim_product.sql)
[0m15:15:16.158802 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.97163236, "process_user_time": 2.047075, "process_kernel_time": 1.547568, "process_mem_max_rss": "179388416", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:15:16.159136 [debug] [MainThread]: Command `dbt run` failed at 15:15:16.159087 after 0.97 seconds
[0m15:15:16.159345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15627d990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b4ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102bc4090>]}
[0m15:15:16.159515 [debug] [MainThread]: Flushing usage events
[0m15:16:28.818185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff1c050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff81750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff81dd0>]}


============================== 15:16:28.820848 | a59b214a-c41c-43cb-a4da-e166780c210e ==============================
[0m15:16:28.820848 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:16:28.821169 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:16:29.492663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a59b214a-c41c-43cb-a4da-e166780c210e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff61150>]}
[0m15:16:29.511140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a59b214a-c41c-43cb-a4da-e166780c210e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff4d5d0>]}
[0m15:16:29.511620 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:16:29.524264 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:16:29.583719 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:16:29.584026 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:16:29.642234 [error] [MainThread]: Encountered an error:
Compilation Error in model dim_product (models/staging/dim_product.sql)
  
  Warning: `dbt_utils.surrogate_key` has been replaced by `dbt_utils.generate_surrogate_key`. The new macro treats null values differently to empty strings. To restore the behaviour of the original macro, add a global variable in dbt_project.yml called `surrogate_key_treat_nulls_as_empty_strings` to your dbt_project.yml file with a value of True. The snowflake_airflow_dbt.dim_product model triggered this warning. 
  
  > in macro default__surrogate_key (macros/sql/surrogate_key.sql)
  > called by macro surrogate_key (macros/sql/surrogate_key.sql)
  > called by model dim_product (models/staging/dim_product.sql)
[0m15:16:29.643870 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.85656476, "process_user_time": 1.595031, "process_kernel_time": 2.280056, "process_mem_max_rss": "187580416", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:16:29.644172 [debug] [MainThread]: Command `dbt run` failed at 15:16:29.644127 after 0.86 seconds
[0m15:16:29.644358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14efe39d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10465ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff60d50>]}
[0m15:16:29.644509 [debug] [MainThread]: Flushing usage events
[0m15:17:30.661590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129043410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129080f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1290815d0>]}


============================== 15:17:30.664752 | ebbc53f5-89c8-4d1b-a565-6e79ff253c6b ==============================
[0m15:17:30.664752 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:17:30.665076 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:17:31.396507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15b36a190>]}
[0m15:17:31.415995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1288fca50>]}
[0m15:17:31.416467 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:17:31.429284 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:17:31.488447 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:17:31.488735 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:17:31.610424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15f6f6890>]}
[0m15:17:31.652011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15f5447d0>]}
[0m15:17:31.652255 [info ] [MainThread]: Found 5 models, 1 seed, 3 sources, 563 macros
[0m15:17:31.652403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15f64a5d0>]}
[0m15:17:31.653148 [info ] [MainThread]: 
[0m15:17:31.653366 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:17:31.655036 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:17:31.660201 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:17:31.660380 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:17:31.660502 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:17:32.173493 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.513 seconds
[0m15:17:32.177240 [debug] [ThreadPool]: On list_LB: Close
[0m15:17:32.293501 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:17:32.305465 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:17:32.305889 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:17:32.306187 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:17:32.726550 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.420 seconds
[0m15:17:32.738891 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:17:32.856642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160a98410>]}
[0m15:17:32.858441 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:17:32.859247 [info ] [MainThread]: 
[0m15:17:32.866616 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:17:32.867465 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:17:32.868146 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:17:32.868624 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:17:32.874713 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:17:32.875372 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:17:32.894173 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:17:32.894943 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:17:32.895122 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.contract
  );
[0m15:17:32.895283 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:17:33.645237 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.750 seconds
[0m15:17:33.671515 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:17:33.785673 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15f235c50>]}
[0m15:17:33.787036 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.92s]
[0m15:17:33.787911 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:17:33.788553 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:17:33.789551 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:17:33.790110 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:17:33.790479 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:17:33.795561 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:17:33.797208 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:17:33.799865 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:17:33.801010 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:17:33.801381 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS price_id,
    productid::INTEGER AS product_id,
    pricecomponentid::INTEGER AS price_component_id,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.prices
  );
[0m15:17:33.801718 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:17:34.364419 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.562 seconds
[0m15:17:34.368288 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:17:34.491710 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15f544cd0>]}
[0m15:17:34.493331 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.70s]
[0m15:17:34.494425 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:17:34.495170 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:17:34.495999 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:17:34.496742 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:17:34.497201 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:17:34.505486 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:17:34.506645 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:17:34.509585 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:17:34.510772 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:17:34.511160 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.products
  );
[0m15:17:34.511505 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:17:35.034274 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.523 seconds
[0m15:17:35.035681 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:17:35.216855 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a231250>]}
[0m15:17:35.218093 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.72s]
[0m15:17:35.218789 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:17:35.219212 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:17:35.219894 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:17:35.220339 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:17:35.220697 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:17:35.223362 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:17:35.224646 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:17:35.235980 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:17:35.236939 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:17:35.237207 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (-- dbt model


SELECT
    
    
    
        
    
    
    MD5(COALESCE(CAST(contract_id AS VARCHAR), ''))
 AS contract_key,
    *
FROM LB.stage.stg_contract
        );
[0m15:17:35.237454 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:17:36.615247 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.377 seconds
[0m15:17:36.619689 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:17:36.795426 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15efaf850>]}
[0m15:17:36.796087 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.58s]
[0m15:17:36.796432 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:17:36.796670 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:17:36.797002 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:17:36.797297 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:17:36.797489 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:17:36.801032 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:17:36.801863 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:17:36.821667 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:17:36.822073 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    -- dbt model


WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(effective_date) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
    ROW_NUMBER() OVER (PARTITION BY product_id ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    
    
    
        
    
        
    
    
    MD5(COALESCE(CAST(product_id AS VARCHAR), ''), COALESCE(CAST(modificationdate AS VARCHAR), ''))
 AS product_key,
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS effective_date,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY product_id ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products,
  );
[0m15:17:36.822273 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:17:37.253067 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5935d-0202-d35b-0002-d4460001042e
[0m15:17:37.253806 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 10 at position 10
invalid identifier 'MODIFICATIONDATE'
[0m15:17:37.254420 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:17:37.519470 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 10 at position 10
  invalid identifier 'MODIFICATIONDATE'
[0m15:17:37.520049 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ebbc53f5-89c8-4d1b-a565-6e79ff253c6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160b1b8d0>]}
[0m15:17:37.520477 [error] [Thread-1 (]: 5 of 5 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 0.72s]
[0m15:17:37.520782 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:17:37.522605 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:17:37.522811 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:17:37.523035 [info ] [MainThread]: 
[0m15:17:37.523197 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 5.87 seconds (5.87s).
[0m15:17:37.523751 [debug] [MainThread]: Command end result
[0m15:17:37.556178 [info ] [MainThread]: 
[0m15:17:37.556488 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:17:37.556626 [info ] [MainThread]: 
[0m15:17:37.556809 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 10 at position 10
  invalid identifier 'MODIFICATIONDATE'
[0m15:17:37.556941 [info ] [MainThread]: 
[0m15:17:37.557089 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m15:17:37.559050 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.9378347, "process_user_time": 2.247075, "process_kernel_time": 1.982733, "process_mem_max_rss": "198000640", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:17:37.559519 [debug] [MainThread]: Command `dbt run` failed at 15:17:37.559472 after 6.94 seconds
[0m15:17:37.559808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129081410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104996d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129060410>]}
[0m15:17:37.559986 [debug] [MainThread]: Flushing usage events
[0m15:18:56.657580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fa592d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14febcfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14febd650>]}


============================== 15:18:56.660054 | 7b61c09a-1085-4863-8a87-b5c67811eb6d ==============================
[0m15:18:56.660054 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:18:56.660323 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m15:18:57.410613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16dcced50>]}
[0m15:18:57.436925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f8fca50>]}
[0m15:18:57.437913 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:18:57.458315 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:18:57.526807 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:18:57.527081 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:18:57.546540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c3221d0>]}
[0m15:18:57.614713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e021390>]}
[0m15:18:57.615118 [info ] [MainThread]: Found 5 models, 1 seed, 3 sources, 563 macros
[0m15:18:57.615291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16df526d0>]}
[0m15:18:57.616301 [info ] [MainThread]: 
[0m15:18:57.616615 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:18:57.618868 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:18:57.627696 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:18:57.627982 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:18:57.628135 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:18:58.190414 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.562 seconds
[0m15:18:58.191647 [debug] [ThreadPool]: On list_LB: Close
[0m15:18:58.309453 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:18:58.321276 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:18:58.321602 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:18:58.321793 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:18:58.756203 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.434 seconds
[0m15:18:58.759663 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:18:58.882401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1354f6b90>]}
[0m15:18:58.883258 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:18:58.883592 [info ] [MainThread]: 
[0m15:18:58.885852 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:18:58.886345 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:18:58.886724 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:18:58.886996 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:18:58.893266 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:18:58.893964 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:18:58.910761 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:18:58.911813 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:18:58.912036 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.contract
  );
[0m15:18:58.912239 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:18:59.398694 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.486 seconds
[0m15:18:59.414119 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:18:59.519314 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e2d3b50>]}
[0m15:18:59.520232 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.63s]
[0m15:18:59.520791 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:18:59.521197 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:18:59.521788 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:18:59.522372 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:18:59.522693 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:18:59.525965 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:18:59.527617 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:18:59.530065 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:18:59.531431 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:18:59.531803 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS price_id,
    productid::INTEGER AS product_id,
    pricecomponentid::INTEGER AS price_component_id,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.prices
  );
[0m15:18:59.532105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:00.047092 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.515 seconds
[0m15:19:00.049004 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:19:00.156093 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16dda4b50>]}
[0m15:19:00.156723 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.63s]
[0m15:19:00.157021 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:19:00.157244 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:19:00.157506 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:19:00.157771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:19:00.158028 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:19:00.159987 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:19:00.160510 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:19:00.161907 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:19:00.162801 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:19:00.162983 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.products
  );
[0m15:19:00.163135 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:00.606317 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.443 seconds
[0m15:19:00.609055 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:19:00.720935 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f5a0950>]}
[0m15:19:00.722540 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.56s]
[0m15:19:00.723390 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:19:00.724020 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:19:00.725022 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:19:00.725642 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:19:00.725997 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:19:00.733345 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:00.733960 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:19:00.747968 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:00.749217 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:00.749422 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (-- dbt model


SELECT
    
    
    
        
    
    
    MD5(COALESCE(CAST(contract_id AS VARCHAR), ''))
 AS contract_key,
    *
FROM LB.stage.stg_contract
        );
[0m15:19:00.749636 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:02.121367 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.371 seconds
[0m15:19:02.126158 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:19:02.241567 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f56df50>]}
[0m15:19:02.242772 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.52s]
[0m15:19:02.243403 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:19:02.243803 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:19:02.244359 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:19:02.244831 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:19:02.245144 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:19:02.255849 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:19:02.257184 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:19:02.275549 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:19:02.276052 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    -- dbt model


WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(effective_date) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
    ROW_NUMBER() OVER (PARTITION BY product_id ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    
    
    
        
    
        
    
    
    MD5(COALESCE(CAST(product_id AS VARCHAR), ''), COALESCE(CAST(modificationdate AS VARCHAR), ''))
 AS product_key,
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS effective_date,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY product_id ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products,
  );
[0m15:19:02.276272 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:02.697237 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5935f-0202-d35b-0002-d44600010436
[0m15:19:02.700354 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 10 at position 10
invalid identifier 'MODIFICATIONDATE'
[0m15:19:02.703411 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:19:02.842914 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 10 at position 10
  invalid identifier 'MODIFICATIONDATE'
[0m15:19:02.843388 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7b61c09a-1085-4863-8a87-b5c67811eb6d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16dd0d150>]}
[0m15:19:02.843760 [error] [Thread-1 (]: 5 of 5 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 0.60s]
[0m15:19:02.844067 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:19:02.845669 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:19:02.845874 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:19:02.846059 [info ] [MainThread]: 
[0m15:19:02.846221 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 5.23 seconds (5.23s).
[0m15:19:02.846713 [debug] [MainThread]: Command end result
[0m15:19:02.875088 [info ] [MainThread]: 
[0m15:19:02.875379 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:19:02.875513 [info ] [MainThread]: 
[0m15:19:02.875683 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 10 at position 10
  invalid identifier 'MODIFICATIONDATE'
[0m15:19:02.875814 [info ] [MainThread]: 
[0m15:19:02.875969 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m15:19:02.878425 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.2486277, "process_user_time": 2.296892, "process_kernel_time": 2.170679, "process_mem_max_rss": "190529536", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:19:02.878932 [debug] [MainThread]: Command `dbt run` failed at 15:19:02.878876 after 6.25 seconds
[0m15:19:02.879281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fe96f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10485ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14faec690>]}
[0m15:19:02.879528 [debug] [MainThread]: Flushing usage events
[0m15:19:06.844711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13785bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137880ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137881550>]}


============================== 15:19:06.848025 | 406ea2d7-5d6a-48eb-9057-8e11b66635ff ==============================
[0m15:19:06.848025 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:19:06.849762 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:19:07.727551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142041150>]}
[0m15:19:07.751656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133600990>]}
[0m15:19:07.752330 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:19:07.766857 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:19:07.829655 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:19:07.830000 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:19:07.977592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1320e63d0>]}
[0m15:19:08.020648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d0cca90>]}
[0m15:19:08.020916 [info ] [MainThread]: Found 5 models, 1 seed, 3 sources, 563 macros
[0m15:19:08.021066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d021290>]}
[0m15:19:08.021840 [info ] [MainThread]: 
[0m15:19:08.022067 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:19:08.023804 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:19:08.029243 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:19:08.030512 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:19:08.030732 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:19:08.382952 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.352 seconds
[0m15:19:08.385891 [debug] [ThreadPool]: On list_LB: Close
[0m15:19:08.498640 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:19:08.511162 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:19:08.511625 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:19:08.511822 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:08.895858 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.384 seconds
[0m15:19:08.900408 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:19:09.018343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106423990>]}
[0m15:19:09.019614 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:19:09.020318 [info ] [MainThread]: 
[0m15:19:09.024290 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:19:09.025531 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:19:09.026355 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:19:09.026849 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:19:09.037080 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:19:09.038397 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:19:09.054214 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:19:09.055199 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:19:09.055422 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.contract
  );
[0m15:19:09.055629 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:09.494713 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.439 seconds
[0m15:19:09.521785 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:19:09.627119 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cc9e8d0>]}
[0m15:19:09.628878 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.60s]
[0m15:19:09.630856 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:19:09.637213 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:19:09.637969 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:19:09.638555 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:19:09.639215 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:19:09.643222 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:19:09.644421 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:19:09.647317 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:19:09.648505 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:19:09.648830 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS price_id,
    productid::INTEGER AS product_id,
    pricecomponentid::INTEGER AS price_component_id,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.prices
  );
[0m15:19:09.649126 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:10.181819 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.532 seconds
[0m15:19:10.185626 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:19:10.294077 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d659490>]}
[0m15:19:10.295037 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.66s]
[0m15:19:10.295606 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:19:10.295993 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:19:10.296447 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:19:10.296831 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:19:10.297135 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:19:10.300562 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:19:10.301204 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:19:10.303340 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:19:10.304205 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:19:10.304494 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.products
  );
[0m15:19:10.304763 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:10.798531 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.493 seconds
[0m15:19:10.802975 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:19:10.910997 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d63ee90>]}
[0m15:19:10.911700 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.61s]
[0m15:19:10.912063 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:19:10.912570 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:19:10.913110 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:19:10.913408 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:19:10.913574 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:19:10.916161 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:10.916515 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:19:10.926162 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:10.926804 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:10.926975 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (-- dbt model


SELECT
    
    
    
        
    
    
    MD5(COALESCE(CAST(contract_id AS VARCHAR), ''))
 AS contract_key,
    *
FROM LB.stage.stg_contract
        );
[0m15:19:10.927138 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:12.362716 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.435 seconds
[0m15:19:12.368062 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:19:12.483439 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cc91a10>]}
[0m15:19:12.484871 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.57s]
[0m15:19:12.485713 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:19:12.486319 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:19:12.487012 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:19:12.487640 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:19:12.488015 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:19:12.496911 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:19:12.497965 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:19:12.518059 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:19:12.518511 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    -- dbt model


WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(effective_date) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
    ROW_NUMBER() OVER (PARTITION BY product_id ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    
    
    
        
    
        
    
    
    MD5(COALESCE(CAST(product_id AS VARCHAR), ''), COALESCE(CAST(modificationdate AS VARCHAR), ''))
 AS product_key,
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY product_id ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products,
  );
[0m15:19:12.518764 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:12.971979 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5935f-0202-d36d-0002-d446000113d6
[0m15:19:12.972545 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 10 at position 10
invalid identifier 'MODIFICATIONDATE'
[0m15:19:12.973003 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:19:13.094613 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 10 at position 10
  invalid identifier 'MODIFICATIONDATE'
[0m15:19:13.095606 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '406ea2d7-5d6a-48eb-9057-8e11b66635ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1335d5050>]}
[0m15:19:13.096466 [error] [Thread-1 (]: 5 of 5 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 0.61s]
[0m15:19:13.097189 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:19:13.099779 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:19:13.100101 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:19:13.100524 [info ] [MainThread]: 
[0m15:19:13.100830 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 5.08 seconds (5.08s).
[0m15:19:13.102199 [debug] [MainThread]: Command end result
[0m15:19:13.129362 [info ] [MainThread]: 
[0m15:19:13.129652 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:19:13.129784 [info ] [MainThread]: 
[0m15:19:13.129947 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 10 at position 10
  invalid identifier 'MODIFICATIONDATE'
[0m15:19:13.130071 [info ] [MainThread]: 
[0m15:19:13.130212 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m15:19:13.131583 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.3210588, "process_user_time": 2.335189, "process_kernel_time": 1.847846, "process_mem_max_rss": "195166208", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:19:13.131903 [debug] [MainThread]: Command `dbt run` failed at 15:19:13.131866 after 6.32 seconds
[0m15:19:13.132155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1378439d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a02d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a7c1d0>]}
[0m15:19:13.132311 [debug] [MainThread]: Flushing usage events
[0m15:19:26.451002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d15ba90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d17fc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d15b290>]}


============================== 15:19:26.453658 | c6309ddb-06e5-4713-b94e-ef4b62e56031 ==============================
[0m15:19:26.453658 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:19:26.453946 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:19:27.075457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fa49050>]}
[0m15:19:27.096229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b3ea250>]}
[0m15:19:27.096827 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:19:27.121391 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:19:27.185054 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:19:27.185418 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:19:27.322689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b6bc510>]}
[0m15:19:27.367592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b8cd750>]}
[0m15:19:27.367862 [info ] [MainThread]: Found 5 models, 1 seed, 3 sources, 563 macros
[0m15:19:27.368027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b6df450>]}
[0m15:19:27.368847 [info ] [MainThread]: 
[0m15:19:27.369083 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:19:27.370927 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:19:27.376715 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:19:27.376944 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:19:27.377077 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:19:27.981245 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.604 seconds
[0m15:19:27.983532 [debug] [ThreadPool]: On list_LB: Close
[0m15:19:28.098005 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:19:28.108500 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:19:28.108763 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:19:28.108898 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:28.506295 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.397 seconds
[0m15:19:28.509226 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:19:28.620615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe2d910>]}
[0m15:19:28.621585 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:19:28.622149 [info ] [MainThread]: 
[0m15:19:28.624542 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:19:28.625185 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:19:28.625694 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:19:28.626073 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:19:28.632979 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:19:28.633507 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:19:28.651166 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:19:28.651935 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:19:28.652119 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.contract
  );
[0m15:19:28.652284 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:29.193148 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.541 seconds
[0m15:19:29.203630 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:19:29.311259 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b113c50>]}
[0m15:19:29.312163 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.68s]
[0m15:19:29.312806 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:19:29.313215 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:19:29.313810 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:19:29.314435 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:19:29.314866 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:19:29.318130 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:19:29.318849 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:19:29.321075 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:19:29.322059 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:19:29.322368 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS price_id,
    productid::INTEGER AS product_id,
    pricecomponentid::INTEGER AS price_component_id,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.prices
  );
[0m15:19:29.322670 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:29.748577 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.426 seconds
[0m15:19:29.751617 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:19:29.864191 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bf616d0>]}
[0m15:19:29.865203 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.55s]
[0m15:19:29.865785 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:19:29.866240 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:19:29.866799 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:19:29.867323 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:19:29.867697 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:19:29.872605 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:19:29.873503 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:19:29.876998 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:19:29.878754 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:19:29.879223 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.products
  );
[0m15:19:29.879653 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:30.335268 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.456 seconds
[0m15:19:30.336693 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:19:30.439213 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b886e90>]}
[0m15:19:30.439755 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.57s]
[0m15:19:30.440125 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:19:30.440388 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:19:30.440732 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:19:30.441132 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:19:30.441371 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:19:30.443522 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:30.443938 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:19:30.455085 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:30.455715 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:30.455909 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (-- dbt model


SELECT
    
    
    
        
    
    
    MD5(COALESCE(CAST(contract_id AS VARCHAR), ''))
 AS contract_key,
    *
FROM LB.stage.stg_contract
        );
[0m15:19:30.456091 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:31.515228 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.059 seconds
[0m15:19:31.518616 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:19:31.634308 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b30dad0>]}
[0m15:19:31.634950 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.19s]
[0m15:19:31.635324 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:19:31.635561 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:19:31.635927 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:19:31.636208 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:19:31.636384 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:19:31.640448 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:19:31.640891 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:19:31.658445 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:19:31.659068 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    -- dbt model


WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(effective_date) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
    ROW_NUMBER() OVER (PARTITION BY product_id ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    
    
    
        
    
        
    
    
    MD5(COALESCE(CAST(product_id AS VARCHAR), ''), COALESCE(CAST(modificationdate AS VARCHAR), ''))
 AS product_key,
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY product_id ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products,
  );
[0m15:19:31.659261 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:32.096765 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5935f-0202-d370-0002-d4460001541a
[0m15:19:32.097296 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 10 at position 10
invalid identifier 'MODIFICATIONDATE'
[0m15:19:32.097666 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:19:32.205347 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 10 at position 10
  invalid identifier 'MODIFICATIONDATE'
[0m15:19:32.205765 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6309ddb-06e5-4713-b94e-ef4b62e56031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bfb2b90>]}
[0m15:19:32.206079 [error] [Thread-1 (]: 5 of 5 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 0.57s]
[0m15:19:32.206435 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:19:32.207805 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:19:32.208005 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:19:32.208235 [info ] [MainThread]: 
[0m15:19:32.208419 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 4.84 seconds (4.84s).
[0m15:19:32.208927 [debug] [MainThread]: Command end result
[0m15:19:32.236104 [info ] [MainThread]: 
[0m15:19:32.237216 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:19:32.237790 [info ] [MainThread]: 
[0m15:19:32.238058 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 10 at position 10
  invalid identifier 'MODIFICATIONDATE'
[0m15:19:32.238208 [info ] [MainThread]: 
[0m15:19:32.238369 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m15:19:32.240965 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.830084, "process_user_time": 2.293058, "process_kernel_time": 2.119291, "process_mem_max_rss": "193085440", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:19:32.241757 [debug] [MainThread]: Command `dbt run` failed at 15:19:32.241629 after 5.83 seconds
[0m15:19:32.242154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13baee150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102edad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f541d0>]}
[0m15:19:32.242349 [debug] [MainThread]: Flushing usage events
[0m15:19:52.109479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f8f03d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fdbd250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fdbd8d0>]}


============================== 15:19:52.116764 | e8846e54-b6a7-46e2-86af-80e369016828 ==============================
[0m15:19:52.116764 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:19:52.117830 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:19:53.130267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fd95cd0>]}
[0m15:19:53.151110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f6fcad0>]}
[0m15:19:53.151888 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:19:53.165810 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:19:53.231361 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:19:53.231832 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:19:53.382662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16dd95b50>]}
[0m15:19:53.431877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16decf650>]}
[0m15:19:53.432210 [info ] [MainThread]: Found 5 models, 1 seed, 3 sources, 563 macros
[0m15:19:53.432395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e02c710>]}
[0m15:19:53.433364 [info ] [MainThread]: 
[0m15:19:53.433666 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:19:53.435582 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:19:53.441442 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:19:53.441658 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:19:53.441782 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:19:53.930713 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.489 seconds
[0m15:19:53.933231 [debug] [ThreadPool]: On list_LB: Close
[0m15:19:54.060309 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:19:54.071562 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:19:54.072059 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:19:54.072316 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:19:54.496338 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.424 seconds
[0m15:19:54.498860 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:19:54.606271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f0fef90>]}
[0m15:19:54.609162 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:19:54.609575 [info ] [MainThread]: 
[0m15:19:54.612398 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:19:54.612773 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:19:54.613146 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:19:54.613331 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:19:54.617884 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:19:54.618424 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:19:54.640985 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:19:54.641914 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:19:54.642527 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.contract
  );
[0m15:19:54.642790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:55.130927 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.488 seconds
[0m15:19:55.149658 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:19:55.262492 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f45b510>]}
[0m15:19:55.263030 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.65s]
[0m15:19:55.263344 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:19:55.263558 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:19:55.263911 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:19:55.264240 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:19:55.264399 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:19:55.266203 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:19:55.267045 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:19:55.268697 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:19:55.270380 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:19:55.270567 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS price_id,
    productid::INTEGER AS product_id,
    pricecomponentid::INTEGER AS price_component_id,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.prices
  );
[0m15:19:55.270726 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:55.764280 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.493 seconds
[0m15:19:55.765902 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:19:55.881423 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f62bfd0>]}
[0m15:19:55.882935 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.62s]
[0m15:19:55.883632 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:19:55.884114 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:19:55.884774 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:19:55.885470 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:19:55.885878 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:19:55.894382 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:19:55.896157 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:19:55.897937 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:19:55.898759 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:19:55.898961 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.products
  );
[0m15:19:55.899136 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:56.898107 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.998 seconds
[0m15:19:56.905120 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:19:57.022039 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f642010>]}
[0m15:19:57.023719 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 1.14s]
[0m15:19:57.024746 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:19:57.025421 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:19:57.026060 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:19:57.027158 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:19:57.027709 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:19:57.032659 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:57.033170 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:19:57.051924 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:57.052589 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:19:57.052764 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (-- dbt model


SELECT
    
    
    
        
    
    
    MD5(COALESCE(CAST(contract_id AS VARCHAR), ''))
 AS contract_key,
    *
FROM LB.stage.stg_contract
        );
[0m15:19:57.052921 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:58.235134 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.182 seconds
[0m15:19:58.240053 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:19:58.356891 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16dad5850>]}
[0m15:19:58.358426 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.33s]
[0m15:19:58.359348 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:19:58.359942 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:19:58.360714 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:19:58.361390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:19:58.361855 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:19:58.370695 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:19:58.372266 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:19:58.397096 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:19:58.397614 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    -- dbt model


WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
    ROW_NUMBER() OVER (PARTITION BY product_id ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    
    
    
        
    
        
    
    
    MD5(COALESCE(CAST(product_id AS VARCHAR), ''), COALESCE(CAST(modificationdate AS VARCHAR), ''))
 AS product_key,
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY product_id ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products,
  );
[0m15:19:58.397875 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:19:58.848784 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5935f-0202-d36d-0002-d446000113e2
[0m15:19:58.849642 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 10 at position 10
invalid identifier 'MODIFICATIONDATE'
[0m15:19:58.850221 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:19:58.952210 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 10 at position 10
  invalid identifier 'MODIFICATIONDATE'
[0m15:19:58.952712 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8846e54-b6a7-46e2-86af-80e369016828', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f6af450>]}
[0m15:19:58.953164 [error] [Thread-1 (]: 5 of 5 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 0.59s]
[0m15:19:58.953652 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:19:58.955615 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:19:58.955755 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:19:58.955994 [info ] [MainThread]: 
[0m15:19:58.956332 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 5.52 seconds (5.52s).
[0m15:19:58.957215 [debug] [MainThread]: Command end result
[0m15:19:58.983609 [info ] [MainThread]: 
[0m15:19:58.984010 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:19:58.984173 [info ] [MainThread]: 
[0m15:19:58.984379 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 10 at position 10
  invalid identifier 'MODIFICATIONDATE'
[0m15:19:58.984537 [info ] [MainThread]: 
[0m15:19:58.984723 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m15:19:58.987217 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.91827, "process_user_time": 2.909006, "process_kernel_time": 1.693487, "process_mem_max_rss": "190595072", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:19:58.987635 [debug] [MainThread]: Command `dbt run` failed at 15:19:58.987588 after 6.92 seconds
[0m15:19:58.987930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047ead90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e8afb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104864090>]}
[0m15:19:58.988123 [debug] [MainThread]: Flushing usage events
[0m15:20:58.543869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e554a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e5bd250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e5bd8d0>]}


============================== 15:20:58.546124 | dd285eb5-44bd-400a-a755-d744fa0fda07 ==============================
[0m15:20:58.546124 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:20:58.546391 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:20:59.235060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e556590>]}
[0m15:20:59.254333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ee6ee10>]}
[0m15:20:59.254935 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:20:59.268000 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:20:59.325558 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:20:59.325894 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m15:20:59.467938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eed6410>]}
[0m15:20:59.514937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b4cf650>]}
[0m15:20:59.515365 [info ] [MainThread]: Found 5 models, 1 seed, 3 sources, 563 macros
[0m15:20:59.515567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e2d6a10>]}
[0m15:20:59.516775 [info ] [MainThread]: 
[0m15:20:59.517116 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:20:59.519057 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:20:59.525411 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:20:59.525821 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:20:59.525974 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:21:00.038797 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.513 seconds
[0m15:21:00.040938 [debug] [ThreadPool]: On list_LB: Close
[0m15:21:00.154514 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:21:00.158317 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:21:00.158483 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:21:00.158598 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:21:00.544080 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.385 seconds
[0m15:21:00.549112 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:21:00.649499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b540bd0>]}
[0m15:21:00.651004 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:21:00.651815 [info ] [MainThread]: 
[0m15:21:00.654947 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:21:00.655749 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:21:00.656332 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:21:00.656850 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:21:00.665035 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:21:00.665828 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:21:00.704279 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:21:00.705294 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:21:00.705507 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.contract
  );
[0m15:21:00.705672 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:01.215090 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.509 seconds
[0m15:21:01.238545 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:21:01.354480 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16fbb66d0>]}
[0m15:21:01.356324 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.70s]
[0m15:21:01.357180 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:21:01.357838 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:21:01.358714 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:21:01.359310 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:21:01.359696 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:21:01.364550 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:21:01.366048 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:21:01.368863 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:21:01.370066 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:21:01.370461 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS price_id,
    productid::INTEGER AS product_id,
    pricecomponentid::INTEGER AS price_component_id,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.prices
  );
[0m15:21:01.370807 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:01.875867 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.505 seconds
[0m15:21:01.880724 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:21:01.994476 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b67e210>]}
[0m15:21:01.995532 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.64s]
[0m15:21:01.996146 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:21:01.996618 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:21:01.997217 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:21:01.997709 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:21:01.998090 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:21:02.003059 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:21:02.003978 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:21:02.007699 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:21:02.009175 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:21:02.010194 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:21:02.010859 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:02.496620 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.486 seconds
[0m15:21:02.499464 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:21:02.612607 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x28b506410>]}
[0m15:21:02.613719 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.61s]
[0m15:21:02.614649 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:21:02.615367 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:21:02.616475 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:21:02.617207 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:21:02.617723 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:21:02.624757 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:21:02.625859 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:21:02.666619 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:21:02.669602 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:21:02.670254 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (-- dbt model


SELECT
    
    
    
        
    
    
    MD5(COALESCE(CAST(contract_id AS VARCHAR), ''))
 AS contract_key,
    *
FROM LB.stage.stg_contract
        );
[0m15:21:02.670659 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:03.978729 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.308 seconds
[0m15:21:03.981836 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:21:04.388097 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x28b50edd0>]}
[0m15:21:04.388568 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.77s]
[0m15:21:04.388878 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:21:04.389110 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:21:04.389289 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:21:04.389608 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:21:04.389820 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:21:04.394445 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:21:04.395404 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:21:04.410212 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:21:04.410559 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    -- dbt model


WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
    ROW_NUMBER() OVER (PARTITION BY product_id ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    
    
    
        
    
        
    
    
    MD5(COALESCE(CAST(product_id AS VARCHAR), ''), COALESCE(CAST(modificationdate AS VARCHAR), ''))
 AS product_key,
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY product_id ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products,
  );
[0m15:21:04.410751 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:21:04.885461 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59361-0202-d36d-0002-d446000113ea
[0m15:21:04.886353 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000939 (22023): SQL compilation error: error line 27 at position 4
too many arguments for function [MD5(IFNULL(CAST(CURRENT_PRODUCTS.PRODUCT_ID AS VARCHAR(16777216)), ''), IFNULL(CAST(CURRENT_PRODUCTS.MODIFICATIONDATE AS VARCHAR(16777216)), ''))] expected 1, got 2
[0m15:21:04.887064 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:21:05.009416 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000939 (22023): SQL compilation error: error line 27 at position 4
  too many arguments for function [MD5(IFNULL(CAST(CURRENT_PRODUCTS.PRODUCT_ID AS VARCHAR(16777216)), ''), IFNULL(CAST(CURRENT_PRODUCTS.MODIFICATIONDATE AS VARCHAR(16777216)), ''))] expected 1, got 2
[0m15:21:05.010502 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd285eb5-44bd-400a-a755-d744fa0fda07', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x288104a90>]}
[0m15:21:05.011327 [error] [Thread-1 (]: 5 of 5 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 0.62s]
[0m15:21:05.011962 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:21:05.014886 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:21:05.015490 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:21:05.016132 [info ] [MainThread]: 
[0m15:21:05.016526 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 5.50 seconds (5.50s).
[0m15:21:05.017807 [debug] [MainThread]: Command end result
[0m15:21:05.045049 [info ] [MainThread]: 
[0m15:21:05.045301 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:21:05.045429 [info ] [MainThread]: 
[0m15:21:05.045586 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000939 (22023): SQL compilation error: error line 27 at position 4
  too many arguments for function [MD5(IFNULL(CAST(CURRENT_PRODUCTS.PRODUCT_ID AS VARCHAR(16777216)), ''), IFNULL(CAST(CURRENT_PRODUCTS.MODIFICATIONDATE AS VARCHAR(16777216)), ''))] expected 1, got 2
[0m15:21:05.046055 [info ] [MainThread]: 
[0m15:21:05.046722 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m15:21:05.049507 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.5328636, "process_user_time": 2.254008, "process_kernel_time": 2.487031, "process_mem_max_rss": "197492736", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:21:05.050144 [debug] [MainThread]: Command `dbt run` failed at 15:21:05.050092 after 6.53 seconds
[0m15:21:05.050748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102fced90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e555c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030481d0>]}
[0m15:21:05.050963 [debug] [MainThread]: Flushing usage events
[0m15:22:57.122504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145e96490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145e56f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145ebe110>]}


============================== 15:22:57.125181 | 2dd5f4be-04cf-4143-aab8-529c4073cbb2 ==============================
[0m15:22:57.125181 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:22:57.125529 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m15:22:57.785443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145e56f10>]}
[0m15:22:57.804605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145900b10>]}
[0m15:22:57.805086 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:22:57.816533 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:22:57.878074 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:22:57.878423 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:22:58.026067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x157eac450>]}
[0m15:22:58.078948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x157d05b50>]}
[0m15:22:58.079224 [info ] [MainThread]: Found 5 models, 1 seed, 3 sources, 563 macros
[0m15:22:58.079383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1440e2f10>]}
[0m15:22:58.080184 [info ] [MainThread]: 
[0m15:22:58.080412 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:22:58.082207 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:22:58.087826 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:22:58.088037 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:22:58.088163 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:22:58.594143 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.506 seconds
[0m15:22:58.596893 [debug] [ThreadPool]: On list_LB: Close
[0m15:22:58.708761 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:22:58.720244 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:22:58.720629 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:22:58.720883 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:22:59.088646 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.368 seconds
[0m15:22:59.092373 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:22:59.208301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x157eac550>]}
[0m15:22:59.209550 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:22:59.210073 [info ] [MainThread]: 
[0m15:22:59.213680 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:22:59.214373 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:22:59.215012 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:22:59.215464 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:22:59.221675 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:22:59.222618 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:22:59.237040 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:22:59.237753 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:22:59.237917 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.contract
  );
[0m15:22:59.238097 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:22:59.895948 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.658 seconds
[0m15:22:59.916871 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:23:00.029005 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1681c5990>]}
[0m15:23:00.030068 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.81s]
[0m15:23:00.030859 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:23:00.031371 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:23:00.032198 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:23:00.032784 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:23:00.033685 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:23:00.038133 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:23:00.040669 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:23:00.044113 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:23:00.044961 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:23:00.045625 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS price_id,
    productid::INTEGER AS product_id,
    pricecomponentid::INTEGER AS price_component_id,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modification_date
FROM lb.raw.prices
  );
[0m15:23:00.045967 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:23:01.004773 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.959 seconds
[0m15:23:01.008151 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:23:01.127795 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168273490>]}
[0m15:23:01.129314 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 1.09s]
[0m15:23:01.130300 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:23:01.131088 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:23:01.131996 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:23:01.132594 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:23:01.132998 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:23:01.163201 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:23:01.164428 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:23:01.168781 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:23:01.171398 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:23:01.171983 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:23:01.174274 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:23:01.618047 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.446 seconds
[0m15:23:01.619102 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:23:01.728787 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16805b890>]}
[0m15:23:01.729235 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.60s]
[0m15:23:01.729500 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:23:01.729696 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:23:01.729973 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:23:01.730891 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:23:01.731108 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:23:01.733605 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:23:01.734340 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:23:01.755044 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:23:01.756002 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:23:01.756205 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (-- dbt model


SELECT
    
    
    
        
    
    
    MD5(COALESCE(CAST(contract_id AS VARCHAR), ''))
 AS contract_key,
    *
FROM LB.stage.stg_contract
        );
[0m15:23:01.756371 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:23:03.093297 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.336 seconds
[0m15:23:03.098563 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:23:03.229922 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16805bdd0>]}
[0m15:23:03.230997 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.50s]
[0m15:23:03.231499 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:23:03.231849 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:23:03.232116 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:23:03.232676 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:23:03.232842 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:23:03.237556 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:23:03.238380 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:23:03.253356 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:23:03.253670 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY product_id ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    
    
    
        
    
        
    
    
    MD5(COALESCE(CAST(product_id AS VARCHAR), ''), COALESCE(CAST(modificationdate AS VARCHAR), ''))
 AS product_key,
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS effective_date,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY product_id ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m15:23:03.253971 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:23:03.665390 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59363-0202-d36d-0002-d446000113f6
[0m15:23:03.666014 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000939 (22023): SQL compilation error: error line 26 at position 4
too many arguments for function [MD5(IFNULL(CAST(CURRENT_PRODUCTS.PRODUCT_ID AS VARCHAR(16777216)), ''), IFNULL(CAST(CURRENT_PRODUCTS.MODIFICATIONDATE AS VARCHAR(16777216)), ''))] expected 1, got 2
[0m15:23:03.666612 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:23:03.945232 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000939 (22023): SQL compilation error: error line 26 at position 4
  too many arguments for function [MD5(IFNULL(CAST(CURRENT_PRODUCTS.PRODUCT_ID AS VARCHAR(16777216)), ''), IFNULL(CAST(CURRENT_PRODUCTS.MODIFICATIONDATE AS VARCHAR(16777216)), ''))] expected 1, got 2
[0m15:23:03.945897 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2dd5f4be-04cf-4143-aab8-529c4073cbb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155068190>]}
[0m15:23:03.946460 [error] [Thread-1 (]: 5 of 5 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 0.71s]
[0m15:23:03.946994 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:23:03.951749 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:23:03.952209 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:23:03.952725 [info ] [MainThread]: 
[0m15:23:03.953008 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 5.87 seconds (5.87s).
[0m15:23:03.953739 [debug] [MainThread]: Command end result
[0m15:23:03.973145 [info ] [MainThread]: 
[0m15:23:03.973459 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:23:03.973606 [info ] [MainThread]: 
[0m15:23:03.973783 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000939 (22023): SQL compilation error: error line 26 at position 4
  too many arguments for function [MD5(IFNULL(CAST(CURRENT_PRODUCTS.PRODUCT_ID AS VARCHAR(16777216)), ''), IFNULL(CAST(CURRENT_PRODUCTS.MODIFICATIONDATE AS VARCHAR(16777216)), ''))] expected 1, got 2
[0m15:23:03.973936 [info ] [MainThread]: 
[0m15:23:03.974089 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m15:23:03.975963 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.8829975, "process_user_time": 2.047318, "process_kernel_time": 2.47494, "process_mem_max_rss": "200982528", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:23:03.976357 [debug] [MainThread]: Command `dbt run` failed at 15:23:03.976316 after 6.88 seconds
[0m15:23:03.976616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b56d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145e9c2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1681bbb50>]}
[0m15:23:03.976793 [debug] [MainThread]: Flushing usage events
[0m15:29:08.436170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fa5b590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fabd390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fabda10>]}


============================== 15:29:08.439146 | 40fa8844-0700-4d63-bb8f-fa7f04e2d4ac ==============================
[0m15:29:08.439146 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:29:08.439509 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:29:09.154823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '40fa8844-0700-4d63-bb8f-fa7f04e2d4ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fa9ca50>]}
[0m15:29:09.175448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '40fa8844-0700-4d63-bb8f-fa7f04e2d4ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f400c10>]}
[0m15:29:09.176087 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:29:09.193780 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:29:09.270250 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 3 files changed.
[0m15:29:09.270658 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_contract.sql
[0m15:29:09.270902 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m15:29:09.271077 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:29:09.271245 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m15:29:09.446361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '40fa8844-0700-4d63-bb8f-fa7f04e2d4ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b28f650>]}
[0m15:29:09.494438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '40fa8844-0700-4d63-bb8f-fa7f04e2d4ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x175a40710>]}
[0m15:29:09.494710 [info ] [MainThread]: Found 1 seed, 4 models, 3 sources, 563 macros
[0m15:29:09.494865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '40fa8844-0700-4d63-bb8f-fa7f04e2d4ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x175b385d0>]}
[0m15:29:09.495746 [info ] [MainThread]: 
[0m15:29:09.495981 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:29:09.497806 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:29:09.503385 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:29:09.503629 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:29:09.503761 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:29:10.155287 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.651 seconds
[0m15:29:10.158548 [debug] [ThreadPool]: On list_LB: Close
[0m15:29:10.282618 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:29:10.295362 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:29:10.295835 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:29:10.296140 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:29:10.741342 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.445 seconds
[0m15:29:10.742829 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:29:10.852995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '40fa8844-0700-4d63-bb8f-fa7f04e2d4ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x175ca7710>]}
[0m15:29:10.853590 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:29:10.853828 [info ] [MainThread]: 
[0m15:29:10.856064 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:29:10.856463 [info ] [Thread-1 (]: 1 of 4 START sql view model stage.stg_contract ................................. [RUN]
[0m15:29:10.856722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:29:10.856909 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:29:10.862756 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:29:10.863315 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:29:10.880669 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:29:10.881958 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:29:10.882200 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m15:29:10.882398 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:29:11.399728 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.517 seconds
[0m15:29:11.421316 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:29:11.532038 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '40fa8844-0700-4d63-bb8f-fa7f04e2d4ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17763bf10>]}
[0m15:29:11.534955 [info ] [Thread-1 (]: 1 of 4 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.67s]
[0m15:29:11.535675 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:29:11.536397 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:29:11.537329 [info ] [Thread-1 (]: 2 of 4 START sql view model stage.stg_prices ................................... [RUN]
[0m15:29:11.538101 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:29:11.538637 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:29:11.544380 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:29:11.546196 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:29:11.550094 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:29:11.551158 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:29:11.551400 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m15:29:11.551589 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:29:12.025780 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.474 seconds
[0m15:29:12.028012 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:29:12.135745 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '40fa8844-0700-4d63-bb8f-fa7f04e2d4ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x175ae3450>]}
[0m15:29:12.137397 [info ] [Thread-1 (]: 2 of 4 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.60s]
[0m15:29:12.138232 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:29:12.138781 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:29:12.139358 [info ] [Thread-1 (]: 3 of 4 START sql view model stage.stg_products ................................. [RUN]
[0m15:29:12.139874 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:29:12.140264 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:29:12.144865 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:29:12.146197 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:29:12.148818 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:29:12.149973 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:29:12.150152 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:29:12.150338 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:29:12.737477 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.587 seconds
[0m15:29:12.740844 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:29:12.855401 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '40fa8844-0700-4d63-bb8f-fa7f04e2d4ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x175a83490>]}
[0m15:29:12.856527 [info ] [Thread-1 (]: 3 of 4 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.72s]
[0m15:29:12.857648 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:29:12.859305 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:29:12.860240 [info ] [Thread-1 (]: 4 of 4 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:29:12.861038 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_product)
[0m15:29:12.861506 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:29:12.887896 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:29:12.889646 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:29:12.922944 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:29:12.923421 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY product_id ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY product_id ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m15:29:12.923803 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:29:13.485562 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.561 seconds
[0m15:29:13.500309 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:29:13.501132 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m15:29:13.629683 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.128 seconds
[0m15:29:13.637771 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:29:13.638370 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m15:29:13.714323 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.075 seconds
[0m15:29:13.722289 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:29:13.722640 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m15:29:13.779770 [debug] [Thread-1 (]: SQL status: SUCCESS 9 in 0.057 seconds
[0m15:29:13.792675 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m15:29:13.793623 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:29:13.793782 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m15:29:13.879167 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.085 seconds
[0m15:29:13.879440 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:29:13.879625 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
                ) and (
                    DBT_INTERNAL_SOURCE.modificationdate = DBT_INTERNAL_DEST.modificationdate
                )

    
    when matched then update set
        "PRODUCT_KEY" = DBT_INTERNAL_SOURCE."PRODUCT_KEY","PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCT_KEY", "PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "END_DATE", "IS_CURRENT")
    values
        ("PRODUCT_KEY", "PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "END_DATE", "IS_CURRENT")

;
[0m15:29:14.012422 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59369-0202-d372-0002-d4460001346a
[0m15:29:14.012654 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 9
invalid identifier 'PRODUCT_KEY'
[0m15:29:14.012859 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:29:14.137530 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 17 at position 9
  invalid identifier 'PRODUCT_KEY'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_product.sql
[0m15:29:14.138627 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '40fa8844-0700-4d63-bb8f-fa7f04e2d4ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x177c64950>]}
[0m15:29:14.139478 [error] [Thread-1 (]: 4 of 4 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 1.28s]
[0m15:29:14.140189 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:29:14.142494 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:29:14.142866 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:29:14.143266 [info ] [MainThread]: 
[0m15:29:14.143591 [info ] [MainThread]: Finished running 3 view models, 1 incremental model in 0 hours 0 minutes and 4.65 seconds (4.65s).
[0m15:29:14.144521 [debug] [MainThread]: Command end result
[0m15:29:14.164377 [info ] [MainThread]: 
[0m15:29:14.164631 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:29:14.164763 [info ] [MainThread]: 
[0m15:29:14.164931 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 17 at position 9
  invalid identifier 'PRODUCT_KEY'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_product.sql
[0m15:29:14.165059 [info ] [MainThread]: 
[0m15:29:14.165194 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m15:29:14.166548 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.7676086, "process_user_time": 2.719587, "process_kernel_time": 1.109626, "process_mem_max_rss": "198639616", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:29:14.166897 [debug] [MainThread]: Command `dbt run` failed at 15:29:14.166859 after 5.77 seconds
[0m15:29:14.167131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fa9c710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042d2d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042e1650>]}
[0m15:29:14.167293 [debug] [MainThread]: Flushing usage events
[0m15:30:25.235088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146457610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1464bd850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1464bded0>]}


============================== 15:30:25.237945 | 3d997679-0532-4a05-a9c6-ea9a6e87c3d1 ==============================
[0m15:30:25.237945 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:30:25.238235 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:30:26.012941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3d997679-0532-4a05-a9c6-ea9a6e87c3d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146db5cd0>]}
[0m15:30:26.032486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3d997679-0532-4a05-a9c6-ea9a6e87c3d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145e009d0>]}
[0m15:30:26.033195 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:30:26.046420 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:30:26.118090 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:30:26.118396 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:30:26.138378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3d997679-0532-4a05-a9c6-ea9a6e87c3d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b474f90>]}
[0m15:30:26.188015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3d997679-0532-4a05-a9c6-ea9a6e87c3d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b090550>]}
[0m15:30:26.188371 [info ] [MainThread]: Found 1 seed, 4 models, 3 sources, 563 macros
[0m15:30:26.188529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d997679-0532-4a05-a9c6-ea9a6e87c3d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b081950>]}
[0m15:30:26.189455 [info ] [MainThread]: 
[0m15:30:26.189768 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:30:26.191745 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:30:26.198227 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:30:26.198467 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:30:26.198603 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:30:29.669710 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 3.471 seconds
[0m15:30:29.673347 [debug] [ThreadPool]: On list_LB: Close
[0m15:30:29.792332 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:30:29.800880 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:30:29.801207 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:30:29.801413 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:30:30.299585 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.498 seconds
[0m15:30:30.301096 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:30:30.422182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d997679-0532-4a05-a9c6-ea9a6e87c3d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a2f17d0>]}
[0m15:30:30.422670 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:30:30.422871 [info ] [MainThread]: 
[0m15:30:30.424786 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:30:30.425106 [info ] [Thread-1 (]: 1 of 4 START sql view model stage.stg_contract ................................. [RUN]
[0m15:30:30.425341 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:30:30.425496 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:30:30.429695 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:30:30.430769 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:30:30.453931 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:30:30.454705 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:30:30.454889 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contract_id,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS created_at,
    startdate::DATE AS start_date,
    enddate::DATE AS end_date,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS product_id,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m15:30:30.455093 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:30:31.079547 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.621 seconds
[0m15:30:31.103832 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:30:31.213228 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d997679-0532-4a05-a9c6-ea9a6e87c3d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9786d0>]}
[0m15:30:31.213940 [info ] [Thread-1 (]: 1 of 4 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.79s]
[0m15:30:31.214913 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:30:31.215788 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:30:31.217856 [info ] [Thread-1 (]: 2 of 4 START sql view model stage.stg_prices ................................... [RUN]
[0m15:30:31.218194 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:30:31.218364 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:30:31.229303 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:30:31.230742 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:30:31.232976 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:30:31.233976 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:30:31.234442 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m15:30:31.234689 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:30:31.734992 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.500 seconds
[0m15:30:31.737702 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:30:31.856480 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d997679-0532-4a05-a9c6-ea9a6e87c3d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b5aacd0>]}
[0m15:30:31.857489 [info ] [Thread-1 (]: 2 of 4 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.64s]
[0m15:30:31.858478 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:30:31.859240 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:30:31.860176 [info ] [Thread-1 (]: 3 of 4 START sql view model stage.stg_products ................................. [RUN]
[0m15:30:31.860992 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:30:31.861654 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:30:31.867633 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:30:31.869380 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:30:31.872562 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:30:31.873845 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:30:31.874218 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS product_id,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:30:31.874550 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:30:32.509931 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.635 seconds
[0m15:30:32.514774 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:30:32.632389 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d997679-0532-4a05-a9c6-ea9a6e87c3d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b4480d0>]}
[0m15:30:32.633634 [info ] [Thread-1 (]: 3 of 4 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.77s]
[0m15:30:32.634328 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:30:32.635695 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:30:32.636381 [info ] [Thread-1 (]: 4 of 4 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:30:32.636897 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_product)
[0m15:30:32.637315 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:30:32.648338 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:30:32.650042 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:30:32.669450 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:30:32.669793 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY product_id ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY product_id ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m15:30:32.670024 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:30:33.358392 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.688 seconds
[0m15:30:33.371543 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:30:33.372111 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m15:30:33.472304 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.100 seconds
[0m15:30:33.481489 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:30:33.481950 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m15:30:33.559690 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.077 seconds
[0m15:30:33.573004 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:30:33.573602 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m15:30:33.664780 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.091 seconds
[0m15:30:33.700822 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m15:30:33.701923 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:30:33.702145 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m15:30:33.797052 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.095 seconds
[0m15:30:33.797326 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:30:33.797514 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.product_id = DBT_INTERNAL_DEST.product_id
                ) and (
                    DBT_INTERNAL_SOURCE.modificationdate = DBT_INTERNAL_DEST.modificationdate
                )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "END_DATE", "IS_CURRENT")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "END_DATE", "IS_CURRENT")

;
[0m15:30:34.657229 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.859 seconds
[0m15:30:34.657519 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:30:34.657686 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m15:30:34.762303 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.104 seconds
[0m15:30:34.772368 [debug] [Thread-1 (]: Applying DROP to: LB.stage.dim_product__dbt_tmp
[0m15:30:34.775524 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:30:34.775752 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.stage.dim_product__dbt_tmp cascade
[0m15:30:34.895995 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.120 seconds
[0m15:30:34.899608 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:30:35.023854 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d997679-0532-4a05-a9c6-ea9a6e87c3d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b44a6d0>]}
[0m15:30:35.025558 [info ] [Thread-1 (]: 4 of 4 OK created sql incremental model stage.dim_product ...................... [[32mSUCCESS 0[0m in 2.39s]
[0m15:30:35.026529 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:30:35.028201 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:30:35.028645 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:30:35.029116 [info ] [MainThread]: 
[0m15:30:35.029479 [info ] [MainThread]: Finished running 3 view models, 1 incremental model in 0 hours 0 minutes and 8.84 seconds (8.84s).
[0m15:30:35.030583 [debug] [MainThread]: Command end result
[0m15:30:35.066827 [info ] [MainThread]: 
[0m15:30:35.067159 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:30:35.067334 [info ] [MainThread]: 
[0m15:30:35.067507 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m15:30:35.069061 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.870801, "process_user_time": 2.467864, "process_kernel_time": 2.107973, "process_mem_max_rss": "190889984", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:30:35.069471 [debug] [MainThread]: Command `dbt run` succeeded at 15:30:35.069422 after 9.87 seconds
[0m15:30:35.069847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d16d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d16cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e10750>]}
[0m15:30:35.070039 [debug] [MainThread]: Flushing usage events
[0m15:35:39.770689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d31f190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139b5d650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d381a10>]}


============================== 15:35:39.773712 | 29972eb1-6279-4cc7-b177-412f92029f7b ==============================
[0m15:35:39.773712 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:35:39.774067 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:35:40.510612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '29972eb1-6279-4cc7-b177-412f92029f7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a955a10>]}
[0m15:35:40.529577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '29972eb1-6279-4cc7-b177-412f92029f7b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x139a00c90>]}
[0m15:35:40.530122 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:35:40.544364 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:35:40.617892 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 3 files changed.
[0m15:35:40.618218 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_contract.sql
[0m15:35:40.618391 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:35:40.618559 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m15:35:40.618717 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m15:35:40.762966 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.dim_contract' (models/staging/dim_contract.sql) depends on a node named 'stg_contracts' which was not found
[0m15:35:40.767670 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0318389, "process_user_time": 1.880119, "process_kernel_time": 2.040574, "process_mem_max_rss": "182927360", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:35:40.767948 [debug] [MainThread]: Command `dbt run` failed at 15:35:40.767904 after 1.03 seconds
[0m15:35:40.768120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d360a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f52d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ae30290>]}
[0m15:35:40.768294 [debug] [MainThread]: Flushing usage events
[0m15:35:55.116334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143e59590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143e81250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143e81890>]}


============================== 15:35:55.119238 | ff9d66b0-67f5-4afc-b3d3-22b0712e45d8 ==============================
[0m15:35:55.119238 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:35:55.119556 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m15:35:55.708543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1688cf650>]}
[0m15:35:55.727387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143500990>]}
[0m15:35:55.727874 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:35:55.739463 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:35:55.796824 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 3 files changed.
[0m15:35:55.797115 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_contract.sql
[0m15:35:55.797285 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:35:55.797461 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m15:35:55.797625 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m15:35:55.976098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1403e31d0>]}
[0m15:35:56.037963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143aec8d0>]}
[0m15:35:56.038327 [info ] [MainThread]: Found 1 seed, 5 models, 3 sources, 563 macros
[0m15:35:56.038499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16890e850>]}
[0m15:35:56.039594 [info ] [MainThread]: 
[0m15:35:56.039884 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:35:56.043202 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:35:56.055040 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:35:56.055330 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:35:56.055473 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:35:56.525260 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.470 seconds
[0m15:35:56.526435 [debug] [ThreadPool]: On list_LB: Close
[0m15:35:56.644090 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:35:56.652136 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:35:56.652396 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:35:56.652543 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:35:56.997258 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.345 seconds
[0m15:35:57.002008 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:35:57.127423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168ad6810>]}
[0m15:35:57.128562 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:35:57.129013 [info ] [MainThread]: 
[0m15:35:57.132724 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:35:57.133374 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:35:57.133771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:35:57.133937 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:35:57.140432 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:35:57.140894 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:35:57.154840 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:35:57.155602 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:35:57.155785 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m15:35:57.155943 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:35:57.633361 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.477 seconds
[0m15:35:57.661441 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:35:57.786534 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168992d50>]}
[0m15:35:57.788101 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.65s]
[0m15:35:57.789125 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:35:57.789781 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:35:57.790797 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:35:57.791416 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:35:57.791866 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:35:57.796392 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:35:57.797818 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:35:57.800342 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:35:57.801426 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:35:57.801710 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m15:35:57.802052 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:35:58.342638 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.541 seconds
[0m15:35:58.344248 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:35:58.488360 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1692b3a10>]}
[0m15:35:58.490056 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.70s]
[0m15:35:58.490972 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:35:58.491556 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:35:58.492315 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:35:58.493036 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:35:58.493487 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:35:58.498200 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:35:58.499122 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:35:58.502248 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:35:58.503294 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:35:58.503646 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:35:58.503984 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:35:58.976770 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.473 seconds
[0m15:35:58.979851 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:35:59.092760 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168b72810>]}
[0m15:35:59.093574 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.60s]
[0m15:35:59.094138 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:35:59.094526 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:35:59.095089 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:35:59.095496 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:35:59.095784 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:35:59.101140 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:35:59.102344 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:35:59.115058 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:35:59.116014 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:35:59.116178 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m15:35:59.116325 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:36:00.693238 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.577 seconds
[0m15:36:00.700665 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:36:00.821167 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168d2fcd0>]}
[0m15:36:00.823106 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.72s]
[0m15:36:00.824571 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:36:00.825585 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:36:00.826538 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:36:00.827199 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:36:00.827650 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:36:00.837651 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:36:00.839132 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:36:00.877314 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:36:00.877747 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY product_id ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    product_id,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY productid ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m15:36:00.878010 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:36:01.445071 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59370-0202-d370-0002-d44600015452
[0m15:36:01.445402 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 14 at position 43
invalid identifier 'PRODUCT_ID'
[0m15:36:01.445706 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:36:01.570193 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 14 at position 43
  invalid identifier 'PRODUCT_ID'
[0m15:36:01.571368 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff9d66b0-67f5-4afc-b3d3-22b0712e45d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16914d5d0>]}
[0m15:36:01.572327 [error] [Thread-1 (]: 5 of 5 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 0.74s]
[0m15:36:01.573043 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:36:01.575992 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:36:01.576391 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:36:01.576894 [info ] [MainThread]: 
[0m15:36:01.577213 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 5.54 seconds (5.54s).
[0m15:36:01.578272 [debug] [MainThread]: Command end result
[0m15:36:01.611104 [info ] [MainThread]: 
[0m15:36:01.611426 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:36:01.611594 [info ] [MainThread]: 
[0m15:36:01.611807 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 14 at position 43
  invalid identifier 'PRODUCT_ID'
[0m15:36:01.611968 [info ] [MainThread]: 
[0m15:36:01.612154 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m15:36:01.613946 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.5321703, "process_user_time": 2.359556, "process_kernel_time": 2.314748, "process_mem_max_rss": "188956672", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:36:01.614374 [debug] [MainThread]: Command `dbt run` failed at 15:36:01.614330 after 6.53 seconds
[0m15:36:01.614667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100572d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143e60610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143503650>]}
[0m15:36:01.614845 [debug] [MainThread]: Flushing usage events
[0m15:36:33.034723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14661b210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14665bb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146681e90>]}


============================== 15:36:33.037297 | ca7ba5c8-5178-49ab-8367-a3eb5b227472 ==============================
[0m15:36:33.037297 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:36:33.037589 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:36:34.082254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146622e90>]}
[0m15:36:34.101826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137cfc990>]}
[0m15:36:34.102441 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:36:34.117877 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:36:34.243333 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:36:34.243767 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:36:34.378219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16172ea90>]}
[0m15:36:34.432087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165f03c10>]}
[0m15:36:34.432484 [info ] [MainThread]: Found 1 seed, 5 models, 3 sources, 563 macros
[0m15:36:34.432643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165f5cbd0>]}
[0m15:36:34.433516 [info ] [MainThread]: 
[0m15:36:34.433909 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:36:34.435972 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:36:34.441946 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:36:34.442167 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:36:34.442296 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:36:34.868096 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.426 seconds
[0m15:36:34.870554 [debug] [ThreadPool]: On list_LB: Close
[0m15:36:34.993492 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:36:35.005209 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:36:35.005495 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:36:35.005620 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:36:35.455772 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.450 seconds
[0m15:36:35.459295 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:36:35.576877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127ef7c90>]}
[0m15:36:35.578012 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:36:35.578594 [info ] [MainThread]: 
[0m15:36:35.581663 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:36:35.582428 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:36:35.583047 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:36:35.583439 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:36:35.590836 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:36:35.591650 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:36:35.608125 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:36:35.609070 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:36:35.609281 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m15:36:35.609445 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:36:36.213657 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.604 seconds
[0m15:36:36.239953 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:36:36.349735 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16603a090>]}
[0m15:36:36.351345 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.76s]
[0m15:36:36.352377 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:36:36.353088 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:36:36.353957 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:36:36.354819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:36:36.355289 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:36:36.360610 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:36:36.361955 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:36:36.364067 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:36:36.364991 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:36:36.365195 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m15:36:36.365385 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:36:36.890435 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.525 seconds
[0m15:36:36.894425 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:36:37.001895 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127ef7dd0>]}
[0m15:36:37.002886 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.65s]
[0m15:36:37.003552 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:36:37.004063 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:36:37.004706 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:36:37.005256 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:36:37.005667 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:36:37.016567 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:36:37.017694 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:36:37.021414 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:36:37.022398 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:36:37.022648 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:36:37.022871 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:36:37.535803 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.513 seconds
[0m15:36:37.537273 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:36:37.649921 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16670ff90>]}
[0m15:36:37.650486 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.64s]
[0m15:36:37.650775 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:36:37.650995 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:36:37.651325 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:36:37.651702 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:36:37.651857 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:36:37.653560 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:36:37.654164 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:36:37.663551 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:36:37.664207 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:36:37.664385 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m15:36:37.664536 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:36:38.774774 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.110 seconds
[0m15:36:38.777000 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:36:38.887092 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1665384d0>]}
[0m15:36:38.888462 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.23s]
[0m15:36:38.889426 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:36:38.890116 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:36:38.891021 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:36:38.891798 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:36:38.892252 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:36:38.900068 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:36:38.901219 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:36:38.922641 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:36:38.922980 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY productid ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY productid ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m15:36:38.923177 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:36:39.488528 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.565 seconds
[0m15:36:39.500185 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:36:39.500750 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m15:36:39.585516 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.084 seconds
[0m15:36:39.590886 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:36:39.591391 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m15:36:39.662938 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.071 seconds
[0m15:36:39.673899 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:36:39.674429 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m15:36:39.780807 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.106 seconds
[0m15:36:39.805078 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m15:36:39.806033 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:36:39.806220 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m15:36:39.922395 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.116 seconds
[0m15:36:39.922853 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:36:39.923193 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.modificationdate = DBT_INTERNAL_DEST.modificationdate
                )

    
    when matched then update set
        "PRODUCT_ID" = DBT_INTERNAL_SOURCE."PRODUCT_ID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","END_DATE" = DBT_INTERNAL_SOURCE."END_DATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "END_DATE", "IS_CURRENT")
    values
        ("PRODUCT_ID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "END_DATE", "IS_CURRENT")

;
[0m15:36:40.075389 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59370-0202-d370-0002-d44600015466
[0m15:36:40.075968 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 9
invalid identifier 'PRODUCT_ID'
[0m15:36:40.076495 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:36:40.187765 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 17 at position 9
  invalid identifier 'PRODUCT_ID'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_product.sql
[0m15:36:40.188493 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca7ba5c8-5178-49ab-8367-a3eb5b227472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1667924d0>]}
[0m15:36:40.189078 [error] [Thread-1 (]: 5 of 5 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 1.30s]
[0m15:36:40.189677 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:36:40.191784 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:36:40.192143 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:36:40.192595 [info ] [MainThread]: 
[0m15:36:40.192979 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 5.76 seconds (5.76s).
[0m15:36:40.194065 [debug] [MainThread]: Command end result
[0m15:36:40.230697 [info ] [MainThread]: 
[0m15:36:40.231019 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:36:40.231157 [info ] [MainThread]: 
[0m15:36:40.231322 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 17 at position 9
  invalid identifier 'PRODUCT_ID'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_product.sql
[0m15:36:40.231456 [info ] [MainThread]: 
[0m15:36:40.231734 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m15:36:40.234068 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.229305, "process_user_time": 2.551638, "process_kernel_time": 2.229759, "process_mem_max_rss": "195428352", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:36:40.234677 [debug] [MainThread]: Command `dbt run` failed at 15:36:40.234608 after 7.23 seconds
[0m15:36:40.235060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e22d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146659950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e93fd0>]}
[0m15:36:40.235243 [debug] [MainThread]: Flushing usage events
[0m15:37:55.044425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120f5b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120fbd090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120fbd710>]}


============================== 15:37:55.047555 | 05506a3e-0568-4ba8-8597-8255b321e180 ==============================
[0m15:37:55.047555 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:37:55.047902 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:37:56.385751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e0950d0>]}
[0m15:37:56.413666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117796c90>]}
[0m15:37:56.415705 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:37:56.444844 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:37:56.539035 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:37:56.539292 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:37:56.557173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e0a1890>]}
[0m15:37:56.608184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e3622d0>]}
[0m15:37:56.608480 [info ] [MainThread]: Found 1 seed, 5 models, 3 sources, 563 macros
[0m15:37:56.608645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e250050>]}
[0m15:37:56.609649 [info ] [MainThread]: 
[0m15:37:56.609932 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:37:56.611803 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:37:56.618050 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:37:56.618257 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:37:56.618386 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:37:57.204882 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.586 seconds
[0m15:37:57.205943 [debug] [ThreadPool]: On list_LB: Close
[0m15:37:57.313265 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:37:57.319485 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:37:57.319743 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:37:57.319937 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:37:57.742728 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.423 seconds
[0m15:37:57.746907 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:37:57.861753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e081410>]}
[0m15:37:57.862586 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:37:57.862991 [info ] [MainThread]: 
[0m15:37:57.864784 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:37:57.865065 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:37:57.865309 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:37:57.865451 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:37:57.869641 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:37:57.870607 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:37:57.888250 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:37:57.889289 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:37:57.889483 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m15:37:57.889641 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:37:58.360854 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.471 seconds
[0m15:37:58.378521 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:37:58.488397 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120f973d0>]}
[0m15:37:58.489645 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.62s]
[0m15:37:58.490604 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:37:58.491308 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:37:58.492165 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:37:58.493071 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:37:58.493520 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:37:58.500926 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:37:58.502393 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:37:58.504623 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:37:58.505719 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:37:58.505890 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m15:37:58.506045 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:37:58.976430 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.470 seconds
[0m15:37:58.978008 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:37:59.092180 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e206990>]}
[0m15:37:59.092645 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.60s]
[0m15:37:59.092927 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:37:59.093118 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:37:59.093335 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:37:59.093521 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:37:59.093662 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:37:59.095314 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:37:59.095681 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:37:59.096962 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:37:59.097743 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:37:59.097917 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:37:59.098083 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:37:59.606566 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.508 seconds
[0m15:37:59.610979 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:37:59.730025 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f811410>]}
[0m15:37:59.731387 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.64s]
[0m15:37:59.732309 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:37:59.732963 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:37:59.733852 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:37:59.734807 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:37:59.735353 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:37:59.740647 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:37:59.741851 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:37:59.755525 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:37:59.756507 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:37:59.756713 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m15:37:59.756873 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:38:01.002670 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.245 seconds
[0m15:38:01.007352 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:38:01.134175 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1274539d0>]}
[0m15:38:01.135779 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.40s]
[0m15:38:01.136871 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:38:01.137596 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:38:01.138319 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:38:01.138968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:38:01.139417 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:38:01.151138 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:38:01.152281 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:38:01.175247 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:01.175542 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY productid ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY productid ORDER BY modificationdate) AS end_date,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m15:38:01.175724 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:38:01.717543 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.542 seconds
[0m15:38:01.729674 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:01.730315 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m15:38:01.833105 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.102 seconds
[0m15:38:01.839517 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:01.839932 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m15:38:01.945844 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.106 seconds
[0m15:38:01.957061 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:01.957617 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m15:38:02.022682 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.065 seconds
[0m15:38:02.051908 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m15:38:02.052888 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:02.053063 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m15:38:02.145150 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.092 seconds
[0m15:38:02.145699 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:02.146360 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.modificationdate = DBT_INTERNAL_DEST.modificationdate
                )

    
    when matched then update set
        "PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")
    values
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")

;
[0m15:38:02.316478 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b59372-0202-d36c-0002-d446000144be
[0m15:38:02.316786 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 101
invalid identifier 'ENDDATE'
[0m15:38:02.317409 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:38:02.441149 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 17 at position 101
  invalid identifier 'ENDDATE'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_product.sql
[0m15:38:02.442933 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05506a3e-0568-4ba8-8597-8255b321e180', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f754710>]}
[0m15:38:02.444927 [error] [Thread-1 (]: 5 of 5 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 1.30s]
[0m15:38:02.446127 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:38:02.448557 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:38:02.448755 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:38:02.448968 [info ] [MainThread]: 
[0m15:38:02.449125 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 5.84 seconds (5.84s).
[0m15:38:02.449659 [debug] [MainThread]: Command end result
[0m15:38:02.490803 [info ] [MainThread]: 
[0m15:38:02.491149 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:38:02.491430 [info ] [MainThread]: 
[0m15:38:02.491918 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 17 at position 101
  invalid identifier 'ENDDATE'
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_product.sql
[0m15:38:02.492164 [info ] [MainThread]: 
[0m15:38:02.492489 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m15:38:02.498447 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.496643, "process_user_time": 3.083379, "process_kernel_time": 1.382995, "process_mem_max_rss": "189333504", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:38:02.501044 [debug] [MainThread]: Command `dbt run` failed at 15:38:02.500715 after 7.50 seconds
[0m15:38:02.501986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105052d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120fbc7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120fbf210>]}
[0m15:38:02.502436 [debug] [MainThread]: Flushing usage events
[0m15:38:51.962278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14591f1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145981250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145981890>]}


============================== 15:38:51.965753 | 6b6af35e-a2a2-4a53-bdc6-140690020074 ==============================
[0m15:38:51.965753 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:38:51.966060 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:38:52.712380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146201150>]}
[0m15:38:52.731545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1415fcad0>]}
[0m15:38:52.732046 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:38:52.744324 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:38:52.810824 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m15:38:52.811146 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m15:38:52.929405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abfb850>]}
[0m15:38:52.972482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ac32b90>]}
[0m15:38:52.972743 [info ] [MainThread]: Found 1 seed, 5 models, 3 sources, 563 macros
[0m15:38:52.972898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a8d5210>]}
[0m15:38:52.973678 [info ] [MainThread]: 
[0m15:38:52.973906 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:38:52.975631 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:38:52.980912 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:38:52.981094 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:38:52.981216 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:38:53.490123 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.509 seconds
[0m15:38:53.493497 [debug] [ThreadPool]: On list_LB: Close
[0m15:38:53.605846 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:38:53.616941 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:38:53.617208 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:38:53.617352 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:38:53.994856 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.377 seconds
[0m15:38:53.998259 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:38:54.138785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abd0350>]}
[0m15:38:54.139270 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:38:54.139442 [info ] [MainThread]: 
[0m15:38:54.141309 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:38:54.141820 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m15:38:54.142436 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m15:38:54.142765 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:38:54.149578 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:38:54.150151 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:38:54.165673 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:38:54.166615 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:38:54.166977 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m15:38:54.167190 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:38:54.647998 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.480 seconds
[0m15:38:54.674290 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:38:54.786628 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b847b90>]}
[0m15:38:54.788405 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.64s]
[0m15:38:54.789550 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:38:54.790314 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:38:54.791416 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m15:38:54.792168 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:38:54.792660 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:38:54.797609 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:38:54.799205 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:38:54.801918 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:38:54.803297 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:38:54.803677 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m15:38:54.804021 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:38:55.266681 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.463 seconds
[0m15:38:55.267742 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:38:55.379699 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a683150>]}
[0m15:38:55.381384 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.59s]
[0m15:38:55.382478 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:38:55.383238 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:38:55.384100 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m15:38:55.384715 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:38:55.385160 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:38:55.393366 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:38:55.394358 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:38:55.397243 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:38:55.398721 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:38:55.399103 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:38:55.399440 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:38:55.989619 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.590 seconds
[0m15:38:55.991218 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:38:56.093164 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14595a610>]}
[0m15:38:56.094106 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.71s]
[0m15:38:56.094637 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:38:56.095091 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:38:56.095841 [info ] [Thread-1 (]: 4 of 5 START sql table model stage.dim_contract ................................ [RUN]
[0m15:38:56.096410 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:38:56.096655 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:38:56.098947 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:38:56.099609 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:38:56.114737 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:38:56.115570 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:38:56.115807 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m15:38:56.116025 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:38:57.165879 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.049 seconds
[0m15:38:57.171402 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:38:57.293493 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a8e24d0>]}
[0m15:38:57.294893 [info ] [Thread-1 (]: 4 of 5 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.20s]
[0m15:38:57.295713 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:38:57.296181 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:38:57.296601 [info ] [Thread-1 (]: 5 of 5 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:38:57.297037 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:38:57.297299 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:38:57.302705 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:38:57.303729 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:38:57.321662 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:57.321986 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY productid ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY productid ORDER BY modificationdate) AS enddate,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m15:38:57.322202 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:38:57.933952 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.612 seconds
[0m15:38:57.944122 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:57.944380 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m15:38:58.031186 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.086 seconds
[0m15:38:58.038951 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:58.039580 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m15:38:58.112682 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.073 seconds
[0m15:38:58.125917 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:58.126609 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m15:38:58.226658 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.100 seconds
[0m15:38:58.254449 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m15:38:58.255700 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:58.255961 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m15:38:58.354842 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m15:38:58.355457 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:58.355860 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.modificationdate = DBT_INTERNAL_DEST.modificationdate
                )

    
    when matched then update set
        "PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")
    values
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")

;
[0m15:38:58.856318 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.500 seconds
[0m15:38:58.857852 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:58.858512 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m15:38:58.978017 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.119 seconds
[0m15:38:58.989664 [debug] [Thread-1 (]: Applying DROP to: LB.stage.dim_product__dbt_tmp
[0m15:38:58.995266 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:38:58.995551 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.stage.dim_product__dbt_tmp cascade
[0m15:38:59.103012 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.107 seconds
[0m15:38:59.106144 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:38:59.209367 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b6af35e-a2a2-4a53-bdc6-140690020074', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae96bd0>]}
[0m15:38:59.210297 [info ] [Thread-1 (]: 5 of 5 OK created sql incremental model stage.dim_product ...................... [[32mSUCCESS 0[0m in 1.91s]
[0m15:38:59.210932 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:38:59.212484 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:38:59.212834 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:38:59.213259 [info ] [MainThread]: 
[0m15:38:59.213579 [info ] [MainThread]: Finished running 3 view models, 1 table model, 1 incremental model in 0 hours 0 minutes and 6.24 seconds (6.24s).
[0m15:38:59.214659 [debug] [MainThread]: Command end result
[0m15:38:59.242383 [info ] [MainThread]: 
[0m15:38:59.242760 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:38:59.242909 [info ] [MainThread]: 
[0m15:38:59.243086 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m15:38:59.246922 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.319769, "process_user_time": 2.736639, "process_kernel_time": 1.681961, "process_mem_max_rss": "199786496", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:38:59.247838 [debug] [MainThread]: Command `dbt run` succeeded at 15:38:59.247682 after 7.32 seconds
[0m15:38:59.248696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1459814d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145981550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10235c690>]}
[0m15:38:59.248921 [debug] [MainThread]: Flushing usage events
[0m15:40:35.281092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e95afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e9bd550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e9bdbd0>]}


============================== 15:40:35.283525 | 834698ff-1705-4f20-b702-9a4ee1cc7a1f ==============================
[0m15:40:35.283525 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:40:35.283823 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:40:35.988039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15af694d0>]}
[0m15:40:36.007105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e2ea590>]}
[0m15:40:36.007592 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:40:36.019352 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:40:36.079761 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:40:36.080098 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m15:40:36.222614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bd2e7d0>]}
[0m15:40:36.270410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e5f7210>]}
[0m15:40:36.270728 [info ] [MainThread]: Found 1 seed, 6 models, 3 sources, 563 macros
[0m15:40:36.270890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c812550>]}
[0m15:40:36.271829 [info ] [MainThread]: 
[0m15:40:36.272108 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:40:36.274323 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:40:36.278080 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:40:36.278293 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:40:36.278424 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:40:36.777313 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.499 seconds
[0m15:40:36.780506 [debug] [ThreadPool]: On list_LB: Close
[0m15:40:36.896985 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:40:36.909468 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:40:36.910002 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:40:36.910330 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:40:37.404293 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.494 seconds
[0m15:40:37.406155 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:40:37.510368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e888150>]}
[0m15:40:37.511088 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:40:37.511440 [info ] [MainThread]: 
[0m15:40:37.513816 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m15:40:37.514392 [info ] [Thread-1 (]: 1 of 6 START sql table model stage.dim_date .................................... [RUN]
[0m15:40:37.514844 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m15:40:37.515139 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m15:40:37.523094 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m15:40:37.523412 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
select datediff(
        day,
        cast('2018-01-01' as date),
        cast('2030-12-31' as date)
        )
[0m15:40:37.523587 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:40:37.907865 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.384 seconds
[0m15:40:37.912490 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m15:40:37.914269 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m15:40:37.934486 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m15:40:37.935933 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m15:40:37.936341 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- dbt model








with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
     + 
    
    p7.generated_number * power(2, 7)
     + 
    
    p8.generated_number * power(2, 8)
     + 
    
    p9.generated_number * power(2, 9)
     + 
    
    p10.generated_number * power(2, 10)
     + 
    
    p11.generated_number * power(2, 11)
     + 
    
    p12.generated_number * power(2, 12)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
     cross join 
    
    p as p12
    
    

    )

    select *
    from unioned
    where generated_number <= 4747
    order by generated_number



),

all_periods as (

    select (
        

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2018-01-01' as date)
        )


    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2030-12-31' as date)

)

select * from filtered


        );
[0m15:40:39.313998 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.377 seconds
[0m15:40:39.326572 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m15:40:39.460147 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e67ad90>]}
[0m15:40:39.460881 [info ] [Thread-1 (]: 1 of 6 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 1.94s]
[0m15:40:39.461309 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m15:40:39.461602 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:40:39.462012 [info ] [Thread-1 (]: 2 of 6 START sql view model stage.stg_contract ................................. [RUN]
[0m15:40:39.462291 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m15:40:39.462503 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:40:39.464951 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:40:39.465453 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:40:39.481010 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:40:39.482072 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:40:39.482300 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m15:40:39.482710 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:40:40.131197 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.649 seconds
[0m15:40:40.132554 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:40:40.288181 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e636d50>]}
[0m15:40:40.288686 [info ] [Thread-1 (]: 2 of 6 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.83s]
[0m15:40:40.289021 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:40:40.289257 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:40:40.290188 [info ] [Thread-1 (]: 3 of 6 START sql view model stage.stg_prices ................................... [RUN]
[0m15:40:40.290969 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:40:40.291499 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:40:40.294483 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:40:40.295619 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:40:40.300209 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:40:40.301968 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:40:40.302706 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m15:40:40.303277 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:40:40.803080 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.496 seconds
[0m15:40:40.809739 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:40:40.919700 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15eaa4510>]}
[0m15:40:40.921549 [info ] [Thread-1 (]: 3 of 6 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.63s]
[0m15:40:40.922328 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:40:40.923113 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:40:40.924115 [info ] [Thread-1 (]: 4 of 6 START sql view model stage.stg_products ................................. [RUN]
[0m15:40:40.924428 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:40:40.924706 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:40:40.932337 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:40:40.933738 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:40:40.936160 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:40:40.937162 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:40:40.937342 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:40:40.937501 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:40:41.462121 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.525 seconds
[0m15:40:41.463149 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:40:41.570870 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15eb54ad0>]}
[0m15:40:41.571755 [info ] [Thread-1 (]: 4 of 6 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.65s]
[0m15:40:41.572523 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:40:41.572918 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:40:41.573738 [info ] [Thread-1 (]: 5 of 6 START sql table model stage.dim_contract ................................ [RUN]
[0m15:40:41.574533 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:40:41.575075 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:40:41.579388 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:40:41.580792 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:40:41.583890 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:40:41.584956 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:40:41.585155 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m15:40:41.585311 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:40:42.620937 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.034 seconds
[0m15:40:42.629496 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:40:42.786480 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e168a50>]}
[0m15:40:42.790752 [info ] [Thread-1 (]: 5 of 6 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.21s]
[0m15:40:42.792334 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:40:42.793878 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:40:42.796279 [info ] [Thread-1 (]: 6 of 6 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:40:42.796919 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.dim_product)
[0m15:40:42.797109 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:40:42.815024 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:40:42.817547 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:40:42.841782 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:40:42.842572 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY productid ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY productid ORDER BY modificationdate) AS enddate,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m15:40:42.842891 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:40:43.510995 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.668 seconds
[0m15:40:43.519633 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:40:43.520009 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m15:40:43.664888 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.144 seconds
[0m15:40:43.671696 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:40:43.672322 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m15:40:43.817796 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.145 seconds
[0m15:40:43.831465 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:40:43.832161 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m15:40:43.898776 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.066 seconds
[0m15:40:43.929767 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m15:40:43.931192 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:40:43.931491 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m15:40:44.023144 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.091 seconds
[0m15:40:44.024021 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:40:44.024722 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.modificationdate = DBT_INTERNAL_DEST.modificationdate
                )

    
    when matched then update set
        "PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")
    values
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")

;
[0m15:40:44.320311 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.295 seconds
[0m15:40:44.321775 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:40:44.322448 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m15:40:44.437574 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.114 seconds
[0m15:40:44.449984 [debug] [Thread-1 (]: Applying DROP to: LB.stage.dim_product__dbt_tmp
[0m15:40:44.456686 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:40:44.456963 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.stage.dim_product__dbt_tmp cascade
[0m15:40:44.583294 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.126 seconds
[0m15:40:44.585890 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:40:44.689958 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '834698ff-1705-4f20-b702-9a4ee1cc7a1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15eaac2d0>]}
[0m15:40:44.691069 [info ] [Thread-1 (]: 6 of 6 OK created sql incremental model stage.dim_product ...................... [[32mSUCCESS 0[0m in 1.89s]
[0m15:40:44.691983 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:40:44.693669 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:40:44.694201 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:40:44.694878 [info ] [MainThread]: 
[0m15:40:44.695399 [info ] [MainThread]: Finished running 2 table models, 3 view models, 1 incremental model in 0 hours 0 minutes and 8.42 seconds (8.42s).
[0m15:40:44.696808 [debug] [MainThread]: Command end result
[0m15:40:44.722544 [info ] [MainThread]: 
[0m15:40:44.722802 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:40:44.722944 [info ] [MainThread]: 
[0m15:40:44.723102 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m15:40:44.724883 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.471573, "process_user_time": 2.185674, "process_kernel_time": 2.472155, "process_mem_max_rss": "198295552", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:40:44.725190 [debug] [MainThread]: Command `dbt run` succeeded at 15:40:44.725155 after 9.47 seconds
[0m15:40:44.725423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e9bd990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103234990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032bec90>]}
[0m15:40:44.725577 [debug] [MainThread]: Flushing usage events
[0m15:43:53.816398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1164574d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116496b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1164bd910>]}


============================== 15:43:53.819407 | 986c568b-125b-4929-9540-623cec31e472 ==============================
[0m15:43:53.819407 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:43:53.819712 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m15:43:54.521522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116496d50>]}
[0m15:43:54.541142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115e00bd0>]}
[0m15:43:54.541764 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:43:54.556159 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:43:54.635436 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m15:43:54.635785 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/fact_energy_consumption.sql
[0m15:43:54.635965 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m15:43:54.792894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a9f0150>]}
[0m15:43:54.845019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ab4ead0>]}
[0m15:43:54.845386 [info ] [MainThread]: Found 1 seed, 7 models, 3 sources, 563 macros
[0m15:43:54.845584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a9d4a90>]}
[0m15:43:54.846682 [info ] [MainThread]: 
[0m15:43:54.847012 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:43:54.849413 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:43:54.854040 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:43:54.854326 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:43:54.854465 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:43:55.281770 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.427 seconds
[0m15:43:55.284302 [debug] [ThreadPool]: On list_LB: Close
[0m15:43:55.401844 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:43:55.413617 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:43:55.413931 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:43:55.414072 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:43:55.840067 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.426 seconds
[0m15:43:55.843248 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:43:55.958012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15abfc790>]}
[0m15:43:55.959533 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:43:55.960181 [info ] [MainThread]: 
[0m15:43:55.964238 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m15:43:55.964996 [info ] [Thread-1 (]: 1 of 7 START sql table model stage.dim_date .................................... [RUN]
[0m15:43:55.965544 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m15:43:55.965914 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m15:43:55.978640 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m15:43:55.979107 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
select datediff(
        day,
        cast('1900-01-01' as date),
        cast('2030-12-31' as date)
        )
[0m15:43:55.979394 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:43:56.372406 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.393 seconds
[0m15:43:56.375815 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m15:43:56.377340 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m15:43:56.406272 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m15:43:56.408298 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m15:43:56.408666 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- dbt model








with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
     + 
    
    p7.generated_number * power(2, 7)
     + 
    
    p8.generated_number * power(2, 8)
     + 
    
    p9.generated_number * power(2, 9)
     + 
    
    p10.generated_number * power(2, 10)
     + 
    
    p11.generated_number * power(2, 11)
     + 
    
    p12.generated_number * power(2, 12)
     + 
    
    p13.generated_number * power(2, 13)
     + 
    
    p14.generated_number * power(2, 14)
     + 
    
    p15.generated_number * power(2, 15)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
     cross join 
    
    p as p12
     cross join 
    
    p as p13
     cross join 
    
    p as p14
     cross join 
    
    p as p15
    
    

    )

    select *
    from unioned
    where generated_number <= 47846
    order by generated_number



),

all_periods as (

    select (
        

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('1900-01-01' as date)
        )


    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2030-12-31' as date)

)

select * from filtered


        );
[0m15:43:57.853541 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.444 seconds
[0m15:43:57.871268 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m15:43:57.975244 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ababd10>]}
[0m15:43:57.975875 [info ] [Thread-1 (]: 1 of 7 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 2.01s]
[0m15:43:57.976368 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m15:43:57.976603 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:43:57.977506 [info ] [Thread-1 (]: 2 of 7 START sql view model stage.stg_contract ................................. [RUN]
[0m15:43:57.977785 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m15:43:57.977968 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:43:57.979888 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:57.980313 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:43:57.994943 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:57.996090 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:43:57.996307 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m15:43:57.996475 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:43:58.514410 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.518 seconds
[0m15:43:58.518126 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:43:58.633694 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15b196e90>]}
[0m15:43:58.635390 [info ] [Thread-1 (]: 2 of 7 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.66s]
[0m15:43:58.636526 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:43:58.637234 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:43:58.638502 [info ] [Thread-1 (]: 3 of 7 START sql view model stage.stg_prices ................................... [RUN]
[0m15:43:58.639247 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:43:58.639780 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:43:58.645857 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:43:58.647661 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:43:58.651072 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:43:58.652468 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:43:58.652845 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m15:43:58.653192 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:43:59.167760 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.514 seconds
[0m15:43:59.171875 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:43:59.282178 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1164bcc50>]}
[0m15:43:59.282764 [info ] [Thread-1 (]: 3 of 7 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.64s]
[0m15:43:59.283061 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:43:59.283266 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:43:59.283549 [info ] [Thread-1 (]: 4 of 7 START sql view model stage.stg_products ................................. [RUN]
[0m15:43:59.283873 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:43:59.284076 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:43:59.285856 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:43:59.286215 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:43:59.287423 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:43:59.287901 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:43:59.288057 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:43:59.288206 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:43:59.792036 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.504 seconds
[0m15:43:59.793475 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:43:59.900269 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15aaa9b90>]}
[0m15:43:59.900729 [info ] [Thread-1 (]: 4 of 7 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.62s]
[0m15:43:59.901016 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:43:59.901210 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:43:59.901477 [info ] [Thread-1 (]: 5 of 7 START sql table model stage.dim_contract ................................ [RUN]
[0m15:43:59.901786 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:43:59.901953 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:43:59.903644 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:43:59.903998 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:43:59.906078 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:43:59.906690 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:43:59.906879 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m15:43:59.907023 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:44:00.838498 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.931 seconds
[0m15:44:00.844599 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:44:00.960902 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15b2c5690>]}
[0m15:44:00.962048 [info ] [Thread-1 (]: 5 of 7 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.06s]
[0m15:44:00.962988 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:44:00.963699 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m15:44:00.964627 [info ] [Thread-1 (]: 6 of 7 START sql incremental model stage.fact_energy_consumption ............... [RUN]
[0m15:44:00.965332 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.fact_energy_consumption)
[0m15:44:00.965856 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_consumption
[0m15:44:00.972193 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:44:00.972971 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_consumption
[0m15:44:01.001209 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:44:01.002853 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:44:01.003090 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
create or replace transient table LB.stage.fact_energy_consumption
         as
        (

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    WHERE c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
)
SELECT
    cwp.contractid,
    cwp.productid,
    cwp.createdat,
    cwp.consumption,
    cwp.base_price + (cwp.working_price * cwp.consumption) AS revenue
FROM consumption_with_price cwp
        );
[0m15:44:01.003292 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:44:02.168598 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.165 seconds
[0m15:44:02.181403 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_consumption__dbt_tmp
[0m15:44:02.184190 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:44:02.184401 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
drop view if exists LB.stage.fact_energy_consumption__dbt_tmp cascade
[0m15:44:02.254654 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.070 seconds
[0m15:44:02.258700 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: Close
[0m15:44:02.370012 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ab4e750>]}
[0m15:44:02.371096 [info ] [Thread-1 (]: 6 of 7 OK created sql incremental model stage.fact_energy_consumption .......... [[32mSUCCESS 1[0m in 1.40s]
[0m15:44:02.371703 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m15:44:02.372267 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:44:02.373237 [info ] [Thread-1 (]: 7 of 7 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:44:02.373995 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_energy_consumption, now model.snowflake_airflow_dbt.dim_product)
[0m15:44:02.374550 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:44:02.381015 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:44:02.382449 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:44:02.385022 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:44:02.385311 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY productid ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY productid ORDER BY modificationdate) AS enddate,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m15:44:02.385496 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:44:02.985361 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.600 seconds
[0m15:44:02.990970 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:44:02.991218 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m15:44:03.070990 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.080 seconds
[0m15:44:03.075040 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:44:03.075304 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m15:44:03.159899 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.084 seconds
[0m15:44:03.170378 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:44:03.170665 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m15:44:03.268910 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.098 seconds
[0m15:44:03.286113 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m15:44:03.287419 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:44:03.287642 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m15:44:03.390349 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.103 seconds
[0m15:44:03.390660 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:44:03.390880 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.modificationdate = DBT_INTERNAL_DEST.modificationdate
                )

    
    when matched then update set
        "PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")
    values
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")

;
[0m15:44:03.704275 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.313 seconds
[0m15:44:03.705441 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:44:03.705977 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m15:44:03.829255 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.122 seconds
[0m15:44:03.836547 [debug] [Thread-1 (]: Applying DROP to: LB.stage.dim_product__dbt_tmp
[0m15:44:03.837714 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:44:03.838127 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.stage.dim_product__dbt_tmp cascade
[0m15:44:04.063070 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.224 seconds
[0m15:44:04.068085 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:44:04.174913 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '986c568b-125b-4929-9540-623cec31e472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15b1b2b50>]}
[0m15:44:04.176442 [info ] [Thread-1 (]: 7 of 7 OK created sql incremental model stage.dim_product ...................... [[32mSUCCESS 0[0m in 1.80s]
[0m15:44:04.177509 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:44:04.179654 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:44:04.180162 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:44:04.180745 [info ] [MainThread]: 
[0m15:44:04.181150 [info ] [MainThread]: Finished running 2 table models, 3 view models, 2 incremental models in 0 hours 0 minutes and 9.33 seconds (9.33s).
[0m15:44:04.182467 [debug] [MainThread]: Command end result
[0m15:44:04.214162 [info ] [MainThread]: 
[0m15:44:04.214518 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:44:04.214670 [info ] [MainThread]: 
[0m15:44:04.214833 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:44:04.217329 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.430955, "process_user_time": 2.469378, "process_kernel_time": 2.092844, "process_mem_max_rss": "198524928", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:44:04.218715 [debug] [MainThread]: Command `dbt run` succeeded at 15:44:04.218487 after 10.43 seconds
[0m15:44:04.219428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11649cd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11649cb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102346cd0>]}
[0m15:44:04.219666 [debug] [MainThread]: Flushing usage events
[0m15:50:05.550796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dc1b390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dc81110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dc81790>]}


============================== 15:50:05.553511 | 509f2b9b-3050-46d2-9174-f77177ba11ba ==============================
[0m15:50:05.553511 [info ] [MainThread]: Running with dbt=1.8.0
[0m15:50:05.553792 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:50:06.264215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f0c6d50>]}
[0m15:50:06.283467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ce4e250>]}
[0m15:50:06.284030 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m15:50:06.296536 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m15:50:06.360966 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:50:06.361177 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:50:06.377451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a8a75d0>]}
[0m15:50:06.420759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ac79c50>]}
[0m15:50:06.421007 [info ] [MainThread]: Found 1 seed, 7 models, 3 sources, 563 macros
[0m15:50:06.421161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aae3250>]}
[0m15:50:06.422041 [info ] [MainThread]: 
[0m15:50:06.422276 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:50:06.424033 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m15:50:06.471576 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m15:50:06.471787 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m15:50:06.471906 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:50:06.910687 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.439 seconds
[0m15:50:06.913827 [debug] [ThreadPool]: On list_LB: Close
[0m15:50:07.035635 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m15:50:07.048022 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m15:50:07.048535 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m15:50:07.048819 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:50:07.602632 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.553 seconds
[0m15:50:07.611809 [debug] [ThreadPool]: On list_LB_stage: Close
[0m15:50:07.757790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae53550>]}
[0m15:50:07.759552 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:50:07.760156 [info ] [MainThread]: 
[0m15:50:07.763199 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m15:50:07.763612 [info ] [Thread-1 (]: 1 of 7 START sql table model stage.dim_date .................................... [RUN]
[0m15:50:07.763848 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m15:50:07.763995 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m15:50:07.775970 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m15:50:07.776221 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
select datediff(
        day,
        cast('1900-01-01' as date),
        cast('2030-12-31' as date)
        )
[0m15:50:07.776392 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:50:08.168028 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.392 seconds
[0m15:50:08.174001 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m15:50:08.175166 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m15:50:08.189163 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m15:50:08.190584 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m15:50:08.190868 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- dbt model








with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
     + 
    
    p7.generated_number * power(2, 7)
     + 
    
    p8.generated_number * power(2, 8)
     + 
    
    p9.generated_number * power(2, 9)
     + 
    
    p10.generated_number * power(2, 10)
     + 
    
    p11.generated_number * power(2, 11)
     + 
    
    p12.generated_number * power(2, 12)
     + 
    
    p13.generated_number * power(2, 13)
     + 
    
    p14.generated_number * power(2, 14)
     + 
    
    p15.generated_number * power(2, 15)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
     cross join 
    
    p as p12
     cross join 
    
    p as p13
     cross join 
    
    p as p14
     cross join 
    
    p as p15
    
    

    )

    select *
    from unioned
    where generated_number <= 47846
    order by generated_number



),

all_periods as (

    select (
        

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('1900-01-01' as date)
        )


    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2030-12-31' as date)

)

select * from filtered


        );
[0m15:50:09.787559 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.596 seconds
[0m15:50:09.805040 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m15:50:09.919316 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16afeea10>]}
[0m15:50:09.920867 [info ] [Thread-1 (]: 1 of 7 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 2.15s]
[0m15:50:09.921928 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m15:50:09.922543 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m15:50:09.923241 [info ] [Thread-1 (]: 2 of 7 START sql view model stage.stg_contract ................................. [RUN]
[0m15:50:09.923863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m15:50:09.924303 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m15:50:09.929426 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:50:09.930766 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m15:50:09.954636 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m15:50:09.956852 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m15:50:09.957182 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m15:50:09.957432 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:50:10.437605 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.480 seconds
[0m15:50:10.440584 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m15:50:10.553808 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16acd8310>]}
[0m15:50:10.555029 [info ] [Thread-1 (]: 2 of 7 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.63s]
[0m15:50:10.555860 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m15:50:10.556424 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m15:50:10.557178 [info ] [Thread-1 (]: 3 of 7 START sql view model stage.stg_prices ................................... [RUN]
[0m15:50:10.558106 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m15:50:10.558615 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m15:50:10.565966 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:50:10.567704 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m15:50:10.571720 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m15:50:10.573398 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m15:50:10.573896 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m15:50:10.574543 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:50:12.153672 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.577 seconds
[0m15:50:12.158915 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m15:50:12.961231 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa8f390>]}
[0m15:50:12.961909 [info ] [Thread-1 (]: 3 of 7 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 2.40s]
[0m15:50:12.962260 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m15:50:12.962508 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m15:50:12.962985 [info ] [Thread-1 (]: 4 of 7 START sql view model stage.stg_products ................................. [RUN]
[0m15:50:12.963480 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m15:50:12.963784 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m15:50:12.968369 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m15:50:12.969152 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m15:50:12.971174 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m15:50:12.971979 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m15:50:12.972215 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m15:50:12.972440 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:50:13.676988 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.704 seconds
[0m15:50:13.679679 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m15:50:13.805072 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9ac4d0>]}
[0m15:50:13.806521 [info ] [Thread-1 (]: 4 of 7 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.84s]
[0m15:50:13.807550 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m15:50:13.808220 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m15:50:13.809015 [info ] [Thread-1 (]: 5 of 7 START sql table model stage.dim_contract ................................ [RUN]
[0m15:50:13.809581 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m15:50:13.809997 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m15:50:13.814450 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:50:13.815199 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m15:50:13.817572 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m15:50:13.818329 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m15:50:13.818484 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m15:50:13.818629 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:50:15.523780 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.705 seconds
[0m15:50:15.527455 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m15:50:15.679982 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa11910>]}
[0m15:50:15.680916 [info ] [Thread-1 (]: 5 of 7 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.87s]
[0m15:50:15.681546 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m15:50:15.681932 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m15:50:15.682471 [info ] [Thread-1 (]: 6 of 7 START sql incremental model stage.fact_energy_consumption ............... [RUN]
[0m15:50:15.682896 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.fact_energy_consumption)
[0m15:50:15.683200 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_consumption
[0m15:50:15.693539 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:50:15.694406 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_consumption
[0m15:50:15.711791 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:50:15.712134 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
create or replace  temporary view LB.stage.fact_energy_consumption__dbt_tmp
  
   as (
    

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
    WHERE createdat > (SELECT MAX(createdat) FROM LB.stage.fact_energy_consumption)
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    WHERE c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
)
SELECT
    cwp.contractid,
    cwp.productid,
    cwp.createdat,
    cwp.consumption,
    cwp.base_price + (cwp.working_price * cwp.consumption) AS revenue
FROM consumption_with_price cwp
  );
[0m15:50:15.712342 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:50:16.955222 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.243 seconds
[0m15:50:16.966595 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:50:16.967158 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption__dbt_tmp
[0m15:50:17.117418 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.150 seconds
[0m15:50:17.127771 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:50:17.128380 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption
[0m15:50:17.219954 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.091 seconds
[0m15:50:17.231544 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:50:17.232446 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table "LB"."STAGE"."FACT_ENERGY_CONSUMPTION"
[0m15:50:17.310081 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.077 seconds
[0m15:50:17.340923 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:50:17.342477 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:50:17.342756 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
-- back compat for old kwarg name
  
  begin;
[0m15:50:17.475027 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.132 seconds
[0m15:50:17.476522 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:50:17.477262 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
merge into LB.stage.fact_energy_consumption as DBT_INTERNAL_DEST
        using LB.stage.fact_energy_consumption__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.contractid = DBT_INTERNAL_DEST.contractid
                ) and (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.createdat = DBT_INTERNAL_DEST.createdat
                )

    
    when matched then update set
        "CONTRACTID" = DBT_INTERNAL_SOURCE."CONTRACTID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","CONSUMPTION" = DBT_INTERNAL_SOURCE."CONSUMPTION","REVENUE" = DBT_INTERNAL_SOURCE."REVENUE"
    

    when not matched then insert
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")
    values
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")

;
[0m15:50:18.695265 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.217 seconds
[0m15:50:18.696536 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:50:18.697157 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
COMMIT
[0m15:50:18.831977 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.134 seconds
[0m15:50:18.854902 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_consumption__dbt_tmp
[0m15:50:18.872975 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m15:50:18.873755 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
drop view if exists LB.stage.fact_energy_consumption__dbt_tmp cascade
[0m15:50:19.198800 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.325 seconds
[0m15:50:19.203351 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: Close
[0m15:50:19.321788 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b985a10>]}
[0m15:50:19.323391 [info ] [Thread-1 (]: 6 of 7 OK created sql incremental model stage.fact_energy_consumption .......... [[32mSUCCESS 0[0m in 3.64s]
[0m15:50:19.324309 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m15:50:19.325234 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m15:50:19.325944 [info ] [Thread-1 (]: 7 of 7 START sql incremental model stage.dim_product ........................... [RUN]
[0m15:50:19.326448 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_energy_consumption, now model.snowflake_airflow_dbt.dim_product)
[0m15:50:19.326822 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m15:50:19.355108 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m15:50:19.358077 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m15:50:19.362441 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:50:19.363228 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY productid ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY productid ORDER BY modificationdate) AS enddate,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m15:50:19.363868 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:50:20.202646 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.837 seconds
[0m15:50:20.211370 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:50:20.211949 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m15:50:20.453880 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.241 seconds
[0m15:50:20.458766 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:50:20.459471 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m15:50:20.565795 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.106 seconds
[0m15:50:20.572017 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:50:20.572754 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m15:50:21.212978 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.639 seconds
[0m15:50:21.224133 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m15:50:21.226852 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:50:21.227078 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m15:50:21.340035 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.113 seconds
[0m15:50:21.340613 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:50:21.341026 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.modificationdate = DBT_INTERNAL_DEST.modificationdate
                )

    
    when matched then update set
        "PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")
    values
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")

;
[0m15:50:22.088724 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.747 seconds
[0m15:50:22.090269 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:50:22.090689 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m15:50:22.218172 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.127 seconds
[0m15:50:22.226684 [debug] [Thread-1 (]: Applying DROP to: LB.stage.dim_product__dbt_tmp
[0m15:50:22.227768 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m15:50:22.228180 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.stage.dim_product__dbt_tmp cascade
[0m15:50:22.367659 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.139 seconds
[0m15:50:22.373466 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m15:50:22.501147 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '509f2b9b-3050-46d2-9174-f77177ba11ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a8876d0>]}
[0m15:50:22.502882 [info ] [Thread-1 (]: 7 of 7 OK created sql incremental model stage.dim_product ...................... [[32mSUCCESS 0[0m in 3.17s]
[0m15:50:22.504171 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m15:50:22.507003 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:50:22.507252 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m15:50:22.507485 [info ] [MainThread]: 
[0m15:50:22.507656 [info ] [MainThread]: Finished running 2 table models, 3 view models, 2 incremental models in 0 hours 0 minutes and 16.09 seconds (16.09s).
[0m15:50:22.508280 [debug] [MainThread]: Command end result
[0m15:50:22.532192 [info ] [MainThread]: 
[0m15:50:22.532585 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:50:22.532744 [info ] [MainThread]: 
[0m15:50:22.532947 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m15:50:22.538043 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 17.017653, "process_user_time": 2.636708, "process_kernel_time": 2.259213, "process_mem_max_rss": "195084288", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:50:22.539468 [debug] [MainThread]: Command `dbt run` succeeded at 15:50:22.539351 after 17.02 seconds
[0m15:50:22.540938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1025a0690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1024a6d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1024a6cd0>]}
[0m15:50:22.541132 [debug] [MainThread]: Flushing usage events
[0m20:03:15.463577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133f1b350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133f80c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133f81310>]}


============================== 20:03:15.466568 | cd9aef05-4c45-4d95-9e0a-aed04c23c8a7 ==============================
[0m20:03:15.466568 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:03:15.466916 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:03:18.301697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136f27f50>]}
[0m20:03:18.320610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133f4e250>]}
[0m20:03:18.321133 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:03:18.370745 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:03:18.454365 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:03:18.454646 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:03:18.471565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1605e2e90>]}
[0m20:03:18.516839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160785450>]}
[0m20:03:18.517090 [info ] [MainThread]: Found 1 seed, 7 models, 3 sources, 563 macros
[0m20:03:18.517241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160652b90>]}
[0m20:03:18.518119 [info ] [MainThread]: 
[0m20:03:18.518364 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:03:18.520105 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:03:18.566524 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:03:18.566739 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:03:18.566856 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:03:19.089918 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.523 seconds
[0m20:03:19.092637 [debug] [ThreadPool]: On list_LB: Close
[0m20:03:19.210453 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:03:19.219601 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:03:19.220038 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:03:19.220319 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:03:19.673076 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.453 seconds
[0m20:03:19.675488 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:03:19.788794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133b6e910>]}
[0m20:03:19.789797 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:03:19.790328 [info ] [MainThread]: 
[0m20:03:19.793028 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:03:19.793653 [info ] [Thread-1 (]: 1 of 7 START sql table model stage.dim_date .................................... [RUN]
[0m20:03:19.794146 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m20:03:19.794525 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:03:19.805830 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:03:19.806144 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
select datediff(
        day,
        cast('1900-01-01' as date),
        cast('2030-12-31' as date)
        )
[0m20:03:19.806303 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:20.126034 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.320 seconds
[0m20:03:20.138883 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:03:20.141197 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:03:20.155015 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:03:20.156580 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:03:20.156849 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- dbt model








with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
     + 
    
    p7.generated_number * power(2, 7)
     + 
    
    p8.generated_number * power(2, 8)
     + 
    
    p9.generated_number * power(2, 9)
     + 
    
    p10.generated_number * power(2, 10)
     + 
    
    p11.generated_number * power(2, 11)
     + 
    
    p12.generated_number * power(2, 12)
     + 
    
    p13.generated_number * power(2, 13)
     + 
    
    p14.generated_number * power(2, 14)
     + 
    
    p15.generated_number * power(2, 15)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
     cross join 
    
    p as p12
     cross join 
    
    p as p13
     cross join 
    
    p as p14
     cross join 
    
    p as p15
    
    

    )

    select *
    from unioned
    where generated_number <= 47846
    order by generated_number



),

all_periods as (

    select (
        

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('1900-01-01' as date)
        )


    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2030-12-31' as date)

)

select * from filtered


        );
[0m20:03:22.116086 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.957 seconds
[0m20:03:22.142439 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:03:22.240259 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160513350>]}
[0m20:03:22.241425 [info ] [Thread-1 (]: 1 of 7 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 2.44s]
[0m20:03:22.242196 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:03:22.242662 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m20:03:22.243366 [info ] [Thread-1 (]: 2 of 7 START sql view model stage.stg_contract ................................. [RUN]
[0m20:03:22.243856 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m20:03:22.244245 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m20:03:22.249277 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:03:22.251581 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m20:03:22.270606 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:03:22.271878 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:03:22.272086 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m20:03:22.272265 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:22.921127 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.648 seconds
[0m20:03:22.925560 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m20:03:23.080249 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160cd5f10>]}
[0m20:03:23.081203 [info ] [Thread-1 (]: 2 of 7 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.84s]
[0m20:03:23.081846 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m20:03:23.082344 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m20:03:23.083239 [info ] [Thread-1 (]: 3 of 7 START sql view model stage.stg_prices ................................... [RUN]
[0m20:03:23.083750 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m20:03:23.084113 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m20:03:23.088542 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:03:23.090230 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m20:03:23.094303 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:03:23.095811 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:03:23.096172 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m20:03:23.096412 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:23.637961 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.541 seconds
[0m20:03:23.642188 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m20:03:23.788266 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160dff890>]}
[0m20:03:23.789420 [info ] [Thread-1 (]: 3 of 7 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.70s]
[0m20:03:23.790325 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m20:03:23.790918 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m20:03:23.791690 [info ] [Thread-1 (]: 4 of 7 START sql view model stage.stg_products ................................. [RUN]
[0m20:03:23.792477 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m20:03:23.792966 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m20:03:23.797606 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m20:03:23.799273 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m20:03:23.802744 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m20:03:23.804487 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:03:23.805017 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m20:03:23.805430 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:24.675918 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.870 seconds
[0m20:03:24.676908 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m20:03:24.810148 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160dfcf50>]}
[0m20:03:24.810835 [info ] [Thread-1 (]: 4 of 7 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 1.02s]
[0m20:03:24.811252 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m20:03:24.811528 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m20:03:24.811884 [info ] [Thread-1 (]: 5 of 7 START sql table model stage.dim_contract ................................ [RUN]
[0m20:03:24.812340 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m20:03:24.812609 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m20:03:24.815246 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:03:24.816229 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m20:03:24.818078 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:03:24.818879 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m20:03:24.819098 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m20:03:24.819359 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:26.100312 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.280 seconds
[0m20:03:26.107006 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m20:03:26.223116 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160785a10>]}
[0m20:03:26.225363 [info ] [Thread-1 (]: 5 of 7 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.41s]
[0m20:03:26.226979 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m20:03:26.227943 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:03:26.229224 [info ] [Thread-1 (]: 6 of 7 START sql incremental model stage.fact_energy_consumption ............... [RUN]
[0m20:03:26.229888 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.fact_energy_consumption)
[0m20:03:26.230306 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:03:26.242346 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:03:26.244746 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:03:26.271825 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:03:26.272183 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
create or replace  temporary view LB.stage.fact_energy_consumption__dbt_tmp
  
   as (
    

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
    WHERE createdat > (SELECT MAX(createdat) FROM LB.stage.fact_energy_consumption)
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    WHERE c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
)
SELECT
    cwp.contractid,
    cwp.productid,
    cwp.createdat,
    cwp.consumption,
    cwp.base_price + (cwp.working_price * cwp.consumption) AS revenue
FROM consumption_with_price cwp
  );
[0m20:03:26.272495 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:26.912885 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.640 seconds
[0m20:03:26.927801 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:03:26.928324 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption__dbt_tmp
[0m20:03:27.037285 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.109 seconds
[0m20:03:27.043118 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:03:27.043664 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption
[0m20:03:27.139090 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.095 seconds
[0m20:03:27.151686 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:03:27.152209 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table "LB"."STAGE"."FACT_ENERGY_CONSUMPTION"
[0m20:03:27.209226 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.057 seconds
[0m20:03:27.230633 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:03:27.231522 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:03:27.231679 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
-- back compat for old kwarg name
  
  begin;
[0m20:03:27.317525 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m20:03:27.318060 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:03:27.318414 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
merge into LB.stage.fact_energy_consumption as DBT_INTERNAL_DEST
        using LB.stage.fact_energy_consumption__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.contractid = DBT_INTERNAL_DEST.contractid
                ) and (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.createdat = DBT_INTERNAL_DEST.createdat
                )

    
    when matched then update set
        "CONTRACTID" = DBT_INTERNAL_SOURCE."CONTRACTID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","CONSUMPTION" = DBT_INTERNAL_SOURCE."CONSUMPTION","REVENUE" = DBT_INTERNAL_SOURCE."REVENUE"
    

    when not matched then insert
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")
    values
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")

;
[0m20:03:27.702997 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.384 seconds
[0m20:03:27.704197 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:03:27.704866 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
COMMIT
[0m20:03:27.806758 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.101 seconds
[0m20:03:27.819291 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_consumption__dbt_tmp
[0m20:03:27.826032 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:03:27.826359 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
drop view if exists LB.stage.fact_energy_consumption__dbt_tmp cascade
[0m20:03:27.953502 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.127 seconds
[0m20:03:27.957166 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: Close
[0m20:03:28.060313 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160d84dd0>]}
[0m20:03:28.060961 [info ] [Thread-1 (]: 6 of 7 OK created sql incremental model stage.fact_energy_consumption .......... [[32mSUCCESS 0[0m in 1.83s]
[0m20:03:28.061301 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:03:28.061541 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:03:28.061817 [info ] [Thread-1 (]: 7 of 7 START sql incremental model stage.dim_product ........................... [RUN]
[0m20:03:28.062052 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_energy_consumption, now model.snowflake_airflow_dbt.dim_product)
[0m20:03:28.062237 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:03:28.064671 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:03:28.065871 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:03:28.067839 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:28.068054 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY productid ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY productid ORDER BY modificationdate) AS enddate,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m20:03:28.068248 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:28.608440 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.540 seconds
[0m20:03:28.612846 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:28.613118 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m20:03:28.710615 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.097 seconds
[0m20:03:28.712704 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:28.712915 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m20:03:28.796428 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.083 seconds
[0m20:03:28.805982 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:28.806372 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m20:03:28.968604 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.162 seconds
[0m20:03:28.970139 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m20:03:28.970912 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:28.971069 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m20:03:29.063805 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m20:03:29.064117 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:29.064312 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.modificationdate = DBT_INTERNAL_DEST.modificationdate
                )

    
    when matched then update set
        "PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")
    values
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")

;
[0m20:03:29.439485 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.375 seconds
[0m20:03:29.439811 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:29.440012 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m20:03:29.616465 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.176 seconds
[0m20:03:29.618948 [debug] [Thread-1 (]: Applying DROP to: LB.stage.dim_product__dbt_tmp
[0m20:03:29.619394 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:03:29.619566 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.stage.dim_product__dbt_tmp cascade
[0m20:03:29.731836 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.112 seconds
[0m20:03:29.733017 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:03:29.834495 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd9aef05-4c45-4d95-9e0a-aed04c23c8a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1609ce090>]}
[0m20:03:29.835992 [info ] [Thread-1 (]: 7 of 7 OK created sql incremental model stage.dim_product ...................... [[32mSUCCESS 0[0m in 1.77s]
[0m20:03:29.837224 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:03:29.838794 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:03:29.839218 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m20:03:29.839542 [info ] [MainThread]: 
[0m20:03:29.839886 [info ] [MainThread]: Finished running 2 table models, 3 view models, 2 incremental models in 0 hours 0 minutes and 11.32 seconds (11.32s).
[0m20:03:29.841318 [debug] [MainThread]: Command end result
[0m20:03:29.901854 [info ] [MainThread]: 
[0m20:03:29.902642 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:03:29.902961 [info ] [MainThread]: 
[0m20:03:29.903819 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m20:03:29.949151 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 14.51717, "process_user_time": 2.705259, "process_kernel_time": 2.570646, "process_mem_max_rss": "190906368", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:03:29.950880 [debug] [MainThread]: Command `dbt run` succeeded at 20:03:29.950683 after 14.52 seconds
[0m20:03:29.952139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1002e8690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1001eed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10025ff90>]}
[0m20:03:29.952744 [debug] [MainThread]: Flushing usage events
[0m20:08:09.355334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c819790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c8596d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c860190>]}


============================== 20:08:09.357960 | a75c4d77-0008-40ed-9eaa-e1269b415cb2 ==============================
[0m20:08:09.357960 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:08:09.358245 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:08:09.973781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ef5d150>]}
[0m20:08:09.992981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c000ad0>]}
[0m20:08:09.993740 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:08:10.007715 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:08:10.069394 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:08:10.069616 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:08:10.085919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fcc2990>]}
[0m20:08:10.129743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149549ed0>]}
[0m20:08:10.130009 [info ] [MainThread]: Found 1 seed, 7 models, 3 sources, 563 macros
[0m20:08:10.130163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149652790>]}
[0m20:08:10.131109 [info ] [MainThread]: 
[0m20:08:10.131381 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:08:10.133203 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:08:10.181969 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:08:10.182173 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:08:10.182300 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:08:10.734792 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.552 seconds
[0m20:08:10.738032 [debug] [ThreadPool]: On list_LB: Close
[0m20:08:10.851793 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:08:10.857071 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:08:10.857340 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:08:10.857472 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:08:11.260205 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.403 seconds
[0m20:08:11.264498 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:08:11.377065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1496a6210>]}
[0m20:08:11.378388 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:08:11.378964 [info ] [MainThread]: 
[0m20:08:11.383779 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:08:11.384478 [info ] [Thread-1 (]: 1 of 7 START sql table model stage.dim_date .................................... [RUN]
[0m20:08:11.385013 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m20:08:11.385407 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:08:11.402632 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:08:11.403033 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
select datediff(
        day,
        cast('1900-01-01' as date),
        cast('2030-12-31' as date)
        )
[0m20:08:11.403271 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:11.785611 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.382 seconds
[0m20:08:11.800932 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:08:11.802346 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:08:11.816684 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:08:11.818271 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:08:11.818581 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- dbt model








with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
     + 
    
    p7.generated_number * power(2, 7)
     + 
    
    p8.generated_number * power(2, 8)
     + 
    
    p9.generated_number * power(2, 9)
     + 
    
    p10.generated_number * power(2, 10)
     + 
    
    p11.generated_number * power(2, 11)
     + 
    
    p12.generated_number * power(2, 12)
     + 
    
    p13.generated_number * power(2, 13)
     + 
    
    p14.generated_number * power(2, 14)
     + 
    
    p15.generated_number * power(2, 15)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
     cross join 
    
    p as p12
     cross join 
    
    p as p13
     cross join 
    
    p as p14
     cross join 
    
    p as p15
    
    

    )

    select *
    from unioned
    where generated_number <= 47846
    order by generated_number



),

all_periods as (

    select (
        

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('1900-01-01' as date)
        )


    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2030-12-31' as date)

)

select * from filtered


        );
[0m20:08:13.326299 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.507 seconds
[0m20:08:13.348172 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:08:13.542960 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d5106d0>]}
[0m20:08:13.543806 [info ] [Thread-1 (]: 1 of 7 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 2.16s]
[0m20:08:13.544218 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:08:13.544478 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m20:08:13.544707 [info ] [Thread-1 (]: 2 of 7 START sql view model stage.stg_contract ................................. [RUN]
[0m20:08:13.545085 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m20:08:13.545336 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m20:08:13.547723 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:08:13.548448 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m20:08:13.559314 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:08:13.560173 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:08:13.560355 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m20:08:13.560531 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:14.124080 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.563 seconds
[0m20:08:14.126443 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m20:08:14.235552 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14975ad50>]}
[0m20:08:14.236414 [info ] [Thread-1 (]: 2 of 7 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.69s]
[0m20:08:14.237326 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m20:08:14.238007 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m20:08:14.239063 [info ] [Thread-1 (]: 3 of 7 START sql view model stage.stg_prices ................................... [RUN]
[0m20:08:14.239653 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m20:08:14.240041 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m20:08:14.244544 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:08:14.246086 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m20:08:14.249760 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:08:14.251080 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:08:14.251556 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m20:08:14.251733 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:14.743610 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.491 seconds
[0m20:08:14.747349 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m20:08:14.856376 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149de93d0>]}
[0m20:08:14.857452 [info ] [Thread-1 (]: 3 of 7 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.62s]
[0m20:08:14.858317 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m20:08:14.858934 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m20:08:14.859780 [info ] [Thread-1 (]: 4 of 7 START sql view model stage.stg_products ................................. [RUN]
[0m20:08:14.860567 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m20:08:14.861171 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m20:08:14.865503 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m20:08:14.866263 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m20:08:14.869197 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m20:08:14.870224 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:08:14.870409 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m20:08:14.870569 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:15.387157 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.516 seconds
[0m20:08:15.391226 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m20:08:17.801040 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1495c6810>]}
[0m20:08:17.803357 [info ] [Thread-1 (]: 4 of 7 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 2.94s]
[0m20:08:17.804313 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m20:08:17.805020 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m20:08:17.806472 [info ] [Thread-1 (]: 5 of 7 START sql table model stage.dim_contract ................................ [RUN]
[0m20:08:17.807101 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m20:08:17.807447 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m20:08:17.813532 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:08:17.815728 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m20:08:17.818345 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:08:17.819292 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m20:08:17.819543 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m20:08:17.819817 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:19.063394 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.243 seconds
[0m20:08:19.065467 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m20:08:19.171469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149763f90>]}
[0m20:08:19.172250 [info ] [Thread-1 (]: 5 of 7 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.36s]
[0m20:08:19.172798 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m20:08:19.173473 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:08:19.174259 [info ] [Thread-1 (]: 6 of 7 START sql incremental model stage.fact_energy_consumption ............... [RUN]
[0m20:08:19.174755 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.fact_energy_consumption)
[0m20:08:19.175201 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:08:19.187909 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:08:19.188738 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:08:19.208415 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:08:19.208733 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
create or replace  temporary view LB.stage.fact_energy_consumption__dbt_tmp
  
   as (
    

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
    WHERE createdat > (SELECT MAX(createdat) FROM LB.stage.fact_energy_consumption)
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    WHERE c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
)
SELECT
    cwp.contractid,
    cwp.productid,
    cwp.createdat,
    cwp.consumption,
    cwp.base_price + (cwp.working_price * cwp.consumption) AS revenue
FROM consumption_with_price cwp
  );
[0m20:08:19.208927 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:19.986239 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.777 seconds
[0m20:08:20.000323 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:08:20.000840 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption__dbt_tmp
[0m20:08:20.112560 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.111 seconds
[0m20:08:20.118762 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:08:20.119406 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption
[0m20:08:20.222681 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.103 seconds
[0m20:08:20.235300 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:08:20.235854 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table "LB"."STAGE"."FACT_ENERGY_CONSUMPTION"
[0m20:08:20.333189 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.097 seconds
[0m20:08:20.357718 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:08:20.358784 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:08:20.359002 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
-- back compat for old kwarg name
  
  begin;
[0m20:08:20.502661 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.143 seconds
[0m20:08:20.503906 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:08:20.504560 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
merge into LB.stage.fact_energy_consumption as DBT_INTERNAL_DEST
        using LB.stage.fact_energy_consumption__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.contractid = DBT_INTERNAL_DEST.contractid
                ) and (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.createdat = DBT_INTERNAL_DEST.createdat
                )

    
    when matched then update set
        "CONTRACTID" = DBT_INTERNAL_SOURCE."CONTRACTID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","CONSUMPTION" = DBT_INTERNAL_SOURCE."CONSUMPTION","REVENUE" = DBT_INTERNAL_SOURCE."REVENUE"
    

    when not matched then insert
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")
    values
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")

;
[0m20:08:21.241620 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.736 seconds
[0m20:08:21.242986 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:08:21.243526 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
COMMIT
[0m20:08:21.360438 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.116 seconds
[0m20:08:21.393864 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_consumption__dbt_tmp
[0m20:08:21.399414 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:08:21.399786 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
drop view if exists LB.stage.fact_energy_consumption__dbt_tmp cascade
[0m20:08:21.531756 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.131 seconds
[0m20:08:21.536474 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: Close
[0m20:08:21.695264 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149d97a50>]}
[0m20:08:21.702555 [info ] [Thread-1 (]: 6 of 7 OK created sql incremental model stage.fact_energy_consumption .......... [[32mSUCCESS 0[0m in 2.52s]
[0m20:08:21.703781 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:08:21.704446 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:08:21.705387 [info ] [Thread-1 (]: 7 of 7 START sql incremental model stage.dim_product ........................... [RUN]
[0m20:08:21.705986 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_energy_consumption, now model.snowflake_airflow_dbt.dim_product)
[0m20:08:21.706440 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:08:21.712502 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:08:21.713742 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:08:21.716592 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:08:21.717019 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE modificationdate > (SELECT MAX(modificationdate) FROM LB.stage.dim_product)
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY productid ORDER BY modificationdate DESC) AS rn
    FROM products
)
SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate AS modificationdate,
    LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (PARTITION BY productid ORDER BY modificationdate) AS enddate,
    CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
FROM current_products
  );
[0m20:08:21.717398 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:08:22.300955 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.583 seconds
[0m20:08:22.309718 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:08:22.310367 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m20:08:22.420662 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.110 seconds
[0m20:08:22.426158 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:08:22.426761 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m20:08:22.522210 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.095 seconds
[0m20:08:22.529977 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:08:22.530519 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m20:08:22.619666 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.089 seconds
[0m20:08:22.624289 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m20:08:22.626857 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:08:22.627395 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m20:08:22.724410 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.096 seconds
[0m20:08:22.725360 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:08:22.725977 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.modificationdate = DBT_INTERNAL_DEST.modificationdate
                )

    
    when matched then update set
        "PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")
    values
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")

;
[0m20:08:23.160468 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.434 seconds
[0m20:08:23.161451 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:08:23.161935 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m20:08:23.281895 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.119 seconds
[0m20:08:23.283663 [debug] [Thread-1 (]: Applying DROP to: LB.stage.dim_product__dbt_tmp
[0m20:08:23.284010 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:08:23.284163 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.stage.dim_product__dbt_tmp cascade
[0m20:08:23.398248 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.114 seconds
[0m20:08:23.400391 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:08:23.507803 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a75c4d77-0008-40ed-9eaa-e1269b415cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11986fdd0>]}
[0m20:08:23.508751 [info ] [Thread-1 (]: 7 of 7 OK created sql incremental model stage.dim_product ...................... [[32mSUCCESS 0[0m in 1.80s]
[0m20:08:23.509373 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:08:23.515142 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:08:23.515571 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m20:08:23.516050 [info ] [MainThread]: 
[0m20:08:23.516425 [info ] [MainThread]: Finished running 2 table models, 3 view models, 2 incremental models in 0 hours 0 minutes and 13.38 seconds (13.38s).
[0m20:08:23.517959 [debug] [MainThread]: Command end result
[0m20:08:23.551232 [info ] [MainThread]: 
[0m20:08:23.551538 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:08:23.551688 [info ] [MainThread]: 
[0m20:08:23.551845 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m20:08:23.554140 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 14.226617, "process_user_time": 2.654586, "process_kernel_time": 2.202604, "process_mem_max_rss": "191315968", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:08:23.554740 [debug] [MainThread]: Command `dbt run` succeeded at 20:08:23.554677 after 14.23 seconds
[0m20:08:23.555078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d6ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d6ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e68710>]}
[0m20:08:23.555276 [debug] [MainThread]: Flushing usage events
[0m20:17:55.212675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e11ac90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e14c5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e181c10>]}


============================== 20:17:55.215358 | a1ead0cb-107b-4a5c-9703-8f369724d2f0 ==============================
[0m20:17:55.215358 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:17:55.215637 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m20:17:55.990668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e8d8890>]}
[0m20:17:56.010592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9fca10>]}
[0m20:17:56.011182 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:17:56.025297 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:17:56.099172 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:17:56.099562 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m20:17:56.256649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165bbc090>]}
[0m20:17:56.310909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165bc49d0>]}
[0m20:17:56.311268 [info ] [MainThread]: Found 1 seed, 7 models, 3 sources, 563 macros
[0m20:17:56.311445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165e02bd0>]}
[0m20:17:56.312497 [info ] [MainThread]: 
[0m20:17:56.312791 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:17:56.315276 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:17:56.330065 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:17:56.330497 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:17:56.330737 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:17:56.859275 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.528 seconds
[0m20:17:56.861950 [debug] [ThreadPool]: On list_LB: Close
[0m20:17:57.011976 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:17:57.024685 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:17:57.025227 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:17:57.025550 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:17:57.447514 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.422 seconds
[0m20:17:57.452119 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:17:57.559462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16577d5d0>]}
[0m20:17:57.560733 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:17:57.561221 [info ] [MainThread]: 
[0m20:17:57.564753 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:17:57.565578 [info ] [Thread-1 (]: 1 of 7 START sql table model stage.dim_date .................................... [RUN]
[0m20:17:57.566188 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m20:17:57.566547 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:17:57.584893 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:17:57.585323 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
select datediff(
        day,
        cast('1900-01-01' as date),
        cast('2030-12-31' as date)
        )
[0m20:17:57.585603 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:17:57.907084 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.321 seconds
[0m20:17:57.923657 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:17:57.925605 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:17:57.948423 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:17:57.950243 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:17:57.950578 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- dbt model








with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
     + 
    
    p7.generated_number * power(2, 7)
     + 
    
    p8.generated_number * power(2, 8)
     + 
    
    p9.generated_number * power(2, 9)
     + 
    
    p10.generated_number * power(2, 10)
     + 
    
    p11.generated_number * power(2, 11)
     + 
    
    p12.generated_number * power(2, 12)
     + 
    
    p13.generated_number * power(2, 13)
     + 
    
    p14.generated_number * power(2, 14)
     + 
    
    p15.generated_number * power(2, 15)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
     cross join 
    
    p as p12
     cross join 
    
    p as p13
     cross join 
    
    p as p14
     cross join 
    
    p as p15
    
    

    )

    select *
    from unioned
    where generated_number <= 47846
    order by generated_number



),

all_periods as (

    select (
        

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('1900-01-01' as date)
        )


    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2030-12-31' as date)

)

select * from filtered


        );
[0m20:17:59.407317 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.456 seconds
[0m20:17:59.424597 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:17:59.527152 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b8e8090>]}
[0m20:17:59.528554 [info ] [Thread-1 (]: 1 of 7 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 1.96s]
[0m20:17:59.529583 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:17:59.530265 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m20:17:59.531267 [info ] [Thread-1 (]: 2 of 7 START sql view model stage.stg_contract ................................. [RUN]
[0m20:17:59.531914 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m20:17:59.532330 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m20:17:59.537424 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:17:59.538686 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m20:17:59.555951 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:17:59.556886 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:17:59.557092 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m20:17:59.557258 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:00.042195 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.485 seconds
[0m20:18:00.045361 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m20:18:00.157037 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b93f910>]}
[0m20:18:00.158162 [info ] [Thread-1 (]: 2 of 7 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.63s]
[0m20:18:00.158821 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m20:18:00.159326 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m20:18:00.160204 [info ] [Thread-1 (]: 3 of 7 START sql view model stage.stg_prices ................................... [RUN]
[0m20:18:00.160749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m20:18:00.161163 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m20:18:00.166080 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:18:00.168487 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m20:18:00.173610 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:18:00.175007 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:18:00.175605 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m20:18:00.175903 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:00.691320 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.515 seconds
[0m20:18:00.694657 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m20:18:00.838624 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165cafbd0>]}
[0m20:18:00.840573 [info ] [Thread-1 (]: 3 of 7 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.68s]
[0m20:18:00.841432 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m20:18:00.842091 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m20:18:00.843141 [info ] [Thread-1 (]: 4 of 7 START sql view model stage.stg_products ................................. [RUN]
[0m20:18:00.843817 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m20:18:00.844263 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m20:18:00.850042 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m20:18:00.851363 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m20:18:00.854537 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m20:18:00.855751 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:18:00.856117 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m20:18:00.856410 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:01.273402 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.417 seconds
[0m20:18:01.275056 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m20:18:01.380676 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9ad6d0>]}
[0m20:18:01.382306 [info ] [Thread-1 (]: 4 of 7 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.54s]
[0m20:18:01.383229 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m20:18:01.383832 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m20:18:01.384767 [info ] [Thread-1 (]: 5 of 7 START sql table model stage.dim_contract ................................ [RUN]
[0m20:18:01.385421 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m20:18:01.385816 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m20:18:01.389574 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:18:01.390741 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m20:18:01.395511 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:18:01.396506 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m20:18:01.396798 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m20:18:01.397074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:02.650596 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.253 seconds
[0m20:18:02.653624 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m20:18:02.759457 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16baf9a90>]}
[0m20:18:02.760694 [info ] [Thread-1 (]: 5 of 7 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.37s]
[0m20:18:02.761798 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m20:18:02.762593 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:18:02.763628 [info ] [Thread-1 (]: 6 of 7 START sql incremental model stage.fact_energy_consumption ............... [RUN]
[0m20:18:02.764417 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.fact_energy_consumption)
[0m20:18:02.764930 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:18:02.772920 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:18:02.773992 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:18:02.791941 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:18:02.792338 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
create or replace  temporary view LB.stage.fact_energy_consumption__dbt_tmp
  
   as (
    

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
    WHERE createdat > (SELECT MAX(createdat) FROM LB.stage.fact_energy_consumption)
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    WHERE c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
)
SELECT
    cwp.contractid,
    cwp.productid,
    cwp.createdat,
    cwp.consumption,
    cwp.base_price + (cwp.working_price * cwp.consumption) AS revenue
FROM consumption_with_price cwp
  );
[0m20:18:02.792538 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:03.366924 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.574 seconds
[0m20:18:03.380710 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:18:03.381384 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption__dbt_tmp
[0m20:18:03.495128 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.113 seconds
[0m20:18:03.501205 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:18:03.501793 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption
[0m20:18:03.586545 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.084 seconds
[0m20:18:03.598259 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:18:03.598734 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table "LB"."STAGE"."FACT_ENERGY_CONSUMPTION"
[0m20:18:03.729298 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.130 seconds
[0m20:18:03.750742 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:18:03.751586 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:18:03.751759 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
-- back compat for old kwarg name
  
  begin;
[0m20:18:03.896592 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.144 seconds
[0m20:18:03.897626 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:18:03.898292 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
merge into LB.stage.fact_energy_consumption as DBT_INTERNAL_DEST
        using LB.stage.fact_energy_consumption__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.contractid = DBT_INTERNAL_DEST.contractid
                ) and (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.createdat = DBT_INTERNAL_DEST.createdat
                )

    
    when matched then update set
        "CONTRACTID" = DBT_INTERNAL_SOURCE."CONTRACTID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","CONSUMPTION" = DBT_INTERNAL_SOURCE."CONSUMPTION","REVENUE" = DBT_INTERNAL_SOURCE."REVENUE"
    

    when not matched then insert
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")
    values
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")

;
[0m20:18:04.289624 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.390 seconds
[0m20:18:04.290485 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:18:04.291001 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
COMMIT
[0m20:18:04.420870 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.129 seconds
[0m20:18:04.435204 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_consumption__dbt_tmp
[0m20:18:04.439334 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:18:04.439556 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
drop view if exists LB.stage.fact_energy_consumption__dbt_tmp cascade
[0m20:18:04.556319 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.116 seconds
[0m20:18:04.558467 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: Close
[0m20:18:04.668327 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165e91a10>]}
[0m20:18:04.669126 [info ] [Thread-1 (]: 6 of 7 OK created sql incremental model stage.fact_energy_consumption .......... [[32mSUCCESS 0[0m in 1.90s]
[0m20:18:04.669881 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:18:04.670631 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:18:04.671462 [info ] [Thread-1 (]: 7 of 7 START sql incremental model stage.dim_product ........................... [RUN]
[0m20:18:04.672268 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_energy_consumption, now model.snowflake_airflow_dbt.dim_product)
[0m20:18:04.672849 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:18:04.679479 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:18:04.680823 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:18:04.683811 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:18:04.684113 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE (productid, productcode, productname, energy, consumptiontype, modificationdate) > (
        SELECT MAX(productid), MAX(productcode), MAX(productname), MAX(energy), MAX(consumptiontype), MAX(modificationdate)
        FROM LB.stage.dim_product
    )
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY productid, productcode, productname, energy, consumptiontype 
               ORDER BY modificationdate DESC
           ) AS rn
    FROM products
),
product_changes AS (
    SELECT 
        productid,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (
            PARTITION BY productid, productcode, productname, energy, consumptiontype
            ORDER BY modificationdate
        ) AS enddate,
        CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
    FROM current_products
)
SELECT 
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    enddate,
    is_current
FROM product_changes
  );
[0m20:18:04.684324 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:05.209383 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.525 seconds
[0m20:18:05.211641 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:18:05.211883 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m20:18:05.297296 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.085 seconds
[0m20:18:05.302935 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:18:05.303453 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m20:18:05.372030 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.068 seconds
[0m20:18:05.374464 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:18:05.374725 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m20:18:05.638949 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.264 seconds
[0m20:18:05.642872 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m20:18:05.645061 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:18:05.645459 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m20:18:05.741610 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.096 seconds
[0m20:18:05.742417 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:18:05.742826 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.productcode = DBT_INTERNAL_DEST.productcode
                ) and (
                    DBT_INTERNAL_SOURCE.productname = DBT_INTERNAL_DEST.productname
                ) and (
                    DBT_INTERNAL_SOURCE.energy = DBT_INTERNAL_DEST.energy
                ) and (
                    DBT_INTERNAL_SOURCE.consumptiontype = DBT_INTERNAL_DEST.consumptiontype
                )

    
    when matched then update set
        "PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")
    values
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")

;
[0m20:18:05.881713 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5948a-0202-d35b-0002-d4460001060e
[0m20:18:05.882533 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002096 (42601): SQL compilation error: error line 10 at position 8
Unsupported: Scalar subquery with multi-column SELECT clause.
[0m20:18:05.883260 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:18:05.996990 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  002096 (42601): SQL compilation error: error line 10 at position 8
  Unsupported: Scalar subquery with multi-column SELECT clause.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_product.sql
[0m20:18:05.998550 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1ead0cb-107b-4a5c-9703-8f369724d2f0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16baf99d0>]}
[0m20:18:05.999819 [error] [Thread-1 (]: 7 of 7 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 1.33s]
[0m20:18:06.000748 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:18:06.004303 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:18:06.004772 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m20:18:06.005322 [info ] [MainThread]: 
[0m20:18:06.005728 [info ] [MainThread]: Finished running 2 table models, 3 view models, 2 incremental models in 0 hours 0 minutes and 9.69 seconds (9.69s).
[0m20:18:06.007286 [debug] [MainThread]: Command end result
[0m20:18:06.045821 [info ] [MainThread]: 
[0m20:18:06.046126 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:18:06.046259 [info ] [MainThread]: 
[0m20:18:06.046436 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  002096 (42601): SQL compilation error: error line 10 at position 8
  Unsupported: Scalar subquery with multi-column SELECT clause.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/dim_product.sql
[0m20:18:06.046575 [info ] [MainThread]: 
[0m20:18:06.046757 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m20:18:06.049340 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 10.868803, "process_user_time": 2.946084, "process_kernel_time": 2.229, "process_mem_max_rss": "192561152", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:18:06.049925 [debug] [MainThread]: Command `dbt run` failed at 20:18:06.049879 after 10.87 seconds
[0m20:18:06.050524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10293ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e181ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9b5610>]}
[0m20:18:06.050717 [debug] [MainThread]: Flushing usage events
[0m20:21:28.264394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14415a210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144159990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144181610>]}


============================== 20:21:28.266886 | 5f0fa247-7c81-45df-9169-19afb17a6cc7 ==============================
[0m20:21:28.266886 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:21:28.267151 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:21:28.986152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144031b90>]}
[0m20:21:29.005677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117673050>]}
[0m20:21:29.006256 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:21:29.019706 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:21:29.086579 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:21:29.086944 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m20:21:29.225754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169e29150>]}
[0m20:21:29.273488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abd97d0>]}
[0m20:21:29.273789 [info ] [MainThread]: Found 1 seed, 7 models, 3 sources, 563 macros
[0m20:21:29.273946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ac4f950>]}
[0m20:21:29.274819 [info ] [MainThread]: 
[0m20:21:29.275105 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:21:29.277069 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:21:29.282957 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:21:29.283221 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:21:29.283349 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:21:29.774167 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.491 seconds
[0m20:21:29.776321 [debug] [ThreadPool]: On list_LB: Close
[0m20:21:29.888016 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:21:29.899768 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:21:29.899984 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:21:29.900100 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:21:30.373842 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.474 seconds
[0m20:21:30.377247 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:21:30.481944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ad16510>]}
[0m20:21:30.482645 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:21:30.483058 [info ] [MainThread]: 
[0m20:21:30.485789 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:21:30.486468 [info ] [Thread-1 (]: 1 of 7 START sql table model stage.dim_date .................................... [RUN]
[0m20:21:30.487046 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m20:21:30.487476 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:21:30.499362 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:21:30.499625 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
select datediff(
        day,
        cast('1900-01-01' as date),
        cast('2030-12-31' as date)
        )
[0m20:21:30.499788 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:21:30.819610 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.320 seconds
[0m20:21:30.834273 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:21:30.834974 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:21:30.846570 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:21:30.847796 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:21:30.848055 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- dbt model








with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
     + 
    
    p7.generated_number * power(2, 7)
     + 
    
    p8.generated_number * power(2, 8)
     + 
    
    p9.generated_number * power(2, 9)
     + 
    
    p10.generated_number * power(2, 10)
     + 
    
    p11.generated_number * power(2, 11)
     + 
    
    p12.generated_number * power(2, 12)
     + 
    
    p13.generated_number * power(2, 13)
     + 
    
    p14.generated_number * power(2, 14)
     + 
    
    p15.generated_number * power(2, 15)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
     cross join 
    
    p as p12
     cross join 
    
    p as p13
     cross join 
    
    p as p14
     cross join 
    
    p as p15
    
    

    )

    select *
    from unioned
    where generated_number <= 47846
    order by generated_number



),

all_periods as (

    select (
        

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('1900-01-01' as date)
        )


    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2030-12-31' as date)

)

select * from filtered


        );
[0m20:21:32.369255 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.521 seconds
[0m20:21:32.389914 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:21:32.493578 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ab90950>]}
[0m20:21:32.494638 [info ] [Thread-1 (]: 1 of 7 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 2.00s]
[0m20:21:32.495311 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:21:32.495561 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m20:21:32.495922 [info ] [Thread-1 (]: 2 of 7 START sql view model stage.stg_contract ................................. [RUN]
[0m20:21:32.496152 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m20:21:32.496308 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m20:21:32.497869 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:21:32.498224 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m20:21:32.507044 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:21:32.507827 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:21:32.508021 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m20:21:32.508200 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:21:33.035346 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.527 seconds
[0m20:21:33.038940 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m20:21:33.146213 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1156111d0>]}
[0m20:21:33.147032 [info ] [Thread-1 (]: 2 of 7 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.65s]
[0m20:21:33.147638 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m20:21:33.148090 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m20:21:33.149014 [info ] [Thread-1 (]: 3 of 7 START sql view model stage.stg_prices ................................... [RUN]
[0m20:21:33.149649 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m20:21:33.150099 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m20:21:33.154998 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:21:33.156352 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m20:21:33.160757 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:21:33.162433 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:21:33.162998 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m20:21:33.163257 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:21:33.612589 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.449 seconds
[0m20:21:33.615666 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m20:21:33.730790 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9a32d0>]}
[0m20:21:33.731751 [info ] [Thread-1 (]: 3 of 7 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.58s]
[0m20:21:33.732388 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m20:21:33.732746 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m20:21:33.733341 [info ] [Thread-1 (]: 4 of 7 START sql view model stage.stg_products ................................. [RUN]
[0m20:21:33.733801 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m20:21:33.734153 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m20:21:33.737825 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m20:21:33.738623 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m20:21:33.741900 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m20:21:33.743276 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:21:33.743638 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m20:21:33.743963 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:21:34.185097 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.441 seconds
[0m20:21:34.189061 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m20:21:34.298016 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9b3910>]}
[0m20:21:34.298917 [info ] [Thread-1 (]: 4 of 7 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.56s]
[0m20:21:34.299790 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m20:21:34.300423 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m20:21:34.301205 [info ] [Thread-1 (]: 5 of 7 START sql table model stage.dim_contract ................................ [RUN]
[0m20:21:34.302095 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m20:21:34.302634 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m20:21:34.307472 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:21:34.308240 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m20:21:34.313438 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:21:34.314136 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m20:21:34.314543 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m20:21:34.314713 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:21:35.441705 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.127 seconds
[0m20:21:35.444918 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m20:21:35.565855 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abaf890>]}
[0m20:21:35.567047 [info ] [Thread-1 (]: 5 of 7 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.26s]
[0m20:21:35.567612 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m20:21:35.568049 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:21:35.568866 [info ] [Thread-1 (]: 6 of 7 START sql incremental model stage.fact_energy_consumption ............... [RUN]
[0m20:21:35.569581 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.fact_energy_consumption)
[0m20:21:35.570177 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:21:35.577989 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:21:35.579128 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:21:35.599338 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:21:35.599665 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
create or replace  temporary view LB.stage.fact_energy_consumption__dbt_tmp
  
   as (
    

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
    WHERE createdat > (SELECT MAX(createdat) FROM LB.stage.fact_energy_consumption)
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    WHERE c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
)
SELECT
    cwp.contractid,
    cwp.productid,
    cwp.createdat,
    cwp.consumption,
    cwp.base_price + (cwp.working_price * cwp.consumption) AS revenue
FROM consumption_with_price cwp
  );
[0m20:21:35.599871 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:21:36.258893 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.659 seconds
[0m20:21:36.273897 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:21:36.274529 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption__dbt_tmp
[0m20:21:36.368017 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.093 seconds
[0m20:21:36.369787 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:21:36.369951 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption
[0m20:21:36.454960 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.085 seconds
[0m20:21:36.460958 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:21:36.461236 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table "LB"."STAGE"."FACT_ENERGY_CONSUMPTION"
[0m20:21:36.532386 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.071 seconds
[0m20:21:36.562644 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:21:36.563490 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:21:36.563654 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
-- back compat for old kwarg name
  
  begin;
[0m20:21:36.649585 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m20:21:36.649863 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:21:36.650049 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
merge into LB.stage.fact_energy_consumption as DBT_INTERNAL_DEST
        using LB.stage.fact_energy_consumption__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.contractid = DBT_INTERNAL_DEST.contractid
                ) and (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.createdat = DBT_INTERNAL_DEST.createdat
                )

    
    when matched then update set
        "CONTRACTID" = DBT_INTERNAL_SOURCE."CONTRACTID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","CONSUMPTION" = DBT_INTERNAL_SOURCE."CONSUMPTION","REVENUE" = DBT_INTERNAL_SOURCE."REVENUE"
    

    when not matched then insert
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")
    values
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")

;
[0m20:21:37.054181 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.404 seconds
[0m20:21:37.054796 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:21:37.055184 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
COMMIT
[0m20:21:37.168633 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.113 seconds
[0m20:21:37.182058 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_consumption__dbt_tmp
[0m20:21:37.186489 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:21:37.186733 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
drop view if exists LB.stage.fact_energy_consumption__dbt_tmp cascade
[0m20:21:37.290056 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.103 seconds
[0m20:21:37.292272 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: Close
[0m20:21:37.403036 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11756a490>]}
[0m20:21:37.404195 [info ] [Thread-1 (]: 6 of 7 OK created sql incremental model stage.fact_energy_consumption .......... [[32mSUCCESS 0[0m in 1.83s]
[0m20:21:37.405117 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:21:37.405825 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:21:37.406637 [info ] [Thread-1 (]: 7 of 7 START sql incremental model stage.dim_product ........................... [RUN]
[0m20:21:37.407273 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_energy_consumption, now model.snowflake_airflow_dbt.dim_product)
[0m20:21:37.407570 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:21:37.412739 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:21:37.414879 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:21:37.418179 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:21:37.418483 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE productid > (
        SELECT COALESCE(MAX(productid), 0)
        FROM LB.stage.dim_product
    )
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY productid, productcode, productname, energy, consumptiontype 
               ORDER BY modificationdate DESC
           ) AS rn
    FROM products
),
product_changes AS (
    SELECT 
        productid,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (
            PARTITION BY productid, productcode, productname, energy, consumptiontype
            ORDER BY modificationdate
        ) AS enddate,
        CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
    FROM current_products
)
SELECT 
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    enddate,
    is_current
FROM product_changes
WHERE rn = 1
  );
[0m20:21:37.418757 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:21:37.885145 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b5948d-0202-d372-0002-d446000135ea
[0m20:21:37.885973 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 48 at position 6
invalid identifier 'RN'
[0m20:21:37.886574 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:21:38.015949 [debug] [Thread-1 (]: Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 48 at position 6
  invalid identifier 'RN'
[0m20:21:38.017390 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5f0fa247-7c81-45df-9169-19afb17a6cc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b9a9850>]}
[0m20:21:38.018635 [error] [Thread-1 (]: 7 of 7 ERROR creating sql incremental model stage.dim_product .................. [[31mERROR[0m in 0.61s]
[0m20:21:38.020775 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:21:38.023846 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:21:38.024588 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m20:21:38.025046 [info ] [MainThread]: 
[0m20:21:38.025363 [info ] [MainThread]: Finished running 2 table models, 3 view models, 2 incremental models in 0 hours 0 minutes and 8.75 seconds (8.75s).
[0m20:21:38.026939 [debug] [MainThread]: Command end result
[0m20:21:38.058829 [info ] [MainThread]: 
[0m20:21:38.059148 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:21:38.059408 [info ] [MainThread]: 
[0m20:21:38.059593 [error] [MainThread]:   Database Error in model dim_product (models/staging/dim_product.sql)
  000904 (42000): SQL compilation error: error line 48 at position 6
  invalid identifier 'RN'
[0m20:21:38.059813 [info ] [MainThread]: 
[0m20:21:38.060466 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m20:21:38.068921 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 9.831391, "process_user_time": 2.62277, "process_kernel_time": 2.004297, "process_mem_max_rss": "196935680", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:21:38.069763 [debug] [MainThread]: Command `dbt run` failed at 20:21:38.069688 after 9.83 seconds
[0m20:21:38.070088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14415a2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10245ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1024cff90>]}
[0m20:21:38.070271 [debug] [MainThread]: Flushing usage events
[0m20:22:50.534431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a95b410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a9bd350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a9bd9d0>]}


============================== 20:22:50.541480 | ff2d57d4-e413-4453-9421-1c1b3ad66546 ==============================
[0m20:22:50.541480 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:22:50.542072 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:22:51.293864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1481ea910>]}
[0m20:22:51.316159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f36eed0>]}
[0m20:22:51.317441 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:22:51.335869 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:22:51.433444 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:22:51.433856 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m20:22:51.608806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ede3c90>]}
[0m20:22:51.665526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1485c3110>]}
[0m20:22:51.665924 [info ] [MainThread]: Found 1 seed, 7 models, 3 sources, 563 macros
[0m20:22:51.666107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14839d510>]}
[0m20:22:51.667075 [info ] [MainThread]: 
[0m20:22:51.667377 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:22:51.669286 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:22:51.675267 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:22:51.675522 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:22:51.675679 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:22:52.147194 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.471 seconds
[0m20:22:52.148044 [debug] [ThreadPool]: On list_LB: Close
[0m20:22:52.250288 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:22:52.261639 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:22:52.261995 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:22:52.262237 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:22:52.648513 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.386 seconds
[0m20:22:52.651893 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:22:52.763908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1489dd610>]}
[0m20:22:52.764765 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:22:52.765305 [info ] [MainThread]: 
[0m20:22:52.768104 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:22:52.768870 [info ] [Thread-1 (]: 1 of 7 START sql table model stage.dim_date .................................... [RUN]
[0m20:22:52.769470 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m20:22:52.769866 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:22:52.782559 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:22:52.782876 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
select datediff(
        day,
        cast('1900-01-01' as date),
        cast('2030-12-31' as date)
        )
[0m20:22:52.783043 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:22:53.145965 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.363 seconds
[0m20:22:53.161298 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:22:53.162308 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:22:53.174763 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:22:53.176234 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:22:53.176507 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- dbt model








with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
     + 
    
    p7.generated_number * power(2, 7)
     + 
    
    p8.generated_number * power(2, 8)
     + 
    
    p9.generated_number * power(2, 9)
     + 
    
    p10.generated_number * power(2, 10)
     + 
    
    p11.generated_number * power(2, 11)
     + 
    
    p12.generated_number * power(2, 12)
     + 
    
    p13.generated_number * power(2, 13)
     + 
    
    p14.generated_number * power(2, 14)
     + 
    
    p15.generated_number * power(2, 15)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
     cross join 
    
    p as p12
     cross join 
    
    p as p13
     cross join 
    
    p as p14
     cross join 
    
    p as p15
    
    

    )

    select *
    from unioned
    where generated_number <= 47846
    order by generated_number



),

all_periods as (

    select (
        

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('1900-01-01' as date)
        )


    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2030-12-31' as date)

)

select * from filtered


        );
[0m20:22:54.660702 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.484 seconds
[0m20:22:54.695165 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:22:54.804677 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ef19050>]}
[0m20:22:54.805170 [info ] [Thread-1 (]: 1 of 7 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 2.03s]
[0m20:22:54.805519 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:22:54.805722 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m20:22:54.805905 [info ] [Thread-1 (]: 2 of 7 START sql view model stage.stg_contract ................................. [RUN]
[0m20:22:54.806208 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m20:22:54.806403 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m20:22:54.808234 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:22:54.808750 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m20:22:54.820090 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:22:54.820895 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:22:54.821071 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m20:22:54.821282 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:22:55.369463 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.548 seconds
[0m20:22:55.372626 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m20:22:55.484533 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148648a90>]}
[0m20:22:55.485749 [info ] [Thread-1 (]: 2 of 7 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.68s]
[0m20:22:55.486413 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m20:22:55.492823 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m20:22:55.495672 [info ] [Thread-1 (]: 3 of 7 START sql view model stage.stg_prices ................................... [RUN]
[0m20:22:55.496420 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m20:22:55.496879 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m20:22:55.501776 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:22:55.503389 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m20:22:55.508556 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:22:55.510103 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:22:55.510739 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m20:22:55.511262 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:22:55.991620 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.480 seconds
[0m20:22:55.995240 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m20:22:56.107042 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1484afd50>]}
[0m20:22:56.108175 [info ] [Thread-1 (]: 3 of 7 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.61s]
[0m20:22:56.109037 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m20:22:56.109647 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m20:22:56.110423 [info ] [Thread-1 (]: 4 of 7 START sql view model stage.stg_products ................................. [RUN]
[0m20:22:56.111287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m20:22:56.111835 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m20:22:56.116397 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m20:22:56.117312 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m20:22:56.120332 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m20:22:56.121382 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:22:56.121630 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m20:22:56.121794 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:22:56.597902 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.476 seconds
[0m20:22:56.600818 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m20:22:56.727357 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148ba3010>]}
[0m20:22:56.728497 [info ] [Thread-1 (]: 4 of 7 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.62s]
[0m20:22:56.729372 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m20:22:56.729999 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m20:22:56.730878 [info ] [Thread-1 (]: 5 of 7 START sql table model stage.dim_contract ................................ [RUN]
[0m20:22:56.731794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m20:22:56.732262 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m20:22:56.736270 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:22:56.737071 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m20:22:56.742028 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:22:56.743439 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m20:22:56.743708 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m20:22:56.743877 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:22:57.729929 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.986 seconds
[0m20:22:57.732088 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m20:22:57.850020 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148d0a750>]}
[0m20:22:57.851154 [info ] [Thread-1 (]: 5 of 7 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.12s]
[0m20:22:57.852091 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m20:22:57.852759 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:22:57.853628 [info ] [Thread-1 (]: 6 of 7 START sql incremental model stage.fact_energy_consumption ............... [RUN]
[0m20:22:57.854406 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.fact_energy_consumption)
[0m20:22:57.855016 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:22:57.862745 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:22:57.863797 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:22:57.877957 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:22:57.878248 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
create or replace  temporary view LB.stage.fact_energy_consumption__dbt_tmp
  
   as (
    

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
    WHERE createdat > (SELECT MAX(createdat) FROM LB.stage.fact_energy_consumption)
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    WHERE c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
)
SELECT
    cwp.contractid,
    cwp.productid,
    cwp.createdat,
    cwp.consumption,
    cwp.base_price + (cwp.working_price * cwp.consumption) AS revenue
FROM consumption_with_price cwp
  );
[0m20:22:57.878445 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:22:58.590225 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.711 seconds
[0m20:22:58.602476 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:22:58.602913 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption__dbt_tmp
[0m20:22:58.690562 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.087 seconds
[0m20:22:58.697580 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:22:58.698229 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption
[0m20:22:58.769546 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.071 seconds
[0m20:22:58.782183 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:22:58.782694 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table "LB"."STAGE"."FACT_ENERGY_CONSUMPTION"
[0m20:22:58.893995 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.111 seconds
[0m20:22:58.917396 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:22:58.918194 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:22:58.918350 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
-- back compat for old kwarg name
  
  begin;
[0m20:22:59.016414 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m20:22:59.017167 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:22:59.017778 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
merge into LB.stage.fact_energy_consumption as DBT_INTERNAL_DEST
        using LB.stage.fact_energy_consumption__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.contractid = DBT_INTERNAL_DEST.contractid
                ) and (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.createdat = DBT_INTERNAL_DEST.createdat
                )

    
    when matched then update set
        "CONTRACTID" = DBT_INTERNAL_SOURCE."CONTRACTID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","CONSUMPTION" = DBT_INTERNAL_SOURCE."CONSUMPTION","REVENUE" = DBT_INTERNAL_SOURCE."REVENUE"
    

    when not matched then insert
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")
    values
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")

;
[0m20:22:59.299946 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.281 seconds
[0m20:22:59.300755 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:22:59.301274 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
COMMIT
[0m20:22:59.400773 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.099 seconds
[0m20:22:59.409009 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_consumption__dbt_tmp
[0m20:22:59.412012 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:22:59.412267 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
drop view if exists LB.stage.fact_energy_consumption__dbt_tmp cascade
[0m20:22:59.614159 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.201 seconds
[0m20:22:59.617796 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: Close
[0m20:22:59.716524 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1482f3c50>]}
[0m20:22:59.717291 [info ] [Thread-1 (]: 6 of 7 OK created sql incremental model stage.fact_energy_consumption .......... [[32mSUCCESS 0[0m in 1.86s]
[0m20:22:59.717775 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:22:59.718238 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:22:59.718629 [info ] [Thread-1 (]: 7 of 7 START sql incremental model stage.dim_product ........................... [RUN]
[0m20:22:59.718991 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_energy_consumption, now model.snowflake_airflow_dbt.dim_product)
[0m20:22:59.719159 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:22:59.721669 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:22:59.722305 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:22:59.724409 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:22:59.724682 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE productid > (
        SELECT COALESCE(MAX(productid), 0)
        FROM LB.stage.dim_product
    )
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY productid, productcode, productname, energy, consumptiontype 
               ORDER BY modificationdate DESC
           ) AS rn
    FROM products
),
product_changes AS (
    SELECT 
        productid,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (
            PARTITION BY productid, productcode, productname, energy, consumptiontype
            ORDER BY modificationdate
        ) AS enddate,
        CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
    FROM current_products
    WHERE rn = 1
)
SELECT 
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    enddate,
    is_current
FROM product_changes
  );
[0m20:22:59.724885 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:23:02.175907 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.451 seconds
[0m20:23:02.181878 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:23:02.182575 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m20:23:02.264317 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.081 seconds
[0m20:23:02.271149 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:23:02.271779 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m20:23:02.342986 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.071 seconds
[0m20:23:02.349599 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:23:02.350252 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m20:23:02.454399 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.104 seconds
[0m20:23:02.459466 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m20:23:02.462150 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:23:02.462627 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m20:23:02.556855 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.094 seconds
[0m20:23:02.558337 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:23:02.559079 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.productcode = DBT_INTERNAL_DEST.productcode
                ) and (
                    DBT_INTERNAL_SOURCE.productname = DBT_INTERNAL_DEST.productname
                ) and (
                    DBT_INTERNAL_SOURCE.energy = DBT_INTERNAL_DEST.energy
                ) and (
                    DBT_INTERNAL_SOURCE.consumptiontype = DBT_INTERNAL_DEST.consumptiontype
                )

    
    when matched then update set
        "PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")
    values
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")

;
[0m20:23:02.993204 [debug] [Thread-1 (]: SQL status: SUCCESS 11 in 0.433 seconds
[0m20:23:02.994338 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:23:02.995029 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m20:23:03.248289 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.252 seconds
[0m20:23:03.253746 [debug] [Thread-1 (]: Applying DROP to: LB.stage.dim_product__dbt_tmp
[0m20:23:03.254834 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:23:03.255364 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.stage.dim_product__dbt_tmp cascade
[0m20:23:03.356872 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.101 seconds
[0m20:23:03.360487 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:23:03.469419 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ff2d57d4-e413-4453-9421-1c1b3ad66546', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148aa7410>]}
[0m20:23:03.470582 [info ] [Thread-1 (]: 7 of 7 OK created sql incremental model stage.dim_product ...................... [[32mSUCCESS 11[0m in 3.75s]
[0m20:23:03.471520 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:23:03.473764 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:23:03.474246 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m20:23:03.474815 [info ] [MainThread]: 
[0m20:23:03.475251 [info ] [MainThread]: Finished running 2 table models, 3 view models, 2 incremental models in 0 hours 0 minutes and 11.81 seconds (11.81s).
[0m20:23:03.476891 [debug] [MainThread]: Command end result
[0m20:23:03.502744 [info ] [MainThread]: 
[0m20:23:03.503020 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:23:03.503158 [info ] [MainThread]: 
[0m20:23:03.503315 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m20:23:03.506203 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.030015, "process_user_time": 3.059183, "process_kernel_time": 1.790899, "process_mem_max_rss": "193937408", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:23:03.506614 [debug] [MainThread]: Command `dbt run` succeeded at 20:23:03.506567 after 13.03 seconds
[0m20:23:03.506882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a996050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102292b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102292cd0>]}
[0m20:23:03.507052 [debug] [MainThread]: Flushing usage events
[0m20:46:53.434381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e097410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e07ff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e0bdad0>]}


============================== 20:46:53.437244 | cd00740c-89f9-4610-8100-cfd91f91d57c ==============================
[0m20:46:53.437244 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:46:53.437578 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --full-refresh', 'send_anonymous_usage_stats': 'True'}
[0m20:46:56.223622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e0bda50>]}
[0m20:46:56.254944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e096290>]}
[0m20:46:56.255731 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:46:56.272815 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:46:56.363888 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:46:56.364148 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:46:56.416192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16adabdd0>]}
[0m20:46:56.477334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b158750>]}
[0m20:46:56.477903 [info ] [MainThread]: Found 1 seed, 7 models, 3 sources, 563 macros
[0m20:46:56.478111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ac91dd0>]}
[0m20:46:56.479600 [info ] [MainThread]: 
[0m20:46:56.479981 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:46:56.482240 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:46:56.592893 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:46:56.593231 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:46:56.593397 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:46:57.210503 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.617 seconds
[0m20:46:57.214177 [debug] [ThreadPool]: On list_LB: Close
[0m20:46:57.335263 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:46:57.352531 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:46:57.353023 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:46:57.353296 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:46:57.769401 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.416 seconds
[0m20:46:57.771215 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:46:57.912633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fe9de90>]}
[0m20:46:57.915954 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:46:57.916847 [info ] [MainThread]: 
[0m20:46:57.934295 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:46:57.935701 [info ] [Thread-1 (]: 1 of 7 START sql table model stage.dim_date .................................... [RUN]
[0m20:46:57.937173 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m20:46:57.938389 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:46:57.960795 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:46:57.961999 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
select datediff(
        day,
        cast('1900-01-01' as date),
        cast('2030-12-31' as date)
        )
[0m20:46:57.964291 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:46:58.407961 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.445 seconds
[0m20:46:58.413920 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:46:58.418895 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:46:58.435423 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:46:58.437052 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:46:58.437298 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- dbt model








with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
     + 
    
    p7.generated_number * power(2, 7)
     + 
    
    p8.generated_number * power(2, 8)
     + 
    
    p9.generated_number * power(2, 9)
     + 
    
    p10.generated_number * power(2, 10)
     + 
    
    p11.generated_number * power(2, 11)
     + 
    
    p12.generated_number * power(2, 12)
     + 
    
    p13.generated_number * power(2, 13)
     + 
    
    p14.generated_number * power(2, 14)
     + 
    
    p15.generated_number * power(2, 15)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
     cross join 
    
    p as p12
     cross join 
    
    p as p13
     cross join 
    
    p as p14
     cross join 
    
    p as p15
    
    

    )

    select *
    from unioned
    where generated_number <= 47846
    order by generated_number



),

all_periods as (

    select (
        

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('1900-01-01' as date)
        )


    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2030-12-31' as date)

)

select * from filtered


        );
[0m20:47:00.077207 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.639 seconds
[0m20:47:00.096728 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:47:00.202916 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16adc60d0>]}
[0m20:47:00.203842 [info ] [Thread-1 (]: 1 of 7 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 2.26s]
[0m20:47:00.204499 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:47:00.204986 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m20:47:00.205646 [info ] [Thread-1 (]: 2 of 7 START sql view model stage.stg_contract ................................. [RUN]
[0m20:47:00.206199 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m20:47:00.206517 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m20:47:00.208211 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:47:00.208724 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m20:47:00.217657 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:47:00.218622 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:47:00.218832 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m20:47:00.218999 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:00.734455 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.515 seconds
[0m20:47:00.737254 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m20:47:00.846736 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ace9210>]}
[0m20:47:00.847662 [info ] [Thread-1 (]: 2 of 7 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.64s]
[0m20:47:00.848364 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m20:47:00.848838 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m20:47:00.849638 [info ] [Thread-1 (]: 3 of 7 START sql view model stage.stg_prices ................................... [RUN]
[0m20:47:00.850247 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m20:47:00.850666 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m20:47:00.855247 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:47:00.856529 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m20:47:00.858658 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:47:00.859534 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:47:00.859723 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m20:47:00.859876 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:01.325307 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.465 seconds
[0m20:47:01.326445 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m20:47:01.439465 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b5ec450>]}
[0m20:47:01.440612 [info ] [Thread-1 (]: 3 of 7 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.59s]
[0m20:47:01.441148 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m20:47:01.441568 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m20:47:01.442553 [info ] [Thread-1 (]: 4 of 7 START sql view model stage.stg_products ................................. [RUN]
[0m20:47:01.443278 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m20:47:01.443726 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m20:47:01.447985 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m20:47:01.448883 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m20:47:01.451433 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m20:47:01.452097 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:47:01.452271 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m20:47:01.452424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:01.961901 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.509 seconds
[0m20:47:01.964136 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m20:47:02.068680 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b48fe10>]}
[0m20:47:02.069797 [info ] [Thread-1 (]: 4 of 7 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.63s]
[0m20:47:02.070433 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m20:47:02.070861 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m20:47:02.071534 [info ] [Thread-1 (]: 5 of 7 START sql table model stage.dim_contract ................................ [RUN]
[0m20:47:02.072212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m20:47:02.072522 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m20:47:02.077346 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:47:02.078646 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m20:47:02.081990 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:47:02.083284 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m20:47:02.083574 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m20:47:02.083738 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:03.236587 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.153 seconds
[0m20:47:03.240152 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m20:47:03.348201 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ada0ad0>]}
[0m20:47:03.349444 [info ] [Thread-1 (]: 5 of 7 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.28s]
[0m20:47:03.350568 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m20:47:03.351373 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:47:03.352253 [info ] [Thread-1 (]: 6 of 7 START sql incremental model stage.fact_energy_consumption ............... [RUN]
[0m20:47:03.352927 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.fact_energy_consumption)
[0m20:47:03.353424 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:47:03.360876 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:47:03.361525 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:47:03.380703 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:47:03.381701 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:47:03.381924 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
create or replace transient table LB.stage.fact_energy_consumption
         as
        (

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    WHERE c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
)
SELECT
    cwp.contractid,
    cwp.productid,
    cwp.createdat,
    cwp.consumption,
    cwp.base_price + (cwp.working_price * cwp.consumption) AS revenue
FROM consumption_with_price cwp
        );
[0m20:47:03.382121 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:04.913034 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.531 seconds
[0m20:47:04.931920 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_consumption__dbt_tmp
[0m20:47:04.935543 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:47:04.935843 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
drop view if exists LB.stage.fact_energy_consumption__dbt_tmp cascade
[0m20:47:05.052426 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.116 seconds
[0m20:47:05.054336 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: Close
[0m20:47:05.174285 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d7bbc50>]}
[0m20:47:05.174718 [info ] [Thread-1 (]: 6 of 7 OK created sql incremental model stage.fact_energy_consumption .......... [[32mSUCCESS 1[0m in 1.82s]
[0m20:47:05.175019 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:47:05.175231 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:47:05.175516 [info ] [Thread-1 (]: 7 of 7 START sql incremental model stage.dim_product ........................... [RUN]
[0m20:47:05.175764 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_energy_consumption, now model.snowflake_airflow_dbt.dim_product)
[0m20:47:05.175918 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:47:05.177980 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:47:05.178665 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:47:05.179949 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m20:47:05.180638 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:47:05.180847 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.stage.dim_product
         as
        (

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY productid, productcode, productname, energy, consumptiontype 
               ORDER BY modificationdate DESC
           ) AS rn
    FROM products
),
product_changes AS (
    SELECT 
        productid,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (
            PARTITION BY productid, productcode, productname, energy, consumptiontype
            ORDER BY modificationdate
        ) AS enddate,
        CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
    FROM current_products
    WHERE rn = 1
)
SELECT 
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    enddate,
    is_current
FROM product_changes
        );
[0m20:47:05.181064 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:47:06.309868 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.128 seconds
[0m20:47:06.315288 [debug] [Thread-1 (]: Applying DROP to: LB.stage.dim_product__dbt_tmp
[0m20:47:06.316133 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:47:06.316717 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.stage.dim_product__dbt_tmp cascade
[0m20:47:06.391211 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.074 seconds
[0m20:47:06.394638 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:47:06.511730 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd00740c-89f9-4610-8100-cfd91f91d57c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b7537d0>]}
[0m20:47:06.513296 [info ] [Thread-1 (]: 7 of 7 OK created sql incremental model stage.dim_product ...................... [[32mSUCCESS 1[0m in 1.34s]
[0m20:47:06.514089 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:47:06.516305 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:47:06.516625 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m20:47:06.516917 [info ] [MainThread]: 
[0m20:47:06.517191 [info ] [MainThread]: Finished running 2 table models, 3 view models, 2 incremental models in 0 hours 0 minutes and 10.04 seconds (10.04s).
[0m20:47:06.517987 [debug] [MainThread]: Command end result
[0m20:47:06.548946 [info ] [MainThread]: 
[0m20:47:06.549248 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:47:06.549394 [info ] [MainThread]: 
[0m20:47:06.549555 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m20:47:06.551458 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.150371, "process_user_time": 3.288158, "process_kernel_time": 1.580767, "process_mem_max_rss": "186122240", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:47:06.551849 [debug] [MainThread]: Command `dbt run` succeeded at 20:47:06.551803 after 13.15 seconds
[0m20:47:06.552108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d331250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e095950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b006d0>]}
[0m20:47:06.552269 [debug] [MainThread]: Flushing usage events
[0m20:51:54.783317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125757b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1257b9290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1257b9910>]}


============================== 20:51:54.785787 | 73d6c071-f713-42e4-9961-9484873f34b9 ==============================
[0m20:51:54.785787 [info ] [MainThread]: Running with dbt=1.8.0
[0m20:51:54.786080 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:51:55.503328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13202d150>]}
[0m20:51:55.522687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1251fca50>]}
[0m20:51:55.523231 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:51:55.537874 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m20:51:55.610216 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:51:55.610454 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:51:55.627376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127ea7d10>]}
[0m20:51:55.678384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132d553d0>]}
[0m20:51:55.678881 [info ] [MainThread]: Found 1 seed, 7 models, 3 sources, 563 macros
[0m20:51:55.679072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132f52d10>]}
[0m20:51:55.680182 [info ] [MainThread]: 
[0m20:51:55.680470 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:51:55.682492 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:51:55.779003 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:51:55.779271 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:51:55.779394 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:51:56.251303 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.472 seconds
[0m20:51:56.253371 [debug] [ThreadPool]: On list_LB: Close
[0m20:51:56.378005 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:51:56.382120 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:51:56.382296 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:51:56.382417 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:51:56.844489 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.462 seconds
[0m20:51:56.849081 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:51:56.959840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132fa7310>]}
[0m20:51:56.961086 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:51:56.961416 [info ] [MainThread]: 
[0m20:51:56.966259 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_date
[0m20:51:56.967085 [info ] [Thread-1 (]: 1 of 7 START sql table model stage.dim_date .................................... [RUN]
[0m20:51:56.967501 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.dim_date)
[0m20:51:56.967718 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_date
[0m20:51:56.978823 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:51:56.979794 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
select datediff(
        day,
        cast('1900-01-01' as date),
        cast('2030-12-31' as date)
        )
[0m20:51:56.980512 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:51:57.395116 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.415 seconds
[0m20:51:57.412382 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_date"
[0m20:51:57.416652 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_date
[0m20:51:57.440262 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_date"
[0m20:51:57.443355 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_date"
[0m20:51:57.444068 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_date"} */
create or replace transient table LB.stage.dim_date
         as
        (-- dbt model








with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * power(2, 0)
     + 
    
    p1.generated_number * power(2, 1)
     + 
    
    p2.generated_number * power(2, 2)
     + 
    
    p3.generated_number * power(2, 3)
     + 
    
    p4.generated_number * power(2, 4)
     + 
    
    p5.generated_number * power(2, 5)
     + 
    
    p6.generated_number * power(2, 6)
     + 
    
    p7.generated_number * power(2, 7)
     + 
    
    p8.generated_number * power(2, 8)
     + 
    
    p9.generated_number * power(2, 9)
     + 
    
    p10.generated_number * power(2, 10)
     + 
    
    p11.generated_number * power(2, 11)
     + 
    
    p12.generated_number * power(2, 12)
     + 
    
    p13.generated_number * power(2, 13)
     + 
    
    p14.generated_number * power(2, 14)
     + 
    
    p15.generated_number * power(2, 15)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
     cross join 
    
    p as p12
     cross join 
    
    p as p13
     cross join 
    
    p as p14
     cross join 
    
    p as p15
    
    

    )

    select *
    from unioned
    where generated_number <= 47846
    order by generated_number



),

all_periods as (

    select (
        

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('1900-01-01' as date)
        )


    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2030-12-31' as date)

)

select * from filtered


        );
[0m20:51:58.912649 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.462 seconds
[0m20:51:58.928749 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_date: Close
[0m20:51:59.041725 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132cd41d0>]}
[0m20:51:59.044955 [info ] [Thread-1 (]: 1 of 7 OK created sql table model stage.dim_date ............................... [[32mSUCCESS 1[0m in 2.07s]
[0m20:51:59.046142 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_date
[0m20:51:59.047188 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m20:51:59.048176 [info ] [Thread-1 (]: 2 of 7 START sql view model stage.stg_contract ................................. [RUN]
[0m20:51:59.048543 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_date, now model.snowflake_airflow_dbt.stg_contract)
[0m20:51:59.048698 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m20:51:59.052341 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:51:59.052686 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m20:51:59.062183 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:51:59.062976 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:51:59.063168 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m20:51:59.063563 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:51:59.511785 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.448 seconds
[0m20:51:59.513441 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m20:51:59.622141 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13352d450>]}
[0m20:51:59.623122 [info ] [Thread-1 (]: 2 of 7 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.57s]
[0m20:51:59.623876 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m20:51:59.624475 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m20:51:59.626589 [info ] [Thread-1 (]: 3 of 7 START sql view model stage.stg_prices ................................... [RUN]
[0m20:51:59.627266 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m20:51:59.627652 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m20:51:59.632250 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:51:59.634301 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m20:51:59.638273 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:51:59.639774 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:51:59.640402 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m20:51:59.641038 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:52:00.166170 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.525 seconds
[0m20:52:00.169277 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m20:52:00.283103 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1336d26d0>]}
[0m20:52:00.284366 [info ] [Thread-1 (]: 3 of 7 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.66s]
[0m20:52:00.285439 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m20:52:00.286152 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m20:52:00.287186 [info ] [Thread-1 (]: 4 of 7 START sql view model stage.stg_products ................................. [RUN]
[0m20:52:00.287939 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m20:52:00.288344 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m20:52:00.292832 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m20:52:00.299013 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m20:52:00.300374 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m20:52:00.300887 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:52:00.301050 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m20:52:00.301200 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:52:00.774948 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.474 seconds
[0m20:52:00.779299 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m20:52:00.889210 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133063750>]}
[0m20:52:00.890179 [info ] [Thread-1 (]: 4 of 7 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.60s]
[0m20:52:00.890945 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m20:52:00.891573 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_contract
[0m20:52:00.892391 [info ] [Thread-1 (]: 5 of 7 START sql table model stage.dim_contract ................................ [RUN]
[0m20:52:00.893097 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.dim_contract)
[0m20:52:00.893706 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_contract
[0m20:52:00.898666 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:52:00.899730 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_contract
[0m20:52:00.903377 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_contract"
[0m20:52:00.904155 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_contract"
[0m20:52:00.904355 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_contract"} */
create or replace transient table LB.stage.dim_contract
         as
        (

SELECT
    contractid,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM LB.stage.stg_contract
        );
[0m20:52:00.904510 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:52:02.163807 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.259 seconds
[0m20:52:02.166999 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_contract: Close
[0m20:52:02.287661 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133061110>]}
[0m20:52:02.288316 [info ] [Thread-1 (]: 5 of 7 OK created sql table model stage.dim_contract ........................... [[32mSUCCESS 1[0m in 1.39s]
[0m20:52:02.288644 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_contract
[0m20:52:02.288892 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:52:02.289232 [info ] [Thread-1 (]: 6 of 7 START sql incremental model stage.fact_energy_consumption ............... [RUN]
[0m20:52:02.289481 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_contract, now model.snowflake_airflow_dbt.fact_energy_consumption)
[0m20:52:02.289640 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:52:02.294849 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:52:02.295875 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:52:02.313272 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:52:02.313715 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
create or replace  temporary view LB.stage.fact_energy_consumption__dbt_tmp
  
   as (
    

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
    WHERE createdat > (SELECT MAX(createdat) FROM LB.stage.fact_energy_consumption)
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    WHERE c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
)
SELECT
    cwp.contractid,
    cwp.productid,
    cwp.createdat,
    cwp.consumption,
    cwp.base_price + (cwp.working_price * cwp.consumption) AS revenue
FROM consumption_with_price cwp
  );
[0m20:52:02.313944 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:52:03.334761 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.009 seconds
[0m20:52:03.399288 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:52:03.400653 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption__dbt_tmp
[0m20:52:03.497017 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.095 seconds
[0m20:52:03.503979 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:52:03.504620 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table LB.stage.fact_energy_consumption
[0m20:52:03.614329 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.109 seconds
[0m20:52:03.619010 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:52:03.619277 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
describe table "LB"."STAGE"."FACT_ENERGY_CONSUMPTION"
[0m20:52:03.705614 [debug] [Thread-1 (]: SQL status: SUCCESS 5 in 0.086 seconds
[0m20:52:03.721239 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:52:03.722147 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:52:03.722312 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
-- back compat for old kwarg name
  
  begin;
[0m20:52:03.817391 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.095 seconds
[0m20:52:03.818114 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:52:03.818639 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
merge into LB.stage.fact_energy_consumption as DBT_INTERNAL_DEST
        using LB.stage.fact_energy_consumption__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.contractid = DBT_INTERNAL_DEST.contractid
                ) and (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.createdat = DBT_INTERNAL_DEST.createdat
                )

    
    when matched then update set
        "CONTRACTID" = DBT_INTERNAL_SOURCE."CONTRACTID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","CONSUMPTION" = DBT_INTERNAL_SOURCE."CONSUMPTION","REVENUE" = DBT_INTERNAL_SOURCE."REVENUE"
    

    when not matched then insert
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")
    values
        ("CONTRACTID", "PRODUCTID", "CREATEDAT", "CONSUMPTION", "REVENUE")

;
[0m20:52:04.839440 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.020 seconds
[0m20:52:04.840505 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:52:04.841201 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
COMMIT
[0m20:52:05.050257 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.208 seconds
[0m20:52:05.068822 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_consumption__dbt_tmp
[0m20:52:05.077349 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_consumption"
[0m20:52:05.077919 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_consumption"} */
drop view if exists LB.stage.fact_energy_consumption__dbt_tmp cascade
[0m20:52:05.191058 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.113 seconds
[0m20:52:05.195467 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_consumption: Close
[0m20:52:05.307562 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1330d9f50>]}
[0m20:52:05.309995 [info ] [Thread-1 (]: 6 of 7 OK created sql incremental model stage.fact_energy_consumption .......... [[32mSUCCESS 0[0m in 3.02s]
[0m20:52:05.311972 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_consumption
[0m20:52:05.313220 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m20:52:05.314367 [info ] [Thread-1 (]: 7 of 7 START sql incremental model stage.dim_product ........................... [RUN]
[0m20:52:05.314972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_energy_consumption, now model.snowflake_airflow_dbt.dim_product)
[0m20:52:05.315375 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m20:52:05.322569 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m20:52:05.323711 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m20:52:05.326614 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:52:05.327192 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace  temporary view LB.stage.dim_product__dbt_tmp
  
   as (
    

WITH products AS (
    SELECT * FROM LB.stage.stg_products
    
    WHERE productid > (
        SELECT COALESCE(MAX(productid), 0)
        FROM LB.stage.dim_product
    )
    
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY productid, productcode, productname, energy, consumptiontype 
               ORDER BY modificationdate DESC
           ) AS rn
    FROM products
),
product_changes AS (
    SELECT 
        productid,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate,
        LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (
            PARTITION BY productid, productcode, productname, energy, consumptiontype
            ORDER BY modificationdate
        ) AS enddate,
        CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
    FROM current_products
    WHERE rn = 1
)
SELECT 
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    modificationdate,
    enddate,
    is_current
FROM product_changes
  );
[0m20:52:05.327706 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:52:05.914968 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.585 seconds
[0m20:52:05.922763 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:52:05.923245 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product__dbt_tmp
[0m20:52:06.011241 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.087 seconds
[0m20:52:06.020724 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:52:06.022105 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table LB.stage.dim_product
[0m20:52:06.096871 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.074 seconds
[0m20:52:06.112155 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:52:06.113118 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
describe table "LB"."STAGE"."DIM_PRODUCT"
[0m20:52:06.175274 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.061 seconds
[0m20:52:06.181734 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m20:52:06.188847 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:52:06.190724 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
-- back compat for old kwarg name
  
  begin;
[0m20:52:06.303031 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.109 seconds
[0m20:52:06.303515 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:52:06.303882 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
merge into LB.stage.dim_product as DBT_INTERNAL_DEST
        using LB.stage.dim_product__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.productcode = DBT_INTERNAL_DEST.productcode
                ) and (
                    DBT_INTERNAL_SOURCE.productname = DBT_INTERNAL_DEST.productname
                ) and (
                    DBT_INTERNAL_SOURCE.energy = DBT_INTERNAL_DEST.energy
                ) and (
                    DBT_INTERNAL_SOURCE.consumptiontype = DBT_INTERNAL_DEST.consumptiontype
                )

    
    when matched then update set
        "PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","CONSUMPTIONTYPE" = DBT_INTERNAL_SOURCE."CONSUMPTIONTYPE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","IS_CURRENT" = DBT_INTERNAL_SOURCE."IS_CURRENT"
    

    when not matched then insert
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")
    values
        ("PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "ENERGY", "CONSUMPTIONTYPE", "MODIFICATIONDATE", "ENDDATE", "IS_CURRENT")

;
[0m20:52:07.083877 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.779 seconds
[0m20:52:07.085137 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:52:07.086167 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
COMMIT
[0m20:52:07.305367 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.219 seconds
[0m20:52:07.317866 [debug] [Thread-1 (]: Applying DROP to: LB.stage.dim_product__dbt_tmp
[0m20:52:07.319179 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m20:52:07.319677 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
drop view if exists LB.stage.dim_product__dbt_tmp cascade
[0m20:52:07.482924 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.163 seconds
[0m20:52:07.486218 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m20:52:07.769424 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73d6c071-f713-42e4-9961-9484873f34b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1335e0390>]}
[0m20:52:07.770723 [info ] [Thread-1 (]: 7 of 7 OK created sql incremental model stage.dim_product ...................... [[32mSUCCESS 0[0m in 2.45s]
[0m20:52:07.771716 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m20:52:07.774317 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:52:07.774766 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m20:52:07.775219 [info ] [MainThread]: 
[0m20:52:07.775558 [info ] [MainThread]: Finished running 2 table models, 3 view models, 2 incremental models in 0 hours 0 minutes and 12.09 seconds (12.09s).
[0m20:52:07.776941 [debug] [MainThread]: Command end result
[0m20:52:07.815640 [info ] [MainThread]: 
[0m20:52:07.815966 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:52:07.816110 [info ] [MainThread]: 
[0m20:52:07.816272 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m20:52:07.821645 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.065546, "process_user_time": 2.343385, "process_kernel_time": 2.312093, "process_mem_max_rss": "191774720", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:52:07.823692 [debug] [MainThread]: Command `dbt run` succeeded at 20:52:07.823502 after 13.07 seconds
[0m20:52:07.826719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1257b97d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104590690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104496cd0>]}
[0m20:52:07.827130 [debug] [MainThread]: Flushing usage events
[0m21:19:21.114225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137a5aa50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137abcf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137abd5d0>]}


============================== 21:19:21.117029 | 27b5cb32-d187-449a-b269-0581fa8641d4 ==============================
[0m21:19:21.117029 [info ] [MainThread]: Running with dbt=1.8.0
[0m21:19:21.117368 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:19:21.903792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151a3b090>]}
[0m21:19:21.923886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137400b90>]}
[0m21:19:21.924558 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m21:19:21.943477 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m21:19:22.015954 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 1 files added, 1 files changed.
[0m21:19:22.016292 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/fact_consumption_revenue.sql
[0m21:19:22.016434 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_energy_consumption.sql
[0m21:19:22.016632 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_date.sql
[0m21:19:22.016787 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_contract.sql
[0m21:19:22.016966 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m21:19:22.173064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155bfc890>]}
[0m21:19:22.222879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1530c6810>]}
[0m21:19:22.223317 [info ] [MainThread]: Found 1 seed, 5 models, 3 sources, 563 macros
[0m21:19:22.223511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146aee610>]}
[0m21:19:22.224422 [info ] [MainThread]: 
[0m21:19:22.224686 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:19:22.226646 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m21:19:22.232605 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m21:19:22.232807 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m21:19:22.232926 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:19:22.790206 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.557 seconds
[0m21:19:22.793282 [debug] [ThreadPool]: On list_LB: Close
[0m21:19:23.468337 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m21:19:23.478219 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m21:19:23.478498 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m21:19:23.478641 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:19:23.964011 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.485 seconds
[0m21:19:23.965968 [debug] [ThreadPool]: On list_LB_stage: Close
[0m21:19:24.078637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155bfc850>]}
[0m21:19:24.079610 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:19:24.080082 [info ] [MainThread]: 
[0m21:19:24.084436 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m21:19:24.085519 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m21:19:24.086324 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m21:19:24.087524 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m21:19:24.104566 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m21:19:24.105888 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m21:19:24.135812 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m21:19:24.136556 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m21:19:24.136739 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m21:19:24.136900 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:24.593657 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.457 seconds
[0m21:19:24.608116 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m21:19:24.712767 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15308d610>]}
[0m21:19:24.713629 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.63s]
[0m21:19:24.714268 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m21:19:24.714736 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m21:19:24.715432 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m21:19:24.716071 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m21:19:24.716508 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m21:19:24.720390 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m21:19:24.721466 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m21:19:24.726462 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m21:19:24.727144 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m21:19:24.727339 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m21:19:24.727503 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:25.181319 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.454 seconds
[0m21:19:25.183870 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m21:19:25.305369 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155d1fe10>]}
[0m21:19:25.306171 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.59s]
[0m21:19:25.306737 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m21:19:25.307110 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m21:19:25.307893 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m21:19:25.308412 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m21:19:25.308821 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m21:19:25.312945 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m21:19:25.313862 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m21:19:25.317355 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m21:19:25.318629 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m21:19:25.319041 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m21:19:25.319357 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:25.864352 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.545 seconds
[0m21:19:25.866553 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m21:19:25.971185 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155f90510>]}
[0m21:19:25.972021 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.66s]
[0m21:19:25.972572 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m21:19:25.973012 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:19:25.973939 [info ] [Thread-1 (]: 4 of 5 START sql incremental model stage.fact_consumption_revenue .............. [RUN]
[0m21:19:25.974739 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_consumption_revenue)
[0m21:19:25.975330 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:19:25.982037 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:19:25.982983 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:19:26.006723 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:19:26.007905 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:19:26.008139 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
create or replace transient table LB.stage.fact_consumption_revenue
         as
        (

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat AS anlagedatum,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    AND c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
),
current_data AS (
    SELECT
        cwp.contractid,
        cwp.productid,
        cwp.anlagedatum,
        cwp.consumption AS verbrauch,
        cwp.base_price + (cwp.working_price * cwp.consumption) AS umsatz,
        CURRENT_TIMESTAMP() AS valid_from,
        '9999-12-31'::DATE AS valid_to
    FROM consumption_with_price cwp
)

-- Insert the new records and update the historical ones
SELECT
    c.contractid,
    c.productid,
    c.anlagedatum,
    c.verbrauch,
    c.umsatz,
    c.valid_from,
    c.valid_to
FROM current_data c
LEFT JOIN LB.stage.fact_consumption_revenue t
ON c.contractid = t.contractid
   AND c.productid = t.productid
   AND c.anlagedatum = t.anlagedatum
   AND c.valid_from = t.valid_from
WHERE (t.valid_to >= CURRENT_DATE() OR t.valid_to IS NULL)
   AND (t.valid_from <= CURRENT_DATE())
   OR t.contractid IS NULL
        );
[0m21:19:26.008361 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:26.448209 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b594c7-0202-d36d-0002-d44600011622
[0m21:19:26.448731 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'LB.STAGE.FACT_CONSUMPTION_REVENUE' does not exist or not authorized.
[0m21:19:26.449148 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: Close
[0m21:19:26.563460 [debug] [Thread-1 (]: Database Error in model fact_consumption_revenue (models/staging/fact_consumption_revenue.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.STAGE.FACT_CONSUMPTION_REVENUE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/fact_consumption_revenue.sql
[0m21:19:26.564082 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152f0b750>]}
[0m21:19:26.564670 [error] [Thread-1 (]: 4 of 5 ERROR creating sql incremental model stage.fact_consumption_revenue ..... [[31mERROR[0m in 0.59s]
[0m21:19:26.565255 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:19:26.565735 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m21:19:26.567024 [info ] [Thread-1 (]: 5 of 5 START sql table model stage.dim_product ................................. [RUN]
[0m21:19:26.567521 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_consumption_revenue, now model.snowflake_airflow_dbt.dim_product)
[0m21:19:26.567861 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m21:19:26.571027 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m21:19:26.571481 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m21:19:26.579120 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m21:19:26.580023 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m21:19:26.580217 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.stage.dim_product
         as
        (

WITH products AS (
    SELECT * FROM LB.stage.stg_products
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY productid, productcode, productname, energy, consumptiontype 
               ORDER BY modificationdate DESC
           ) AS rn
    FROM products
),
product_changes AS (
    SELECT 
        productid,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate AS anlagedatum,
        LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (
            PARTITION BY productid, productcode, productname, energy, consumptiontype
            ORDER BY modificationdate
        ) AS enddate,
        CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
    FROM current_products
    WHERE rn = 1
)

SELECT 
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    anlagedatum,
    enddate,
    is_current
FROM product_changes
        );
[0m21:19:26.580391 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:28.100470 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.520 seconds
[0m21:19:28.102952 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m21:19:28.223390 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27b5cb32-d187-449a-b269-0581fa8641d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1565bd750>]}
[0m21:19:28.224159 [info ] [Thread-1 (]: 5 of 5 OK created sql table model stage.dim_product ............................ [[32mSUCCESS 1[0m in 1.66s]
[0m21:19:28.224541 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m21:19:28.225695 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:19:28.225874 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m21:19:28.226106 [info ] [MainThread]: 
[0m21:19:28.226253 [info ] [MainThread]: Finished running 3 view models, 1 incremental model, 1 table model in 0 hours 0 minutes and 6.00 seconds (6.00s).
[0m21:19:28.226794 [debug] [MainThread]: Command end result
[0m21:19:28.255297 [info ] [MainThread]: 
[0m21:19:28.255836 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:19:28.256249 [info ] [MainThread]: 
[0m21:19:28.256503 [error] [MainThread]:   Database Error in model fact_consumption_revenue (models/staging/fact_consumption_revenue.sql)
  002003 (42S02): SQL compilation error:
  Object 'LB.STAGE.FACT_CONSUMPTION_REVENUE' does not exist or not authorized.
  compiled Code at target/run/snowflake_airflow_dbt/models/staging/fact_consumption_revenue.sql
[0m21:19:28.256643 [info ] [MainThread]: 
[0m21:19:28.256793 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:19:28.259665 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.1764565, "process_user_time": 2.81314, "process_kernel_time": 1.73678, "process_mem_max_rss": "197574656", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:19:28.261217 [debug] [MainThread]: Command `dbt run` failed at 21:19:28.260921 after 7.18 seconds
[0m21:19:28.262116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137abca50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104efed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137a9cd50>]}
[0m21:19:28.262420 [debug] [MainThread]: Flushing usage events
[0m21:22:25.355281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c1f910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c81310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c5acd0>]}


============================== 21:22:25.358132 | a8018023-2982-4a81-811f-388c346ec0fc ==============================
[0m21:22:25.358132 [info ] [MainThread]: Running with dbt=1.8.0
[0m21:22:25.358426 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:22:26.216999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168d1d2d0>]}
[0m21:22:26.236279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117d6ae90>]}
[0m21:22:26.237661 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m21:22:26.251507 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m21:22:26.319454 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:22:26.319697 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:22:26.336667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abc8050>]}
[0m21:22:26.381173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ac5bc10>]}
[0m21:22:26.381449 [info ] [MainThread]: Found 1 seed, 5 models, 3 sources, 563 macros
[0m21:22:26.381601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a87fa50>]}
[0m21:22:26.382401 [info ] [MainThread]: 
[0m21:22:26.382647 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:22:26.384592 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m21:22:26.397063 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m21:22:26.397366 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m21:22:26.397512 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:22:26.948444 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.551 seconds
[0m21:22:26.950741 [debug] [ThreadPool]: On list_LB: Close
[0m21:22:27.075988 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m21:22:27.085968 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m21:22:27.086400 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m21:22:27.086656 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:22:27.468263 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.381 seconds
[0m21:22:27.471625 [debug] [ThreadPool]: On list_LB_stage: Close
[0m21:22:27.584347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c4c3d0>]}
[0m21:22:27.586406 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:22:27.586868 [info ] [MainThread]: 
[0m21:22:27.590441 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m21:22:27.591211 [info ] [Thread-1 (]: 1 of 5 START sql view model stage.stg_contract ................................. [RUN]
[0m21:22:27.591758 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m21:22:27.592125 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m21:22:27.598211 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m21:22:27.598741 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m21:22:27.622840 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m21:22:27.625062 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m21:22:27.625451 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m21:22:27.625685 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:22:28.103643 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.478 seconds
[0m21:22:28.126877 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m21:22:28.232389 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12074ead0>]}
[0m21:22:28.233165 [info ] [Thread-1 (]: 1 of 5 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.64s]
[0m21:22:28.233703 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m21:22:28.234086 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m21:22:28.234646 [info ] [Thread-1 (]: 2 of 5 START sql view model stage.stg_prices ................................... [RUN]
[0m21:22:28.234975 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m21:22:28.235136 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m21:22:28.236623 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m21:22:28.238373 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m21:22:28.239677 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m21:22:28.240237 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m21:22:28.240412 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m21:22:28.240583 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:22:28.761878 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.521 seconds
[0m21:22:28.765608 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m21:22:28.876333 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12074ea50>]}
[0m21:22:28.877081 [info ] [Thread-1 (]: 2 of 5 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.64s]
[0m21:22:28.877631 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m21:22:28.878001 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m21:22:28.878914 [info ] [Thread-1 (]: 3 of 5 START sql view model stage.stg_products ................................. [RUN]
[0m21:22:28.879506 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m21:22:28.879805 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m21:22:28.885650 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m21:22:28.886568 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m21:22:28.890226 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m21:22:28.891564 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m21:22:28.892105 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m21:22:28.892526 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:22:29.410329 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.518 seconds
[0m21:22:29.411492 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m21:22:29.515358 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b08d5d0>]}
[0m21:22:29.515784 [info ] [Thread-1 (]: 3 of 5 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.64s]
[0m21:22:29.516238 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m21:22:29.516451 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:22:29.516758 [info ] [Thread-1 (]: 4 of 5 START sql incremental model stage.fact_consumption_revenue .............. [RUN]
[0m21:22:29.517138 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_consumption_revenue)
[0m21:22:29.517298 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:22:29.522687 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:22:29.523220 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:22:29.542995 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:22:29.543353 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
create or replace  temporary view LB.stage.fact_consumption_revenue__dbt_tmp
  
   as (
    

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
    WHERE createdat > (SELECT COALESCE(MAX(anlagedatum), '1900-01-01'::TIMESTAMP) FROM LB.stage.fact_consumption_revenue)
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat AS anlagedatum,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    AND c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
),
current_data AS (
    SELECT
        cwp.contractid,
        cwp.productid,
        cwp.anlagedatum,
        cwp.consumption AS verbrauch,
        cwp.base_price + (cwp.working_price * cwp.consumption) AS umsatz,
        CURRENT_TIMESTAMP() AS valid_from,
        '9999-12-31'::DATE AS valid_to
    FROM consumption_with_price cwp
)

-- Insert the new records and update the historical ones
SELECT
    c.contractid,
    c.productid,
    c.anlagedatum,
    c.verbrauch,
    c.umsatz,
    c.valid_from,
    c.valid_to
FROM current_data c
LEFT JOIN LB.stage.fact_consumption_revenue t
ON c.contractid = t.contractid
   AND c.productid = t.productid
   AND c.anlagedatum = t.anlagedatum
   AND c.valid_from = t.valid_from
WHERE (t.valid_to >= CURRENT_DATE() OR t.valid_to IS NULL)
   AND (t.valid_from <= CURRENT_DATE())
   OR t.contractid IS NULL
  );
[0m21:22:29.543574 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:22:30.071226 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.527 seconds
[0m21:22:30.085879 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:22:30.086365 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
describe table LB.stage.fact_consumption_revenue__dbt_tmp
[0m21:22:30.165981 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.079 seconds
[0m21:22:30.171799 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:22:30.172406 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
describe table LB.stage.fact_consumption_revenue
[0m21:22:30.261447 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.088 seconds
[0m21:22:30.272839 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:22:30.273296 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
describe table "LB"."STAGE"."FACT_CONSUMPTION_REVENUE"
[0m21:22:30.363922 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.090 seconds
[0m21:22:30.386838 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:22:30.387691 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:22:30.387852 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
-- back compat for old kwarg name
  
  begin;
[0m21:22:30.580223 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.192 seconds
[0m21:22:30.580827 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:22:30.581269 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
merge into LB.stage.fact_consumption_revenue as DBT_INTERNAL_DEST
        using LB.stage.fact_consumption_revenue__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.contractid = DBT_INTERNAL_DEST.contractid
                ) and (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.anlagedatum = DBT_INTERNAL_DEST.anlagedatum
                )

    
    when matched then update set
        "CONTRACTID" = DBT_INTERNAL_SOURCE."CONTRACTID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("CONTRACTID", "PRODUCTID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "VALID_FROM", "VALID_TO")
    values
        ("CONTRACTID", "PRODUCTID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "VALID_FROM", "VALID_TO")

;
[0m21:22:31.648999 [debug] [Thread-1 (]: SQL status: SUCCESS 36228 in 1.067 seconds
[0m21:22:31.649775 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:22:31.650377 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
COMMIT
[0m21:22:32.012598 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.362 seconds
[0m21:22:32.023376 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_consumption_revenue__dbt_tmp
[0m21:22:32.031040 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:22:32.031586 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
drop view if exists LB.stage.fact_consumption_revenue__dbt_tmp cascade
[0m21:22:32.129637 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m21:22:32.131799 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: Close
[0m21:22:32.249886 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aba1890>]}
[0m21:22:32.251062 [info ] [Thread-1 (]: 4 of 5 OK created sql incremental model stage.fact_consumption_revenue ......... [[32mSUCCESS 36228[0m in 2.73s]
[0m21:22:32.252002 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:22:32.252642 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m21:22:32.253425 [info ] [Thread-1 (]: 5 of 5 START sql table model stage.dim_product ................................. [RUN]
[0m21:22:32.254126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_consumption_revenue, now model.snowflake_airflow_dbt.dim_product)
[0m21:22:32.254655 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m21:22:32.259376 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m21:22:32.260775 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m21:22:32.271745 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m21:22:32.272685 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m21:22:32.272891 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.stage.dim_product
         as
        (

WITH products AS (
    SELECT * FROM LB.stage.stg_products
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY productid, productcode, productname, energy, consumptiontype 
               ORDER BY modificationdate DESC
           ) AS rn
    FROM products
),
product_changes AS (
    SELECT 
        productid,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate AS anlagedatum,
        LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (
            PARTITION BY productid, productcode, productname, energy, consumptiontype
            ORDER BY modificationdate
        ) AS enddate,
        CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
    FROM current_products
    WHERE rn = 1
)

SELECT 
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    anlagedatum,
    enddate,
    is_current
FROM product_changes
        );
[0m21:22:32.273064 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:22:33.550844 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.277 seconds
[0m21:22:33.554603 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m21:22:33.666966 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8018023-2982-4a81-811f-388c346ec0fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aee5750>]}
[0m21:22:33.668176 [info ] [Thread-1 (]: 5 of 5 OK created sql table model stage.dim_product ............................ [[32mSUCCESS 1[0m in 1.41s]
[0m21:22:33.669119 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m21:22:33.671169 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:22:33.671645 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.dim_product' was properly closed.
[0m21:22:33.672196 [info ] [MainThread]: 
[0m21:22:33.672564 [info ] [MainThread]: Finished running 3 view models, 1 incremental model, 1 table model in 0 hours 0 minutes and 7.29 seconds (7.29s).
[0m21:22:33.673863 [debug] [MainThread]: Command end result
[0m21:22:33.704804 [info ] [MainThread]: 
[0m21:22:33.705460 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:22:33.705802 [info ] [MainThread]: 
[0m21:22:33.706058 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:22:33.710238 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.386739, "process_user_time": 2.826456, "process_kernel_time": 1.215403, "process_mem_max_rss": "194723840", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:22:33.712656 [debug] [MainThread]: Command `dbt run` succeeded at 21:22:33.712411 after 8.39 seconds
[0m21:22:33.713482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117bc04d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c4c550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1028b8710>]}
[0m21:22:33.713718 [debug] [MainThread]: Flushing usage events
[0m21:24:47.142502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f1f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f80f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f81610>]}


============================== 21:24:47.151349 | f06e6442-519e-4744-8788-b9b0c487fe3a ==============================
[0m21:24:47.151349 [info ] [MainThread]: Running with dbt=1.8.0
[0m21:24:47.151707 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:24:48.360444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f26e50>]}
[0m21:24:48.380411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127800bd0>]}
[0m21:24:48.381150 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m21:24:48.402359 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m21:24:48.483649 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m21:24:48.483989 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/fact_current_consumption_revenue.sql
[0m21:24:48.618225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13730e9d0>]}
[0m21:24:48.661758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1371da910>]}
[0m21:24:48.662036 [info ] [MainThread]: Found 1 seed, 6 models, 3 sources, 563 macros
[0m21:24:48.662197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136fd4690>]}
[0m21:24:48.662985 [info ] [MainThread]: 
[0m21:24:48.663228 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:24:48.665067 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m21:24:48.670625 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m21:24:48.670857 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m21:24:48.670987 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:24:52.290438 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 3.619 seconds
[0m21:24:52.293815 [debug] [ThreadPool]: On list_LB: Close
[0m21:24:52.412059 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m21:24:52.417841 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m21:24:52.418092 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m21:24:52.418562 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:24:52.845167 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.427 seconds
[0m21:24:52.846988 [debug] [ThreadPool]: On list_LB_stage: Close
[0m21:24:52.955183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135ce4190>]}
[0m21:24:52.955740 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:24:52.955937 [info ] [MainThread]: 
[0m21:24:52.957520 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m21:24:52.957803 [info ] [Thread-1 (]: 1 of 6 START sql view model stage.stg_contract ................................. [RUN]
[0m21:24:52.958029 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m21:24:52.958176 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m21:24:52.962126 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m21:24:52.962622 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m21:24:52.980449 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m21:24:52.981320 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m21:24:52.981534 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m21:24:52.981714 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:24:53.401650 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.420 seconds
[0m21:24:53.414799 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m21:24:53.523506 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13753b810>]}
[0m21:24:53.524517 [info ] [Thread-1 (]: 1 of 6 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.56s]
[0m21:24:53.525015 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m21:24:53.525532 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m21:24:53.526179 [info ] [Thread-1 (]: 2 of 6 START sql view model stage.stg_prices ................................... [RUN]
[0m21:24:53.526916 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m21:24:53.527365 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m21:24:53.529654 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m21:24:53.530228 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m21:24:53.532370 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m21:24:53.533396 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m21:24:53.533598 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m21:24:53.533754 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:24:54.026194 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.492 seconds
[0m21:24:54.027307 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m21:24:54.131041 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13732d6d0>]}
[0m21:24:54.131758 [info ] [Thread-1 (]: 2 of 6 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.60s]
[0m21:24:54.132582 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m21:24:54.132959 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m21:24:54.133598 [info ] [Thread-1 (]: 3 of 6 START sql view model stage.stg_products ................................. [RUN]
[0m21:24:54.134040 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m21:24:54.134512 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m21:24:54.141425 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m21:24:54.142185 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m21:24:54.145602 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m21:24:54.146608 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m21:24:54.146823 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m21:24:54.146978 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:24:54.636216 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.489 seconds
[0m21:24:54.638394 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m21:24:54.745576 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137334e10>]}
[0m21:24:54.746547 [info ] [Thread-1 (]: 3 of 6 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.61s]
[0m21:24:54.747472 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m21:24:54.747978 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:24:54.748641 [info ] [Thread-1 (]: 4 of 6 START sql incremental model stage.fact_consumption_revenue .............. [RUN]
[0m21:24:54.749287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_consumption_revenue)
[0m21:24:54.749695 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:24:54.761005 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:24:54.761489 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:24:54.777907 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:24:54.778332 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
create or replace  temporary view LB.stage.fact_consumption_revenue__dbt_tmp
  
   as (
    

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
    WHERE createdat > (SELECT COALESCE(MAX(anlagedatum), '1900-01-01'::TIMESTAMP) FROM LB.stage.fact_consumption_revenue)
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat AS anlagedatum,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    AND c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
),
current_data AS (
    SELECT
        cwp.contractid,
        cwp.productid,
        cwp.anlagedatum,
        cwp.consumption AS verbrauch,
        cwp.base_price + (cwp.working_price * cwp.consumption) AS umsatz,
        CURRENT_TIMESTAMP() AS valid_from,
        '9999-12-31'::DATE AS valid_to
    FROM consumption_with_price cwp
)

-- Insert the new records and update the historical ones
SELECT
    c.contractid,
    c.productid,
    c.anlagedatum,
    c.verbrauch,
    c.umsatz,
    c.valid_from,
    c.valid_to
FROM current_data c
LEFT JOIN LB.stage.fact_consumption_revenue t
ON c.contractid = t.contractid
   AND c.productid = t.productid
   AND c.anlagedatum = t.anlagedatum
   AND c.valid_from = t.valid_from
WHERE (t.valid_to >= CURRENT_DATE() OR t.valid_to IS NULL)
   AND (t.valid_from <= CURRENT_DATE())
   OR t.contractid IS NULL
  );
[0m21:24:54.778564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:24:55.383441 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.605 seconds
[0m21:24:55.392686 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:24:55.393198 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
describe table LB.stage.fact_consumption_revenue__dbt_tmp
[0m21:24:55.475783 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.082 seconds
[0m21:24:55.479741 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:24:55.480213 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
describe table LB.stage.fact_consumption_revenue
[0m21:24:55.573619 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.093 seconds
[0m21:24:55.582597 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:24:55.583212 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
describe table "LB"."STAGE"."FACT_CONSUMPTION_REVENUE"
[0m21:24:55.644431 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.061 seconds
[0m21:24:55.668627 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:24:55.669553 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:24:55.669738 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
-- back compat for old kwarg name
  
  begin;
[0m21:24:55.767667 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.098 seconds
[0m21:24:55.768011 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:24:55.768229 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
merge into LB.stage.fact_consumption_revenue as DBT_INTERNAL_DEST
        using LB.stage.fact_consumption_revenue__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.contractid = DBT_INTERNAL_DEST.contractid
                ) and (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.anlagedatum = DBT_INTERNAL_DEST.anlagedatum
                )

    
    when matched then update set
        "CONTRACTID" = DBT_INTERNAL_SOURCE."CONTRACTID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("CONTRACTID", "PRODUCTID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "VALID_FROM", "VALID_TO")
    values
        ("CONTRACTID", "PRODUCTID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "VALID_FROM", "VALID_TO")

;
[0m21:24:56.195373 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.427 seconds
[0m21:24:56.196509 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:24:56.196830 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
COMMIT
[0m21:24:56.306796 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.110 seconds
[0m21:24:56.315827 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_consumption_revenue__dbt_tmp
[0m21:24:56.322409 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:24:56.322908 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
drop view if exists LB.stage.fact_consumption_revenue__dbt_tmp cascade
[0m21:24:56.427764 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.104 seconds
[0m21:24:56.430232 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: Close
[0m21:24:56.534725 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137162450>]}
[0m21:24:56.535672 [info ] [Thread-1 (]: 4 of 6 OK created sql incremental model stage.fact_consumption_revenue ......... [[32mSUCCESS 0[0m in 1.79s]
[0m21:24:56.536435 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:24:56.536998 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m21:24:56.537849 [info ] [Thread-1 (]: 5 of 6 START sql table model stage.dim_product ................................. [RUN]
[0m21:24:56.538365 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_consumption_revenue, now model.snowflake_airflow_dbt.dim_product)
[0m21:24:56.538757 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m21:24:56.543489 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m21:24:56.544269 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m21:24:56.560168 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m21:24:56.561166 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m21:24:56.561432 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.stage.dim_product
         as
        (

WITH products AS (
    SELECT * FROM LB.stage.stg_products
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY productid, productcode, productname, energy, consumptiontype 
               ORDER BY modificationdate DESC
           ) AS rn
    FROM products
),
product_changes AS (
    SELECT 
        productid,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate AS anlagedatum,
        LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (
            PARTITION BY productid, productcode, productname, energy, consumptiontype
            ORDER BY modificationdate
        ) AS enddate,
        CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
    FROM current_products
    WHERE rn = 1
)

SELECT 
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    anlagedatum,
    enddate,
    is_current
FROM product_changes
        );
[0m21:24:56.561943 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:24:57.424721 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.863 seconds
[0m21:24:57.428312 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m21:24:57.541623 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137592390>]}
[0m21:24:57.542617 [info ] [Thread-1 (]: 5 of 6 OK created sql table model stage.dim_product ............................ [[32mSUCCESS 1[0m in 1.00s]
[0m21:24:57.543193 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m21:24:57.543665 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m21:24:57.544229 [info ] [Thread-1 (]: 6 of 6 START sql view model stage.fact_current_consumption_revenue ............. [RUN]
[0m21:24:57.544698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_current_consumption_revenue)
[0m21:24:57.545044 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m21:24:57.549653 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_current_consumption_revenue"
[0m21:24:57.550485 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m21:24:57.553756 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_current_consumption_revenue"
[0m21:24:57.554580 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_current_consumption_revenue"
[0m21:24:57.554773 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_current_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_current_consumption_revenue"} */
create or replace   view LB.stage.fact_current_consumption_revenue
  
   as (
    

SELECT
    contractid,
    productid,
    anlagedatum,
    verbrauch,
    umsatz
FROM LB.stage.fact_consumption_revenue
WHERE valid_from <= CURRENT_DATE()
AND valid_to >= CURRENT_DATE()
  );
[0m21:24:57.554996 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:24:57.992558 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.437 seconds
[0m21:24:57.994790 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_current_consumption_revenue: Close
[0m21:24:58.099123 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f06e6442-519e-4744-8788-b9b0c487fe3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1306fc310>]}
[0m21:24:58.100171 [info ] [Thread-1 (]: 6 of 6 OK created sql view model stage.fact_current_consumption_revenue ........ [[32mSUCCESS 1[0m in 0.55s]
[0m21:24:58.101145 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m21:24:58.103191 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:24:58.103740 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_current_consumption_revenue' was properly closed.
[0m21:24:58.104399 [info ] [MainThread]: 
[0m21:24:58.104907 [info ] [MainThread]: Finished running 4 view models, 1 incremental model, 1 table model in 0 hours 0 minutes and 9.44 seconds (9.44s).
[0m21:24:58.106176 [debug] [MainThread]: Command end result
[0m21:24:58.132169 [info ] [MainThread]: 
[0m21:24:58.132468 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:24:58.132614 [info ] [MainThread]: 
[0m21:24:58.132774 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m21:24:58.134545 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.069661, "process_user_time": 2.577994, "process_kernel_time": 2.100703, "process_mem_max_rss": "185991168", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:24:58.134902 [debug] [MainThread]: Command `dbt run` succeeded at 21:24:58.134866 after 11.07 seconds
[0m21:24:58.135141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10078ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10078acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137370390>]}
[0m21:24:58.135296 [debug] [MainThread]: Flushing usage events
[0m21:30:02.734386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c15ae90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c1bcf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c1bd5d0>]}


============================== 21:30:02.737502 | 9e981dbe-e941-4d3d-89e6-4ae77342cbb7 ==============================
[0m21:30:02.737502 [info ] [MainThread]: Running with dbt=1.8.0
[0m21:30:02.737801 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:30:03.660273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16cc91690>]}
[0m21:30:03.682799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bb00b50>]}
[0m21:30:03.683416 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m21:30:03.716476 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m21:30:03.911655 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:30:03.912807 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:30:03.944779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c189fd0>]}
[0m21:30:04.015389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x179f8a6d0>]}
[0m21:30:04.015840 [info ] [MainThread]: Found 1 seed, 6 models, 3 sources, 563 macros
[0m21:30:04.016097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17a090f50>]}
[0m21:30:04.017882 [info ] [MainThread]: 
[0m21:30:04.018794 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:30:04.021705 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m21:30:04.103847 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m21:30:04.104082 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m21:30:04.104212 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:30:04.620102 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.516 seconds
[0m21:30:04.620967 [debug] [ThreadPool]: On list_LB: Close
[0m21:30:04.735085 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m21:30:04.745030 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m21:30:04.745521 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m21:30:04.745912 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:30:05.227668 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.481 seconds
[0m21:30:05.231726 [debug] [ThreadPool]: On list_LB_stage: Close
[0m21:30:05.350252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c06e890>]}
[0m21:30:05.352163 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:30:05.353113 [info ] [MainThread]: 
[0m21:30:05.358611 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m21:30:05.362016 [info ] [Thread-1 (]: 1 of 6 START sql view model stage.stg_contract ................................. [RUN]
[0m21:30:05.363351 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m21:30:05.364275 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m21:30:05.381087 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m21:30:05.381972 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m21:30:05.428118 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m21:30:05.429648 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m21:30:05.430087 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

SELECT
    id::INTEGER AS contractid,
    type::VARCHAR(50) AS type,
    energy::VARCHAR(50) AS energy,
    usage::FLOAT AS usage,
    usagenet::FLOAT AS usagenet,
    createdat::TIMESTAMP AS createdat,
    startdate::DATE AS startdate,
    enddate::DATE AS enddate,
    city::VARCHAR(100) AS city,
    status::VARCHAR(50) AS status,
    productid::INTEGER AS productid,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.contract
  );
[0m21:30:05.430603 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:05.950297 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.520 seconds
[0m21:30:05.972518 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m21:30:06.087685 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17a297d10>]}
[0m21:30:06.088698 [info ] [Thread-1 (]: 1 of 6 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.72s]
[0m21:30:06.089161 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m21:30:06.090004 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m21:30:06.090785 [info ] [Thread-1 (]: 2 of 6 START sql view model stage.stg_prices ................................... [RUN]
[0m21:30:06.091645 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m21:30:06.091873 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m21:30:06.094088 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m21:30:06.094709 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m21:30:06.096296 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m21:30:06.097030 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m21:30:06.097224 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS id,
    productid::INTEGER AS productid,
    pricecomponentid::INTEGER AS pricecomponentid,
    productcomponent::VARCHAR(50) AS productcomponent,
    price::FLOAT AS price,
    unit::VARCHAR(20) AS unit,
    valid_from::DATE AS valid_from,
    valid_until::DATE AS valid_until,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.prices
  );
[0m21:30:06.097394 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:06.587987 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.490 seconds
[0m21:30:06.592211 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m21:30:06.702585 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17a0cd2d0>]}
[0m21:30:06.703717 [info ] [Thread-1 (]: 2 of 6 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.61s]
[0m21:30:06.704484 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m21:30:06.705006 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m21:30:06.705874 [info ] [Thread-1 (]: 3 of 6 START sql view model stage.stg_products ................................. [RUN]
[0m21:30:06.706457 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m21:30:06.706834 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m21:30:06.712132 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m21:30:06.713212 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m21:30:06.717546 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m21:30:06.719711 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m21:30:06.720485 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    -- dbt model


SELECT
    id::INTEGER AS productid,
    productcode::VARCHAR(50) AS productcode,
    productname::VARCHAR(100) AS productname,
    energy::VARCHAR(50) AS energy,
    consumptiontype::VARCHAR(50) AS consumptiontype,
    deleted::BOOLEAN AS deleted,
    modificationdate::TIMESTAMP AS modificationdate
FROM lb.raw.products
  );
[0m21:30:06.721031 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:07.185318 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.464 seconds
[0m21:30:07.188250 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m21:30:07.332170 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17a039c90>]}
[0m21:30:07.333367 [info ] [Thread-1 (]: 3 of 6 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.63s]
[0m21:30:07.334269 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m21:30:07.334855 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:30:07.335472 [info ] [Thread-1 (]: 4 of 6 START sql incremental model stage.fact_consumption_revenue .............. [RUN]
[0m21:30:07.336450 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_consumption_revenue)
[0m21:30:07.336960 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:30:07.351683 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:30:07.353154 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:30:07.406128 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:30:07.406916 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
create or replace  temporary view LB.stage.fact_consumption_revenue__dbt_tmp
  
   as (
    

WITH contracts AS (
    SELECT * FROM LB.stage.stg_contract
    
    WHERE createdat > (SELECT COALESCE(MAX(anlagedatum), '1900-01-01'::TIMESTAMP) FROM LB.stage.fact_consumption_revenue)
    
),
prices AS (
    SELECT * FROM LB.stage.stg_prices
),
consumption_with_price AS (
    SELECT
        c.contractid,
        c.productid,
        c.usage AS consumption,
        c.createdat AS anlagedatum,
        MAX(CASE WHEN p.productcomponent = 'baseprice' THEN p.price ELSE 0 END) AS base_price,
        MAX(CASE WHEN p.productcomponent = 'workingprice' THEN p.price ELSE 0 END) AS working_price
    FROM contracts c
    LEFT JOIN prices p ON c.productid = p.productid
    AND c.createdat BETWEEN p.valid_from AND COALESCE(p.valid_until, '9999-12-31'::DATE)
    GROUP BY c.contractid, c.productid, c.usage, c.createdat
),
current_data AS (
    SELECT
        cwp.contractid,
        cwp.productid,
        cwp.anlagedatum,
        cwp.consumption AS verbrauch,
        cwp.base_price + (cwp.working_price * cwp.consumption) AS umsatz,
        CURRENT_TIMESTAMP() AS valid_from,
        '9999-12-31'::DATE AS valid_to
    FROM consumption_with_price cwp
)

-- Insert the new records and update the historical ones
SELECT
    c.contractid,
    c.productid,
    c.anlagedatum,
    c.verbrauch,
    c.umsatz,
    c.valid_from,
    c.valid_to
FROM current_data c
LEFT JOIN LB.stage.fact_consumption_revenue t
ON c.contractid = t.contractid
   AND c.productid = t.productid
   AND c.anlagedatum = t.anlagedatum
   AND c.valid_from = t.valid_from
WHERE (t.valid_to >= CURRENT_DATE() OR t.valid_to IS NULL)
   AND (t.valid_from <= CURRENT_DATE())
   OR t.contractid IS NULL
  );
[0m21:30:07.407551 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:08.178887 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.771 seconds
[0m21:30:08.195172 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:30:08.195669 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
describe table LB.stage.fact_consumption_revenue__dbt_tmp
[0m21:30:08.282229 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.086 seconds
[0m21:30:08.287483 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:30:08.288070 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
describe table LB.stage.fact_consumption_revenue
[0m21:30:08.362799 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.074 seconds
[0m21:30:08.373272 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:30:08.373873 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
describe table "LB"."STAGE"."FACT_CONSUMPTION_REVENUE"
[0m21:30:08.435037 [debug] [Thread-1 (]: SQL status: SUCCESS 7 in 0.061 seconds
[0m21:30:08.466315 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:30:08.467922 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:30:08.468285 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
-- back compat for old kwarg name
  
  begin;
[0m21:30:08.565865 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.097 seconds
[0m21:30:08.566636 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:30:08.567027 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
merge into LB.stage.fact_consumption_revenue as DBT_INTERNAL_DEST
        using LB.stage.fact_consumption_revenue__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.contractid = DBT_INTERNAL_DEST.contractid
                ) and (
                    DBT_INTERNAL_SOURCE.productid = DBT_INTERNAL_DEST.productid
                ) and (
                    DBT_INTERNAL_SOURCE.anlagedatum = DBT_INTERNAL_DEST.anlagedatum
                )

    
    when matched then update set
        "CONTRACTID" = DBT_INTERNAL_SOURCE."CONTRACTID","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","ANLAGEDATUM" = DBT_INTERNAL_SOURCE."ANLAGEDATUM","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","UMSATZ" = DBT_INTERNAL_SOURCE."UMSATZ","VALID_FROM" = DBT_INTERNAL_SOURCE."VALID_FROM","VALID_TO" = DBT_INTERNAL_SOURCE."VALID_TO"
    

    when not matched then insert
        ("CONTRACTID", "PRODUCTID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "VALID_FROM", "VALID_TO")
    values
        ("CONTRACTID", "PRODUCTID", "ANLAGEDATUM", "VERBRAUCH", "UMSATZ", "VALID_FROM", "VALID_TO")

;
[0m21:30:09.067773 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.500 seconds
[0m21:30:09.068390 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:30:09.069282 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
COMMIT
[0m21:30:09.181202 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.111 seconds
[0m21:30:09.192515 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_consumption_revenue__dbt_tmp
[0m21:30:09.199881 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m21:30:09.200445 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_consumption_revenue"} */
drop view if exists LB.stage.fact_consumption_revenue__dbt_tmp cascade
[0m21:30:09.340137 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.139 seconds
[0m21:30:09.343344 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_consumption_revenue: Close
[0m21:30:09.470429 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17a77ff10>]}
[0m21:30:09.472816 [info ] [Thread-1 (]: 4 of 6 OK created sql incremental model stage.fact_consumption_revenue ......... [[32mSUCCESS 0[0m in 2.13s]
[0m21:30:09.475591 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m21:30:09.477521 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m21:30:09.481184 [info ] [Thread-1 (]: 5 of 6 START sql table model stage.dim_product ................................. [RUN]
[0m21:30:09.481929 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_consumption_revenue, now model.snowflake_airflow_dbt.dim_product)
[0m21:30:09.482476 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m21:30:09.502709 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m21:30:09.504300 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m21:30:09.550195 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.dim_product"
[0m21:30:09.552994 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.dim_product"
[0m21:30:09.553808 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.dim_product"} */
create or replace transient table LB.stage.dim_product
         as
        (

WITH products AS (
    SELECT * FROM LB.stage.stg_products
),
current_products AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY productid, productcode, productname, energy, consumptiontype 
               ORDER BY modificationdate DESC
           ) AS rn
    FROM products
),
product_changes AS (
    SELECT 
        productid,
        productcode,
        productname,
        energy,
        consumptiontype,
        modificationdate AS anlagedatum,
        LEAD(modificationdate, 1, '9999-12-31'::DATE) OVER (
            PARTITION BY productid, productcode, productname, energy, consumptiontype
            ORDER BY modificationdate
        ) AS enddate,
        CASE WHEN rn = 1 THEN TRUE ELSE FALSE END AS is_current
    FROM current_products
    WHERE rn = 1
)

SELECT 
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    anlagedatum,
    enddate,
    is_current
FROM product_changes
        );
[0m21:30:09.554610 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:12.038797 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.482 seconds
[0m21:30:12.048005 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.dim_product: Close
[0m21:30:12.190636 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17a7bce50>]}
[0m21:30:12.191905 [info ] [Thread-1 (]: 5 of 6 OK created sql table model stage.dim_product ............................ [[32mSUCCESS 1[0m in 2.71s]
[0m21:30:12.192791 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m21:30:12.193390 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m21:30:12.194154 [info ] [Thread-1 (]: 6 of 6 START sql view model stage.fact_current_consumption_revenue ............. [RUN]
[0m21:30:12.194664 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_current_consumption_revenue)
[0m21:30:12.195014 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m21:30:12.200687 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_current_consumption_revenue"
[0m21:30:12.201942 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m21:30:12.209023 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_current_consumption_revenue"
[0m21:30:12.210879 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_current_consumption_revenue"
[0m21:30:12.211341 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_current_consumption_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_current_consumption_revenue"} */
create or replace   view LB.stage.fact_current_consumption_revenue
  
   as (
    

SELECT
    contractid,
    productid,
    anlagedatum,
    verbrauch,
    umsatz
FROM LB.stage.fact_consumption_revenue
WHERE valid_from <= CURRENT_DATE()
AND valid_to >= CURRENT_DATE()
  );
[0m21:30:12.211813 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:13.114123 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.902 seconds
[0m21:30:13.117836 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_current_consumption_revenue: Close
[0m21:30:13.245453 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e981dbe-e941-4d3d-89e6-4ae77342cbb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17a5aec90>]}
[0m21:30:13.246284 [info ] [Thread-1 (]: 6 of 6 OK created sql view model stage.fact_current_consumption_revenue ........ [[32mSUCCESS 1[0m in 1.05s]
[0m21:30:13.246899 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m21:30:13.249523 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:30:13.249906 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_current_consumption_revenue' was properly closed.
[0m21:30:13.250329 [info ] [MainThread]: 
[0m21:30:13.250684 [info ] [MainThread]: Finished running 4 view models, 1 incremental model, 1 table model in 0 hours 0 minutes and 9.23 seconds (9.23s).
[0m21:30:13.251912 [debug] [MainThread]: Command end result
[0m21:30:13.300267 [info ] [MainThread]: 
[0m21:30:13.300586 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:30:13.300772 [info ] [MainThread]: 
[0m21:30:13.301287 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m21:30:13.305192 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.617249, "process_user_time": 2.977215, "process_kernel_time": 2.002567, "process_mem_max_rss": "188973056", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:30:13.306098 [debug] [MainThread]: Command `dbt run` succeeded at 21:30:13.306040 after 10.62 seconds
[0m21:30:13.307233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100caff90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100c3ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16acae8d0>]}
[0m21:30:13.307405 [debug] [MainThread]: Flushing usage events
[0m23:43:09.144946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ebf6b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1660719d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x166072050>]}


============================== 23:43:09.148141 | 0aff9701-736e-4f56-9808-8b9d271b90c0 ==============================
[0m23:43:09.148141 [info ] [MainThread]: Running with dbt=1.8.0
[0m23:43:09.148465 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/logs', 'profiles_dir': '/Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt docs generate', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:43:10.945286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0aff9701-736e-4f56-9808-8b9d271b90c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1695d5150>]}
[0m23:43:11.008353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0aff9701-736e-4f56-9808-8b9d271b90c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127a00c10>]}
[0m23:43:11.010251 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m23:43:11.080539 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m23:43:11.216680 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:43:11.217759 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:43:11.246247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0aff9701-736e-4f56-9808-8b9d271b90c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae72290>]}
[0m23:43:11.265864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0aff9701-736e-4f56-9808-8b9d271b90c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ada3790>]}
[0m23:43:11.266174 [info ] [MainThread]: Found 1 seed, 6 models, 3 sources, 563 macros
[0m23:43:11.266336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0aff9701-736e-4f56-9808-8b9d271b90c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ada2750>]}
[0m23:43:11.267419 [info ] [MainThread]: 
[0m23:43:11.267710 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:43:11.269676 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB_stage'
[0m23:43:11.279262 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m23:43:11.279505 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m23:43:11.279633 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:43:15.296900 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 4.017 seconds
[0m23:43:15.299391 [debug] [ThreadPool]: On list_LB_stage: Close
[0m23:43:15.445517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0aff9701-736e-4f56-9808-8b9d271b90c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16910e710>]}
[0m23:43:15.446188 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:43:15.446482 [info ] [MainThread]: 
[0m23:43:15.449127 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m23:43:15.449402 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m23:43:15.449568 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m23:43:15.453328 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m23:43:15.453930 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m23:43:15.454291 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m23:43:15.454478 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m23:43:15.454688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m23:43:15.454830 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m23:43:15.456275 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m23:43:15.456977 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m23:43:15.457312 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m23:43:15.457487 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m23:43:15.457716 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m23:43:15.457853 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m23:43:15.459412 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m23:43:15.459787 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m23:43:15.460097 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m23:43:15.460269 [debug] [Thread-1 (]: Began running node seed.snowflake_airflow_dbt.bookings_1
[0m23:43:15.460517 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now seed.snowflake_airflow_dbt.bookings_1)
[0m23:43:15.460691 [debug] [Thread-1 (]: Began compiling node seed.snowflake_airflow_dbt.bookings_1
[0m23:43:15.461548 [debug] [Thread-1 (]: Began executing node seed.snowflake_airflow_dbt.bookings_1
[0m23:43:15.461806 [debug] [Thread-1 (]: Finished running node seed.snowflake_airflow_dbt.bookings_1
[0m23:43:15.461966 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m23:43:15.462154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.snowflake_airflow_dbt.bookings_1, now model.snowflake_airflow_dbt.fact_consumption_revenue)
[0m23:43:15.462288 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m23:43:15.466945 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_consumption_revenue"
[0m23:43:15.467953 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m23:43:15.468993 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_consumption_revenue
[0m23:43:15.469570 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.dim_product
[0m23:43:15.470534 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.fact_consumption_revenue, now model.snowflake_airflow_dbt.dim_product)
[0m23:43:15.470968 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.dim_product
[0m23:43:15.474806 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.dim_product"
[0m23:43:15.476292 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.dim_product
[0m23:43:15.476633 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.dim_product
[0m23:43:15.476802 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m23:43:15.478003 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.dim_product, now model.snowflake_airflow_dbt.fact_current_consumption_revenue)
[0m23:43:15.478191 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m23:43:15.480292 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_current_consumption_revenue"
[0m23:43:15.481022 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m23:43:15.481565 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_current_consumption_revenue
[0m23:43:15.482282 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:43:15.482621 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_current_consumption_revenue' was properly closed.
[0m23:43:15.483714 [debug] [MainThread]: Command end result
[0m23:43:15.534672 [debug] [MainThread]: Acquiring new snowflake connection 'generate_catalog'
[0m23:43:15.534873 [info ] [MainThread]: Building catalog
[0m23:43:15.538929 [debug] [ThreadPool]: Acquiring new snowflake connection 'LB.information_schema'
[0m23:43:15.545793 [debug] [ThreadPool]: Using snowflake connection "LB.information_schema"
[0m23:43:15.546244 [debug] [ThreadPool]: On LB.information_schema: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "LB.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        case
            when is_dynamic = 'YES' and table_type = 'BASE TABLE' THEN 'DYNAMIC TABLE'
            else table_type
        end as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from LB.INFORMATION_SCHEMA.tables
            where (
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'fact_consumption_revenue' and upper("table_name") = upper('fact_consumption_revenue')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'stg_products' and upper("table_name") = upper('stg_products')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'stg_contract' and upper("table_name") = upper('stg_contract')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'bookings_1' and upper("table_name") = upper('bookings_1')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'dim_product' and upper("table_name") = upper('dim_product')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'stg_prices' and upper("table_name") = upper('stg_prices')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'fact_current_consumption_revenue' and upper("table_name") = upper('fact_current_consumption_revenue')

                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from LB.INFORMATION_SCHEMA.columns
            where (
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'fact_consumption_revenue' and upper("table_name") = upper('fact_consumption_revenue')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'stg_products' and upper("table_name") = upper('stg_products')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'stg_contract' and upper("table_name") = upper('stg_contract')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'bookings_1' and upper("table_name") = upper('bookings_1')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'dim_product' and upper("table_name") = upper('dim_product')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'stg_prices' and upper("table_name") = upper('stg_prices')

                )
             or 
                (
                    
    "table_schema" ilike 'stage' and upper("table_schema") = upper('stage')

                    and 
    "table_name" ilike 'fact_current_consumption_revenue' and upper("table_name") = upper('fact_current_consumption_revenue')

                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m23:43:15.546622 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:43:19.196255 [debug] [ThreadPool]: SQL status: SUCCESS 48 in 3.649 seconds
[0m23:43:19.204515 [debug] [ThreadPool]: On LB.information_schema: Close
[0m23:43:19.328428 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly LB.information_schema, now lb.information_schema)
[0m23:43:19.331799 [debug] [ThreadPool]: Using snowflake connection "lb.information_schema"
[0m23:43:19.332106 [debug] [ThreadPool]: On lb.information_schema: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "lb.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        case
            when is_dynamic = 'YES' and table_type = 'BASE TABLE' THEN 'DYNAMIC TABLE'
            else table_type
        end as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from lb.INFORMATION_SCHEMA.tables
            where (
                (
                    
    "table_schema" ilike 'raw' and upper("table_schema") = upper('raw')

                    and 
    "table_name" ilike 'products' and upper("table_name") = upper('products')

                )
             or 
                (
                    
    "table_schema" ilike 'raw' and upper("table_schema") = upper('raw')

                    and 
    "table_name" ilike 'contract' and upper("table_name") = upper('contract')

                )
             or 
                (
                    
    "table_schema" ilike 'raw' and upper("table_schema") = upper('raw')

                    and 
    "table_name" ilike 'prices' and upper("table_name") = upper('prices')

                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from lb.INFORMATION_SCHEMA.columns
            where (
                (
                    
    "table_schema" ilike 'raw' and upper("table_schema") = upper('raw')

                    and 
    "table_name" ilike 'products' and upper("table_name") = upper('products')

                )
             or 
                (
                    
    "table_schema" ilike 'raw' and upper("table_schema") = upper('raw')

                    and 
    "table_name" ilike 'contract' and upper("table_name") = upper('contract')

                )
             or 
                (
                    
    "table_schema" ilike 'raw' and upper("table_schema") = upper('raw')

                    and 
    "table_name" ilike 'prices' and upper("table_name") = upper('prices')

                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m23:43:19.332385 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:43:22.061985 [debug] [ThreadPool]: SQL status: SUCCESS 30 in 2.729 seconds
[0m23:43:22.065910 [debug] [ThreadPool]: On lb.information_schema: Close
[0m23:43:22.232230 [info ] [MainThread]: Catalog written to /Users/srinivasuluchalla/lb_project/dbt_airflow_snowflake/dbt/target/catalog.json
[0m23:43:22.236056 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 13.141501, "process_user_time": 2.635267, "process_kernel_time": 0.643808, "process_mem_max_rss": "187662336", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:43:22.236640 [debug] [MainThread]: Command `dbt docs generate` succeeded at 23:43:22.236555 after 13.14 seconds
[0m23:43:22.236866 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m23:43:22.236989 [debug] [MainThread]: Connection 'lb.information_schema' was properly closed.
[0m23:43:22.237224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x166060590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1035e47d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a6b6950>]}
[0m23:43:22.237562 [debug] [MainThread]: Flushing usage events
[0m11:24:11.387113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119458e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1198bd1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1198bd810>]}


============================== 11:24:11.399524 | 542edb2b-fa5e-45a4-817b-4f101277ce93 ==============================
[0m11:24:11.399524 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:24:11.399902 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:24:12.968992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '542edb2b-fa5e-45a4-817b-4f101277ce93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11976c810>]}
[0m11:24:12.995741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '542edb2b-fa5e-45a4-817b-4f101277ce93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11816ef10>]}
[0m11:24:12.996717 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:24:13.059025 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:24:13.170432 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 0 files added, 3 files changed.
[0m11:24:13.170808 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_current_consumption_revenue.sql
[0m11:24:13.170947 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/fact_consumption_revenue.sql
[0m11:24:13.171065 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://seeds/bookings_1.csv
[0m11:24:13.171175 [debug] [MainThread]: Partial parsing: deleted file: snowflake_airflow_dbt://models/staging/dim_product.sql
[0m11:24:13.171368 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_products.sql
[0m11:24:13.171531 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_contract.sql
[0m11:24:13.171687 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/stg_prices.sql
[0m11:24:13.336592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '542edb2b-fa5e-45a4-817b-4f101277ce93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12927cd90>]}
[0m11:24:13.385230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '542edb2b-fa5e-45a4-817b-4f101277ce93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16367c290>]}
[0m11:24:13.385584 [info ] [MainThread]: Found 3 models, 3 sources, 563 macros
[0m11:24:13.385764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '542edb2b-fa5e-45a4-817b-4f101277ce93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163928b50>]}
[0m11:24:13.386845 [info ] [MainThread]: 
[0m11:24:13.387166 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:24:13.389271 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:24:13.395434 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:24:13.395653 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:24:13.395781 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:24:13.969118 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.572 seconds
[0m11:24:13.973386 [debug] [ThreadPool]: On list_LB: Close
[0m11:24:14.188081 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m11:24:14.198667 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:24:14.199126 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:24:14.199525 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:24:14.640476 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.441 seconds
[0m11:24:14.643110 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:24:14.756425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '542edb2b-fa5e-45a4-817b-4f101277ce93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1198d9650>]}
[0m11:24:14.757171 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:24:14.757546 [info ] [MainThread]: 
[0m11:24:14.760116 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m11:24:14.760741 [info ] [Thread-1 (]: 1 of 3 START sql view model stage.stg_contract ................................. [RUN]
[0m11:24:14.761165 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m11:24:14.761505 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m11:24:14.770163 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m11:24:14.770848 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m11:24:14.795686 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m11:24:14.797816 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m11:24:14.798263 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

WITH ranked_contracts AS (
    SELECT
        id::INTEGER AS id,
        type::VARCHAR(50) AS type,
        energy::VARCHAR(50) AS energy,
        usage::FLOAT AS usage,
        usagenet::FLOAT AS usagenet,
        createdat::TIMESTAMP AS createdat,
        startdate::DATE AS startdate,
        enddate::DATE AS enddate,
        city::VARCHAR(100) AS city,
        status::VARCHAR(50) AS status,
        productid::INTEGER AS productid,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                type,
                energy,
                usage,
                usagenet,
                createdat,
                startdate,
                enddate,
                city,
                status,
                productid
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.contract
)

SELECT
    id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM ranked_contracts
WHERE row_num = 1
  );
[0m11:24:14.798841 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:24:15.375718 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.577 seconds
[0m11:24:15.396054 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m11:24:15.501330 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '542edb2b-fa5e-45a4-817b-4f101277ce93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163e0d4d0>]}
[0m11:24:15.502484 [info ] [Thread-1 (]: 1 of 3 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.74s]
[0m11:24:15.503346 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m11:24:15.503955 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m11:24:15.504845 [info ] [Thread-1 (]: 2 of 3 START sql view model stage.stg_prices ................................... [RUN]
[0m11:24:15.505460 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m11:24:15.506020 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m11:24:15.511071 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m11:24:15.512413 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m11:24:15.513823 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m11:24:15.514540 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m11:24:15.514816 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    

WITH ranked_prices AS (
    SELECT
        id::INTEGER AS id,
        productid::INTEGER AS productid,
        pricecomponentid::INTEGER AS pricecomponentid,
        productcomponent::VARCHAR(50) AS productcomponent,
        price::FLOAT AS price,
        unit::VARCHAR(20) AS unit,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productid,
                pricecomponentid,
                productcomponent
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.prices
)

SELECT
    id,
    productid,
    pricecomponentid,
    productcomponent,
    price,
    unit,
    modificationdate
FROM ranked_prices
WHERE row_num = 1
  );
[0m11:24:15.514993 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:24:15.999411 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.484 seconds
[0m11:24:16.002307 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m11:24:16.102964 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '542edb2b-fa5e-45a4-817b-4f101277ce93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16358dfd0>]}
[0m11:24:16.103408 [info ] [Thread-1 (]: 2 of 3 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.60s]
[0m11:24:16.103679 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m11:24:16.103860 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m11:24:16.104128 [info ] [Thread-1 (]: 3 of 3 START sql view model stage.stg_products ................................. [RUN]
[0m11:24:16.104368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m11:24:16.104516 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m11:24:16.106244 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m11:24:16.106706 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m11:24:16.108667 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m11:24:16.109386 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m11:24:16.109612 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    

WITH ranked_products AS (
    SELECT
        id::INTEGER AS productid,
        productcode::VARCHAR(50) AS productcode,
        productname::VARCHAR(100) AS productname,
        energy::VARCHAR(50) AS energy,
        consumptiontype::VARCHAR(50) AS consumptiontype,
        deleted::BOOLEAN AS deleted,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productcode,
                productname,
                energy,
                consumptiontype
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.products
)

SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    deleted,
    modificationdate
FROM ranked_products
WHERE row_num = 1
  );
[0m11:24:16.109805 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:24:16.571883 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.462 seconds
[0m11:24:16.574416 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m11:24:16.986497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '542edb2b-fa5e-45a4-817b-4f101277ce93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x164032850>]}
[0m11:24:16.987885 [info ] [Thread-1 (]: 3 of 3 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.88s]
[0m11:24:16.988819 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m11:24:16.990367 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:24:16.990788 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m11:24:16.991379 [info ] [MainThread]: 
[0m11:24:16.991944 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 3.60 seconds (3.60s).
[0m11:24:16.993372 [debug] [MainThread]: Command end result
[0m11:24:17.013609 [info ] [MainThread]: 
[0m11:24:17.013867 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:24:17.013997 [info ] [MainThread]: 
[0m11:24:17.014156 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m11:24:17.052541 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.697287, "process_user_time": 2.6644, "process_kernel_time": 1.908004, "process_mem_max_rss": "193134592", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:24:17.053028 [debug] [MainThread]: Command `dbt run` succeeded at 11:24:17.052978 after 5.70 seconds
[0m11:24:17.053259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f4c750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f4c690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e61650>]}
[0m11:24:17.053428 [debug] [MainThread]: Flushing usage events
[0m11:24:43.205595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14061e910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140680f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1406815d0>]}


============================== 11:24:43.208787 | 66ca5102-9697-4fce-a746-ce0db182fd0f ==============================
[0m11:24:43.208787 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:24:43.209104 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt', 'log_path': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --full-refresh', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:24:43.898157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '66ca5102-9697-4fce-a746-ce0db182fd0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147ac5110>]}
[0m11:24:43.918571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '66ca5102-9697-4fce-a746-ce0db182fd0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e472e90>]}
[0m11:24:43.919257 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:24:43.932261 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:24:43.995994 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:24:43.996232 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:24:44.009615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '66ca5102-9697-4fce-a746-ce0db182fd0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168667f50>]}
[0m11:24:44.051860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '66ca5102-9697-4fce-a746-ce0db182fd0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16865c2d0>]}
[0m11:24:44.052132 [info ] [MainThread]: Found 3 models, 3 sources, 563 macros
[0m11:24:44.052281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66ca5102-9697-4fce-a746-ce0db182fd0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16854c0d0>]}
[0m11:24:44.053071 [info ] [MainThread]: 
[0m11:24:44.053326 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:24:44.055145 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:24:44.061913 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:24:44.062145 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:24:44.062290 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:24:47.925794 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 3.863 seconds
[0m11:24:47.927830 [debug] [ThreadPool]: On list_LB: Close
[0m11:24:48.032267 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m11:24:48.042974 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:24:48.043673 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:24:48.044157 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:24:49.157297 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.113 seconds
[0m11:24:49.165401 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:24:49.274617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66ca5102-9697-4fce-a746-ce0db182fd0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16865d010>]}
[0m11:24:49.278290 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:24:49.279081 [info ] [MainThread]: 
[0m11:24:49.289486 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m11:24:49.290775 [info ] [Thread-1 (]: 1 of 3 START sql view model stage.stg_contract ................................. [RUN]
[0m11:24:49.291623 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m11:24:49.292164 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m11:24:49.302283 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m11:24:49.302940 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m11:24:49.352820 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m11:24:49.354539 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m11:24:49.355138 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

WITH ranked_contracts AS (
    SELECT
        id::INTEGER AS id,
        type::VARCHAR(50) AS type,
        energy::VARCHAR(50) AS energy,
        usage::FLOAT AS usage,
        usagenet::FLOAT AS usagenet,
        createdat::TIMESTAMP AS createdat,
        startdate::DATE AS startdate,
        enddate::DATE AS enddate,
        city::VARCHAR(100) AS city,
        status::VARCHAR(50) AS status,
        productid::INTEGER AS productid,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                type,
                energy,
                usage,
                usagenet,
                createdat,
                startdate,
                enddate,
                city,
                status,
                productid
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.contract
)

SELECT
    id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM ranked_contracts
WHERE row_num = 1
  );
[0m11:24:49.355635 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:24:49.991107 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.635 seconds
[0m11:24:50.020042 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m11:24:50.129096 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66ca5102-9697-4fce-a746-ce0db182fd0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1684f2dd0>]}
[0m11:24:50.131006 [info ] [Thread-1 (]: 1 of 3 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.84s]
[0m11:24:50.132707 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m11:24:50.133698 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m11:24:50.134350 [info ] [Thread-1 (]: 2 of 3 START sql view model stage.stg_prices ................................... [RUN]
[0m11:24:50.135246 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m11:24:50.135721 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m11:24:50.152198 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m11:24:50.153700 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m11:24:50.157926 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m11:24:50.160034 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m11:24:50.160411 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    

WITH ranked_prices AS (
    SELECT
        id::INTEGER AS id,
        productid::INTEGER AS productid,
        pricecomponentid::INTEGER AS pricecomponentid,
        productcomponent::VARCHAR(50) AS productcomponent,
        price::FLOAT AS price,
        unit::VARCHAR(20) AS unit,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productid,
                pricecomponentid,
                productcomponent
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.prices
)

SELECT
    id,
    productid,
    pricecomponentid,
    productcomponent,
    price,
    unit,
    modificationdate
FROM ranked_prices
WHERE row_num = 1
  );
[0m11:24:50.160787 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:24:50.645618 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.485 seconds
[0m11:24:50.647914 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m11:24:50.759105 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66ca5102-9697-4fce-a746-ce0db182fd0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1685b1490>]}
[0m11:24:50.761040 [info ] [Thread-1 (]: 2 of 3 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.62s]
[0m11:24:50.762368 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m11:24:50.763240 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m11:24:50.764044 [info ] [Thread-1 (]: 3 of 3 START sql view model stage.stg_products ................................. [RUN]
[0m11:24:50.764551 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m11:24:50.764980 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m11:24:50.769537 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m11:24:50.770640 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m11:24:50.774232 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m11:24:50.776233 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m11:24:50.776943 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    

WITH ranked_products AS (
    SELECT
        id::INTEGER AS productid,
        productcode::VARCHAR(50) AS productcode,
        productname::VARCHAR(100) AS productname,
        energy::VARCHAR(50) AS energy,
        consumptiontype::VARCHAR(50) AS consumptiontype,
        deleted::BOOLEAN AS deleted,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productcode,
                productname,
                energy,
                consumptiontype
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.products
)

SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    deleted,
    modificationdate
FROM ranked_products
WHERE row_num = 1
  );
[0m11:24:50.777463 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:24:51.410054 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.633 seconds
[0m11:24:51.412093 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m11:24:51.833570 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66ca5102-9697-4fce-a746-ce0db182fd0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ec1e590>]}
[0m11:24:51.834493 [info ] [Thread-1 (]: 3 of 3 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 1.07s]
[0m11:24:51.835142 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m11:24:51.836618 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:24:51.837418 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m11:24:51.838585 [info ] [MainThread]: 
[0m11:24:51.838955 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 7.78 seconds (7.78s).
[0m11:24:51.840396 [debug] [MainThread]: Command end result
[0m11:24:51.881209 [info ] [MainThread]: 
[0m11:24:51.881890 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:24:51.882077 [info ] [MainThread]: 
[0m11:24:51.882244 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m11:24:51.885263 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.722874, "process_user_time": 3.050233, "process_kernel_time": 0.780326, "process_mem_max_rss": "183107584", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:24:51.886489 [debug] [MainThread]: Command `dbt run` succeeded at 11:24:51.886390 after 8.72 seconds
[0m11:24:51.887354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1003747d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168bf0bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1002d8fd0>]}
[0m11:24:51.887601 [debug] [MainThread]: Flushing usage events
[0m11:29:45.986003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f957990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9bd450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9bda50>]}


============================== 11:29:45.989928 | 38f65971-79fc-4616-82b3-dbf96bf59502 ==============================
[0m11:29:45.989928 [info ] [MainThread]: Running with dbt=1.8.0
[0m11:29:45.990547 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --full-refresh', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:29:46.828576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '38f65971-79fc-4616-82b3-dbf96bf59502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14efc7fd0>]}
[0m11:29:46.856528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '38f65971-79fc-4616-82b3-dbf96bf59502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a672ed0>]}
[0m11:29:46.857700 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m11:29:46.875851 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m11:29:46.986866 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:29:46.987347 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:29:47.016959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '38f65971-79fc-4616-82b3-dbf96bf59502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a9adad0>]}
[0m11:29:47.103184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '38f65971-79fc-4616-82b3-dbf96bf59502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a95c350>]}
[0m11:29:47.103517 [info ] [MainThread]: Found 3 models, 3 sources, 563 macros
[0m11:29:47.103682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '38f65971-79fc-4616-82b3-dbf96bf59502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9bd1d0>]}
[0m11:29:47.104584 [info ] [MainThread]: 
[0m11:29:47.104876 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:29:47.107112 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m11:29:47.122384 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m11:29:47.122666 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m11:29:47.122994 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:29:48.052827 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.930 seconds
[0m11:29:48.056645 [debug] [ThreadPool]: On list_LB: Close
[0m11:29:48.201602 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m11:29:48.211517 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m11:29:48.212060 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m11:29:48.212488 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:29:48.574192 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.362 seconds
[0m11:29:48.575770 [debug] [ThreadPool]: On list_LB_stage: Close
[0m11:29:48.698727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '38f65971-79fc-4616-82b3-dbf96bf59502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a7f1d10>]}
[0m11:29:48.699533 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:29:48.699986 [info ] [MainThread]: 
[0m11:29:48.702612 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m11:29:48.703195 [info ] [Thread-1 (]: 1 of 3 START sql view model stage.stg_contract ................................. [RUN]
[0m11:29:48.703812 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m11:29:48.704175 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m11:29:48.714253 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m11:29:48.715000 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m11:29:48.763137 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m11:29:48.764288 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m11:29:48.764503 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

WITH ranked_contracts AS (
    SELECT
        id::INTEGER AS id,
        type::VARCHAR(50) AS type,
        energy::VARCHAR(50) AS energy,
        usage::FLOAT AS usage,
        usagenet::FLOAT AS usagenet,
        createdat::TIMESTAMP AS createdat,
        startdate::DATE AS startdate,
        enddate::DATE AS enddate,
        city::VARCHAR(100) AS city,
        status::VARCHAR(50) AS status,
        productid::INTEGER AS productid,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                type,
                energy,
                usage,
                usagenet,
                createdat,
                startdate,
                enddate,
                city,
                status,
                productid
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.contract
)

SELECT
    id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM ranked_contracts
WHERE row_num = 1
  );
[0m11:29:48.764926 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:29:49.254907 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.490 seconds
[0m11:29:49.271594 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m11:29:49.382067 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38f65971-79fc-4616-82b3-dbf96bf59502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa6fa10>]}
[0m11:29:49.383308 [info ] [Thread-1 (]: 1 of 3 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.68s]
[0m11:29:49.384249 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m11:29:49.384809 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m11:29:49.385776 [info ] [Thread-1 (]: 2 of 3 START sql view model stage.stg_prices ................................... [RUN]
[0m11:29:49.386549 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m11:29:49.387078 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m11:29:49.394813 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m11:29:49.396047 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m11:29:49.402182 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m11:29:49.403337 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m11:29:49.403617 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    

WITH ranked_prices AS (
    SELECT
        id::INTEGER AS id,
        productid::INTEGER AS productid,
        pricecomponentid::INTEGER AS pricecomponentid,
        productcomponent::VARCHAR(50) AS productcomponent,
        price::FLOAT AS price,
        unit::VARCHAR(20) AS unit,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productid,
                pricecomponentid,
                productcomponent
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.prices
)

SELECT
    id,
    productid,
    pricecomponentid,
    productcomponent,
    price,
    unit,
    modificationdate
FROM ranked_prices
WHERE row_num = 1
  );
[0m11:29:49.403814 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:29:49.927968 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.524 seconds
[0m11:29:49.941461 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m11:29:50.057790 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38f65971-79fc-4616-82b3-dbf96bf59502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bdd4750>]}
[0m11:29:50.058485 [info ] [Thread-1 (]: 2 of 3 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.67s]
[0m11:29:50.058921 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m11:29:50.059307 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m11:29:50.059918 [info ] [Thread-1 (]: 3 of 3 START sql view model stage.stg_products ................................. [RUN]
[0m11:29:50.060157 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m11:29:50.060308 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m11:29:50.062359 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m11:29:50.063004 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m11:29:50.065109 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m11:29:50.067622 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m11:29:50.068346 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    

WITH ranked_products AS (
    SELECT
        id::INTEGER AS productid,
        productcode::VARCHAR(50) AS productcode,
        productname::VARCHAR(100) AS productname,
        energy::VARCHAR(50) AS energy,
        consumptiontype::VARCHAR(50) AS consumptiontype,
        deleted::BOOLEAN AS deleted,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productcode,
                productname,
                energy,
                consumptiontype
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.products
)

SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    deleted,
    modificationdate
FROM ranked_products
WHERE row_num = 1
  );
[0m11:29:50.068984 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:29:50.599983 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.531 seconds
[0m11:29:50.601649 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m11:29:50.702623 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38f65971-79fc-4616-82b3-dbf96bf59502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16beaf790>]}
[0m11:29:50.704834 [info ] [Thread-1 (]: 3 of 3 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.64s]
[0m11:29:50.706354 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m11:29:50.710884 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:29:50.711168 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.stg_products' was properly closed.
[0m11:29:50.711484 [info ] [MainThread]: 
[0m11:29:50.711659 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 3.61 seconds (3.61s).
[0m11:29:50.712165 [debug] [MainThread]: Command end result
[0m11:29:50.732041 [info ] [MainThread]: 
[0m11:29:50.732548 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:29:50.732746 [info ] [MainThread]: 
[0m11:29:50.732930 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m11:29:50.734956 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.8115854, "process_user_time": 3.121571, "process_kernel_time": 0.756005, "process_mem_max_rss": "190464000", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:29:50.735311 [debug] [MainThread]: Command `dbt run` succeeded at 11:29:50.735268 after 4.81 seconds
[0m11:29:50.735561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044b07d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044b0690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10442c050>]}
[0m11:29:50.735721 [debug] [MainThread]: Flushing usage events
[0m12:27:22.499233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134819790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134880c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134881250>]}


============================== 12:27:22.502328 | ce0320c3-d67f-46f3-ada9-b9ed456e1937 ==============================
[0m12:27:22.502328 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:27:22.502635 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --full-refresh', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:27:23.243690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce0320c3-d67f-46f3-ada9-b9ed456e1937', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168ee5150>]}
[0m12:27:23.264042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce0320c3-d67f-46f3-ada9-b9ed456e1937', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127172f10>]}
[0m12:27:23.264670 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:27:23.277258 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:27:23.336350 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:27:23.336654 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/fact_energy_revenue.sql
[0m12:27:23.398210 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.snowflake_airflow_dbt.fact_energy_revenue' (models/staging/fact_energy_revenue.sql) depends on a node named 'stg_contracts' which was not found
[0m12:27:23.399964 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.93932444, "process_user_time": 2.368263, "process_kernel_time": 1.540997, "process_mem_max_rss": "186155008", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:27:23.400304 [debug] [MainThread]: Command `dbt run` failed at 12:27:23.400257 after 0.94 seconds
[0m12:27:23.400496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1023d07d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134859650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ab91590>]}
[0m12:27:23.400663 [debug] [MainThread]: Flushing usage events
[0m12:27:36.583631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db5a290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db81110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db81710>]}


============================== 12:27:36.586758 | 4fb3b61b-66b9-433f-9865-9e5e9f6ee70b ==============================
[0m12:27:36.586758 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:27:36.587214 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --full-refresh', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:27:37.275928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4fb3b61b-66b9-433f-9865-9e5e9f6ee70b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a847d50>]}
[0m12:27:37.295976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4fb3b61b-66b9-433f-9865-9e5e9f6ee70b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d2fcad0>]}
[0m12:27:37.296584 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:27:37.308690 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:27:37.367369 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m12:27:37.367676 [debug] [MainThread]: Partial parsing: added file: snowflake_airflow_dbt://models/staging/fact_energy_revenue.sql
[0m12:27:37.497355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4fb3b61b-66b9-433f-9865-9e5e9f6ee70b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abe9dd0>]}
[0m12:27:37.540402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4fb3b61b-66b9-433f-9865-9e5e9f6ee70b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa98a10>]}
[0m12:27:37.540693 [info ] [MainThread]: Found 4 models, 3 sources, 563 macros
[0m12:27:37.540896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4fb3b61b-66b9-433f-9865-9e5e9f6ee70b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a9c4490>]}
[0m12:27:37.541694 [info ] [MainThread]: 
[0m12:27:37.541947 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:27:37.543796 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m12:27:37.549479 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m12:27:37.549672 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m12:27:37.549792 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:27:41.554157 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 4.004 seconds
[0m12:27:41.555712 [debug] [ThreadPool]: On list_LB: Close
[0m12:27:41.660220 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m12:27:41.667951 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m12:27:41.668260 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m12:27:41.668446 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:27:42.074349 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.406 seconds
[0m12:27:42.076039 [debug] [ThreadPool]: On list_LB_stage: Close
[0m12:27:42.183999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4fb3b61b-66b9-433f-9865-9e5e9f6ee70b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16abba910>]}
[0m12:27:42.184432 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:27:42.184615 [info ] [MainThread]: 
[0m12:27:42.186050 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m12:27:42.186282 [info ] [Thread-1 (]: 1 of 4 START sql view model stage.stg_contract ................................. [RUN]
[0m12:27:42.186471 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m12:27:42.186610 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m12:27:42.190138 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:27:42.191058 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m12:27:42.206638 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:27:42.208035 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m12:27:42.208270 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

WITH ranked_contracts AS (
    SELECT
        id::INTEGER AS id,
        type::VARCHAR(50) AS type,
        energy::VARCHAR(50) AS energy,
        usage::FLOAT AS usage,
        usagenet::FLOAT AS usagenet,
        createdat::TIMESTAMP AS createdat,
        startdate::DATE AS startdate,
        enddate::DATE AS enddate,
        city::VARCHAR(100) AS city,
        status::VARCHAR(50) AS status,
        productid::INTEGER AS productid,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                type,
                energy,
                usage,
                usagenet,
                createdat,
                startdate,
                enddate,
                city,
                status,
                productid
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.contract
)

SELECT
    id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM ranked_contracts
WHERE row_num = 1
  );
[0m12:27:42.208883 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:27:42.882462 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.673 seconds
[0m12:27:42.906336 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m12:27:43.062627 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4fb3b61b-66b9-433f-9865-9e5e9f6ee70b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ae4d2d0>]}
[0m12:27:43.063517 [info ] [Thread-1 (]: 1 of 4 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.87s]
[0m12:27:43.064156 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m12:27:43.064592 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m12:27:43.065154 [info ] [Thread-1 (]: 2 of 4 START sql view model stage.stg_prices ................................... [RUN]
[0m12:27:43.065828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m12:27:43.066068 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m12:27:43.068319 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:27:43.068665 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m12:27:43.069804 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:27:43.070817 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m12:27:43.071004 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    

WITH ranked_prices AS (
    SELECT
        id::INTEGER AS id,
        productid::INTEGER AS productid,
        pricecomponentid::INTEGER AS pricecomponentid,
        productcomponent::VARCHAR(50) AS productcomponent,
        price::FLOAT AS price,
        unit::VARCHAR(20) AS unit,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productid,
                pricecomponentid,
                productcomponent
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.prices
)

SELECT
    id,
    productid,
    pricecomponentid,
    productcomponent,
    price,
    unit,
    modificationdate
FROM ranked_prices
WHERE row_num = 1
  );
[0m12:27:43.071165 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:27:43.520278 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.449 seconds
[0m12:27:43.522490 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m12:27:43.630557 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4fb3b61b-66b9-433f-9865-9e5e9f6ee70b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aeca990>]}
[0m12:27:43.631401 [info ] [Thread-1 (]: 2 of 4 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.56s]
[0m12:27:43.632054 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m12:27:43.632498 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m12:27:43.632944 [info ] [Thread-1 (]: 3 of 4 START sql view model stage.stg_products ................................. [RUN]
[0m12:27:43.633321 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m12:27:43.633637 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m12:27:43.635809 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m12:27:43.637074 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m12:27:43.638254 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m12:27:43.639352 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m12:27:43.639539 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    

WITH ranked_products AS (
    SELECT
        id::INTEGER AS productid,
        productcode::VARCHAR(50) AS productcode,
        productname::VARCHAR(100) AS productname,
        energy::VARCHAR(50) AS energy,
        consumptiontype::VARCHAR(50) AS consumptiontype,
        deleted::BOOLEAN AS deleted,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productcode,
                productname,
                energy,
                consumptiontype
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.products
)

SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    deleted,
    modificationdate
FROM ranked_products
WHERE row_num = 1
  );
[0m12:27:43.639702 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:27:44.319218 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.679 seconds
[0m12:27:44.322792 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m12:27:44.440059 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4fb3b61b-66b9-433f-9865-9e5e9f6ee70b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a6a6110>]}
[0m12:27:44.441624 [info ] [Thread-1 (]: 3 of 4 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.81s]
[0m12:27:44.442656 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m12:27:44.444408 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m12:27:44.444985 [info ] [Thread-1 (]: 4 of 4 START sql incremental model stage.fact_energy_revenue ................... [RUN]
[0m12:27:44.445439 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_energy_revenue)
[0m12:27:44.445748 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_revenue
[0m12:27:44.450787 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m12:27:44.451633 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_revenue
[0m12:27:44.470690 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m12:27:44.471909 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m12:27:44.472133 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
create or replace transient table LB.stage.fact_energy_revenue
         as
        (

WITH latest_contracts AS (
    SELECT
        id AS contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        city,
        status,
        productid,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY id
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_contract
    WHERE type = 'energy' AND energy = 'electricity'
),
latest_products AS (
    SELECT
        productid,
        productcode,
        productname,
        energy,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY productid
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_products
    WHERE productcode = 'energy' AND energy = 'electricity'
),
latest_prices AS (
    SELECT
        productid,
        MAX(CASE WHEN productcomponent = 'baseprice' THEN price ELSE NULL END) AS baseprice,
        MAX(CASE WHEN productcomponent = 'workingprice' THEN price ELSE NULL END) AS workingprice
    FROM LB.stage.stg_prices
    WHERE productid = 1001
    GROUP BY productid
)

SELECT
    c.contract_id,
    c.type,
    c.energy,
    c.usage AS verbrauch,
    c.usagenet,
    c.createdat,
    c.startdate,
    c.enddate,
    c.city,
    c.status,
    c.productid,
    p.productcode,
    p.productname,
    lp.baseprice AS grundpreis,
    lp.workingprice AS arbeitspreis,
    (lp.baseprice + c.usage * lp.workingprice) AS revenue,
    c.modificationdate
FROM latest_contracts c
JOIN latest_products p ON c.productid = p.productid
JOIN latest_prices lp ON c.productid = lp.productid
WHERE c.row_num = 1 AND p.row_num = 1
        );
[0m12:27:44.472328 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:27:47.081599 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.609 seconds
[0m12:27:47.091104 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_revenue__dbt_tmp
[0m12:27:47.093883 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m12:27:47.094073 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
drop view if exists LB.stage.fact_energy_revenue__dbt_tmp cascade
[0m12:27:47.312592 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.218 seconds
[0m12:27:47.315475 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: Close
[0m12:27:47.413877 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4fb3b61b-66b9-433f-9865-9e5e9f6ee70b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16aa938d0>]}
[0m12:27:47.415037 [info ] [Thread-1 (]: 4 of 4 OK created sql incremental model stage.fact_energy_revenue .............. [[32mSUCCESS 1[0m in 2.97s]
[0m12:27:47.415950 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m12:27:47.417267 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:27:47.417785 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_energy_revenue' was properly closed.
[0m12:27:47.418366 [info ] [MainThread]: 
[0m12:27:47.418876 [info ] [MainThread]: Finished running 3 view models, 1 incremental model in 0 hours 0 minutes and 9.88 seconds (9.88s).
[0m12:27:47.420413 [debug] [MainThread]: Command end result
[0m12:27:47.443596 [info ] [MainThread]: 
[0m12:27:47.443885 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:27:47.444033 [info ] [MainThread]: 
[0m12:27:47.444177 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m12:27:47.445836 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.945663, "process_user_time": 2.576774, "process_kernel_time": 1.61352, "process_mem_max_rss": "192020480", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:27:47.446136 [debug] [MainThread]: Command `dbt run` succeeded at 12:27:47.446101 after 10.95 seconds
[0m12:27:47.446367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14db43a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1021ead10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ac42810>]}
[0m12:27:47.446512 [debug] [MainThread]: Flushing usage events
[0m12:33:32.103203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e65a950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e6bd090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e6bd690>]}


============================== 12:33:32.105939 | ece1d28e-7ae5-4550-9c47-08b5ac942676 ==============================
[0m12:33:32.105939 [info ] [MainThread]: Running with dbt=1.8.0
[0m12:33:32.106260 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/poc/lb_project/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --full-refresh', 'send_anonymous_usage_stats': 'True'}
[0m12:33:32.852886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ece1d28e-7ae5-4550-9c47-08b5ac942676', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x162845150>]}
[0m12:33:32.875583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ece1d28e-7ae5-4550-9c47-08b5ac942676', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12defca50>]}
[0m12:33:32.876579 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m12:33:32.896494 [debug] [MainThread]: checksum: dbb12d416fdb55e3665e4828703bbedf40c5c90ed7ca6ff39bbbfb29b12b0a92, vars: {}, profile: , target: , version: 1.8.0
[0m12:33:32.972777 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:33:32.973129 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/fact_energy_revenue.sql
[0m12:33:33.107614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ece1d28e-7ae5-4550-9c47-08b5ac942676', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167fa7210>]}
[0m12:33:33.155506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ece1d28e-7ae5-4550-9c47-08b5ac942676', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167fd6090>]}
[0m12:33:33.155833 [info ] [MainThread]: Found 4 models, 3 sources, 563 macros
[0m12:33:33.156001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ece1d28e-7ae5-4550-9c47-08b5ac942676', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167e13690>]}
[0m12:33:33.156909 [info ] [MainThread]: 
[0m12:33:33.157200 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:33:33.159403 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m12:33:33.167413 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m12:33:33.167707 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m12:33:33.167842 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:33:33.652408 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.485 seconds
[0m12:33:33.653400 [debug] [ThreadPool]: On list_LB: Close
[0m12:33:33.759300 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m12:33:33.777365 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m12:33:33.777624 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m12:33:33.777755 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:33:34.204635 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.427 seconds
[0m12:33:34.205941 [debug] [ThreadPool]: On list_LB_stage: Close
[0m12:33:34.315616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ece1d28e-7ae5-4550-9c47-08b5ac942676', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x167e91450>]}
[0m12:33:34.316015 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:33:34.316176 [info ] [MainThread]: 
[0m12:33:34.317872 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m12:33:34.318175 [info ] [Thread-1 (]: 1 of 4 START sql view model stage.stg_contract ................................. [RUN]
[0m12:33:34.318391 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m12:33:34.318532 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m12:33:34.322455 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:33:34.323130 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m12:33:34.340958 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m12:33:34.342363 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m12:33:34.342611 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

WITH ranked_contracts AS (
    SELECT
        id::INTEGER AS id,
        type::VARCHAR(50) AS type,
        energy::VARCHAR(50) AS energy,
        usage::FLOAT AS usage,
        usagenet::FLOAT AS usagenet,
        createdat::TIMESTAMP AS createdat,
        startdate::DATE AS startdate,
        enddate::DATE AS enddate,
        city::VARCHAR(100) AS city,
        status::VARCHAR(50) AS status,
        productid::INTEGER AS productid,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                type,
                energy,
                usage,
                usagenet,
                createdat,
                startdate,
                enddate,
                city,
                status,
                productid
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.contract
)

SELECT
    id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM ranked_contracts
WHERE row_num = 1
  );
[0m12:33:34.342893 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:33:35.042346 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.699 seconds
[0m12:33:35.052621 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m12:33:35.173532 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ece1d28e-7ae5-4550-9c47-08b5ac942676', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x164fd43d0>]}
[0m12:33:35.174116 [info ] [Thread-1 (]: 1 of 4 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.85s]
[0m12:33:35.174533 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m12:33:35.174838 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m12:33:35.175042 [info ] [Thread-1 (]: 2 of 4 START sql view model stage.stg_prices ................................... [RUN]
[0m12:33:35.175239 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m12:33:35.175381 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m12:33:35.178258 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:33:35.178815 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m12:33:35.180055 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m12:33:35.180913 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m12:33:35.181127 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    

WITH ranked_prices AS (
    SELECT
        id::INTEGER AS id,
        productid::INTEGER AS productid,
        pricecomponentid::INTEGER AS pricecomponentid,
        productcomponent::VARCHAR(50) AS productcomponent,
        price::FLOAT AS price,
        unit::VARCHAR(20) AS unit,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productid,
                pricecomponentid,
                productcomponent
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.prices
)

SELECT
    id,
    productid,
    pricecomponentid,
    productcomponent,
    price,
    unit,
    modificationdate
FROM ranked_prices
WHERE row_num = 1
  );
[0m12:33:35.181291 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:33:35.887195 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.706 seconds
[0m12:33:35.890464 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m12:33:36.043095 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ece1d28e-7ae5-4550-9c47-08b5ac942676', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168428b50>]}
[0m12:33:36.044131 [info ] [Thread-1 (]: 2 of 4 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.87s]
[0m12:33:36.044788 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m12:33:36.045254 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m12:33:36.045904 [info ] [Thread-1 (]: 3 of 4 START sql view model stage.stg_products ................................. [RUN]
[0m12:33:36.046661 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m12:33:36.047116 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m12:33:36.054242 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m12:33:36.055461 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m12:33:36.058129 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m12:33:36.059015 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m12:33:36.059211 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    

WITH ranked_products AS (
    SELECT
        id::INTEGER AS productid,
        productcode::VARCHAR(50) AS productcode,
        productname::VARCHAR(100) AS productname,
        energy::VARCHAR(50) AS energy,
        consumptiontype::VARCHAR(50) AS consumptiontype,
        deleted::BOOLEAN AS deleted,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productcode,
                productname,
                energy,
                consumptiontype
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.products
)

SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    deleted,
    modificationdate
FROM ranked_products
WHERE row_num = 1
  );
[0m12:33:36.059380 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:33:36.569763 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.510 seconds
[0m12:33:36.572912 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m12:33:36.680464 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ece1d28e-7ae5-4550-9c47-08b5ac942676', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168484cd0>]}
[0m12:33:36.681439 [info ] [Thread-1 (]: 3 of 4 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.63s]
[0m12:33:36.682074 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m12:33:36.683548 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m12:33:36.684382 [info ] [Thread-1 (]: 4 of 4 START sql incremental model stage.fact_energy_revenue ................... [RUN]
[0m12:33:36.685063 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_energy_revenue)
[0m12:33:36.685479 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_revenue
[0m12:33:36.690671 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m12:33:36.691627 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_revenue
[0m12:33:36.712949 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m12:33:36.714127 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m12:33:36.714335 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
create or replace transient table LB.stage.fact_energy_revenue
         as
        (

WITH latest_contracts AS (
    SELECT
        id AS contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        city,
        status,
        productid,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY id
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_contract
    WHERE type = 'energy' AND energy = 'electricity'
),
latest_products AS (
    SELECT
        productid,
        productcode,
        productname,
        energy,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY productid
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_products
    WHERE productcode = 'energy' AND energy = 'electricity'
),
latest_prices AS (
    SELECT
        productid,
        MAX(CASE WHEN productcomponent = 'baseprice' THEN price ELSE NULL END) AS baseprice,
        MAX(CASE WHEN productcomponent = 'workingprice' THEN price ELSE NULL END) AS workingprice
    FROM LB.stage.stg_prices
    GROUP BY productid
)

SELECT
    c.contract_id,
    c.type,
    c.energy,
    c.usage AS verbrauch,
    c.usagenet,
    c.createdat,
    c.startdate,
    c.enddate,
    c.city,
    c.status,
    c.productid,
    p.productcode,
    p.productname,
    lp.baseprice AS grundpreis,
    lp.workingprice AS arbeitspreis,
    (lp.baseprice + c.usage * lp.workingprice) AS revenue,
    c.modificationdate
FROM latest_contracts c
JOIN latest_products p ON c.productid = p.productid
JOIN latest_prices lp ON c.productid = lp.productid
WHERE c.row_num = 1 AND p.row_num = 1
        );
[0m12:33:36.714523 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:33:38.834484 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.119 seconds
[0m12:33:38.848521 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_revenue__dbt_tmp
[0m12:33:38.851383 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m12:33:38.851561 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.0", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
drop view if exists LB.stage.fact_energy_revenue__dbt_tmp cascade
[0m12:33:38.923764 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.072 seconds
[0m12:33:38.927189 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: Close
[0m12:33:39.031850 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ece1d28e-7ae5-4550-9c47-08b5ac942676', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x164fab8d0>]}
[0m12:33:39.034310 [info ] [Thread-1 (]: 4 of 4 OK created sql incremental model stage.fact_energy_revenue .............. [[32mSUCCESS 1[0m in 2.34s]
[0m12:33:39.035983 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m12:33:39.041816 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:33:39.042661 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_energy_revenue' was properly closed.
[0m12:33:39.043419 [info ] [MainThread]: 
[0m12:33:39.043859 [info ] [MainThread]: Finished running 3 view models, 1 incremental model in 0 hours 0 minutes and 5.89 seconds (5.89s).
[0m12:33:39.044671 [debug] [MainThread]: Command end result
[0m12:33:39.069221 [info ] [MainThread]: 
[0m12:33:39.069510 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:33:39.069655 [info ] [MainThread]: 
[0m12:33:39.069815 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m12:33:39.071779 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.014318, "process_user_time": 2.611702, "process_kernel_time": 1.555615, "process_mem_max_rss": "201818112", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:33:39.072157 [debug] [MainThread]: Command `dbt run` succeeded at 12:33:39.072116 after 7.01 seconds
[0m12:33:39.072407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e69cd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e69c4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f78710>]}
[0m12:33:39.072562 [debug] [MainThread]: Flushing usage events
[0m16:38:02.186539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ea70ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12eaa1ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12eaa24d0>]}


============================== 16:38:02.202673 | 67a60486-de04-4ec4-ae36-a207deb543a4 ==============================
[0m16:38:02.202673 [info ] [MainThread]: Running with dbt=1.8.3
[0m16:38:02.203078 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/hometask_lb/dbt_airflow_snowflake/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/hometask_lb/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:38:10.974865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a464a10>]}
[0m16:38:10.999329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128d08190>]}
[0m16:38:11.000105 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m16:38:11.055296 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m16:38:11.140726 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m16:38:11.141741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fb7f4d0>]}
[0m16:38:11.947235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b593c10>]}
[0m16:38:11.992912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b95a9d0>]}
[0m16:38:11.993188 [info ] [MainThread]: Found 4 models, 3 sources, 563 macros
[0m16:38:11.993351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b8d7b50>]}
[0m16:38:11.994207 [info ] [MainThread]: 
[0m16:38:11.994457 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:38:11.996406 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m16:38:12.002840 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m16:38:12.003040 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m16:38:12.003175 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:38:12.631440 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.628 seconds
[0m16:38:12.633697 [debug] [ThreadPool]: On list_LB: Close
[0m16:38:12.743373 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m16:38:12.747900 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m16:38:12.748107 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m16:38:12.748238 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:38:13.244282 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.496 seconds
[0m16:38:13.247542 [debug] [ThreadPool]: On list_LB_stage: Close
[0m16:38:13.857163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b467850>]}
[0m16:38:13.858207 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:38:13.858844 [info ] [MainThread]: 
[0m16:38:13.862027 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m16:38:13.862911 [info ] [Thread-1 (]: 1 of 4 START sql view model stage.stg_contract ................................. [RUN]
[0m16:38:13.863520 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m16:38:13.863945 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m16:38:13.877117 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m16:38:13.878436 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m16:38:13.928287 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m16:38:13.929820 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m16:38:13.930058 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

WITH ranked_contracts AS (
    SELECT
        id::INTEGER AS id,
        type::VARCHAR(50) AS type,
        energy::VARCHAR(50) AS energy,
        usage::FLOAT AS usage,
        usagenet::FLOAT AS usagenet,
        createdat::TIMESTAMP AS createdat,
        startdate::DATE AS startdate,
        enddate::DATE AS enddate,
        city::VARCHAR(100) AS city,
        status::VARCHAR(50) AS status,
        productid::INTEGER AS productid,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                type,
                energy,
                usage,
                usagenet,
                createdat,
                startdate,
                enddate,
                city,
                status,
                productid
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.contract
)

SELECT
    id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM ranked_contracts
WHERE row_num = 1
  );
[0m16:38:13.930559 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:38:14.466173 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.535 seconds
[0m16:38:14.487314 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m16:38:14.638996 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc6e8d0>]}
[0m16:38:14.639981 [info ] [Thread-1 (]: 1 of 4 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.77s]
[0m16:38:14.640640 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m16:38:14.641143 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m16:38:14.641844 [info ] [Thread-1 (]: 2 of 4 START sql view model stage.stg_prices ................................... [RUN]
[0m16:38:14.642442 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m16:38:14.642868 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m16:38:14.647683 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m16:38:14.648678 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m16:38:14.652786 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m16:38:14.653881 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m16:38:14.654115 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    

WITH ranked_prices AS (
    SELECT
        id::INTEGER AS id,
        productid::INTEGER AS productid,
        pricecomponentid::INTEGER AS pricecomponentid,
        productcomponent::VARCHAR(50) AS productcomponent,
        price::FLOAT AS price,
        unit::VARCHAR(20) AS unit,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productid,
                pricecomponentid,
                productcomponent
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.prices
)

SELECT
    id,
    productid,
    pricecomponentid,
    productcomponent,
    price,
    unit,
    modificationdate
FROM ranked_prices
WHERE row_num = 1
  );
[0m16:38:14.654300 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:38:15.286810 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.632 seconds
[0m16:38:15.290156 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m16:38:15.408045 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b74ef90>]}
[0m16:38:15.409142 [info ] [Thread-1 (]: 2 of 4 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.77s]
[0m16:38:15.410042 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m16:38:15.410685 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m16:38:15.411513 [info ] [Thread-1 (]: 3 of 4 START sql view model stage.stg_products ................................. [RUN]
[0m16:38:15.412313 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m16:38:15.412889 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m16:38:15.417708 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m16:38:15.418536 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m16:38:15.422077 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m16:38:15.423080 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m16:38:15.423281 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    

WITH ranked_products AS (
    SELECT
        id::INTEGER AS productid,
        productcode::VARCHAR(50) AS productcode,
        productname::VARCHAR(100) AS productname,
        energy::VARCHAR(50) AS energy,
        consumptiontype::VARCHAR(50) AS consumptiontype,
        deleted::BOOLEAN AS deleted,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productcode,
                productname,
                energy,
                consumptiontype
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.products
)

SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    deleted,
    modificationdate
FROM ranked_products
WHERE row_num = 1
  );
[0m16:38:15.423457 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:38:16.104622 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.681 seconds
[0m16:38:16.107654 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m16:38:16.222061 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b6a7510>]}
[0m16:38:16.223064 [info ] [Thread-1 (]: 3 of 4 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.81s]
[0m16:38:16.223801 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m16:38:16.225008 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m16:38:16.225586 [info ] [Thread-1 (]: 4 of 4 START sql incremental model stage.fact_energy_revenue ................... [RUN]
[0m16:38:16.226111 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_energy_revenue)
[0m16:38:16.226521 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_revenue
[0m16:38:16.231645 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m16:38:16.232694 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_revenue
[0m16:38:16.259564 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m16:38:16.260100 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
create or replace  temporary view LB.stage.fact_energy_revenue__dbt_tmp
  
   as (
    

WITH latest_contracts AS (
    SELECT
        id AS contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        city,
        status,
        productid,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY id
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_contract
    WHERE type = 'energy' AND energy = 'electricity'
),
latest_products AS (
    SELECT
        productid,
        productcode,
        productname,
        energy,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY productid
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_products
    WHERE productcode = 'energy' AND energy = 'electricity'
),
latest_prices AS (
    SELECT
        productid,
        MAX(CASE WHEN productcomponent = 'baseprice' THEN price ELSE NULL END) AS baseprice,
        MAX(CASE WHEN productcomponent = 'workingprice' THEN price ELSE NULL END) AS workingprice
    FROM LB.stage.stg_prices
    GROUP BY productid
)

SELECT
    c.contract_id,
    c.type,
    c.energy,
    c.usage AS verbrauch,
    c.usagenet,
    c.createdat,
    c.startdate,
    c.enddate,
    c.city,
    c.status,
    c.productid,
    p.productcode,
    p.productname,
    lp.baseprice AS grundpreis,
    lp.workingprice AS arbeitspreis,
    (lp.baseprice + c.usage * lp.workingprice) AS revenue,
    c.modificationdate
FROM latest_contracts c
JOIN latest_products p ON c.productid = p.productid
JOIN latest_prices lp ON c.productid = lp.productid
WHERE c.row_num = 1 AND p.row_num = 1
  );
[0m16:38:16.260398 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:38:16.924678 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.664 seconds
[0m16:38:16.936685 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m16:38:16.937232 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
describe table LB.stage.fact_energy_revenue__dbt_tmp
[0m16:38:17.021282 [debug] [Thread-1 (]: SQL status: SUCCESS 17 in 0.084 seconds
[0m16:38:17.023593 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m16:38:17.023803 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
describe table LB.stage.fact_energy_revenue
[0m16:38:17.103746 [debug] [Thread-1 (]: SQL status: SUCCESS 17 in 0.080 seconds
[0m16:38:17.107990 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m16:38:17.108198 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
describe table "LB"."STAGE"."FACT_ENERGY_REVENUE"
[0m16:38:17.174638 [debug] [Thread-1 (]: SQL status: SUCCESS 17 in 0.066 seconds
[0m16:38:17.191525 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m16:38:17.192514 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m16:38:17.192676 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
-- back compat for old kwarg name
  
  begin;
[0m16:38:17.314402 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.121 seconds
[0m16:38:17.314957 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m16:38:17.315373 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
merge into LB.stage.fact_energy_revenue as DBT_INTERNAL_DEST
        using LB.stage.fact_energy_revenue__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                DBT_INTERNAL_SOURCE.contract_id = DBT_INTERNAL_DEST.contract_id
            )

    
    when matched then update set
        "CONTRACT_ID" = DBT_INTERNAL_SOURCE."CONTRACT_ID","TYPE" = DBT_INTERNAL_SOURCE."TYPE","ENERGY" = DBT_INTERNAL_SOURCE."ENERGY","VERBRAUCH" = DBT_INTERNAL_SOURCE."VERBRAUCH","USAGENET" = DBT_INTERNAL_SOURCE."USAGENET","CREATEDAT" = DBT_INTERNAL_SOURCE."CREATEDAT","STARTDATE" = DBT_INTERNAL_SOURCE."STARTDATE","ENDDATE" = DBT_INTERNAL_SOURCE."ENDDATE","CITY" = DBT_INTERNAL_SOURCE."CITY","STATUS" = DBT_INTERNAL_SOURCE."STATUS","PRODUCTID" = DBT_INTERNAL_SOURCE."PRODUCTID","PRODUCTCODE" = DBT_INTERNAL_SOURCE."PRODUCTCODE","PRODUCTNAME" = DBT_INTERNAL_SOURCE."PRODUCTNAME","GRUNDPREIS" = DBT_INTERNAL_SOURCE."GRUNDPREIS","ARBEITSPREIS" = DBT_INTERNAL_SOURCE."ARBEITSPREIS","REVENUE" = DBT_INTERNAL_SOURCE."REVENUE","MODIFICATIONDATE" = DBT_INTERNAL_SOURCE."MODIFICATIONDATE"
    

    when not matched then insert
        ("CONTRACT_ID", "TYPE", "ENERGY", "VERBRAUCH", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "CITY", "STATUS", "PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "GRUNDPREIS", "ARBEITSPREIS", "REVENUE", "MODIFICATIONDATE")
    values
        ("CONTRACT_ID", "TYPE", "ENERGY", "VERBRAUCH", "USAGENET", "CREATEDAT", "STARTDATE", "ENDDATE", "CITY", "STATUS", "PRODUCTID", "PRODUCTCODE", "PRODUCTNAME", "GRUNDPREIS", "ARBEITSPREIS", "REVENUE", "MODIFICATIONDATE")

;
[0m16:38:19.158308 [debug] [Thread-1 (]: SQL status: SUCCESS 30724 in 1.842 seconds
[0m16:38:19.159825 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m16:38:19.160798 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
COMMIT
[0m16:38:19.484616 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.323 seconds
[0m16:38:19.499806 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_revenue__dbt_tmp
[0m16:38:19.504013 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m16:38:19.504253 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
drop view if exists LB.stage.fact_energy_revenue__dbt_tmp cascade
[0m16:38:19.649093 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.144 seconds
[0m16:38:19.653442 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: Close
[0m16:38:19.758455 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67a60486-de04-4ec4-ae36-a207deb543a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16b6a7510>]}
[0m16:38:19.759861 [info ] [Thread-1 (]: 4 of 4 OK created sql incremental model stage.fact_energy_revenue .............. [[32mSUCCESS 30724[0m in 3.53s]
[0m16:38:19.761017 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m16:38:19.763217 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:38:19.763677 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_energy_revenue' was properly closed.
[0m16:38:19.764217 [info ] [MainThread]: 
[0m16:38:19.764661 [info ] [MainThread]: Finished running 3 view models, 1 incremental model in 0 hours 0 minutes and 7.77 seconds (7.77s).
[0m16:38:19.766082 [debug] [MainThread]: Command end result
[0m16:38:19.803830 [info ] [MainThread]: 
[0m16:38:19.804233 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:38:19.804519 [info ] [MainThread]: 
[0m16:38:19.804795 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:38:19.882941 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 17.730488, "process_user_time": 4.073714, "process_kernel_time": 0.910724, "process_mem_max_rss": "191692800", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:38:19.883798 [debug] [MainThread]: Command `dbt run` succeeded at 16:38:19.883699 after 17.73 seconds
[0m16:38:19.884279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103228e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129df4e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103459550>]}
[0m16:38:19.884526 [debug] [MainThread]: Flushing usage events
[0m18:18:30.326861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e11b890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e1917d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e191d90>]}


============================== 18:18:30.330348 | 2cff4a9e-f5b3-4ca4-a304-d2961979df4d ==============================
[0m18:18:30.330348 [info ] [MainThread]: Running with dbt=1.8.3
[0m18:18:30.330669 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/srinivasuluchalla/hometask_lb/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/srinivasuluchalla/hometask_lb/dbt_airflow_snowflake/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --full-refresh', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:18:31.101745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2cff4a9e-f5b3-4ca4-a304-d2961979df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143225490>]}
[0m18:18:31.124476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2cff4a9e-f5b3-4ca4-a304-d2961979df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e1ce410>]}
[0m18:18:31.125064 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:18:31.144237 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m18:18:31.206457 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:18:31.206695 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:18:31.221518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2cff4a9e-f5b3-4ca4-a304-d2961979df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec1ddd0>]}
[0m18:18:31.267063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2cff4a9e-f5b3-4ca4-a304-d2961979df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143480350>]}
[0m18:18:31.267332 [info ] [MainThread]: Found 4 models, 3 sources, 563 macros
[0m18:18:31.267490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2cff4a9e-f5b3-4ca4-a304-d2961979df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14338e450>]}
[0m18:18:31.268397 [info ] [MainThread]: 
[0m18:18:31.268666 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:18:31.270995 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:18:31.278240 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:18:31.278525 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:18:31.278662 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:18:31.789809 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.511 seconds
[0m18:18:31.792510 [debug] [ThreadPool]: On list_LB: Close
[0m18:18:31.900934 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m18:18:31.905528 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:18:31.905719 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:18:31.905847 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:18:32.269882 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.364 seconds
[0m18:18:32.272575 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:18:32.392162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2cff4a9e-f5b3-4ca4-a304-d2961979df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143314110>]}
[0m18:18:32.393299 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:18:32.393941 [info ] [MainThread]: 
[0m18:18:32.396692 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m18:18:32.397394 [info ] [Thread-1 (]: 1 of 4 START sql view model stage.stg_contract ................................. [RUN]
[0m18:18:32.397952 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m18:18:32.398390 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m18:18:32.406714 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m18:18:32.407182 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m18:18:32.421768 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m18:18:32.422752 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m18:18:32.422951 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

WITH ranked_contracts AS (
    SELECT
        id::INTEGER AS id,
        type::VARCHAR(50) AS type,
        energy::VARCHAR(50) AS energy,
        usage::FLOAT AS usage,
        usagenet::FLOAT AS usagenet,
        createdat::TIMESTAMP AS createdat,
        startdate::DATE AS startdate,
        enddate::DATE AS enddate,
        city::VARCHAR(100) AS city,
        status::VARCHAR(50) AS status,
        productid::INTEGER AS productid,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                type,
                energy,
                usage,
                usagenet,
                createdat,
                startdate,
                enddate,
                city,
                status,
                productid
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.contract
)

SELECT
    id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM ranked_contracts
WHERE row_num = 1
  );
[0m18:18:32.423123 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:18:33.188462 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.765 seconds
[0m18:18:33.212647 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m18:18:33.314698 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cff4a9e-f5b3-4ca4-a304-d2961979df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143611f90>]}
[0m18:18:33.315844 [info ] [Thread-1 (]: 1 of 4 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.92s]
[0m18:18:33.316810 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m18:18:33.317546 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m18:18:33.318354 [info ] [Thread-1 (]: 2 of 4 START sql view model stage.stg_prices ................................... [RUN]
[0m18:18:33.319090 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m18:18:33.319709 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m18:18:33.325277 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m18:18:33.326500 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m18:18:33.330931 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m18:18:33.332313 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m18:18:33.332599 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    

WITH ranked_prices AS (
    SELECT
        id::INTEGER AS id,
        productid::INTEGER AS productid,
        pricecomponentid::INTEGER AS pricecomponentid,
        productcomponent::VARCHAR(50) AS productcomponent,
        price::FLOAT AS price,
        unit::VARCHAR(20) AS unit,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productid,
                pricecomponentid,
                productcomponent
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.prices
)

SELECT
    id,
    productid,
    pricecomponentid,
    productcomponent,
    price,
    unit,
    modificationdate
FROM ranked_prices
WHERE row_num = 1
  );
[0m18:18:33.332835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:18:33.859509 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.526 seconds
[0m18:18:33.862697 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m18:18:33.974957 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cff4a9e-f5b3-4ca4-a304-d2961979df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ff98c50>]}
[0m18:18:33.975858 [info ] [Thread-1 (]: 2 of 4 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.66s]
[0m18:18:33.976870 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m18:18:33.977362 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m18:18:33.978006 [info ] [Thread-1 (]: 3 of 4 START sql view model stage.stg_products ................................. [RUN]
[0m18:18:33.978835 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m18:18:33.979210 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m18:18:33.984111 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m18:18:33.984908 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m18:18:33.988203 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m18:18:33.989721 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m18:18:33.990040 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    

WITH ranked_products AS (
    SELECT
        id::INTEGER AS productid,
        productcode::VARCHAR(50) AS productcode,
        productname::VARCHAR(100) AS productname,
        energy::VARCHAR(50) AS energy,
        consumptiontype::VARCHAR(50) AS consumptiontype,
        deleted::BOOLEAN AS deleted,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productcode,
                productname,
                energy,
                consumptiontype
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.products
)

SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    deleted,
    modificationdate
FROM ranked_products
WHERE row_num = 1
  );
[0m18:18:33.990224 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:18:34.620210 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.630 seconds
[0m18:18:34.627394 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m18:18:34.739705 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cff4a9e-f5b3-4ca4-a304-d2961979df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1436bfe90>]}
[0m18:18:34.740798 [info ] [Thread-1 (]: 3 of 4 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.76s]
[0m18:18:34.741495 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m18:18:34.742998 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m18:18:34.743604 [info ] [Thread-1 (]: 4 of 4 START sql incremental model stage.fact_energy_revenue ................... [RUN]
[0m18:18:34.744103 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_energy_revenue)
[0m18:18:34.744442 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_revenue
[0m18:18:34.752124 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m18:18:34.753081 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_revenue
[0m18:18:34.779645 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m18:18:34.781782 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m18:18:34.782056 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
create or replace transient table LB.stage.fact_energy_revenue
         as
        (

WITH latest_contracts AS (
    SELECT
        id AS contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        city,
        status,
        productid,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY id
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_contract
    WHERE type = 'energy' AND energy = 'electricity'
),
latest_products AS (
    SELECT
        productid,
        productcode,
        productname,
        energy,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY productid
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_products
    WHERE productcode = 'energy' AND energy = 'electricity'
),
latest_prices AS (
    SELECT
        productid,
        MAX(CASE WHEN productcomponent = 'baseprice' THEN price ELSE NULL END) AS baseprice,
        MAX(CASE WHEN productcomponent = 'workingprice' THEN price ELSE NULL END) AS workingprice
    FROM LB.stage.stg_prices
    GROUP BY productid
)

SELECT
    c.contract_id,
    c.type,
    c.energy,
    c.usage AS verbrauch,
    c.usagenet,
    c.createdat,
    c.startdate,
    c.enddate,
    c.city,
    c.status,
    c.productid,
    p.productcode,
    p.productname,
    lp.baseprice AS grundpreis,
    lp.workingprice AS arbeitspreis,
    (lp.baseprice + c.usage * lp.workingprice) AS revenue,
    c.modificationdate
FROM latest_contracts c
JOIN latest_products p ON c.productid = p.productid
JOIN latest_prices lp ON c.productid = lp.productid
WHERE c.row_num = 1 AND p.row_num = 1
        );
[0m18:18:34.782260 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:18:36.738760 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.954 seconds
[0m18:18:36.758323 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_revenue__dbt_tmp
[0m18:18:36.767020 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m18:18:36.767275 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
drop view if exists LB.stage.fact_energy_revenue__dbt_tmp cascade
[0m18:18:36.837675 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.070 seconds
[0m18:18:36.840139 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: Close
[0m18:18:36.934550 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2cff4a9e-f5b3-4ca4-a304-d2961979df4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143257410>]}
[0m18:18:36.935485 [info ] [Thread-1 (]: 4 of 4 OK created sql incremental model stage.fact_energy_revenue .............. [[32mSUCCESS 1[0m in 2.19s]
[0m18:18:36.936185 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m18:18:36.937962 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:18:36.938354 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_energy_revenue' was properly closed.
[0m18:18:36.938789 [info ] [MainThread]: 
[0m18:18:36.939135 [info ] [MainThread]: Finished running 3 view models, 1 incremental model in 0 hours 0 minutes and 5.67 seconds (5.67s).
[0m18:18:36.940106 [debug] [MainThread]: Command end result
[0m18:18:36.973124 [info ] [MainThread]: 
[0m18:18:36.973414 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:18:36.973559 [info ] [MainThread]: 
[0m18:18:36.973725 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:18:37.008721 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.7180557, "process_user_time": 2.578514, "process_kernel_time": 1.576094, "process_mem_max_rss": "197017600", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:18:37.009144 [debug] [MainThread]: Command `dbt run` succeeded at 18:18:37.009097 after 6.72 seconds
[0m18:18:37.009378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102dd4f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e1a2b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fcf1550>]}
[0m18:18:37.009544 [debug] [MainThread]: Flushing usage events
[0m18:46:07.426694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163e53710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1643c5b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1643c6150>]}


============================== 18:46:07.433729 | 57afd01a-1381-48d1-9b3b-7e4d197d25a0 ==============================
[0m18:46:07.433729 [info ] [MainThread]: Running with dbt=1.8.3
[0m18:46:07.435095 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/hometask_lb/dbt_airflow_snowflake/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/srinivasuluchalla/hometask_lb/dbt_airflow_snowflake/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --full-refresh', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m18:46:08.199477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '57afd01a-1381-48d1-9b3b-7e4d197d25a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x164280950>]}
[0m18:46:08.225860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '57afd01a-1381-48d1-9b3b-7e4d197d25a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163c08310>]}
[0m18:46:08.226665 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m18:46:08.244493 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m18:46:08.319749 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:46:08.320210 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/fact_energy_revenue.sql
[0m18:46:08.502677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '57afd01a-1381-48d1-9b3b-7e4d197d25a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1694241d0>]}
[0m18:46:08.566366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '57afd01a-1381-48d1-9b3b-7e4d197d25a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1691f84d0>]}
[0m18:46:08.567125 [info ] [MainThread]: Found 4 models, 3 sources, 563 macros
[0m18:46:08.567577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57afd01a-1381-48d1-9b3b-7e4d197d25a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1691d3290>]}
[0m18:46:08.569795 [info ] [MainThread]: 
[0m18:46:08.570554 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:46:08.574013 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m18:46:08.584711 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m18:46:08.585036 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m18:46:08.585193 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:46:09.065118 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.480 seconds
[0m18:46:09.067497 [debug] [ThreadPool]: On list_LB: Close
[0m18:46:09.230501 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m18:46:09.257576 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m18:46:09.257918 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m18:46:09.258095 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:46:09.707871 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.450 seconds
[0m18:46:09.709809 [debug] [ThreadPool]: On list_LB_stage: Close
[0m18:46:09.816918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '57afd01a-1381-48d1-9b3b-7e4d197d25a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16937ee50>]}
[0m18:46:09.818124 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:46:09.818698 [info ] [MainThread]: 
[0m18:46:09.822719 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m18:46:09.823497 [info ] [Thread-1 (]: 1 of 4 START sql view model stage.stg_contract ................................. [RUN]
[0m18:46:09.824280 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m18:46:09.824749 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m18:46:09.840599 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m18:46:09.841147 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m18:46:09.870517 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m18:46:09.872835 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m18:46:09.873545 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

WITH ranked_contracts AS (
    SELECT
        id::INTEGER AS id,
        type::VARCHAR(50) AS type,
        energy::VARCHAR(50) AS energy,
        usage::FLOAT AS usage,
        usagenet::FLOAT AS usagenet,
        createdat::TIMESTAMP AS createdat,
        startdate::DATE AS startdate,
        enddate::DATE AS enddate,
        city::VARCHAR(100) AS city,
        status::VARCHAR(50) AS status,
        productid::INTEGER AS productid,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                type,
                energy,
                usage,
                usagenet,
                createdat,
                startdate,
                enddate,
                city,
                status,
                productid
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.contract
)

SELECT
    id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM ranked_contracts
WHERE row_num = 1
  );
[0m18:46:09.874149 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:46:10.317510 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.442 seconds
[0m18:46:10.346507 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m18:46:10.460990 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57afd01a-1381-48d1-9b3b-7e4d197d25a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1693a3310>]}
[0m18:46:10.461800 [info ] [Thread-1 (]: 1 of 4 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.64s]
[0m18:46:10.462224 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m18:46:10.462486 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m18:46:10.463005 [info ] [Thread-1 (]: 2 of 4 START sql view model stage.stg_prices ................................... [RUN]
[0m18:46:10.463352 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m18:46:10.463538 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m18:46:10.466251 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m18:46:10.466817 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m18:46:10.468580 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m18:46:10.469472 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m18:46:10.469661 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    

WITH ranked_prices AS (
    SELECT
        id::INTEGER AS id,
        productid::INTEGER AS productid,
        pricecomponentid::INTEGER AS pricecomponentid,
        productcomponent::VARCHAR(50) AS productcomponent,
        price::FLOAT AS price,
        unit::VARCHAR(20) AS unit,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productid,
                pricecomponentid,
                productcomponent
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.prices
)

SELECT
    id,
    productid,
    pricecomponentid,
    productcomponent,
    price,
    unit,
    modificationdate
FROM ranked_prices
WHERE row_num = 1
  );
[0m18:46:10.469837 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:46:10.936539 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.466 seconds
[0m18:46:10.941608 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m18:46:11.074335 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57afd01a-1381-48d1-9b3b-7e4d197d25a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x162cdfd10>]}
[0m18:46:11.077650 [info ] [Thread-1 (]: 2 of 4 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.61s]
[0m18:46:11.079138 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m18:46:11.080288 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m18:46:11.081884 [info ] [Thread-1 (]: 3 of 4 START sql view model stage.stg_products ................................. [RUN]
[0m18:46:11.082567 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m18:46:11.083124 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m18:46:11.093676 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m18:46:11.095644 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m18:46:11.100886 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m18:46:11.103547 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m18:46:11.103836 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    

WITH ranked_products AS (
    SELECT
        id::INTEGER AS productid,
        productcode::VARCHAR(50) AS productcode,
        productname::VARCHAR(100) AS productname,
        energy::VARCHAR(50) AS energy,
        consumptiontype::VARCHAR(50) AS consumptiontype,
        deleted::BOOLEAN AS deleted,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productcode,
                productname,
                energy,
                consumptiontype
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.products
)

SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    deleted,
    modificationdate
FROM ranked_products
WHERE row_num = 1
  );
[0m18:46:11.104619 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:46:11.685627 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.581 seconds
[0m18:46:11.688911 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m18:46:11.789682 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57afd01a-1381-48d1-9b3b-7e4d197d25a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168fbea10>]}
[0m18:46:11.790594 [info ] [Thread-1 (]: 3 of 4 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.71s]
[0m18:46:11.791190 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m18:46:11.793120 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m18:46:11.793852 [info ] [Thread-1 (]: 4 of 4 START sql incremental model stage.fact_energy_revenue ................... [RUN]
[0m18:46:11.794344 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_energy_revenue)
[0m18:46:11.794668 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_revenue
[0m18:46:11.800734 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m18:46:11.802291 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_revenue
[0m18:46:11.841422 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m18:46:11.842847 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m18:46:11.843076 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
create or replace transient table LB.stage.fact_energy_revenue
         as
        (

WITH latest_contracts AS (
    SELECT
        id AS contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        city,
        status,
        productid,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY id
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_contract
),
latest_products AS (
    SELECT
        productid,
        productcode,
        productname,
        energy,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY productid
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_products
),
latest_prices AS (
    SELECT
        productid,
        MAX(CASE WHEN productcomponent = 'baseprice' THEN price ELSE NULL END) AS baseprice,
        MAX(CASE WHEN productcomponent = 'workingprice' THEN price ELSE NULL END) AS workingprice
    FROM LB.stage.stg_prices
    GROUP BY productid
)

SELECT
    c.contract_id,
    c.type,
    c.energy,
    c.usage AS verbrauch,
    c.usagenet,
    c.createdat,
    c.startdate,
    c.enddate,
    c.city,
    c.status,
    c.productid,
    p.productcode,
    p.productname,
    lp.baseprice AS grundpreis,
    lp.workingprice AS arbeitspreis,
    (lp.baseprice + c.usage * lp.workingprice) AS revenue,
    c.modificationdate
FROM latest_contracts c
JOIN latest_products p ON c.productid = p.productid
JOIN latest_prices lp ON c.productid = lp.productid
WHERE c.row_num = 1 AND p.row_num = 1
        );
[0m18:46:11.843307 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:46:13.445906 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.602 seconds
[0m18:46:13.460140 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_revenue__dbt_tmp
[0m18:46:13.468106 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m18:46:13.468539 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
drop view if exists LB.stage.fact_energy_revenue__dbt_tmp cascade
[0m18:46:13.563750 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.095 seconds
[0m18:46:13.566257 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: Close
[0m18:46:13.669979 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '57afd01a-1381-48d1-9b3b-7e4d197d25a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16273ef10>]}
[0m18:46:13.671522 [info ] [Thread-1 (]: 4 of 4 OK created sql incremental model stage.fact_energy_revenue .............. [[32mSUCCESS 1[0m in 1.88s]
[0m18:46:13.672275 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m18:46:13.674021 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:46:13.674361 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_energy_revenue' was properly closed.
[0m18:46:13.674753 [info ] [MainThread]: 
[0m18:46:13.675156 [info ] [MainThread]: Finished running 3 view models, 1 incremental model in 0 hours 0 minutes and 5.10 seconds (5.10s).
[0m18:46:13.676858 [debug] [MainThread]: Command end result
[0m18:46:13.706047 [info ] [MainThread]: 
[0m18:46:13.706332 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:46:13.706475 [info ] [MainThread]: 
[0m18:46:13.706633 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:46:13.708506 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.3312235, "process_user_time": 3.153626, "process_kernel_time": 1.891896, "process_mem_max_rss": "197722112", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:46:13.708933 [debug] [MainThread]: Command `dbt run` succeeded at 18:46:13.708882 after 6.33 seconds
[0m18:46:13.709209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1009a0f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100ae1450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a40ed0>]}
[0m18:46:13.709375 [debug] [MainThread]: Flushing usage events
[0m20:36:45.949530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136d57bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136db9e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136dba410>]}


============================== 20:36:45.956949 | 9620a77d-c168-47aa-ba5e-fa9021dab14e ==============================
[0m20:36:45.956949 [info ] [MainThread]: Running with dbt=1.8.3
[0m20:36:45.957406 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/hometask_lb/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/hometask_lb/dbt_airflow_snowflake/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --full-refresh', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:36:47.104630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9620a77d-c168-47aa-ba5e-fa9021dab14e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a6da6d0>]}
[0m20:36:47.141221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9620a77d-c168-47aa-ba5e-fa9021dab14e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a782d50>]}
[0m20:36:47.141960 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:36:47.185197 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m20:36:47.268037 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:36:47.268429 [debug] [MainThread]: Partial parsing: updated file: snowflake_airflow_dbt://models/staging/fact_energy_revenue.sql
[0m20:36:47.445436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9620a77d-c168-47aa-ba5e-fa9021dab14e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bdf6a10>]}
[0m20:36:47.516188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9620a77d-c168-47aa-ba5e-fa9021dab14e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a8fa690>]}
[0m20:36:47.516514 [info ] [MainThread]: Found 4 models, 3 sources, 563 macros
[0m20:36:47.516680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9620a77d-c168-47aa-ba5e-fa9021dab14e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a8ecf90>]}
[0m20:36:47.517736 [info ] [MainThread]: 
[0m20:36:47.518295 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:36:47.521704 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:36:47.529181 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:36:47.529476 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:36:47.529619 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:36:48.033513 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.504 seconds
[0m20:36:48.034633 [debug] [ThreadPool]: On list_LB: Close
[0m20:36:48.137319 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:36:48.142776 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:36:48.143053 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:36:48.143194 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:36:48.524054 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.381 seconds
[0m20:36:48.527120 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:36:48.636893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9620a77d-c168-47aa-ba5e-fa9021dab14e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127203550>]}
[0m20:36:48.637998 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:36:48.638449 [info ] [MainThread]: 
[0m20:36:48.641421 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m20:36:48.642196 [info ] [Thread-1 (]: 1 of 4 START sql view model stage.stg_contract ................................. [RUN]
[0m20:36:48.642690 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m20:36:48.643040 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m20:36:48.653317 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:36:48.654694 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m20:36:48.708875 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:36:48.710381 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:36:48.710906 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

WITH ranked_contracts AS (
    SELECT
        id::INTEGER AS id,
        type::VARCHAR(50) AS type,
        energy::VARCHAR(50) AS energy,
        usage::FLOAT AS usage,
        usagenet::FLOAT AS usagenet,
        createdat::TIMESTAMP AS createdat,
        startdate::DATE AS startdate,
        enddate::DATE AS enddate,
        city::VARCHAR(100) AS city,
        status::VARCHAR(50) AS status,
        productid::INTEGER AS productid,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                type,
                energy,
                usage,
                usagenet,
                createdat,
                startdate,
                enddate,
                city,
                status,
                productid
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.contract
)

SELECT
    id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM ranked_contracts
WHERE row_num = 1
  );
[0m20:36:48.711466 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:36:49.262650 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.551 seconds
[0m20:36:49.292158 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m20:36:49.411576 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9620a77d-c168-47aa-ba5e-fa9021dab14e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1360904d0>]}
[0m20:36:49.412505 [info ] [Thread-1 (]: 1 of 4 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.77s]
[0m20:36:49.413128 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m20:36:49.413547 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m20:36:49.414304 [info ] [Thread-1 (]: 2 of 4 START sql view model stage.stg_prices ................................... [RUN]
[0m20:36:49.415104 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m20:36:49.415669 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m20:36:49.420030 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:36:49.420979 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m20:36:49.424574 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:36:49.425843 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:36:49.426099 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    

WITH ranked_prices AS (
    SELECT
        id::INTEGER AS id,
        productid::INTEGER AS productid,
        pricecomponentid::INTEGER AS pricecomponentid,
        productcomponent::VARCHAR(50) AS productcomponent,
        price::FLOAT AS price,
        unit::VARCHAR(20) AS unit,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productid,
                pricecomponentid,
                productcomponent
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.prices
)

SELECT
    id,
    productid,
    pricecomponentid,
    productcomponent,
    price,
    unit,
    modificationdate
FROM ranked_prices
WHERE row_num = 1
  );
[0m20:36:49.426274 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:36:49.901255 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.475 seconds
[0m20:36:49.904032 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m20:36:50.006829 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9620a77d-c168-47aa-ba5e-fa9021dab14e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16a6a4610>]}
[0m20:36:50.008116 [info ] [Thread-1 (]: 2 of 4 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.59s]
[0m20:36:50.008962 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m20:36:50.010361 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m20:36:50.011868 [info ] [Thread-1 (]: 3 of 4 START sql view model stage.stg_products ................................. [RUN]
[0m20:36:50.012426 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m20:36:50.012893 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m20:36:50.022213 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m20:36:50.023464 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m20:36:50.026216 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m20:36:50.027516 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:36:50.027755 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    

WITH ranked_products AS (
    SELECT
        id::INTEGER AS productid,
        productcode::VARCHAR(50) AS productcode,
        productname::VARCHAR(100) AS productname,
        energy::VARCHAR(50) AS energy,
        consumptiontype::VARCHAR(50) AS consumptiontype,
        deleted::BOOLEAN AS deleted,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productcode,
                productname,
                energy,
                consumptiontype
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.products
)

SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    deleted,
    modificationdate
FROM ranked_products
WHERE row_num = 1
  );
[0m20:36:50.028051 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:36:50.540826 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.513 seconds
[0m20:36:50.543145 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m20:36:50.655127 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9620a77d-c168-47aa-ba5e-fa9021dab14e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136aae0d0>]}
[0m20:36:50.656288 [info ] [Thread-1 (]: 3 of 4 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.64s]
[0m20:36:50.656866 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m20:36:50.658024 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m20:36:50.658756 [info ] [Thread-1 (]: 4 of 4 START sql incremental model stage.fact_energy_revenue ................... [RUN]
[0m20:36:50.659411 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_energy_revenue)
[0m20:36:50.659876 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_revenue
[0m20:36:50.665180 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m20:36:50.666141 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_revenue
[0m20:36:50.689998 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m20:36:50.691140 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m20:36:50.691346 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
create or replace transient table LB.stage.fact_energy_revenue
         as
        (

WITH latest_contracts AS (
    SELECT
        id AS contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        city,
        status,
        productid,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY id
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_contract
),
latest_products AS (
    SELECT
        productid,
        productcode,
        productname,
        energy,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY productid
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_products
),
latest_prices AS (
    SELECT
        productid,
        MAX(CASE WHEN productcomponent = 'baseprice' THEN price ELSE NULL END) AS baseprice,
        MAX(CASE WHEN productcomponent = 'workingprice' THEN price ELSE NULL END) AS workingprice
    FROM LB.stage.stg_prices
    GROUP BY productid
)

SELECT
    c.contract_id,
    c.type,
    c.energy,
    c.usage AS verbrauch,
    c.usagenet,
    c.createdat,
    c.startdate,
    c.enddate,
    c.city,
    c.status,
    c.productid,
    p.productcode,
    p.productname,
    lp.baseprice AS grundpreis,
    lp.workingprice AS arbeitspreis,
    (lp.baseprice + c.usage * lp.workingprice) AS revenue,
    c.modificationdate
FROM latest_contracts c
LEFT JOIN latest_products p ON c.productid = p.productid
LEFT JOIN latest_prices lp ON c.productid = lp.productid
        );
[0m20:36:50.691526 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:36:53.287824 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.595 seconds
[0m20:36:53.312901 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_revenue__dbt_tmp
[0m20:36:53.318738 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m20:36:53.319038 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
drop view if exists LB.stage.fact_energy_revenue__dbt_tmp cascade
[0m20:36:53.406522 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.087 seconds
[0m20:36:53.409629 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: Close
[0m20:36:53.510058 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9620a77d-c168-47aa-ba5e-fa9021dab14e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f89c910>]}
[0m20:36:53.512392 [info ] [Thread-1 (]: 4 of 4 OK created sql incremental model stage.fact_energy_revenue .............. [[32mSUCCESS 1[0m in 2.85s]
[0m20:36:53.513312 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m20:36:53.515632 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:36:53.516165 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_energy_revenue' was properly closed.
[0m20:36:53.517887 [info ] [MainThread]: 
[0m20:36:53.520938 [info ] [MainThread]: Finished running 3 view models, 1 incremental model in 0 hours 0 minutes and 6.00 seconds (6.00s).
[0m20:36:53.522846 [debug] [MainThread]: Command end result
[0m20:36:53.561857 [info ] [MainThread]: 
[0m20:36:53.562357 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:36:53.562584 [info ] [MainThread]: 
[0m20:36:53.562932 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m20:36:53.565652 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.673449, "process_user_time": 2.768326, "process_kernel_time": 1.990452, "process_mem_max_rss": "189841408", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:36:53.566298 [debug] [MainThread]: Command `dbt run` succeeded at 20:36:53.566172 after 7.67 seconds
[0m20:36:53.566737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10449cf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045dd450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10453c5d0>]}
[0m20:36:53.567177 [debug] [MainThread]: Flushing usage events
[0m20:48:26.954123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1342188d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13426a7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13426b8d0>]}


============================== 20:48:26.956967 | 5c3cb453-e178-4449-ad8b-19da419ef461 ==============================
[0m20:48:26.956967 [info ] [MainThread]: Running with dbt=1.8.3
[0m20:48:26.957247 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/srinivasuluchalla/hometask_lb/dbt_airflow_snowflake/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/srinivasuluchalla/hometask_lb/dbt_airflow_snowflake/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --full-refresh', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:48:32.163248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c3cb453-e178-4449-ad8b-19da419ef461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141241cd0>]}
[0m20:48:32.318596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c3cb453-e178-4449-ad8b-19da419ef461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133a08250>]}
[0m20:48:32.322207 [info ] [MainThread]: Registered adapter: snowflake=1.8.3
[0m20:48:32.377969 [debug] [MainThread]: checksum: 30bd4080c2bc8dee5936f8f60083ffbe1c906859d0fd965607c2144031479456, vars: {}, profile: , target: , version: 1.8.3
[0m20:48:32.636671 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:48:32.637388 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:48:32.681502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c3cb453-e178-4449-ad8b-19da419ef461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14143eed0>]}
[0m20:48:33.473512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c3cb453-e178-4449-ad8b-19da419ef461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141481b50>]}
[0m20:48:33.475628 [info ] [MainThread]: Found 4 models, 3 sources, 563 macros
[0m20:48:33.476668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c3cb453-e178-4449-ad8b-19da419ef461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14138e950>]}
[0m20:48:33.482968 [info ] [MainThread]: 
[0m20:48:33.485093 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:48:33.494767 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_LB'
[0m20:48:33.523384 [debug] [ThreadPool]: Using snowflake connection "list_LB"
[0m20:48:33.524124 [debug] [ThreadPool]: On list_LB: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB"} */
show terse schemas in database LB
    limit 10000
[0m20:48:33.524634 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:48:34.419108 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.894 seconds
[0m20:48:34.424541 [debug] [ThreadPool]: On list_LB: Close
[0m20:48:34.540336 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_LB, now list_LB_stage)
[0m20:48:34.555040 [debug] [ThreadPool]: Using snowflake connection "list_LB_stage"
[0m20:48:34.555658 [debug] [ThreadPool]: On list_LB_stage: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_LB_stage"} */
show objects in LB.stage limit 10000
[0m20:48:34.556289 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:48:34.927179 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.371 seconds
[0m20:48:34.930829 [debug] [ThreadPool]: On list_LB_stage: Close
[0m20:48:35.080824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c3cb453-e178-4449-ad8b-19da419ef461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1320a0110>]}
[0m20:48:35.082978 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:48:35.083725 [info ] [MainThread]: 
[0m20:48:35.090758 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_contract
[0m20:48:35.091808 [info ] [Thread-1 (]: 1 of 4 START sql view model stage.stg_contract ................................. [RUN]
[0m20:48:35.092740 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_LB_stage, now model.snowflake_airflow_dbt.stg_contract)
[0m20:48:35.093456 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_contract
[0m20:48:35.108140 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:48:35.109961 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_contract
[0m20:48:35.153376 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_contract"
[0m20:48:35.158890 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_contract"
[0m20:48:35.160181 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_contract"} */
create or replace   view LB.stage.stg_contract
  
   as (
    

WITH ranked_contracts AS (
    SELECT
        id::INTEGER AS id,
        type::VARCHAR(50) AS type,
        energy::VARCHAR(50) AS energy,
        usage::FLOAT AS usage,
        usagenet::FLOAT AS usagenet,
        createdat::TIMESTAMP AS createdat,
        startdate::DATE AS startdate,
        enddate::DATE AS enddate,
        city::VARCHAR(100) AS city,
        status::VARCHAR(50) AS status,
        productid::INTEGER AS productid,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                type,
                energy,
                usage,
                usagenet,
                createdat,
                startdate,
                enddate,
                city,
                status,
                productid
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.contract
)

SELECT
    id,
    type,
    energy,
    usage,
    usagenet,
    createdat,
    startdate,
    enddate,
    city,
    status,
    productid,
    modificationdate
FROM ranked_contracts
WHERE row_num = 1
  );
[0m20:48:35.160481 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:48:35.668999 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.508 seconds
[0m20:48:35.705586 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_contract: Close
[0m20:48:35.831740 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c3cb453-e178-4449-ad8b-19da419ef461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141257250>]}
[0m20:48:35.832777 [info ] [Thread-1 (]: 1 of 4 OK created sql view model stage.stg_contract ............................ [[32mSUCCESS 1[0m in 0.74s]
[0m20:48:35.833178 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_contract
[0m20:48:35.833444 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_prices
[0m20:48:35.835377 [info ] [Thread-1 (]: 2 of 4 START sql view model stage.stg_prices ................................... [RUN]
[0m20:48:35.836013 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_contract, now model.snowflake_airflow_dbt.stg_prices)
[0m20:48:35.836443 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_prices
[0m20:48:35.841225 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:48:35.842487 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_prices
[0m20:48:35.846737 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_prices"
[0m20:48:35.849092 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_prices"
[0m20:48:35.849438 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_prices"} */
create or replace   view LB.stage.stg_prices
  
   as (
    

WITH ranked_prices AS (
    SELECT
        id::INTEGER AS id,
        productid::INTEGER AS productid,
        pricecomponentid::INTEGER AS pricecomponentid,
        productcomponent::VARCHAR(50) AS productcomponent,
        price::FLOAT AS price,
        unit::VARCHAR(20) AS unit,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productid,
                pricecomponentid,
                productcomponent
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.prices
)

SELECT
    id,
    productid,
    pricecomponentid,
    productcomponent,
    price,
    unit,
    modificationdate
FROM ranked_prices
WHERE row_num = 1
  );
[0m20:48:35.849806 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:48:36.406442 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.557 seconds
[0m20:48:36.408449 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_prices: Close
[0m20:48:36.517095 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c3cb453-e178-4449-ad8b-19da419ef461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141792050>]}
[0m20:48:36.518063 [info ] [Thread-1 (]: 2 of 4 OK created sql view model stage.stg_prices .............................. [[32mSUCCESS 1[0m in 0.68s]
[0m20:48:36.518507 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_prices
[0m20:48:36.518782 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.stg_products
[0m20:48:36.519053 [info ] [Thread-1 (]: 3 of 4 START sql view model stage.stg_products ................................. [RUN]
[0m20:48:36.519548 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_prices, now model.snowflake_airflow_dbt.stg_products)
[0m20:48:36.519729 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.stg_products
[0m20:48:36.522902 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.stg_products"
[0m20:48:36.523522 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.stg_products
[0m20:48:36.526591 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.stg_products"
[0m20:48:36.528007 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.stg_products"
[0m20:48:36.528292 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.stg_products"} */
create or replace   view LB.stage.stg_products
  
   as (
    

WITH ranked_products AS (
    SELECT
        id::INTEGER AS productid,
        productcode::VARCHAR(50) AS productcode,
        productname::VARCHAR(100) AS productname,
        energy::VARCHAR(50) AS energy,
        consumptiontype::VARCHAR(50) AS consumptiontype,
        deleted::BOOLEAN AS deleted,
        modificationdate::TIMESTAMP AS modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY
                id,
                productcode,
                productname,
                energy,
                consumptiontype
            ORDER BY
                modificationdate DESC
        ) AS row_num
    FROM lb.raw.products
)

SELECT
    productid,
    productcode,
    productname,
    energy,
    consumptiontype,
    deleted,
    modificationdate
FROM ranked_products
WHERE row_num = 1
  );
[0m20:48:36.528476 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:48:37.042131 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.513 seconds
[0m20:48:37.047743 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.stg_products: Close
[0m20:48:37.161515 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c3cb453-e178-4449-ad8b-19da419ef461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1416cdb10>]}
[0m20:48:37.162502 [info ] [Thread-1 (]: 3 of 4 OK created sql view model stage.stg_products ............................ [[32mSUCCESS 1[0m in 0.64s]
[0m20:48:37.163051 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.stg_products
[0m20:48:37.171707 [debug] [Thread-1 (]: Began running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m20:48:37.172335 [info ] [Thread-1 (]: 4 of 4 START sql incremental model stage.fact_energy_revenue ................... [RUN]
[0m20:48:37.172653 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.snowflake_airflow_dbt.stg_products, now model.snowflake_airflow_dbt.fact_energy_revenue)
[0m20:48:37.172818 [debug] [Thread-1 (]: Began compiling node model.snowflake_airflow_dbt.fact_energy_revenue
[0m20:48:37.177704 [debug] [Thread-1 (]: Writing injected SQL for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m20:48:37.178164 [debug] [Thread-1 (]: Began executing node model.snowflake_airflow_dbt.fact_energy_revenue
[0m20:48:37.212644 [debug] [Thread-1 (]: Writing runtime sql for node "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m20:48:37.218102 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m20:48:37.234815 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
create or replace transient table LB.stage.fact_energy_revenue
         as
        (

WITH latest_contracts AS (
    SELECT
        id AS contract_id,
        type,
        energy,
        usage,
        usagenet,
        createdat,
        startdate,
        enddate,
        city,
        status,
        productid,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY id
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_contract
),
latest_products AS (
    SELECT
        productid,
        productcode,
        productname,
        energy,
        modificationdate,
        ROW_NUMBER() OVER (
            PARTITION BY productid
            ORDER BY modificationdate DESC
        ) AS row_num
    FROM LB.stage.stg_products
),
latest_prices AS (
    SELECT
        productid,
        MAX(CASE WHEN productcomponent = 'baseprice' THEN price ELSE NULL END) AS baseprice,
        MAX(CASE WHEN productcomponent = 'workingprice' THEN price ELSE NULL END) AS workingprice
    FROM LB.stage.stg_prices
    GROUP BY productid
)

SELECT
    c.contract_id,
    c.type,
    c.energy,
    c.usage AS verbrauch,
    c.usagenet,
    c.createdat,
    c.startdate,
    c.enddate,
    c.city,
    c.status,
    c.productid,
    p.productcode,
    p.productname,
    lp.baseprice AS grundpreis,
    lp.workingprice AS arbeitspreis,
    (lp.baseprice + c.usage * lp.workingprice) AS revenue,
    c.modificationdate
FROM latest_contracts c
LEFT JOIN latest_products p ON c.productid = p.productid
LEFT JOIN latest_prices lp ON c.productid = lp.productid
        );
[0m20:48:37.236178 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:48:39.240994 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.004 seconds
[0m20:48:39.282138 [debug] [Thread-1 (]: Applying DROP to: LB.stage.fact_energy_revenue__dbt_tmp
[0m20:48:39.295123 [debug] [Thread-1 (]: Using snowflake connection "model.snowflake_airflow_dbt.fact_energy_revenue"
[0m20:48:39.295738 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: /* {"app": "dbt", "dbt_version": "1.8.3", "profile_name": "default", "target_name": "dev", "node_id": "model.snowflake_airflow_dbt.fact_energy_revenue"} */
drop view if exists LB.stage.fact_energy_revenue__dbt_tmp cascade
[0m20:48:39.373281 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.077 seconds
[0m20:48:39.379031 [debug] [Thread-1 (]: On model.snowflake_airflow_dbt.fact_energy_revenue: Close
[0m20:48:39.489878 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c3cb453-e178-4449-ad8b-19da419ef461', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1412c48d0>]}
[0m20:48:39.491720 [info ] [Thread-1 (]: 4 of 4 OK created sql incremental model stage.fact_energy_revenue .............. [[32mSUCCESS 1[0m in 2.32s]
[0m20:48:39.492662 [debug] [Thread-1 (]: Finished running node model.snowflake_airflow_dbt.fact_energy_revenue
[0m20:48:39.502224 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:48:39.502805 [debug] [MainThread]: Connection 'model.snowflake_airflow_dbt.fact_energy_revenue' was properly closed.
[0m20:48:39.503533 [info ] [MainThread]: 
[0m20:48:39.505054 [info ] [MainThread]: Finished running 3 view models, 1 incremental model in 0 hours 0 minutes and 6.02 seconds (6.02s).
[0m20:48:39.506374 [debug] [MainThread]: Command end result
[0m20:48:39.587760 [info ] [MainThread]: 
[0m20:48:39.589276 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:48:39.590122 [info ] [MainThread]: 
[0m20:48:39.590866 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m20:48:39.602246 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.6851, "process_user_time": 2.999452, "process_kernel_time": 2.124376, "process_mem_max_rss": "180748288", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:48:39.604329 [debug] [MainThread]: Command `dbt run` succeeded at 20:48:39.604084 after 12.69 seconds
[0m20:48:39.605796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c94f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102dd53d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d34fd0>]}
[0m20:48:39.606746 [debug] [MainThread]: Flushing usage events
